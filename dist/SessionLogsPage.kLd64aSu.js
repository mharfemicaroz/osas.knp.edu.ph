const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index.BnWmU6Nv.js","./index.v0QUZr3I.css"])))=>i.map(i=>d[i]);
import{O as L,r as c,c as T,o as V,A as P,l as p,q as S,f,e as r,d as U,g as v,h as u,M as y,v as m,a as B,F as D,B as I,t as w,C as E,k as R,aa as A}from"./index.BnWmU6Nv.js";import{ai as k,_ as O,a as q,M,L as N}from"./SectionMain.B49Qpy93.js";import{_ as K,a as z}from"./SectionTitleLineWithButton.DdXWgu1s.js";import{_ as F,B as j,a as H}from"./Badge.9BF3SPhK.js";import"./appContext.Dalh19VR.js";import"./activityDesignService.CKh20RdY.js";import"./utilizationRequestService.BnXptyaO.js";import"./liquidationFundService.DvfSXRTk.js";import"./ToasterComponent.C9vFw1wz.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const Q=L("sessionLog",()=>{const _=c({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),s=c(!1),a=c(null),g=c(!1),o=c(null);return{items:_,selected:o,isLoading:s,isLoaded:g,error:a,fetchAll:async(d={},l=!1)=>{if(a.value=null,!(!l&&g.value))try{s.value=!0;const e=await k.list(d);Object.assign(_.value,{total:e.total||0,totalPages:e.totalPages||1,currentPage:d.page||1,pageSize:d.limit||10,data:e.data||[]}),g.value=!0}catch(e){a.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to fetch session logs"}finally{s.value=!1}},fetchById:async d=>{a.value=null;try{s.value=!0;const l=await k.getById(d);return o.value=l,l}catch(l){throw a.value=l?.response?.data?.message||l?.response?.message||l?.message||"Failed to fetch session log",l}finally{s.value=!1}},resetStore:()=>{_.value={total:0,totalPages:1,currentPage:1,pageSize:10,data:[]},o.value=null,g.value=!1,s.value=!1,a.value=null}}}),W={class:"grid grid-cols-1 md:grid-cols-6 gap-2 mb-3 text-sm"},G=["value"],J={class:"flex justify-end"},X=["onClick"],de={__name:"SessionLogsPage",setup(_){const s=Q(),a=c({page:1,limit:10,q:"",method:"",status:"",user_id:"",user_role:"",ip:"",created_from:"",created_to:"",sort:"created_at",order:"DESC"}),g=T(()=>({total:s.items.total||0,totalPages:s.items.totalPages||1,currentPage:s.items.currentPage||1,pageSize:s.items.pageSize||10,data:s.items.data||[]})),o=async(l={},e=!0)=>{a.value={...a.value,...l};const t={...a.value};["q","method","status","user_id","user_role","ip","created_from","created_to","sort","order"].forEach(n=>{(t[n]===""||t[n]==null)&&delete t[n]}),await s.fetchAll(t,e)};V(async()=>{await o({page:1,limit:10})});const x=["GET","POST","PUT","DELETE","PATCH","OPTIONS","HEAD"],$=l=>{const e=Number(l||0);return e>=500?"red":e>=400?"amber":e>=300?"blue":"emerald"},h=[{key:"created_at",label:"Created",sortable:!0,width:170},{key:"request_id",label:"Request ID",sortable:!1,minWidth:140},{key:"method",label:"Method",sortable:!0,width:90},{key:"route",label:"Route",sortable:!1,minWidth:220},{key:"status",label:"Status",sortable:!0,width:100},{key:"response_time_ms",label:"Time (ms)",sortable:!0,width:110},{key:"user_id",label:"User",sortable:!0,width:90},{key:"user_role",label:"Role",sortable:!0,width:110},{key:"ip",label:"IP",sortable:!1,width:130}],d=async l=>{await s.fetchById(l.id);const e=s.selected||l,t=[["Created",e.created_at?new Date(e.created_at).toLocaleString():"-"],["Request ID",e.request_id||"-"],["User",e.user_id||"-"],["Role",e.user_role||"-"],["Method",e.method||"-"],["Route",e.route||"-"],["Status",e.status||"-"],["Response Time (ms)",e.response_time_ms??"-"],["IP",e.ip||"-"],["Origin",e.origin||"-"],["Referer",e.referer||"-"],["User Agent",e.user_agent||"-"]],n=i=>typeof i=="string"?i:JSON.stringify(i,null,2),C=`
    <div class="text-left text-sm">
      ${t.map(([i,b])=>`<div><strong>${i}:</strong> ${n(b)}</div>`).join("")}
      <div class="mt-2"><strong>Query:</strong><pre class="mt-1 p-2 bg-gray-50 rounded overflow-auto">${n(e.query||"{}")}</pre></div>
      <div class="mt-2"><strong>Body:</strong><pre class="mt-1 p-2 bg-gray-50 rounded overflow-auto">${n(e.body||"{}")}</pre></div>
    </div>`;await(await A(async()=>{const{default:i}=await import("./index.BnWmU6Nv.js").then(b=>b.ah);return{default:i}},__vite__mapDeps([0,1]),import.meta.url)).default.fire({title:"Session Log",html:C,width:800,confirmButtonText:"Close"})};return(l,e)=>(S(),P(O,null,{default:p(()=>[f(q,null,{default:p(()=>[f(K,{icon:v(M),title:"Session Logs",main:""},{default:p(()=>[f(z,{icon:v(N),small:"",onClick:e[0]||(e[0]=t=>o({},!0))},null,8,["icon"])]),_:1},8,["icon"]),r("div",W,[u(r("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>a.value.q=t),class:"border rounded px-2 py-1.5",placeholder:"Searchâ€¦",onKeyup:e[2]||(e[2]=y(t=>o({page:1}),["enter"]))},null,544),[[m,a.value.q]]),u(r("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.method=t),class:"border rounded px-2 py-1.5",onChange:e[4]||(e[4]=t=>o({page:1}))},[e[17]||(e[17]=r("option",{value:""},"Any method",-1)),(S(),B(D,null,I(x,t=>r("option",{key:t,value:t},w(t),9,G)),64))],544),[[E,a.value.method]]),u(r("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.status=t),class:"border rounded px-2 py-1.5",placeholder:"Status (e.g., 200)",onKeyup:e[6]||(e[6]=y(t=>o({page:1}),["enter"]))},null,544),[[m,a.value.status]]),u(r("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>a.value.user_id=t),class:"border rounded px-2 py-1.5",placeholder:"User ID",onKeyup:e[8]||(e[8]=y(t=>o({page:1}),["enter"]))},null,544),[[m,a.value.user_id]]),u(r("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>a.value.user_role=t),class:"border rounded px-2 py-1.5",placeholder:"User Role",onKeyup:e[10]||(e[10]=y(t=>o({page:1}),["enter"]))},null,544),[[m,a.value.user_role]]),u(r("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>a.value.ip=t),class:"border rounded px-2 py-1.5",placeholder:"IP",onKeyup:e[12]||(e[12]=y(t=>o({page:1}),["enter"]))},null,544),[[m,a.value.ip]]),u(r("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>a.value.created_from=t),type:"date",class:"border rounded px-2 py-1.5",onChange:e[14]||(e[14]=t=>o({page:1}))},null,544),[[m,a.value.created_from]]),u(r("input",{"onUpdate:modelValue":e[15]||(e[15]=t=>a.value.created_to=t),type:"date",class:"border rounded px-2 py-1.5",onChange:e[16]||(e[16]=t=>o({page:1}))},null,544),[[m,a.value.created_to]])]),v(s).error?(S(),P(F,{key:0,color:"danger"},{default:p(()=>[R(w(v(s).error),1)]),_:1})):U("",!0),f(j,{columns:h,data:g.value,loading:v(s).isLoading,onQueryChange:o},{"cell-created_at":p(({row:t})=>[r("span",null,w(t.created_at?new Date(t.created_at).toLocaleString():"-"),1)]),"cell-status":p(({row:t})=>[f(H,{text:t.status,tone:$(t.status)},null,8,["text","tone"])]),"cell-actions":p(({row:t})=>[r("div",J,[r("button",{class:"px-2 py-1 text-xs rounded bg-gray-200",onClick:n=>d(t)},"View",8,X)])]),_:1},8,["data","loading"])]),_:1})]),_:1}))}};export{de as default};
