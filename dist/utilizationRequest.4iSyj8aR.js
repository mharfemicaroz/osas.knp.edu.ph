import{O as y,r as o}from"./index.DW713-jq.js";import{u as r}from"./utilizationRequestService.CBALDxKC.js";const L=y("utilizationRequest",()=>{const n=o({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),s=o(!1),l=o(null),v=o(!1),u=o(null),d=o(null),m=o(new Set),g=t=>m.value.has(t),c=async(t,a)=>{t!=null&&m.value.add(t);try{return await a()}finally{t!=null&&m.value.delete(t)}},i=t=>{if(!t?.id)return;const a=n.value.data.findIndex(e=>e.id===t.id);a!==-1&&(n.value.data[a]=t)};return{items:n,selected:u,availabilityProbe:d,isActing:g,isLoading:s,error:l,isLoaded:v,fetchAll:async(t={},a=!1)=>{if(l.value=null,!(!a&&v.value))try{s.value=!0;const e=await r.list(t);Object.assign(n.value,{total:e.total||0,totalPages:e.totalPages||1,currentPage:t.page||1,pageSize:t.limit||10,data:e.data||[]}),v.value=!0}catch(e){l.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to fetch utilization requests"}finally{s.value=!1}},fetchById:async t=>{l.value=null;try{s.value=!0;const a=await r.getById(t);u.value=a,i(a)}catch(a){l.value=a?.response?.data?.message||a?.response?.message||a?.message||"Failed to fetch utilization request"}finally{s.value=!1}},create:async t=>{l.value=null;try{s.value=!0;const a=await r.create(t);return n.value.data.push(a),n.value.total+=1,a}catch(a){throw l.value=a?.response?.data?.message||a?.response?.message||a?.message||"Failed to create utilization request",a}finally{s.value=!1}},updateById:async(t,a)=>{l.value=null;try{s.value=!0;const e=await c(t,()=>r.updateById(t,a));return i(e),u.value?.id===t&&(u.value=e),e}catch(e){throw l.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to update utilization request",e}finally{s.value=!1}},deleteById:async t=>{l.value=null;try{s.value=!0,await c(t,()=>r.delete(t)),n.value.data=n.value.data.filter(a=>a.id!==t),n.value.total=Math.max(0,n.value.total-1),u.value?.id===t&&(u.value=null)}catch(a){l.value=a?.response?.data?.message||a?.response?.message||a?.message||"Failed to delete utilization request"}finally{s.value=!1}},submit:async t=>{l.value=null;try{s.value=!0;const a=await c(t,()=>r.submit(t));return i(a),u.value?.id===t&&(u.value=a),a}catch(a){throw l.value=a?.response?.data?.message||a?.response?.message||a?.message||"Failed to submit utilization request",a}finally{s.value=!1}},approve:async(t,a)=>{l.value=null;try{s.value=!0;const e=await c(t,()=>r.approve(t,{remarks:a}));return i(e),u.value?.id===t&&(u.value=e),e}catch(e){throw l.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to approve utilization request",e}finally{s.value=!1}},reject:async(t,a)=>{l.value=null;try{s.value=!0;const e=await c(t,()=>r.reject(t,{remarks:a}));return i(e),u.value?.id===t&&(u.value=e),e}catch(e){throw l.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to reject utilization request",e}finally{s.value=!1}},cancel:async(t,a)=>{l.value=null;try{s.value=!0;const f={...await c(t,()=>r.cancel(t,{remarks:a}))||{},status:"draft"};return i(f),u.value?.id===t&&(u.value=f),f}catch(e){throw l.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to cancel utilization request",e}finally{s.value=!1}},uploadAttachment:async(t,a)=>{l.value=null;try{s.value=!0;const e=await r.uploadAttachment(t,a);return i(e),u.value?.id===t&&(u.value=e),e}catch(e){throw l.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to upload attachment",e}finally{s.value=!1}},deleteAttachment:async(t,a)=>{l.value=null;try{s.value=!0;const e=await r.deleteAttachment(t,a);return i(e),u.value?.id===t&&(u.value=e),e}catch(e){throw l.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to delete attachment",e}finally{s.value=!1}},sendEmail:async(t,a)=>{l.value=null;try{return s.value=!0,await r.sendEmail(t,a)}catch(e){throw l.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to send email",e}finally{s.value=!1}},checkAvailability:async t=>{l.value=null;try{s.value=!0;const a=await r.availability(t);return d.value=a,a}catch(a){throw l.value=a?.response?.data?.message||a?.response?.message||a?.message||"Failed to check availability",a}finally{s.value=!1}},resetStore:()=>{n.value={total:0,totalPages:1,currentPage:1,pageSize:10,data:[]},u.value=null,d.value=null,v.value=!1,s.value=!1,l.value=null}}});export{L as u};
