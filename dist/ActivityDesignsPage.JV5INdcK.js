import{c as L,r as F,x as ve,a as _,d as H,q as y,e as s,k as te,t as v,j as Se,g as b,F as j,B as J,S as g,u as ze,z as We,o as Ce,f as E,l as z,h as M,v as re,s as qe,p as Ge,A as _e,M as Je,C as ee,Q as Ae}from"./index.w1fTWaRQ.js";import{E as He,a as W,d as Be,Q as ke,_ as Ee}from"./dayjs.min.C6Ah_atX.js";import{B as Ke,C as Qe,D as Xe,z as Ze,E as et,F as tt,G as at,H as nt,I as lt,_ as it,a as st,g as rt,J as ot,K as dt,L as ut,M as ct}from"./SectionMain.Co2y8BLV.js";import{_ as mt,a as Fe}from"./SectionTitleLineWithButton.AVJG-kj_.js";import{_ as pt,B as ft,a as $e}from"./Badge.BfbdF7_K.js";import{_ as Re}from"./ActivityDesignFormModal.CIT5zOJ4.js";import{u as Ie}from"./activityDesign.DQYQQrXQ.js";import{Q as yt}from"./browser.CYIVxMbb.js";import{_ as _t}from"./StatusTrailModal.Dq5INm-V.js";import{u as vt}from"./club.CZEs4jG_.js";import{u as gt}from"./clubScope.C_EnuWrj.js";import"./IconifyButton.CaN1pAk4.js";import"./appContext.Db1VNKoe.js";import"./activityDesignService.DKPfTybd.js";import"./utilizationRequestService.BsNdNhg3.js";import"./liquidationFundService.n_EUG0wO.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";import"./ToasterComponent.C4X8owM8.js";import"./annualPlan.CNmvSRSj.js";const bt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},ht={class:"bg-white p-4 rounded-xl shadow-xl w-[980px] max-h-screen overflow-auto"},xt={class:"flex items-center justify-between mb-3"},wt={class:"text-lg font-semibold"},St={class:"text-gray-600"},Ct={class:"flex items-center justify-between gap-2"},At={class:"text-sm text-gray-600"},kt={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},Et=["d"],Ft=["disabled"],$t={class:"mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"},Rt={class:"aspect-video bg-white border rounded overflow-hidden flex items-center justify-center"},Tt=["src"],Bt={key:1,class:"flex items-center justify-center w-full h-full"},It=["d"],Dt={class:"mt-2 text-xs"},Ot=["title"],Pt={class:"text-gray-500 flex items-center justify-between"},Vt={key:0},Nt={key:0},Ut={class:"mt-2 flex items-center justify-between gap-2"},Mt=["onClick","title"],Yt={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},jt=["d"],Lt=["onClick"],zt={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},Wt=["d"],qt={key:0,class:"mt-6 text-center text-sm text-gray-500"},Gt=10*1024*1024,Jt={__name:"ActivityAttachmentsModal",props:{modelValue:{type:Boolean,default:!1},row:{type:Object,default:null}},emits:["update:modelValue"],setup(n,{emit:i}){const c=n,p=i,m=L({get:()=>c.modelValue,set:a=>p("update:modelValue",a)}),A=Ie(),h=F(null),O=F(!1),S=new Set(["image/png","image/jpeg","image/webp","application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]),$=new Set(["png","jpg","jpeg","webp","pdf","docx","xlsx"]),U=(a="")=>{const d=String(a).toLowerCase().match(/\.([a-z0-9]+)$/i);return d?d[1]:""},o=(a="")=>{if(typeof a!="string")return"";const d=a.match(/^data:([^;]+);base64,/i);return d?d[1]:""},P=a=>{const d=a?.type&&S.has(a.type),r=a?.name&&$.has(U(a.name));return d||r},k=(a="")=>String(a).startsWith("image/"),I=(a="")=>a==="application/pdf",x=(a="")=>a==="application/vnd.openxmlformats-officedocument.wordprocessingml.document",f=(a="")=>a==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",R=(a="")=>I(a)?et:x(a)?tt:f(a)?at:k(a)?nt:lt,Y=(a="")=>I(a)?"PDF":x(a)?"Word":f(a)?"Excel":k(a)?"Image":"File",T=(a="")=>I(a)?"pdf":x(a)?"docx":f(a)?"xlsx":a==="image/png"?"png":a==="image/jpeg"?"jpg":a==="image/webp"?"webp":"",D=(a="attachment",d="")=>{const r=/\.[a-z0-9]+$/i.test(a),w=d?d.startsWith(".")?d.slice(1):d:"";return r?a:w?`${a}.${w}`:a},V=a=>!a&&a!==0?"":a<1024?`${a} B`:a<1024*1024?`${(a/1024).toFixed(1)} KB`:`${(a/(1024*1024)).toFixed(1)} MB`,K=L(()=>{const a=h.value?.attachments;if(!a)return[];try{return Array.isArray(a)?a:JSON.parse(a||"[]")}catch{return[]}}),ae=L(()=>(K.value||[]).map((a,d)=>{const r=a.mime||o(a.data)||(a.name?U(a.name)==="pdf"&&"application/pdf":"")||"",w=U(a.name||"")||T(r),Z=a.size??null,N=a.name||`${Y(r)} ${d+1}`;return{id:a.id??d+1,name:N,data:a.data||"",url:a.url||a.href||a.path||"",mime:r,ext:w,size:Z,filename:D(N,w)}}));ve(()=>c.modelValue,async a=>{a&&c.row?.id&&(await A.fetchById(c.row.id),h.value=A.selected||c.row)},{immediate:!1});const de=async a=>{const d=a.target.files?.[0];if(a.target.value="",!(!d||!h.value?.id)){if(d.size>Gt){await g.fire("File too large","Maximum size is 10 MB.","warning");return}if(!P(d)){await g.fire("Unsupported file","Only images (PNG/JPEG/WEBP), PDF, DOCX, and XLSX are allowed.","warning");return}try{O.value=!0,await A.uploadAttachment(h.value.id,d),await A.fetchById(h.value.id),h.value=A.selected}finally{O.value=!1}}},ue=async a=>{!h.value?.id||!(await g.fire({title:"Remove attachment?",icon:"warning",showCancelButton:!0,confirmButtonText:"Remove",confirmButtonColor:"#d33"})).isConfirmed||(await A.deleteAttachment(h.value.id,a),await A.fetchById(h.value.id),h.value=A.selected)},Q=a=>{if(a.data&&String(a.data).startsWith("data:")&&k(a.mime)){const d=window.open();d&&d.document.write(`<img src="${a.data}" style="display:block;max-width:100%;height:auto;margin:0 auto;object-fit:contain"/>`);return}a.url&&window.open(String(a.url),"_blank")},q=a=>{const[d,r]=a.split(","),w=d.match(/data:([^;]+);base64/i)?.[1]||"application/octet-stream",Z=atob(r),N=Z.length,G=new Uint8Array(N);for(let C=0;C<N;C++)G[C]=Z.charCodeAt(C);return new Blob([G],{type:w})},X=(a,d)=>{const r=URL.createObjectURL(a),w=document.createElement("a");w.href=r,w.download=d||"download",document.body.appendChild(w),w.click(),w.remove(),setTimeout(()=>URL.revokeObjectURL(r),1e3)},ce=async a=>{if(a.data&&String(a.data).startsWith("data:")){const d=q(a.data);X(d,a.filename);return}if(a.url)try{const r=await(await fetch(a.url,{credentials:"include"})).blob();X(r,a.filename)}catch{const r=document.createElement("a");r.href=String(a.url),r.setAttribute("download",a.filename),document.body.appendChild(r),r.click(),r.remove()}},ne=a=>k(a.mime)?"Open":"Download",me=a=>k(a.mime)?Qe:Xe,se=a=>k(a.mime)?Q(a):ce(a);return(a,d)=>m.value?(y(),_("div",bt,[s("div",ht,[s("div",xt,[s("h2",wt,[d[1]||(d[1]=te(" Attachments — ",-1)),s("span",St,v(h.value?.name_of_activity||""),1)]),s("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:d[0]||(d[0]=r=>m.value=!1)},"Close")]),s("div",Ct,[s("div",At,[d[2]||(d[2]=te(" Ref: ",-1)),s("strong",null,v(h.value?.reference_code||"—"),1)]),s("label",{class:Se(["inline-flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white rounded text-xs cursor-pointer disabled:opacity-60",{"opacity-60 pointer-events-none":O.value}])},[(y(),_("svg",kt,[s("path",{d:b(Ke)},null,8,Et)])),s("span",null,v(O.value?"Uploading…":"Upload"),1),s("input",{type:"file",class:"hidden",disabled:O.value,onChange:de,accept:".png,.jpg,.jpeg,.webp,.pdf,.docx,.xlsx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,image/png,image/jpeg,image/webp"},null,40,Ft)],2)]),s("div",$t,[(y(!0),_(j,null,J(ae.value,r=>(y(),_("div",{key:r.id,class:"border rounded-lg p-2 bg-gray-50 flex flex-col"},[s("div",Rt,[k(r.mime)&&r.data&&r.data.startsWith("data:")?(y(),_("img",{key:0,src:r.data,class:"object-contain w-full h-full",alt:"Attachment preview"},null,8,Tt)):(y(),_("div",Bt,[(y(),_("svg",{style:{width:"64px",height:"64px"},viewBox:"0 0 24 24","aria-hidden":"true",class:Se({"text-red-600":I(r.mime),"text-blue-600":x(r.mime),"text-emerald-600":f(r.mime),"text-gray-500":!r.mime||!k(r.mime)&&!I(r.mime)})},[s("path",{d:R(r.mime)},null,8,It)],2))]))]),s("div",Dt,[s("div",{class:"font-medium truncate",title:r.name},v(r.name),9,Ot),s("div",Pt,[s("span",null,[te(v(Y(r.mime))+" ",1),r.ext?(y(),_("span",Vt,"("+v(r.ext.toUpperCase())+")",1)):H("",!0)]),r.size?(y(),_("span",Nt,v(V(r.size)),1)):H("",!0)])]),s("div",Ut,[s("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-white border rounded text-xs hover:bg-gray-50",onClick:w=>se(r),title:ne(r)},[(y(),_("svg",Yt,[s("path",{d:me(r)},null,8,jt)])),te(" "+v(ne(r)),1)],8,Mt),s("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-red-600 text-white rounded text-xs",onClick:w=>ue(r.id),title:"Remove"},[(y(),_("svg",zt,[s("path",{d:b(Ze)},null,8,Wt)])),d[3]||(d[3]=te(" Remove ",-1))],8,Lt)])]))),128))]),ae.value.length?H("",!0):(y(),_("div",qt," No attachments yet. "))])])):H("",!0)}},Ht="KOLEHIYO NG PANTUKAN",Kt="Juan A. Sarenas Campus, Kingking, Pantukan, Davao de Oro",Qt="https://osas.knp.edu.ph/#/verify-actdesign?id=",oe=n=>n?Be(n).format("MMMM DD, YYYY"):"—",Xt=n=>n==null||n===""?"—":Number(n).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),De="./",Zt=`${De}images/logo.png`,ea=`${De}images/bg.jpg`;async function Te(n){const c=await(await fetch(n)).blob();return new Promise(p=>{const m=new FileReader;m.onloadend=()=>p(m.result),m.readAsDataURL(c)})}function ta(n){switch(n){case"APPROVED":return[32,141,85];case"PENDING":return[240,158,47];case"REJECTED":return[220,53,69];case"CANCELLED":return[107,114,128];default:return[90,90,90]}}async function aa(n){const i=n.internal.pageSize.getWidth(),c=110,p=36;try{const m=await Te(ea);n.addImage(m,"JPEG",0,0,i,c,void 0,"FAST")}catch{n.setFillColor(21,62,121),n.rect(0,0,i,c,"F")}n.setGState(new n.GState({opacity:.18})),n.setFillColor(0,0,0),n.rect(0,0,i,c,"F"),n.setGState(new n.GState({opacity:1}));try{const m=await Te(Zt);n.addImage(m,"PNG",p,20,70,70,void 0,"FAST")}catch{}return n.setTextColor(255,255,255),n.setFont("helvetica","bold"),n.setFontSize(20),n.text(Ht,p+86,38),n.setFont("helvetica","normal"),n.setFontSize(10),n.text(Kt,p+86,58),n.setTextColor(20),n.setFont("helvetica","bold"),n.setFontSize(14),n.text("ACTIVITY DESIGN",i/2,c+24,{align:"center"}),c+34}async function na(n,i,c){const p=n.internal.pageSize.getWidth(),m=15,A=i?.id??i?.reference_code??"",h=`${Qt}${encodeURIComponent(String(A))}`,O=await yt.toDataURL(h,{margin:0,width:75,errorCorrectionLevel:"M",color:{dark:"#000000",light:"#FFFFFF"}}),S=String(i.status||"").toUpperCase(),[$,U,o]=ta(S),P=i.approved_at?oe(i.approved_at):i.date_filed?oe(i.date_filed):"—",k=`osas.knp.edu.ph/#/verify-actdesign?id=${String(A)}`;return W(n,{startY:c,theme:"plain",styles:{cellPadding:0,fontSize:9},bodyStyles:{minCellHeight:110},margin:{left:m,right:m},tableWidth:p-m*2,body:[[{content:""},{content:""}]],columnStyles:{0:{cellWidth:p-m*2-280},1:{cellWidth:280}},didDrawCell:I=>{if(I.section!=="body")return;const{x,y:f,width:R,height:Y}=I.cell,T=10;if(I.column.index===0){n.setFillColor(255,255,255),n.roundedRect(x,f,R-1,Y,6,6,"F");const D=24,V=Math.min(140,R-22);n.setFillColor($,U,o),n.roundedRect(x+T,f+T,V,D,12,12,"F"),n.setTextColor(255,255,255),n.setFont("helvetica","bold"),n.setFontSize(10),n.text(S||"STATUS",x+T+10,f+T+16),n.setTextColor(20),n.setFont("helvetica","normal"),n.setFontSize(9);const K=f+T+D+14;n.text(`Ref No.: ${i.reference_code||"—"}`,x+T,K),n.text(`Date Issued: ${P}`,x+T,K+16),n.setDrawColor(230),n.roundedRect(x,f,R-1,Y,6,6,"S")}if(I.column.index===1){n.setFillColor(255,255,255),n.roundedRect(x,f,R-1,Y,6,6,"F"),n.setFillColor(66,103,178),n.roundedRect(x,f,R-1,22,6,6,"F"),n.setTextColor(255,255,255),n.setFont("helvetica","bold"),n.setFontSize(10),n.text("VERIFY",x+T,f+15);const D=x+T,V=f+28;n.addImage(O,"PNG",D,V,75,75,void 0,"FAST"),n.setTextColor(20),n.setFont("helvetica","bold"),n.setFontSize(10),n.text("Scan to verify",D+100,V+14),n.setFont("helvetica","normal"),n.setFontSize(9),n.text("This document can be verified",D+100,V+32),n.text("online via the OSAS portal.",D+100,V+46),n.setTextColor(110),n.setFontSize(8),n.text(k,D+100,V+72),n.setDrawColor(230),n.roundedRect(x,f,R-1,Y,6,6,"S")}}}),n.lastAutoTable.finalY}async function Oe(n){const i=new He({unit:"pt",format:[612,936],orientation:"portrait"}),c=i.internal.pageSize.getWidth(),p=15;let m=await aa(i);m=await na(i,n,m)+10,W(i,{startY:m,theme:"grid",styles:{fontSize:9,cellPadding:5},headStyles:{fillColor:[222,235,247],textColor:20,fontStyle:"bold"},head:[["SEMESTER","DATE FILED","SCHOOL YEAR","OFFICE/DEPARTMENT"]],body:[[n.semester||"—",oe(n.date_filed),n.school_year||"—",n.office_department||n?.club?.name||"—"]],columnStyles:{0:{cellWidth:120},1:{cellWidth:120},2:{cellWidth:120},3:{cellWidth:"auto"}},margin:{left:p,right:p}}),m=i.lastAutoTable.finalY+10,W(i,{startY:m,theme:"plain",styles:{fontSize:10},body:[[{content:"ACTIVITY INFORMATION",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",halign:"left",valign:"middle",cellPadding:6}}]],margin:{left:p,right:p}}),m=i.lastAutoTable.finalY,W(i,{startY:m,theme:"grid",styles:{fontSize:9,cellPadding:6},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},body:[[{content:"NAME OF ACTIVITY",styles:{fillColor:[243,248,255],fontStyle:"bold"}},n.name_of_activity||"—"],[{content:"VENUE",styles:{fillColor:[243,248,255],fontStyle:"bold"}},n.venue||"—"],[{content:"DATE OF IMPLEMENTATION",styles:{fillColor:[243,248,255],fontStyle:"bold"}},oe(n.date_of_implementation)],[{content:"PROPOSED BUDGET",styles:{fillColor:[243,248,255],fontStyle:"bold"}},`${Xt(n.proposed_budget)}   (Source: Department Fund)`],[{content:"PARTICIPANTS",styles:{fillColor:[243,248,255],fontStyle:"bold"}},n.participants||"—"],[{content:"NATURE OF ACTIVITY",styles:{fillColor:[243,248,255],fontStyle:"bold"}},n.nature_of_activity||"—"]],columnStyles:{0:{cellWidth:180,fontStyle:"bold"},1:{cellWidth:"auto"}},margin:{left:p,right:p}}),m=i.lastAutoTable.finalY+10,[["RATIONALE",n.rationale],["OBJECTIVES",n.objectives],["DETAILS OF THE ACTIVITY",n.details_of_activity],["BUDGETARY REQUIREMENTS",n.budgetary_requirements]].forEach(([o,P])=>{W(i,{startY:m,theme:"plain",styles:{fontSize:10},body:[[{content:o,styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:p,right:p}}),m=i.lastAutoTable.finalY,W(i,{startY:m,theme:"grid",styles:{fontSize:9,cellPadding:8},body:[[P&&String(P).trim()?P:"—"]],margin:{left:p,right:p}}),m=i.lastAutoTable.finalY+10});{const o=i.internal.pageSize.getHeight();m+180>o-30&&(i.addPage(),m=36)}W(i,{startY:m,theme:"plain",styles:{fontSize:10},body:[[{content:"APPROVAL",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:p,right:p}}),m=i.lastAutoTable.finalY;const O=String(n?.file_by_user_name||"").trim()||(n?.filed_by?`${n.filed_by.first_name||""} ${n.filed_by.last_name||""}`.trim():""),S=String(n?.noted_by||"").trim(),$=n?.approver?`${n.approver.first_name||""} ${n.approver.last_name||""}`.trim():"";W(i,{startY:m,theme:"grid",styles:{fontSize:9,cellPadding:10},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},showHead:"firstPage",rowPageBreak:"avoid",head:[["PREPARED BY:","NOTED BY:","RECOMMENDING APPROVAL:"]],body:[[O||" ",S||" ",$||" "],[{content:`APPROVED BY:


DR. MARY ANN R. ARAULA
Acting College President`,colSpan:3,styles:{halign:"center",fontStyle:"bold",cellPadding:{top:14,right:10,bottom:16,left:10}}}]],columnStyles:{0:{cellWidth:(c-p*2)/3},1:{cellWidth:(c-p*2)/3},2:{cellWidth:"auto"}},didParseCell:o=>{o.section==="body"&&o.row.index===0&&(o.cell.styles.halign="center",o.cell.styles.fontStyle="bold",o.cell.styles.cellPadding={top:16,right:10,bottom:4,left:10})},margin:{left:p,right:p}});const U=i.internal.pageSize.getHeight()-20;return i.setFontSize(8),i.setTextColor(120),i.text(`Generated on ${Be().format("YYYY-MM-DD HH:mm")} • ${window.location.origin}`,p,U),i}async function la(n){(await Oe(n)).save(`${n.reference_code||"Activity_Design"}.pdf`)}const ia={class:"flex items-center gap-2"},sa={class:"p-2 mb-4 rounded-xl border bg-white/60"},ra={class:"flex items-center gap-2 mb-2 text-gray-700"},oa={class:"w-4 h-4",viewBox:"0 0 24 24"},da=["d"],ua={class:"grid grid-cols-1 md:grid-cols-6 gap-2 text-sm"},ca=["value"],ma=["value"],pa=["value"],fa=["value"],ya={key:0,value:""},_a=["value"],va={value:""},ga=["value"],ba={class:"md:col-span-1"},ha={class:"md:col-span-1"},xa={class:"flex items-center gap-2 md:col-span-2"},wa={class:"flex flex-col gap-1"},Sa={class:"text-xs"},Ca={class:"inline-flex items-center gap-2 px-2 py-1 rounded bg-emerald-50 border border-emerald-200"},Aa={class:"font-medium"},ka={class:"text-gray-600"},Ea={class:"text-xs text-gray-700"},Fa={class:"font-medium"},$a={class:"text-gray-500"},Ra={key:1,class:"text-gray-400 text-xs"},Ta={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30"},Ba={class:"bg-white w-[560px] rounded-xl shadow p-4"},Ia={class:"flex items-center justify-between mb-2"},Da={class:"grid grid-cols-1 gap-2 text-sm"},Oa={class:"flex gap-2"},Pa={class:"text-[11px] text-gray-600"},Va={class:"mt-3 flex justify-end gap-2"},nn={__name:"ActivityDesignsPage",setup(n){const i=Ie(),c=ze(),p=vt(),m=We(),{isClub:A,activeClubId:h,withClub:O}=gt(),S=L(()=>{const l=c.user?.last_name||"",e=(c.user?.first_name||"").slice(0,1);return`${l}${l?", ":""}${e?e+".":""}`}),$=l=>{try{return((Array.isArray(l)?l:JSON.parse(l||"[]")||[])||[]).map(t=>(!t||typeof t!="object"||Array.isArray(t.read_by)||(t.read_by=t.user_id!=null?[t.user_id]:[]),t))}catch{return[]}},U={range:!0,partialRange:!0,multiCalendars:2,modelType:"yyyy-MM-dd",enableTimePicker:!1,autoApply:!0,clearable:!0},o=F({page:1,limit:10,sort:"created_at",order:"DESC",q:"",status:"",nature_of_activity:"",school_year:"",semester:"",club_id:"",filed_by_user_id:"",date_filed_from:"",date_filed_to:"",impl_from:"",impl_to:""}),P=L({get:()=>{const{date_filed_from:l,date_filed_to:e}=o.value;return l||e?[l||null,e||null]:null},set:l=>{if(!l)o.value.date_filed_from=null,o.value.date_filed_to=null;else{const[e,t]=l;o.value.date_filed_from=e||null,o.value.date_filed_to=t||null}}}),k=L({get:()=>{const{impl_from:l,impl_to:e}=o.value;return l||e?[l||null,e||null]:null},set:l=>{if(!l)o.value.impl_from=null,o.value.impl_to=null;else{const[e,t]=l;o.value.impl_from=e||null,o.value.impl_to=t||null}}}),I=["1st Semester","2nd Semester","Summer"],x=L(()=>{const l=new Date().getFullYear();return Array.from({length:6},(e,t)=>`${l-t}-${l-t+1}`)}),f=async(l={},e=!0)=>{o.value={...o.value,...l},typeof o.value.officer>"u"&&(o.value.officer=!0);const t=O({...o.value});["q","status","nature_of_activity","school_year","semester","club_id","filed_by_user_id","date_filed_from","date_filed_to","impl_from","impl_to"].forEach(u=>{(t[u]===""||t[u]==null)&&delete t[u]}),t.officer=o.value.officer,await i.fetchAll(t,e)};Ce(async()=>{await Promise.all([f({page:1,limit:10,club_id:A?h:""}),p.fetchAll({page:1,limit:200,officer:!0},!0),m.fetchAll({page:1,limit:200},!0)])});const R=F([]);ve(()=>o.value.club_id,async l=>{if(o.value.filed_by_user_id="",!l){R.value=[];return}try{await p.fetchById(l),R.value=Array.isArray(p.selectedClub?.users)?p.selectedClub.users:[]}catch{R.value=[]}});const Y=L(()=>o.value.club_id?R.value:m.users.data||[]),T=L(()=>({total:i.items.total||0,totalPages:i.items.totalPages||1,currentPage:i.items.currentPage||1,pageSize:i.items.pageSize||10,data:i.items.data||[]})),D=["Curricular","Co-Curricular","Extra-Curricular"],V=["draft","pending","approved","rejected","cancelled"],K=l=>{switch(String(l||"").toLowerCase()){case"draft":return"gray";case"pending":return"amber";case"approved":return"emerald";case"rejected":return"red";case"cancelled":return"zinc";default:return"gray"}},ae=l=>{const e=Number(l);return Number.isFinite(e)?e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},de=[{key:"reference_code",label:"Ref Code",sortable:!0,width:140},{key:"name_of_activity",label:"Activity",sortable:!0,minWidth:220},{key:"annual_plan_item",label:"Annual Plan / Item",sortable:!1,minWidth:260},{key:"club_id",label:"Club",sortable:!1,formatter:(l,e)=>e.club?e.club.name:""},{key:"semester",label:"Sem",sortable:!0,width:110},{key:"school_year",label:"S.Y.",sortable:!0,width:110},{key:"date_of_implementation",label:"Implementation",sortable:!0,width:140,formatter:l=>l?new Date(l).toLocaleDateString():"—"},{key:"status",label:"Status",sortable:!0,width:120}],ue=async l=>{await f(l)},Q=F(!1),q=F(!1),X=F(null),ce=()=>{Q.value=!0},ne=l=>{if(!l)return null;if(typeof l=="object")return l;try{return JSON.parse(l)}catch{return null}},me=async l=>{await i.create(l),Q.value=!1,await f({},!0)},se=async l=>{await i.fetchById(l.id);const e=i.selected||l;X.value={id:e.id,date_filed:e.date_filed||"",semester:e.semester||"",office_department:e.office_department||"",school_year:e.school_year||"",name_of_activity:e.name_of_activity||"",venue:e.venue||"",date_of_implementation:e.date_of_implementation||"",proposed_budget:e.proposed_budget??"",participants:e.participants||"",nature_of_activity:e.nature_of_activity||"Curricular",rationale:e.rationale||"",objectives:e.objectives||"",details_of_activity:e.details_of_activity||"",budgetary_requirements:e.budgetary_requirements||"",file_by_user_name:e.file_by_user_name||"",filed_by_user_id:e.filed_by_user_id||"",club_id:e.club_id||"",status:e.status||"draft",remarks:e.remarks||"",annual_plan_id:e.annual_plan_id||"",annual_plan_item:ne(e.annual_plan_item)},q.value=!0},a=async l=>{const{id:e,...t}=l;await i.updateById(e,t),q.value=!1,await f({},!0)},d=async l=>{if(!l?.id)return;(await g.fire({title:`Delete "${l.name_of_activity}"?`,text:"This cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it",cancelButtonText:"Cancel"})).isConfirmed&&(await i.deleteById(l.id),await f({},!0),await g.fire("Deleted","The activity design has been deleted.","success"))},r=async l=>{await i.fetchById(l.id);const e=i.selected||l;X.value={...e,date_filed:e.date_filed?String(e.date_filed).slice(0,10):"",date_of_implementation:e.date_of_implementation?String(e.date_of_implementation).slice(0,10):"",annual_plan_id:e.annual_plan_id||"",annual_plan_item:ne(e.annual_plan_item)},q.value=!0},w=async l=>{if((await g.fire({title:"Submit for approval?",text:"You can no longer edit after submission.",icon:"question",showCancelButton:!0,confirmButtonText:"Submit",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1})).isConfirmed)try{const t=$(l.remarks);t.push({user_id:c.user?.id||null,user_name:S.value,message:`${S.value} submitted activity design.`,datetime:new Date().toISOString(),is_read:!1,read_by:[c.user?.id||null]}),await i.updateById(l.id,{remarks:JSON.stringify(t)}),await i.submit(l.id),await f({},!0),await g.fire("Submitted","Activity is now pending approval.","success")}catch{await g.fire("Error",i.error||"Failed to submit activity.","error")}},Z=async l=>{const e=await g.fire({title:"Approve activity?",input:"textarea",inputLabel:"Remarks (optional)",inputPlaceholder:"Add a note…",showCancelButton:!0,confirmButtonText:"Approve",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1});if(!e.isConfirmed)return;const t=e.value||"";try{const u=$(l.remarks);u.push({user_id:c.user?.id||null,user_name:S.value,message:`${S.value} approved activity design.${t?" - "+t:""}`,datetime:new Date().toISOString(),is_read:!1,read_by:[c.user?.id||null]}),await i.approve(l.id,JSON.stringify(u)),await f({},!0),await g.fire("Approved","Activity has been approved.","success")}catch{await g.fire("Error",i.error||"Failed to approve activity.","error")}},N=F(!1),G=F(null),C=F({from_email:"",from_name:"",to:"",subject:"",html:"",attachments:[]}),ge=async l=>{try{await i.fetchById(l.id);const e=i.selected||l,u=(await Oe(e)).output("datauristring"),ie=String(u).split(",")[1]||"",Le=`${e.reference_code||"Activity_Design"}.pdf`;G.value=e,C.value={from_email:"osas@knp.edu.ph",from_name:`${c.user?.first_name||""} ${c.user?.last_name||""}`.trim(),to:"",subject:`Activity Design ${e.reference_code||""} - ${e.name_of_activity||""}`.trim(),html:"Please see the attached file.",attachments:[{filename:Le,content:ie,type:"application/pdf"}]},N.value=!0}catch{await g.fire("Error",i.error||"Failed to prepare email.","error")}},Pe=async()=>{const l=G.value;if(l)try{await i.sendEmail(l.id,{...C.value}),N.value=!1,await g.fire("Sent","Email sent successfully.","success")}catch{await g.fire("Error",i.error||"Failed to send email.","error")}},Ve=async l=>{const e=await g.fire({title:"Reject activity?",input:"textarea",inputLabel:"Reason (required)",inputPlaceholder:"State the reason…",inputValidator:u=>u?.trim()?void 0:"Reason is required",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Reject",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1});if(!e.isConfirmed)return;const t=e.value;try{const u=$(l.remarks);u.push({user_id:c.user?.id||null,user_name:S.value,message:`${S.value} rejected activity design - ${t}.`,datetime:new Date().toISOString(),is_read:!1,read_by:[c.user?.id||null]}),await i.reject(l.id,JSON.stringify(u)),await f({},!0),await g.fire("Rejected","Activity has been rejected.","success")}catch{await g.fire("Error",i.error||"Failed to reject activity.","error")}},Ne=async l=>{const e=await g.fire({title:"Cancel activity?",input:"textarea",inputLabel:"Reason (required)",inputPlaceholder:"State the reason…",inputValidator:u=>u?.trim()?void 0:"Reason is required",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Cancel Activity",cancelButtonText:"Keep Activity",allowOutsideClick:!1,allowEscapeKey:!1});if(!e.isConfirmed)return;const t=e.value;try{const u=$(l.remarks);u.push({user_id:c.user?.id||null,user_name:S.value,message:`${S.value} cancelled activity design - ${t}.`,datetime:new Date().toISOString(),is_read:!1,read_by:[c.user?.id||null]}),await i.cancel(l.id,JSON.stringify(u)),await f({},!0),await g.fire("Cancelled","Activity has been cancelled.","success")}catch{await g.fire("Error",i.error||"Failed to cancel activity.","error")}},be=async l=>{if(String(l?.status||"").toLowerCase()!=="approved"){await g.fire("Not allowed","Only approved activities can be printed.","info");return}try{await i.fetchById(l.id);const t=i.selected||l;await la(t)}catch(t){await g.fire("Error",i.error||"Failed to generate PDF.","error"),console.error(t)}},pe=F(!1),he=F(null),xe=async l=>{await i.fetchById(l.id),he.value=i.selected||l,pe.value=!0},fe=F(!1),B=F(null),ye=async l=>{try{await i.fetchById(l.id),B.value=i.selected||l}catch{B.value=l}fe.value=!0},Ue=async l=>{if(!B.value)return;const e=$(B.value.remarks);e.push({user_id:c.user?.id||null,user_name:S.value,message:l?.message||"",datetime:l?.datetime||new Date().toISOString(),is_read:!1,read_by:[c.user?.id||null]});try{B.value.remarks=JSON.stringify(e)}catch{}try{await i.updateById(B.value.id,{remarks:JSON.stringify(e)}),await f({},!0)}catch{}},Me=async()=>{if(!B.value)return;const l=c.user?.id||null,t=$(B.value.remarks).map(u=>{if(!u||u.user_id===l)return u;const ie=Array.isArray(u.read_by)?u.read_by.slice():[];return ie.includes(l)||ie.push(l),{...u,read_by:ie}});try{B.value.remarks=JSON.stringify(t)}catch{}try{await i.updateById(B.value.id,{remarks:JSON.stringify(t)}),await f({},!0)}catch{}},le=qe(),Ye=Ge(),we=async()=>{const l=String(le.query.open_remarks_type||""),e=Number(le.query.open_remarks_id||"");if(l==="AD"&&Number.isFinite(e)){try{await i.fetchById(e)}catch{}const t=i.selected;t&&await ye(t);const u={...le.query};delete u.open_remarks_type,delete u.open_remarks_id,Ye.replace({query:u})}};Ce(we),ve(()=>[le.query.open_remarks_type,le.query.open_remarks_id],()=>{we()});const je=async()=>{await f({q:"",status:"",nature_of_activity:"",school_year:"",semester:"",club_id:"",filed_by_user_id:"",date_filed_from:"",date_filed_to:"",impl_from:"",impl_to:"",page:1})};return(l,e)=>(y(),_(j,null,[E(it,null,{default:z(()=>[E(st,null,{default:z(()=>[b(i).error?(y(),_e(pt,{key:0,icon:b(rt),color:"danger"},{default:z(()=>[te(v(b(i).error),1)]),_:1},8,["icon"])):H("",!0),E(mt,{icon:b(ot),title:"Activity Designs",main:""},{default:z(()=>[s("div",ia,[E(Fe,{icon:b(dt),color:"primary",label:"New Activity",onClick:ce},null,8,["icon"]),E(Fe,{icon:b(ut),color:"info",label:"Refresh",onClick:e[0]||(e[0]=t=>f({},!0))},null,8,["icon"])])]),_:1},8,["icon"]),s("div",sa,[s("div",ra,[(y(),_("svg",oa,[s("path",{d:b(ct)},null,8,da)])),e[23]||(e[23]=s("span",{class:"font-medium text-sm"},"Filters",-1))]),s("div",ua,[M(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>o.value.q=t),placeholder:"Search by ref, activity, venue, office…",class:"border rounded px-2 py-2 md:col-span-2",onKeyup:e[2]||(e[2]=Je(t=>f({page:1}),["enter"]))},null,544),[[re,o.value.q]]),M(s("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.status=t),class:"border rounded px-2 py-2"},[e[24]||(e[24]=s("option",{value:""},"All status",-1)),(y(),_(j,null,J(V,t=>s("option",{key:t,value:t},v(t),9,ca)),64))],512),[[ee,o.value.status]]),M(s("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.value.nature_of_activity=t),class:"border rounded px-2 py-2"},[e[25]||(e[25]=s("option",{value:""},"All natures",-1)),(y(),_(j,null,J(D,t=>s("option",{key:t,value:t},v(t),9,ma)),64))],512),[[ee,o.value.nature_of_activity]]),M(s("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.school_year=t),class:"border rounded px-2 py-2 md:col-span-1"},[(y(!0),_(j,null,J(x.value,t=>(y(),_("option",{key:t,value:t},v(t),9,pa))),128))],512),[[ee,o.value.school_year]]),M(s("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.semester=t),class:"border rounded px-2 py-2 md:col-span-1"},[e[26]||(e[26]=s("option",{disabled:"",value:""},"Select semester…",-1)),(y(),_(j,null,J(I,t=>s("option",{key:t,value:t},v(t),9,fa)),64))],512),[[ee,o.value.semester]]),M(s("select",{"onUpdate:modelValue":e[7]||(e[7]=t=>o.value.club_id=t),class:"border rounded px-2 py-2 md:col-span-2"},[b(c).user.role==="admin"?(y(),_("option",ya,"All clubs")):H("",!0),(y(!0),_(j,null,J(b(p).clubs.data||[],t=>(y(),_("option",{key:t.id,value:t.id},v(t.name),9,_a))),128))],512),[[ee,o.value.club_id]]),M(s("select",{"onUpdate:modelValue":e[8]||(e[8]=t=>o.value.filed_by_user_id=t),class:"border rounded px-2 py-2 md:col-span-2"},[s("option",va,v(o.value.club_id?"Filed by (club members)":"Filed by (any)"),1),(y(!0),_(j,null,J(Y.value,t=>(y(),_("option",{key:t.id,value:t.id},v(t.first_name)+" "+v(t.last_name)+" (@"+v(t.username)+") ",9,ga))),128))],512),[[ee,o.value.filed_by_user_id]]),s("div",ba,[E(b(ke),Ae({modelValue:P.value,"onUpdate:modelValue":e[9]||(e[9]=t=>P.value=t)},U,{placeholder:"Filed date range"}),null,16,["modelValue"])]),s("div",ha,[E(b(ke),Ae({modelValue:k.value,"onUpdate:modelValue":e[10]||(e[10]=t=>k.value=t)},U,{placeholder:"Implementation date range"}),null,16,["modelValue"])]),s("div",xa,[s("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:e[11]||(e[11]=t=>f({page:1}))}," Apply "),s("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:je}," Reset ")])])]),E(ft,{columns:de,data:T.value,loading:b(i).isLoading,onQueryChange:ue},{"cell-annual_plan_item":z(({row:t})=>[s("div",wa,[t.annual_plan_id?(y(),_(j,{key:0},[s("div",Sa,[s("span",Ca,[s("span",Aa,v(t.annual_plan?.reference_code||`AP-${t.annual_plan_id}`),1),s("span",ka,"SY "+v(t.annual_plan?.school_year||"—"),1)])]),s("div",Ea,[s("span",Fa,v((()=>{try{const u=typeof t.annual_plan_item=="string"?JSON.parse(t.annual_plan_item||"null")||{}:t.annual_plan_item||{};return u.item||u.title||u.name||u.activity||"—"}catch{return"—"}})()),1),s("span",$a," — ₱"+v((()=>{try{const u=typeof t.annual_plan_item=="string"?JSON.parse(t.annual_plan_item||"null")||{}:t.annual_plan_item||{};return ae(u.funds??u.budget??0)}catch{return ae(0)}})()),1)])],64)):(y(),_("span",Ra,"—"))])]),"cell-nature_of_activity":z(({value:t})=>[E($e,{text:t||"—",tone:"indigo"},null,8,["text"])]),"cell-status":z(({value:t})=>[E($e,{text:t||"—",tone:K(t)},null,8,["text","tone"])]),"cell-actions":z(({row:t})=>[["admin","manager"].includes(String(b(c).user?.role||"").toLowerCase())?(y(),_e(Ee,{key:0,row:t,moderator:!0,"current-user-id":b(c).user?.id,onAttachments:xe,onSubmit:w,onApprove:Z,onReject:Ve,onEdit:se,onDelete:d,onRemarks:ye,onView:u=>r(t),onCancel:Ne,onPrint:be,onEmail:ge},null,8,["row","current-user-id","onView"])):(y(),_e(Ee,{key:1,row:t,moderator:!1,"current-user-id":b(c).user?.id,onAttachments:xe,onSubmit:w,onEdit:se,onView:u=>r(t),onPrint:be,onEmail:ge,onRemarks:ye},null,8,["row","current-user-id","onView"]))]),_:1},8,["data","loading"])]),_:1})]),_:1}),E(Re,{modelValue:Q.value,"onUpdate:modelValue":e[12]||(e[12]=t=>Q.value=t),mode:"create","locked-club-id":b(A)?b(h):"",onSubmit:me},null,8,["modelValue","locked-club-id"]),E(Re,{modelValue:q.value,"onUpdate:modelValue":e[13]||(e[13]=t=>q.value=t),mode:"edit",initial:X.value||{},onSubmit:a},null,8,["modelValue","initial"]),E(Jt,{modelValue:pe.value,"onUpdate:modelValue":e[14]||(e[14]=t=>pe.value=t),row:he.value},null,8,["modelValue","row"]),E(_t,{modelValue:fe.value,"onUpdate:modelValue":e[15]||(e[15]=t=>fe.value=t),title:"Remarks • "+(B.value?.reference_code||B.value?.name_of_activity||"Item"),items:$(B.value?.remarks),"can-add":!0,onAdd:Ue,onMarkAllRead:Me},null,8,["modelValue","title","items"]),N.value?(y(),_("div",Ta,[s("div",Ba,[s("div",Ia,[e[27]||(e[27]=s("h3",{class:"text-base font-semibold"},"Send Email",-1)),s("button",{class:"px-2 py-1 text-xs bg-gray-200 rounded",onClick:e[16]||(e[16]=t=>N.value=!1)},"Close")]),s("div",Da,[s("div",null,[e[28]||(e[28]=s("label",{class:"block mb-0.5"},"To",-1)),s("div",Oa,[M(s("input",{"onUpdate:modelValue":e[17]||(e[17]=t=>C.value.to=t),class:"flex-1 border rounded px-2 py-1.5",placeholder:"recipient@example.com"},null,512),[[re,C.value.to]]),s("button",{class:"px-2 py-1 text-[11px] rounded border bg-gray-50 hover:bg-gray-100",onClick:e[18]||(e[18]=()=>{const t=G.value?.filed_by_user_id||G.value?.filed_by?.id;t&&b(m).fetchById(t).then(()=>{const u=b(m).selectedUser?.email;u&&(C.value.to=u)})})},"Use Filer"),s("button",{class:"px-2 py-1 text-[11px] rounded border bg-rose-50 hover:bg-rose-100",onClick:e[19]||(e[19]=()=>{C.value.attachments=[]})},"Remove Attachment")])]),s("div",null,[e[29]||(e[29]=s("label",{class:"block mb-0.5"},"Subject",-1)),M(s("input",{"onUpdate:modelValue":e[20]||(e[20]=t=>C.value.subject=t),class:"w-full border rounded px-2 py-1.5"},null,512),[[re,C.value.subject]])]),s("div",null,[e[30]||(e[30]=s("label",{class:"block mb-0.5"},"Message",-1)),M(s("textarea",{"onUpdate:modelValue":e[21]||(e[21]=t=>C.value.html=t),rows:"4",class:"w-full border rounded px-2 py-1.5"},null,512),[[re,C.value.html]])]),s("div",Pa,"Attachment: "+v(C.value.attachments?.[0]?.filename||"activity.pdf"),1)]),s("div",Va,[s("button",{class:"px-3 py-1.5 text-xs bg-gray-200 rounded",onClick:e[22]||(e[22]=t=>N.value=!1)},"Cancel"),s("button",{class:"px-3 py-1.5 text-xs bg-emerald-600 text-white rounded",onClick:Pe},"Send")])])])):H("",!0)],64))}};export{nn as default};
