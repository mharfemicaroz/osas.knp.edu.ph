import{z as J,u as X,r as h,o as Z,c as ee,a as i,f as x,d as u,l as y,e as s,t as v,h as c,k as b,v as f,F as k,C,B as U,g as m,p as se,G as te,q as o,A as le,M as ae,S as P}from"./index.C20gUimh.js";import{c as oe,a as ie}from"./imageCompression.CGjyEC1q.js";import{_ as ne,N as re,O as de,a as ue,w as ce,K as ve,L as pe,M as me,v as be,y as fe,z as we,P as _e}from"./SectionMain.DOLbQH4J.js";import{_ as xe,a as $}from"./SectionTitleLineWithButton.BFQQmMov.js";import{_ as ye,B as ge,a as N}from"./Badge.C7tf28Bv.js";import"./appContext.7HuGpDYo.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";import"./activityDesignService.Bnn2Y4X2.js";import"./utilizationRequestService.BtvbPQF3.js";import"./liquidationFundService.CCvUFTja.js";import"./ToasterComponent.B8py6qzZ.js";const he={class:"flex items-center gap-2"},ke={class:"p-3 mb-4 rounded-xl border bg-white/60"},Ce={class:"flex items-center gap-2 mb-2 text-gray-700"},Ae={class:"w-4 h-4",viewBox:"0 0 24 24"},Ue=["d"],Be={class:"grid grid-cols-1 md:grid-cols-6 gap-2 text-sm"},Ve=["value"],Ee=["value"],Fe={class:"flex items-center gap-2 md:col-span-2"},Pe={class:"w-9 h-9 rounded-full overflow-hidden bg-gray-100 border"},$e=["src"],Ne={key:1,class:"w-full h-full flex items-center justify-center text-[10px] text-gray-400"},Se={class:"inline-flex items-center gap-1"},qe={class:"w-3.5 h-3.5 opacity-70",viewBox:"0 0 24 24"},je=["d"],De={class:"flex items-center gap-1"},Te=["onClick"],Ie=["onClick"],ze={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},Le=["d"],Me=["onClick"],Oe={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},Re=["d"],We=["onClick"],Ke={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},Qe=["d"],Ye={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},Ge={class:"bg-white p-4 md:p-5 rounded-2xl shadow-xl w-[980px] max-h-screen overflow-auto"},He={class:"flex items-center justify-between mb-3"},Je={class:"text-lg font-semibold"},Xe={class:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm"},Ze={class:"md:col-span-3"},es=["disabled"],ss={key:0,class:"text-red-600 text-[11px] mt-1"},ts={class:"md:col-span-3"},ls=["disabled"],as={key:0,class:"text-red-600 text-[11px] mt-1"},os={key:0,class:"md:col-span-3"},is={key:0,class:"text-red-600 text-[11px] mt-1"},ns={key:1,class:"md:col-span-3"},rs={key:0,class:"text-red-600 text-[11px] mt-1"},ds={key:2,class:"md:col-span-3"},us={key:0,class:"text-red-600 text-[11px] mt-1"},cs={key:3,class:"md:col-span-3"},vs={key:0,class:"text-red-600 text-[11px] mt-1"},ps=["disabled"],ms=["disabled"],bs=["disabled"],fs=["value"],ws={key:0,class:"text-red-600 text-[11px] mt-1"},_s=["disabled"],xs=["disabled"],ys={class:"md:col-span-3"},gs=["disabled"],hs={key:0,class:"mt-4 p-3 rounded-xl border bg-white/70"},ks={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},Cs={class:"block mb-1 inline-flex items-center gap-2"},As={class:"w-4 h-4 opacity-80",viewBox:"0 0 24 24"},Us=["d"],Bs={class:"flex items-center gap-3"},Vs={class:"w-16 h-16 rounded-full overflow-hidden bg-gray-100 border"},Es=["src"],Fs={key:1,class:"w-full h-full flex items-center justify-center text-[10px] text-gray-400"},Ps=["disabled"],$s={class:"block mb-1 inline-flex items-center gap-2"},Ns={class:"w-4 h-4 opacity-80",viewBox:"0 0 24 24"},Ss=["d"],qs={class:"flex items-center gap-3"},js={class:"w-28 h-16 rounded-lg overflow-hidden bg-gray-100 border"},Ds=["src"],Ts={key:1,class:"w-full h-full flex items-center justify-center text-[10px] text-gray-400"},Is=["disabled"],zs={class:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-3"},Ls={class:"p-3 rounded-xl border bg-white/70"},Ms={key:0,class:"text-xs text-gray-500"},Os={key:1,class:"text-xs text-gray-500"},Rs={key:2,class:"space-y-1 text-sm"},Ws={class:"truncate"},Ks={class:"text-[11px] text-gray-500"},Qs={class:"flex justify-end gap-2 mt-5"},Ys={key:0,class:"px-4 py-2 bg-blue-600 text-white rounded text-xs"},nt={__name:"UserManagementPage",setup(Gs){const r=J();X();const S=se(),w=h({page:1,limit:10,q:"",role:"",is_active:""}),E=["admin","manager","officer","student"],q=[{label:"All",value:""},{label:"Yes",value:"true"},{label:"No",value:"false"}],_=async(a={},e=!0)=>{w.value={...w.value,...a};const p={...w.value};["q","role","is_active"].forEach(t=>{(p[t]===""||p[t]==null)&&delete p[t]}),p.q&&(p.username=p.q,delete p.q),await r.fetchAll(p,e)};Z(async()=>{await _({page:1,limit:10},!0)});const j=ee(()=>({total:r.users.total||0,totalPages:r.users.totalPages||1,currentPage:r.users.currentPage||1,pageSize:r.users.pageSize||10,data:r.users.data||[]})),D=a=>a?"emerald":"zinc",T=a=>a?"indigo":"gray",I=[{key:"avatar",label:"Avatar",width:64,formatter:(a,e)=>e.avatar||null,sortable:!1},{key:"username",label:"Username",sortable:!0,minWidth:160},{key:"name",label:"Name",sortable:!1,minWidth:200,formatter:(a,e)=>`${e.first_name||""} ${e.last_name||""}`.trim()||"—"},{key:"email",label:"Email",sortable:!0,minWidth:220},{key:"role",label:"Role",sortable:!0,width:120},{key:"is_active",label:"Active",sortable:!0,width:100},{key:"twoFAEnabled",label:"2FA",sortable:!0,width:100}],z=async a=>{await _(a)},g=h(!1),n=h("create"),l=h({id:null,username:"",email:"",first_name:"",last_name:"",role:"student",is_active:!0,twoFAEnabled:!1,bio:"",avatar:null,cover:null,password:"",confirm_password:""}),d=h({}),L=()=>{n.value="create",l.value={id:null,username:"",email:"",first_name:"",last_name:"",role:"student",is_active:!0,twoFAEnabled:!1,bio:"",avatar:null,cover:null,password:"",confirm_password:""},d.value={},g.value=!0},M=async a=>{await r.fetchById(a.id);const e=r.selectedUser||a;n.value="view",l.value={id:e.id,username:e.username||"",email:e.email||"",first_name:e.first_name||"",last_name:e.last_name||"",role:e.role||"student",is_active:!!e.is_active,twoFAEnabled:!!e.twoFAEnabled,bio:e.bio||"",avatar:e.avatar||null,cover:e.cover||null,password:"",confirm_password:""},d.value={},g.value=!0,await F(e.id)},O=async a=>{await r.fetchById(a.id);const e=r.selectedUser||a;n.value="edit",l.value={id:e.id,username:e.username||"",email:e.email||"",first_name:e.first_name||"",last_name:e.last_name||"",role:e.role||"student",is_active:!!e.is_active,twoFAEnabled:!!e.twoFAEnabled,bio:e.bio||"",avatar:e.avatar||null,cover:e.cover||null},d.value={},g.value=!0,await F(e.id)},R=a=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(a||"").trim()),W=()=>{const a={};return l.value.username?.trim()||(a.username="Username is required"),R(l.value.email)||(a.email="Valid email is required"),l.value.role?.trim()||(a.role="Role is required"),n.value==="create"?(l.value.password?.trim()||(a.password="Password is required"),(l.value.password||"").length<6&&(a.password="Password must be at least 6 chars"),(l.value.confirm_password||"")!==(l.value.password||"")&&(a.confirm_password="Passwords do not match")):n.value==="edit"&&(l.value.password?.length&&l.value.password.length<6&&(a.password="At least 6 chars"),l.value.password?.length&&l.value.confirm_password!==l.value.password&&(a.confirm_password="Passwords do not match")),d.value=a,Object.keys(a).length===0},K=async()=>{if(n.value==="view"||!W())return;const a={username:l.value.username.trim(),email:l.value.email.trim(),first_name:l.value.first_name?.trim()||"",last_name:l.value.last_name?.trim()||"",role:l.value.role||"student",is_active:!!l.value.is_active,twoFAEnabled:!!l.value.twoFAEnabled,bio:l.value.bio||null};n.value==="create"?(a.password=l.value.password,await r.create(a)):(l.value.password&&(a.password=l.value.password),await r.updateById(l.value.id,a)),g.value=!1,await _({},!0)},Q=async a=>{!a?.id||!(await P.fire({title:`Delete @${a.username}?`,text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Delete",cancelButtonText:"Cancel"})).isConfirmed||(await r.deleteById(a.id),await _({},!0),await P.fire("Deleted","User record removed.","success"))},Y=async a=>{const e=a?.target?.files?.[0];if(!e||!l.value.id)return;const p=await oe(e);await r.uploadAvatar(l.value.id,p),await r.fetchById(l.value.id),l.value.avatar=r.selectedUser?.avatar||l.value.avatar},G=async a=>{const e=a?.target?.files?.[0];if(!e||!l.value.id)return;const p=await ie(e);await r.uploadCover(l.value.id,p),await r.fetchById(l.value.id),l.value.cover=r.selectedUser?.cover||l.value.cover},A=h([]),B=h(!1),F=async a=>{try{B.value=!0;const e=await r.fetchUserClubs(a,{force:!0});A.value=Array.isArray(e)?e:[]}catch{A.value=[]}finally{B.value=!1}},H=a=>{a?.id&&S.push({name:"profile",params:{id:a.id}})};return(a,e)=>{const p=te("pending-click");return o(),i(k,null,[x(ne,null,{default:y(()=>[x(ue,null,{default:y(()=>[m(r).error?(o(),le(ye,{key:0,color:"danger"},{default:y(()=>[b(v(m(r).error),1)]),_:1})):u("",!0),x(xe,{icon:m(ce),title:"Users",main:""},{default:y(()=>[s("div",he,[x($,{icon:m(ve),color:"primary",label:"New User",onClick:L},null,8,["icon"]),x($,{icon:m(pe),color:"info",label:"Refresh",onClick:e[0]||(e[0]=t=>_({},!0))},null,8,["icon"])])]),_:1},8,["icon"]),s("div",ke,[s("div",Ce,[(o(),i("svg",Ae,[s("path",{d:m(me)},null,8,Ue)])),e[21]||(e[21]=s("span",{class:"font-medium text-sm"},"Filters",-1))]),s("div",Be,[c(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>w.value.q=t),placeholder:"Search username, name, email…",class:"border rounded px-2 py-2 md:col-span-2",onKeyup:e[2]||(e[2]=ae(t=>_({page:1}),["enter"]))},null,544),[[f,w.value.q]]),c(s("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>w.value.role=t),class:"border rounded px-2 py-2"},[e[22]||(e[22]=s("option",{value:""},"All roles",-1)),(o(),i(k,null,U(E,t=>s("option",{key:t,value:t},v(t),9,Ve)),64))],512),[[C,w.value.role]]),c(s("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>w.value.is_active=t),class:"border rounded px-2 py-2"},[(o(),i(k,null,U(q,t=>s("option",{key:t.label,value:t.value},"Active: "+v(t.label),9,Ee)),64))],512),[[C,w.value.is_active]]),s("div",Fe,[s("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:e[5]||(e[5]=t=>_({page:1}))}," Apply "),s("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:e[6]||(e[6]=t=>_({q:"",role:"",is_active:"",page:1},!0))}," Reset ")])])]),x(ge,{columns:I,data:j.value,loading:m(r).isLoading,onQueryChange:z},{"cell-avatar":y(({value:t})=>[s("div",Pe,[t?(o(),i("img",{key:0,src:t,alt:"avatar",class:"w-full h-full object-cover",loading:"lazy"},null,8,$e)):(o(),i("div",Ne,"N/A "))])]),"cell-is_active":y(({value:t})=>[x(N,{text:t?"Active":"Inactive",tone:D(t)},null,8,["text","tone"])]),"cell-twoFAEnabled":y(({value:t})=>[s("div",Se,[(o(),i("svg",qe,[s("path",{d:m(_e)},null,8,je)])),x(N,{text:t?"Enabled":"Disabled",tone:T(t)},null,8,["text","tone"])])]),"cell-actions":y(({row:t})=>[s("div",De,[s("button",{class:"px-2 py-1 text-[12px] rounded bg-blue-600 text-white inline-flex items-center gap-1",onClick:V=>H(t),title:"Open profile"}," Open ",8,Te),s("button",{class:"px-2 py-1 text-[12px] rounded bg-gray-100 hover:bg-gray-200 inline-flex items-center gap-1",onClick:V=>M(t),title:"View"},[(o(),i("svg",ze,[s("path",{d:m(be)},null,8,Le)])),e[23]||(e[23]=b(" View ",-1))],8,Ie),s("button",{class:"px-2 py-1 text-[12px] rounded bg-amber-100 hover:bg-amber-200 inline-flex items-center gap-1",onClick:V=>O(t),title:"Edit"},[(o(),i("svg",Oe,[s("path",{d:m(fe)},null,8,Re)])),e[24]||(e[24]=b(" Edit ",-1))],8,Me),s("button",{class:"px-2 py-1 text-[12px] rounded bg-rose-100 hover:bg-rose-200 inline-flex items-center gap-1",onClick:V=>Q(t),title:"Delete"},[(o(),i("svg",Ke,[s("path",{d:m(we)},null,8,Qe)])),e[25]||(e[25]=b(" Delete ",-1))],8,We)])]),_:1},8,["data","loading"])]),_:1})]),_:1}),g.value?(o(),i("div",Ye,[s("div",Ge,[s("div",He,[s("h2",Je,v(n.value==="create"?"New User":n.value==="edit"?"Edit User":"View User"),1),s("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:e[7]||(e[7]=t=>g.value=!1)},"Close")]),s("div",Xe,[s("div",Ze,[e[26]||(e[26]=s("label",{class:"block mb-1"},[b("Username "),s("span",{class:"text-red-500"},"*")],-1)),c(s("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>l.value.username=t),class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},null,8,es),[[f,l.value.username]]),d.value.username?(o(),i("p",ss,v(d.value.username),1)):u("",!0)]),s("div",ts,[e[27]||(e[27]=s("label",{class:"block mb-1"},[b("Email "),s("span",{class:"text-red-500"},"*")],-1)),c(s("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>l.value.email=t),type:"email",class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},null,8,ls),[[f,l.value.email]]),d.value.email?(o(),i("p",as,v(d.value.email),1)):u("",!0)]),n.value!=="view"?(o(),i(k,{key:0},[n.value==="create"?(o(),i("div",os,[e[28]||(e[28]=s("label",{class:"block mb-1"},[b("Password "),s("span",{class:"text-red-500"},"*")],-1)),c(s("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>l.value.password=t),type:"password",autocomplete:"new-password",class:"w-full border rounded px-2.5 py-2"},null,512),[[f,l.value.password]]),d.value.password?(o(),i("p",is,v(d.value.password),1)):u("",!0)])):u("",!0),n.value==="create"?(o(),i("div",ns,[e[29]||(e[29]=s("label",{class:"block mb-1"},[b("Confirm Password "),s("span",{class:"text-red-500"},"*")],-1)),c(s("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>l.value.confirm_password=t),type:"password",autocomplete:"new-password",class:"w-full border rounded px-2.5 py-2"},null,512),[[f,l.value.confirm_password]]),d.value.confirm_password?(o(),i("p",rs,v(d.value.confirm_password),1)):u("",!0)])):u("",!0),n.value==="edit"?(o(),i("div",ds,[e[30]||(e[30]=s("label",{class:"block mb-1"},"New Password (optional)",-1)),c(s("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>l.value.password=t),type:"password",autocomplete:"new-password",class:"w-full border rounded px-2.5 py-2",placeholder:"Leave blank to keep current"},null,512),[[f,l.value.password]]),d.value.password?(o(),i("p",us,v(d.value.password),1)):u("",!0)])):u("",!0),n.value==="edit"&&l.value.password?(o(),i("div",cs,[e[31]||(e[31]=s("label",{class:"block mb-1"},"Confirm New Password",-1)),c(s("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>l.value.confirm_password=t),type:"password",autocomplete:"new-password",class:"w-full border rounded px-2.5 py-2"},null,512),[[f,l.value.confirm_password]]),d.value.confirm_password?(o(),i("p",vs,v(d.value.confirm_password),1)):u("",!0)])):u("",!0)],64)):u("",!0),s("div",null,[e[32]||(e[32]=s("label",{class:"block mb-1"},"First name",-1)),c(s("input",{"onUpdate:modelValue":e[14]||(e[14]=t=>l.value.first_name=t),class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},null,8,ps),[[f,l.value.first_name]])]),s("div",null,[e[33]||(e[33]=s("label",{class:"block mb-1"},"Last name",-1)),c(s("input",{"onUpdate:modelValue":e[15]||(e[15]=t=>l.value.last_name=t),class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},null,8,ms),[[f,l.value.last_name]])]),s("div",null,[e[34]||(e[34]=s("label",{class:"block mb-1"},[b("Role "),s("span",{class:"text-red-500"},"*")],-1)),c(s("select",{"onUpdate:modelValue":e[16]||(e[16]=t=>l.value.role=t),class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},[(o(),i(k,null,U(E,t=>s("option",{key:t,value:t},v(t),9,fs)),64))],8,bs),[[C,l.value.role]]),d.value.role?(o(),i("p",ws,v(d.value.role),1)):u("",!0)]),s("div",null,[e[36]||(e[36]=s("label",{class:"block mb-1"},"Active",-1)),c(s("select",{"onUpdate:modelValue":e[17]||(e[17]=t=>l.value.is_active=t),class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},e[35]||(e[35]=[s("option",{value:!0},"Yes",-1),s("option",{value:!1},"No",-1)]),8,_s),[[C,l.value.is_active]])]),s("div",null,[e[38]||(e[38]=s("label",{class:"block mb-1"},"Two-Factor Auth",-1)),c(s("select",{"onUpdate:modelValue":e[18]||(e[18]=t=>l.value.twoFAEnabled=t),class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},e[37]||(e[37]=[s("option",{value:!0},"Enabled",-1),s("option",{value:!1},"Disabled",-1)]),8,xs),[[C,l.value.twoFAEnabled]])]),s("div",ys,[e[39]||(e[39]=s("label",{class:"block mb-1"},"Bio",-1)),c(s("textarea",{"onUpdate:modelValue":e[19]||(e[19]=t=>l.value.bio=t),rows:"2",class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},null,8,gs),[[f,l.value.bio]])])]),l.value.id?(o(),i("div",hs,[e[42]||(e[42]=s("div",{class:"flex items-center justify-between mb-2"},[s("div",{class:"text-sm font-medium"},"Media")],-1)),s("div",ks,[s("div",null,[s("label",Cs,[(o(),i("svg",As,[s("path",{d:m(re)},null,8,Us)])),e[40]||(e[40]=b(" Avatar ",-1))]),s("div",Bs,[s("div",Vs,[l.value.avatar?(o(),i("img",{key:0,src:l.value.avatar,class:"w-full h-full object-cover",loading:"lazy"},null,8,Es)):(o(),i("div",Fs,"N/A "))]),s("input",{type:"file",accept:"image/*",disabled:n.value==="view",onChange:Y},null,40,Ps)])]),s("div",null,[s("label",$s,[(o(),i("svg",Ns,[s("path",{d:m(de)},null,8,Ss)])),e[41]||(e[41]=b(" Cover ",-1))]),s("div",qs,[s("div",js,[l.value.cover?(o(),i("img",{key:0,src:l.value.cover,class:"w-full h-full object-cover",loading:"lazy"},null,8,Ds)):(o(),i("div",Ts,"N/A "))]),s("input",{type:"file",accept:"image/*",disabled:n.value==="view",onChange:G},null,40,Is)])])])])):u("",!0),s("div",zs,[s("div",Ls,[e[43]||(e[43]=s("div",{class:"text-sm font-medium mb-2"},"Clubs",-1)),B.value?(o(),i("div",Ms,"Loading clubs…")):A.value.length?(o(),i("ul",Rs,[(o(!0),i(k,null,U(A.value,t=>(o(),i("li",{key:t.id,class:"flex items-center justify-between rounded border px-2 py-1 bg-gray-50"},[s("span",Ws,v(t.name),1),s("span",Ks,v(t.code||""),1)]))),128))])):(o(),i("div",Os,"No clubs found for this user."))])]),s("div",Qs,[s("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:e[20]||(e[20]=t=>g.value=!1)},"Close"),n.value!=="view"?c((o(),i("button",Ys,[b(v(n.value==="edit"?"Save Changes":"Create User"),1)])),[[p,K]]):u("",!0)])])])):u("",!0)],64)}}};export{nt as default};
