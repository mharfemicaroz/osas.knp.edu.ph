const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index.BH0m-Moy.js","./index.v0QUZr3I.css"])))=>i.map(i=>d[i]);
import{N as C,O as V,r as v,c as B,o as I,A as L,l as g,q as h,f as y,e as l,d as U,g as _,h as m,M as b,v as c,a as D,F as E,B as R,t as P,C as q,k as A,aa as O}from"./index.BH0m-Moy.js";import{_ as M,a as N,M as K,L as z}from"./SectionMain.0q4yaC4c.js";import{_ as F,a as j}from"./SectionTitleLineWithButton.DJGDmw72.js";import{_ as H,B as Q,a as W}from"./Badge.D2z9HTct.js";import"./appContext.BZyQu2z5.js";import"./activityDesignService.CRthqIVq.js";import"./utilizationRequestService.DH4XzE5y.js";import"./liquidationFundService.Df8ONB_d.js";import"./ToasterComponent.UWHb-GV7.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";function G(u={}){const{page:s,limit:a,sort:p,order:r,q:S,request_id:w,user_id:x,user_role:i,method:o,status:e,ip:t,created_from:d,created_to:$,...k}=u,n={page:s,limit:a,sort:p,order:r,q:S,request_id:w,user_id:x,user_role:i,method:o,status:e,ip:t,created_from:d,created_to:$,...k};return Object.keys(n).forEach(f=>n[f]===void 0&&delete n[f]),n}const T={async list(u={}){const s=G(u),{data:a}=await C.get("/session-logs",{params:s});return a},async getById(u){const{data:s}=await C.get(`/session-logs/${u}`);return s}},J=V("sessionLog",()=>{const u=v({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),s=v(!1),a=v(null),p=v(!1),r=v(null);return{items:u,selected:r,isLoading:s,isLoaded:p,error:a,fetchAll:async(i={},o=!1)=>{if(a.value=null,!(!o&&p.value))try{s.value=!0;const e=await T.list(i);Object.assign(u.value,{total:e.total||0,totalPages:e.totalPages||1,currentPage:i.page||1,pageSize:i.limit||10,data:e.data||[]}),p.value=!0}catch(e){a.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to fetch session logs"}finally{s.value=!1}},fetchById:async i=>{a.value=null;try{s.value=!0;const o=await T.getById(i);return r.value=o,o}catch(o){throw a.value=o?.response?.data?.message||o?.response?.message||o?.message||"Failed to fetch session log",o}finally{s.value=!1}},resetStore:()=>{u.value={total:0,totalPages:1,currentPage:1,pageSize:10,data:[]},r.value=null,p.value=!1,s.value=!1,a.value=null}}}),X={class:"grid grid-cols-1 md:grid-cols-6 gap-2 mb-3 text-sm"},Y=["value"],Z={class:"flex justify-end"},ee=["onClick"],pe={__name:"SessionLogsPage",setup(u){const s=J(),a=v({page:1,limit:10,q:"",method:"",status:"",user_id:"",user_role:"",ip:"",created_from:"",created_to:"",sort:"created_at",order:"DESC"}),p=B(()=>({total:s.items.total||0,totalPages:s.items.totalPages||1,currentPage:s.items.currentPage||1,pageSize:s.items.pageSize||10,data:s.items.data||[]})),r=async(o={},e=!0)=>{a.value={...a.value,...o};const t={...a.value};["q","method","status","user_id","user_role","ip","created_from","created_to","sort","order"].forEach(d=>{(t[d]===""||t[d]==null)&&delete t[d]}),await s.fetchAll(t,e)};I(async()=>{await r({page:1,limit:10})});const S=["GET","POST","PUT","DELETE","PATCH","OPTIONS","HEAD"],w=o=>{const e=Number(o||0);return e>=500?"red":e>=400?"amber":e>=300?"blue":"emerald"},x=[{key:"created_at",label:"Created",sortable:!0,width:170},{key:"request_id",label:"Request ID",sortable:!1,minWidth:140},{key:"method",label:"Method",sortable:!0,width:90},{key:"route",label:"Route",sortable:!1,minWidth:220},{key:"status",label:"Status",sortable:!0,width:100},{key:"response_time_ms",label:"Time (ms)",sortable:!0,width:110},{key:"user_id",label:"User",sortable:!0,width:90},{key:"user_role",label:"Role",sortable:!0,width:110},{key:"ip",label:"IP",sortable:!1,width:130}],i=async o=>{await s.fetchById(o.id);const e=s.selected||o,t=[["Created",e.created_at?new Date(e.created_at).toLocaleString():"-"],["Request ID",e.request_id||"-"],["User",e.user_id||"-"],["Role",e.user_role||"-"],["Method",e.method||"-"],["Route",e.route||"-"],["Status",e.status||"-"],["Response Time (ms)",e.response_time_ms??"-"],["IP",e.ip||"-"],["Origin",e.origin||"-"],["Referer",e.referer||"-"],["User Agent",e.user_agent||"-"]],d=n=>typeof n=="string"?n:JSON.stringify(n,null,2),$=`
    <div class="text-left text-sm">
      ${t.map(([n,f])=>`<div><strong>${n}:</strong> ${d(f)}</div>`).join("")}
      <div class="mt-2"><strong>Query:</strong><pre class="mt-1 p-2 bg-gray-50 rounded overflow-auto">${d(e.query||"{}")}</pre></div>
      <div class="mt-2"><strong>Body:</strong><pre class="mt-1 p-2 bg-gray-50 rounded overflow-auto">${d(e.body||"{}")}</pre></div>
    </div>`;await(await O(async()=>{const{default:n}=await import("./index.BH0m-Moy.js").then(f=>f.ah);return{default:n}},__vite__mapDeps([0,1]),import.meta.url)).default.fire({title:"Session Log",html:$,width:800,confirmButtonText:"Close"})};return(o,e)=>(h(),L(M,null,{default:g(()=>[y(N,null,{default:g(()=>[y(F,{icon:_(K),title:"Session Logs",main:""},{default:g(()=>[y(j,{icon:_(z),small:"",onClick:e[0]||(e[0]=t=>r({},!0))},null,8,["icon"])]),_:1},8,["icon"]),l("div",X,[m(l("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>a.value.q=t),class:"border rounded px-2 py-1.5",placeholder:"Searchâ€¦",onKeyup:e[2]||(e[2]=b(t=>r({page:1}),["enter"]))},null,544),[[c,a.value.q]]),m(l("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.method=t),class:"border rounded px-2 py-1.5",onChange:e[4]||(e[4]=t=>r({page:1}))},[e[17]||(e[17]=l("option",{value:""},"Any method",-1)),(h(),D(E,null,R(S,t=>l("option",{key:t,value:t},P(t),9,Y)),64))],544),[[q,a.value.method]]),m(l("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.status=t),class:"border rounded px-2 py-1.5",placeholder:"Status (e.g., 200)",onKeyup:e[6]||(e[6]=b(t=>r({page:1}),["enter"]))},null,544),[[c,a.value.status]]),m(l("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>a.value.user_id=t),class:"border rounded px-2 py-1.5",placeholder:"User ID",onKeyup:e[8]||(e[8]=b(t=>r({page:1}),["enter"]))},null,544),[[c,a.value.user_id]]),m(l("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>a.value.user_role=t),class:"border rounded px-2 py-1.5",placeholder:"User Role",onKeyup:e[10]||(e[10]=b(t=>r({page:1}),["enter"]))},null,544),[[c,a.value.user_role]]),m(l("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>a.value.ip=t),class:"border rounded px-2 py-1.5",placeholder:"IP",onKeyup:e[12]||(e[12]=b(t=>r({page:1}),["enter"]))},null,544),[[c,a.value.ip]]),m(l("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>a.value.created_from=t),type:"date",class:"border rounded px-2 py-1.5",onChange:e[14]||(e[14]=t=>r({page:1}))},null,544),[[c,a.value.created_from]]),m(l("input",{"onUpdate:modelValue":e[15]||(e[15]=t=>a.value.created_to=t),type:"date",class:"border rounded px-2 py-1.5",onChange:e[16]||(e[16]=t=>r({page:1}))},null,544),[[c,a.value.created_to]])]),_(s).error?(h(),L(H,{key:0,color:"danger"},{default:g(()=>[A(P(_(s).error),1)]),_:1})):U("",!0),y(Q,{columns:x,data:p.value,loading:_(s).isLoading,onQueryChange:r},{"cell-created_at":g(({row:t})=>[l("span",null,P(t.created_at?new Date(t.created_at).toLocaleString():"-"),1)]),"cell-status":g(({row:t})=>[y(W,{text:t.status,tone:w(t.status)},null,8,["text","tone"])]),"cell-actions":g(({row:t})=>[l("div",Z,[l("button",{class:"px-2 py-1 text-xs rounded bg-gray-200",onClick:d=>i(t)},"View",8,ee)])]),_:1},8,["data","loading"])]),_:1})]),_:1}))}};export{pe as default};
