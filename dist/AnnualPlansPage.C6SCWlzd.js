import{c as B,r as A,o as K,E as pe,a as m,q as r,f as _,A as M,d as b,e as o,g as p,x as re,k as W,t as V,j as ue,F as Y,B as ee,S as x,u as fe,l as R,N as ve,h as Z,M as be,v as ye,C as ie}from"./index.BfTMC2Bg.js";import{u as ge,v as he,a8 as we,y as xe,a9 as Ce,aa as $e,ab as ke,z as me,A as _e,B as Ae,E as Be,F as Se,G as Ve,H as je,I as Ee,C as Fe,D as De,_ as Pe,a as Re,g as ze,J as Me,i as Te,K as Le,L as Ie,M as Ue,V as Oe}from"./SectionMain.CdN9JbDZ.js";import{_ as We,a as se}from"./SectionTitleLineWithButton.DMuhpn7E.js";import{_ as Ne,B as qe,a as Ge}from"./Badge.BIldjo8d.js";import{_ as z}from"./IconifyButton.D9w-nnrD.js";import{_ as ce}from"./AnnualPlanFormModal.CwalVvTF.js";import{u as de}from"./annualPlan.GzHf8iVD.js";import{i as Ye,a as Ke,b as Xe,F as Je}from"./index.fgbdyBZX.js";import{u as Qe}from"./clubScope.s43G-XX6.js";import"./appContext.CENcNP6E.js";import"./activityDesignService.BZUYSqkj.js";import"./utilizationRequestService.C4JHNbve.js";import"./liquidationFundService.uX5sZ-vg.js";import"./ToasterComponent.875IY_cI.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const He={class:"flex items-center gap-1 md:gap-2"},Ze=["aria-expanded"],et={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},tt=["d"],at={__name:"AnnualPlanRowActions",props:{row:{type:Object,required:!0},moderator:{type:Boolean,default:!1}},emits:["attachments","submit","approve","reject","edit","delete","view","cancel"],setup(f,{emit:c}){const C=f,j=B(()=>String(C.row?.status||"").toLowerCase()),$=B(()=>j.value==="draft"),h=B(()=>j.value==="draft"),y=B(()=>j.value!=="draft"),w=B(()=>C.moderator&&j.value==="pending"),D=B(()=>C.moderator&&j.value==="approved"),F=B(()=>C.moderator),v=A(!1),g=A(null),E=A(null),S=i=>{if(!v.value)return;const a=g.value,u=E.value;a&&!a.contains(i.target)&&u&&!u.contains(i.target)&&(v.value=!1)};return K(()=>document.addEventListener("click",S)),pe(()=>document.removeEventListener("click",S)),(i,a)=>(r(),m("div",He,[_(z,{"icon-path":p(ge),color:"text-indigo-600",label:"Attachments",tooltip:"Attachments",size:"sm",onClick:a[0]||(a[0]=u=>i.$emit("attachments",f.row))},null,8,["icon-path"]),y.value?(r(),M(z,{key:0,"icon-path":p(he),color:"text-gray-700",label:"View",tooltip:"View (read-only)",size:"sm",onClick:a[1]||(a[1]=u=>i.$emit("view",f.row))},null,8,["icon-path"])):b("",!0),$.value?(r(),M(z,{key:1,"icon-path":p(we),color:"text-blue-600",label:"Submit",tooltip:"Submit",size:"sm",onClick:a[2]||(a[2]=u=>i.$emit("submit",f.row))},null,8,["icon-path"])):b("",!0),h.value?(r(),M(z,{key:2,"icon-path":p(xe),color:"text-amber-600",label:"Edit",tooltip:"Edit",size:"sm",onClick:a[3]||(a[3]=u=>i.$emit("edit",f.row))},null,8,["icon-path"])):b("",!0),w.value?(r(),M(z,{key:3,"icon-path":p(Ce),color:"text-emerald-600",label:"Approve",tooltip:"Approve",size:"sm",onClick:a[4]||(a[4]=u=>i.$emit("approve",f.row))},null,8,["icon-path"])):b("",!0),w.value?(r(),M(z,{key:4,"icon-path":p($e),color:"text-rose-600",label:"Reject",tooltip:"Reject",size:"sm",onClick:a[5]||(a[5]=u=>i.$emit("reject",f.row))},null,8,["icon-path"])):b("",!0),D.value?(r(),M(z,{key:5,"icon-path":p(ke),color:"text-orange-600",label:"Cancel",tooltip:"Cancel plan",size:"sm",onClick:a[6]||(a[6]=u=>i.$emit("cancel",f.row))},null,8,["icon-path"])):b("",!0),F.value?(r(),M(z,{key:6,"icon-path":p(me),color:"text-red-600",label:"Delete",tooltip:"Delete",size:"sm",onClick:a[7]||(a[7]=u=>i.$emit("delete",f.row))},null,8,["icon-path"])):b("",!0),o("div",{class:"relative md:hidden",ref_key:"btnRef",ref:E},[o("button",{class:"inline-flex items-center justify-center rounded-xl p-1.5 hover:bg-gray-100","aria-expanded":v.value,"aria-haspopup":"menu",title:"More",onClick:a[8]||(a[8]=u=>v.value=!v.value)},[(r(),m("svg",et,[o("path",{d:p(_e)},null,8,tt)]))],8,Ze),v.value?(r(),m("div",{key:0,ref_key:"menuRef",ref:g,role:"menu",class:"absolute right-0 z-20 mt-1 w-44 overflow-hidden rounded-xl border bg-white shadow-lg"},[o("button",{role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:a[9]||(a[9]=u=>{v.value=!1,i.$emit("attachments",f.row)})},"Attachments"),y.value?(r(),m("button",{key:0,role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:a[10]||(a[10]=u=>{v.value=!1,i.$emit("view",f.row)})},"View (read-only)")):b("",!0),$.value?(r(),m("button",{key:1,role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:a[11]||(a[11]=u=>{v.value=!1,i.$emit("submit",f.row)})},"Submit")):b("",!0),h.value?(r(),m("button",{key:2,role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:a[12]||(a[12]=u=>{v.value=!1,i.$emit("edit",f.row)})},"Edit")):b("",!0),w.value?(r(),m("button",{key:3,role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:a[13]||(a[13]=u=>{v.value=!1,i.$emit("approve",f.row)})},"Approve")):b("",!0),w.value?(r(),m("button",{key:4,role:"menuitem",class:"w-full px-3 py-2 text-left text-sm text-rose-600 hover:bg-rose-50",onClick:a[14]||(a[14]=u=>{v.value=!1,i.$emit("reject",f.row)})},"Reject")):b("",!0),D.value?(r(),m("button",{key:5,role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:a[15]||(a[15]=u=>{v.value=!1,i.$emit("cancel",f.row)})},"Cancel")):b("",!0),F.value?(r(),m("button",{key:6,role:"menuitem",class:"w-full px-3 py-2 text-left text-sm text-red-600 hover:bg-red-50",onClick:a[16]||(a[16]=u=>{v.value=!1,i.$emit("delete",f.row)})},"Delete")):b("",!0)],512)):b("",!0)],512)]))}},nt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},ot={class:"bg-white p-4 rounded-xl shadow-xl w-[980px] max-h-screen overflow-auto"},lt={class:"flex items-center justify-between mb-3"},it={class:"text-lg font-semibold"},st={class:"text-gray-600"},rt={class:"flex items-center justify-between gap-2"},dt={class:"text-sm text-gray-600"},ut={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24"},ct=["d"],mt=["disabled"],pt={class:"mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"},ft={class:"aspect-video bg-white border rounded overflow-hidden flex items-center justify-center"},vt=["src"],bt={key:1,class:"flex items-center justify-center w-full h-full"},yt=["d"],gt={class:"mt-2 text-xs"},ht=["title"],wt={class:"text-gray-500 flex items-center justify-between"},xt={key:0},Ct={key:0},$t={class:"mt-2 flex items-center justify-between gap-2"},kt=["onClick","title"],_t={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24"},At=["d"],Bt=["onClick"],St={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24"},Vt=["d"],jt={key:0,class:"mt-6 text-center text-sm text-gray-500"},Et=10*1024*1024,Ft={__name:"AnnualPlanAttachmentsModal",props:{modelValue:{type:Boolean,default:!1},row:{type:Object,default:null}},emits:["update:modelValue"],setup(f,{emit:c}){const C=f,j=c,$=B({get:()=>C.modelValue,set:e=>j("update:modelValue",e)}),h=de(),y=A(null),w=A(!1),D=new Set(["image/png","image/jpeg","image/webp","application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]),F=new Set(["png","jpg","jpeg","webp","pdf","docx","xlsx"]),v=(e="")=>String(e).toLowerCase().match(/\.([a-z0-9]+)$/i)?.[1]||"",g=(e="")=>typeof e=="string"&&e.match(/^data:([^;]+);base64,/i)?.[1]||"",E=e=>e?.type&&D.has(e.type)||e?.name&&F.has(v(e.name)),S=(e="")=>String(e).startsWith("image/"),i=(e="")=>e==="application/pdf",a=(e="")=>e==="application/vnd.openxmlformats-officedocument.wordprocessingml.document",u=(e="")=>e==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",N=(e="")=>i(e)?Be:a(e)?Se:u(e)?Ve:S(e)?je:Ee,O=(e="")=>i(e)?"PDF":a(e)?"Word":u(e)?"Excel":S(e)?"Image":"File",T=(e="")=>i(e)?"pdf":a(e)?"docx":u(e)?"xlsx":e==="image/png"?"png":e==="image/jpeg"?"jpg":e==="image/webp"?"webp":"",q=(e="attachment",d="")=>/\.[a-z0-9]+$/i.test(e)?e:d?`${e}.${d.startsWith(".")?d.slice(1):d}`:e,L=e=>e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(1)} MB`,P=B(()=>{const e=y.value?.attachments;if(!e)return[];try{return Array.isArray(e)?e:JSON.parse(e||"[]")}catch{return[]}}),I=B(()=>(P.value||[]).map((e,d)=>{const s=e.mime||g(e.data)||"",k=v(e.name||"")||T(s),U=e.size??null,l=e.name||`${O(s)} ${d+1}`;return{id:e.id??d+1,name:l,data:e.data||"",url:e.url||e.href||e.path||"",mime:s,ext:k,size:U,filename:q(l,k)}}));re(()=>C.modelValue,async e=>{e&&C.row?.id&&(await h.fetchById(C.row.id),y.value=h.selected||C.row)});const X=async e=>{const d=e.target.files?.[0];if(e.target.value="",!(!d||!y.value?.id)){if(d.size>Et){await x.fire("File too large","Maximum size is 10 MB.","warning");return}if(!E(d)){await x.fire("Unsupported file","Only images, PDF, DOCX, XLSX allowed.","warning");return}try{w.value=!0,await h.uploadAttachment(y.value.id,d),await h.fetchById(y.value.id),y.value=h.selected}finally{w.value=!1}}},te=async e=>{!y.value?.id||!(await x.fire({title:"Remove attachment?",icon:"warning",showCancelButton:!0,confirmButtonText:"Remove",confirmButtonColor:"#d33"})).isConfirmed||(await h.deleteAttachment(y.value.id,e),await h.fetchById(y.value.id),y.value=h.selected)},ae=e=>{if(e.data&&String(e.data).startsWith("data:")&&S(e.mime)){const d=window.open();d&&d.document.write(`<img src="${e.data}" style="display:block;max-width:100%;height:auto;margin:0 auto;object-fit:contain"/>`);return}e.url&&window.open(String(e.url),"_blank")},G=e=>{const[d,s]=e.split(","),k=d.match(/data:([^;]+);base64/i)?.[1]||"application/octet-stream",U=atob(s),l=new Uint8Array(U.length);for(let t=0;t<U.length;t++)l[t]=U.charCodeAt(t);return new Blob([l],{type:k})},J=(e,d)=>{const s=URL.createObjectURL(e),k=document.createElement("a");k.href=s,k.download=d||"download",document.body.appendChild(k),k.click(),k.remove(),setTimeout(()=>URL.revokeObjectURL(s),1e3)},ne=async e=>{if(e.data&&String(e.data).startsWith("data:")){J(G(e.data),e.filename);return}if(e.url)try{const s=await(await fetch(e.url,{credentials:"include"})).blob();J(s,e.filename)}catch{const d=document.createElement("a");d.href=String(e.url),d.setAttribute("download",e.filename),document.body.appendChild(d),d.click(),d.remove()}},Q=e=>S(e.mime)?"Open":"Download",oe=e=>S(e.mime)?Fe:De,le=e=>S(e.mime)?ae(e):ne(e);return(e,d)=>$.value?(r(),m("div",nt,[o("div",ot,[o("div",lt,[o("h2",it,[d[1]||(d[1]=W(" Annual Plan Attachments — ",-1)),o("span",st,V(y.value?.reference_code||""),1)]),o("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:d[0]||(d[0]=s=>$.value=!1)},"Close")]),o("div",rt,[o("div",dt,[d[2]||(d[2]=W(" School Year: ",-1)),o("strong",null,V(y.value?.school_year||"—"),1)]),o("label",{class:ue(["inline-flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white rounded text-xs cursor-pointer disabled:opacity-60",{"opacity-60 pointer-events-none":w.value}])},[(r(),m("svg",ut,[o("path",{d:p(Ae)},null,8,ct)])),o("span",null,V(w.value?"Uploading…":"Upload"),1),o("input",{type:"file",class:"hidden",disabled:w.value,onChange:X,accept:".png,.jpg,.jpeg,.webp,.pdf,.docx,.xlsx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,image/png,image/jpeg,image/webp"},null,40,mt)],2)]),o("div",pt,[(r(!0),m(Y,null,ee(I.value,s=>(r(),m("div",{key:s.id,class:"border rounded-lg p-2 bg-gray-50 flex flex-col"},[o("div",ft,[s.data&&s.data.startsWith("data:")&&s.mime?.startsWith("image/")?(r(),m("img",{key:0,src:s.data,class:"object-contain w-full h-full",alt:"Attachment preview"},null,8,vt)):(r(),m("div",bt,[(r(),m("svg",{style:{width:"64px",height:"64px"},viewBox:"0 0 24 24",class:ue({"text-red-600":s.mime==="application/pdf","text-blue-600":s.mime==="application/vnd.openxmlformats-officedocument.wordprocessingml.document","text-emerald-600":s.mime==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text-gray-500":!s.mime||!s.mime.startsWith("image/")&&s.mime!=="application/pdf"})},[o("path",{d:N(s.mime)},null,8,yt)],2))]))]),o("div",gt,[o("div",{class:"font-medium truncate",title:s.name},V(s.name),9,ht),o("div",wt,[o("span",null,[W(V(O(s.mime))+" ",1),s.ext?(r(),m("span",xt,"("+V(s.ext.toUpperCase())+")",1)):b("",!0)]),s.size?(r(),m("span",Ct,V(L(s.size)),1)):b("",!0)])]),o("div",$t,[o("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-white border rounded text-xs hover:bg-gray-50",onClick:k=>le(s),title:Q(s)},[(r(),m("svg",_t,[o("path",{d:oe(s)},null,8,At)])),W(" "+V(Q(s)),1)],8,kt),o("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-red-600 text-white rounded text-xs",onClick:k=>te(s.id),title:"Remove"},[(r(),m("svg",St,[o("path",{d:p(me)},null,8,Vt)])),d[3]||(d[3]=W(" Remove ",-1))],8,Bt)])]))),128))]),I.value.length?b("",!0):(r(),m("div",jt," No attachments yet. "))])])):b("",!0)}},Dt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/35 backdrop-blur-sm"},Pt={class:"bg-white rounded-2xl shadow-2xl w-full sm:w-[1200px] max-w-[100vw] sm:max-w-[95vw] h-[100vh] sm:h-auto sm:max-h-[90vh] overflow-hidden"},Rt={class:"px-4 py-3 border-b flex items-center justify-between"},zt={class:"p-2 overflow-auto"},Mt={__name:"AnnualPlansCalendarModal",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","open"],setup(f,{emit:c}){const C=f,j=c,$=B({get:()=>C.modelValue,set:i=>j("update:modelValue",i)}),h=de(),y=A([]),w=i=>{if(Array.isArray(i))return i;try{return JSON.parse(i||"[]")}catch{return[]}},D=(i=[])=>{const a=[];i.forEach(u=>{const N=w(u.plans),O=u.club?.name?`[${u.club.name}] `:"";N.forEach((T,q)=>{const L=T?.date_of_implementation;if(!L)return;const P=`${O}${T.item||"Planned Activity"}`;a.push({id:`${u.id}-${q}`,title:P,start:`${L}T00:00:00`,end:`${L}T23:59:59`,backgroundColor:"#b45309",borderColor:"#92400e",textColor:"#ffffff",extendedProps:{annual_plan_id:u.id,reference_code:u.reference_code,school_year:u.school_year,funds:T?.funds??0,status:u.status}})})}),y.value=a},F=async()=>{await h.fetchAll({page:1,limit:500,status:"approved",sort:"created_at",order:"ASC"},!0),D(h.items.data||[])},v=i=>{const a=i?.event?.extendedProps?.annual_plan_id;a&&j("open",Number(a))},g=A(!1),E=()=>{g.value=window.innerWidth<640};K(()=>{E(),window.addEventListener("resize",E)});const S=B(()=>({plugins:[Ye,Ke,Xe],initialView:"dayGridMonth",headerToolbar:g.value?{left:"prev,next",center:"title",right:"dayGridMonth"}:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},height:"auto",handleWindowResize:!0,expandRows:!0,navLinks:!0,eventDisplay:"block",eventClick:v,events:y.value}));return re(()=>C.modelValue,i=>{i&&F()}),re(()=>h.items.data,i=>{$.value&&D(i||[])},{deep:!0}),K(()=>{$.value&&F()}),(i,a)=>$.value?(r(),m("div",Dt,[o("div",Pt,[o("div",Rt,[a[1]||(a[1]=o("h2",{class:"text-base font-semibold"},"Annual Plans Calendar (Approved)",-1)),o("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:a[0]||(a[0]=u=>$.value=!1)},"Close")]),o("div",zt,[_(p(Je),{options:S.value},null,8,["options"])]),a[2]||(a[2]=o("div",{class:"px-4 py-2 text-[11px] text-gray-500 border-t"}," Click a plan item to open its Annual Plan. ",-1))])])):b("",!0)}},Tt={class:"flex flex-wrap items-center gap-2 w-full sm:w-auto justify-start sm:justify-end"},Lt={class:"p-3 mb-4 rounded-xl border bg-white/60"},It={class:"flex items-center gap-2 mb-2 text-gray-700"},Ut={class:"w-4 h-4",viewBox:"0 0 24 24"},Ot=["d"],Wt={class:"grid grid-cols-1 md:grid-cols-6 gap-2 text-sm"},Nt={class:"md:col-span-2 flex"},qt={class:"w-5 h-5",viewBox:"0 0 24 24"},Gt=["d"],Yt=["value"],Kt=["disabled"],Xt=["value"],Jt=["value"],Qt={class:"flex items-center gap-2 md:col-span-2"},Ht={class:"font-medium"},fa={__name:"AnnualPlansPage",setup(f){const c=de(),C=fe(),j=B(()=>["admin","manager"].includes(String(C.user?.role||"").toLowerCase())),$=A(!1),h=()=>{$.value=!0},y=async l=>{try{await c.fetchById(l);const t=c.selected;t&&await G(t)}catch(t){console.error(t)}finally{$.value=!1}},w=A([]);K(async()=>{try{const{data:l}=await ve.get("/clubs",{params:{page:1,limit:500,order:"ASC",sort:"name"}});w.value=Array.isArray(l?.data)?l.data:[]}catch{w.value=[]}});const F=l=>w.value.find(t=>t.id===Number(l))?.name||"—",v=B(()=>{const l=new Date().getFullYear();return Array.from({length:6},(t,n)=>`${l-n}-${l-n+1}`)}),g=A({page:1,limit:10,sort:"created_at",order:"DESC",q:"",status:"",school_year:"",club_id:"",filed_by_user_id:"",approver_user_id:""}),{isClub:E,activeClubId:S,withClub:i}=Qe(),a=async(l={},t=!0)=>{g.value={...g.value,...l};const n=i({...g.value});["q","status","school_year","club_id","filed_by_user_id","approver_user_id"].forEach(H=>{(n[H]===""||n[H]==null)&&delete n[H]}),await c.fetchAll(n,t)};K(async()=>{await a({page:1,limit:10,club_id:E?S:""})});const u=B(()=>({total:c.items.total||0,totalPages:c.items.totalPages||1,currentPage:c.items.currentPage||1,pageSize:c.items.pageSize||10,data:c.items.data||[]})),N=["draft","pending","approved","rejected","cancelled","archived"],O=l=>{switch(String(l||"").toLowerCase()){case"draft":return"gray";case"pending":return"amber";case"approved":return"emerald";case"rejected":return"red";case"cancelled":return"zinc";case"archived":return"slate";default:return"gray"}},T=l=>{const t=Number(l);return Number.isFinite(t)?t.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):"—"},q=[{key:"reference_code",label:"Ref Code",sortable:!0,width:140},{key:"school_year",label:"School Year",sortable:!0,width:120},{key:"club",label:"Club",sortable:!1,minWidth:200,formatter:(l,t)=>t.club?.name||F(t.club_id)||""},{key:"total_budget",label:"Total Budget",sortable:!0,width:140},{key:"status",label:"Status",sortable:!0,width:110},{key:"created_at",label:"Created",sortable:!0,width:170}],L=async l=>{await a(l)},P=A(!1),I=A(!1),X=A(null),te=()=>{P.value=!0},ae=async l=>{await c.create(l),P.value=!1,await a({},!0)},G=async l=>{await c.fetchById(l.id);const t=c.selected||l;let n=[];try{n=Array.isArray(t.plans)?t.plans:JSON.parse(t.plans||"[]")}catch{}X.value={id:t.id,reference_code:t.reference_code,school_year:t.school_year||"",club_id:t.club_id||"",filed_by_user_id:t.filed_by_user_id||C.user?.id||"",approver_user_id:t.approver_user_id||"",plans:n,remarks:t.remarks||"",status:t.status||"draft"},I.value=!0},J=async l=>{const{id:t,...n}=l;await c.updateById(t,n),I.value=!1,await a({},!0)},ne=async l=>{if(!l?.id)return;(await x.fire({title:`Delete annual plan "${l.reference_code}"?`,text:"This cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it",cancelButtonText:"Cancel"})).isConfirmed&&(await c.deleteById(l.id),await a({},!0),await x.fire("Deleted","The annual plan has been deleted.","success"))},Q=async l=>{await G(l)},oe=async l=>{if((await x.fire({title:"Submit for approval?",text:"You can no longer edit after submission.",icon:"question",showCancelButton:!0,confirmButtonText:"Submit",cancelButtonText:"Cancel"})).isConfirmed)try{await c.submit(l.id),await a({},!0),await x.fire("Submitted","Annual plan is now pending approval.","success")}catch{await x.fire("Error",c.error||"Failed to submit.","error")}},le=async l=>{const t=await x.fire({title:"Approve annual plan?",input:"textarea",inputLabel:"Remarks (optional)",inputPlaceholder:"Add a note…",showCancelButton:!0,confirmButtonText:"Approve",cancelButtonText:"Cancel"});if(t.isConfirmed)try{await c.approve(l.id,t.value||""),await a({},!0),await x.fire("Approved","Annual plan has been approved.","success")}catch{await x.fire("Error",c.error||"Failed to approve.","error")}},e=async l=>{const t=await x.fire({title:"Reject annual plan?",input:"textarea",inputLabel:"Reason (required)",inputPlaceholder:"State the reason…",inputValidator:n=>n?.trim()?void 0:"Reason is required",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Reject",cancelButtonText:"Cancel"});if(t.isConfirmed)try{await c.reject(l.id,t.value),await a({},!0),await x.fire("Rejected","Annual plan has been rejected.","success")}catch{await x.fire("Error",c.error||"Failed to reject.","error")}},d=async l=>{const t=await x.fire({title:"Cancel annual plan?",input:"textarea",inputLabel:"Reason (required)",inputPlaceholder:"State the reason…",inputValidator:n=>n?.trim()?void 0:"Reason is required",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Cancel Plan",cancelButtonText:"Keep"});if(t.isConfirmed)try{await c.cancel(l.id,t.value),await c.updateById(l.id,{status:"draft"}),await a({},!0),await x.fire("Moved to Draft","Annual plan was cancelled and returned to Draft for editing.","success")}catch{await x.fire("Error",c.error||"Failed to cancel.","error")}},s=A(!1),k=A(null),U=async l=>{await c.fetchById(l.id),k.value=c.selected||l,s.value=!0};return(l,t)=>(r(),m(Y,null,[_(Pe,null,{default:R(()=>[_(Re,null,{default:R(()=>[p(c).error?(r(),M(Ne,{key:0,icon:p(ze),color:"danger"},{default:R(()=>[W(V(p(c).error),1)]),_:1},8,["icon"])):b("",!0),_(We,{icon:p(Me),title:"Annual Plans",main:""},{default:R(()=>[o("div",Tt,[_(se,{icon:p(Te),color:"info",label:"View Calendar",onClick:h},null,8,["icon"]),_(se,{icon:p(Le),color:"primary",label:"New Annual Plan",onClick:te},null,8,["icon"]),_(se,{icon:p(Ie),color:"info",label:"Refresh",onClick:t[0]||(t[0]=n=>a({},!0))},null,8,["icon"])])]),_:1},8,["icon"]),o("div",Lt,[o("div",It,[(r(),m("svg",Ut,[o("path",{d:p(Ue)},null,8,Ot)])),t[13]||(t[13]=o("span",{class:"font-medium text-sm"},"Filters",-1))]),o("div",Wt,[o("div",Nt,[Z(o("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>g.value.q=n),placeholder:"Search by ref, school year, remarks…",class:"border rounded-s px-2 py-2 flex-1",onKeyup:t[2]||(t[2]=be(n=>a({page:1}),["enter"]))},null,544),[[ye,g.value.q]]),o("button",{class:"px-3 border border-l-0 rounded-e bg-gray-50",title:"Search",onClick:t[3]||(t[3]=n=>a({page:1}))},[(r(),m("svg",qt,[o("path",{d:p(Oe)},null,8,Gt)]))])]),Z(o("select",{"onUpdate:modelValue":t[4]||(t[4]=n=>g.value.status=n),class:"border rounded px-2 py-2"},[t[14]||(t[14]=o("option",{value:""},"All status",-1)),(r(),m(Y,null,ee(N,n=>o("option",{key:n,value:n},V(n),9,Yt)),64))],512),[[ie,g.value.status]]),Z(o("select",{"onUpdate:modelValue":t[5]||(t[5]=n=>g.value.school_year=n),class:"border rounded px-2 py-2",disabled:l.readOnly},[t[15]||(t[15]=o("option",{value:""},"Select school year…",-1)),(r(!0),m(Y,null,ee(v.value,n=>(r(),m("option",{key:n,value:n},V(n),9,Xt))),128))],8,Kt),[[ie,g.value.school_year]]),Z(o("select",{"onUpdate:modelValue":t[6]||(t[6]=n=>g.value.club_id=n),class:"border rounded px-2 py-2"},[t[16]||(t[16]=o("option",{value:""},"Any club",-1)),(r(!0),m(Y,null,ee(w.value,n=>(r(),m("option",{key:n.id,value:n.id},V(n.name),9,Jt))),128))],512),[[ie,g.value.club_id]]),o("div",Qt,[o("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:t[7]||(t[7]=n=>a({page:1}))}," Apply Filters "),o("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:t[8]||(t[8]=()=>{g.value.value={page:1,limit:10,sort:"created_at",order:"DESC",q:"",status:"",school_year:"",club_id:""},a({page:1},!0)})},"Reset")])])]),_(qe,{columns:q,data:u.value,loading:p(c).isLoading,onQueryChange:L},{"cell-total_budget":R(({value:n})=>[o("span",Ht,V(T(n)),1)]),"cell-created_at":R(({value:n})=>[o("span",null,V(n?new Date(n).toLocaleString():"—"),1)]),"cell-status":R(({value:n})=>[_(Ge,{text:n||"—",tone:O(n)},null,8,["text","tone"])]),"cell-actions":R(({row:n})=>[_(at,{row:n,moderator:j.value,onAttachments:U,onSubmit:oe,onApprove:le,onReject:e,onEdit:G,onDelete:ne,onView:H=>Q(n),onCancel:d},null,8,["row","moderator","onView"])]),_:1},8,["data","loading"])]),_:1})]),_:1}),_(ce,{modelValue:P.value,"onUpdate:modelValue":t[9]||(t[9]=n=>P.value=n),mode:"create","locked-club-id":p(E)?p(S):"",onSubmit:ae},null,8,["modelValue","locked-club-id"]),_(ce,{modelValue:I.value,"onUpdate:modelValue":t[10]||(t[10]=n=>I.value=n),mode:"edit",initial:X.value||{},onSubmit:J},null,8,["modelValue","initial"]),_(Ft,{modelValue:s.value,"onUpdate:modelValue":t[11]||(t[11]=n=>s.value=n),row:k.value},null,8,["modelValue","row"]),_(Mt,{modelValue:$.value,"onUpdate:modelValue":t[12]||(t[12]=n=>$.value=n),onOpen:y},null,8,["modelValue"])],64))}};export{fa as default};
