import{u as le,z as ae,c as m,s as oe,r as p,o as re,x as G,A as ne,l as R,G as ie,q as a,f as de,a as o,F as N,e,g as _,t as n,d as P,k as B,h as f,j as S,v as y,B as q,M as ue,S as g}from"./index.w1fTWaRQ.js";import{a as ce,c as pe}from"./imageCompression.CGjyEC1q.js";import{_ as ve,a as me,a1 as ge,y as fe,U as xe,a2 as _e,r as ye,Z as he,a3 as be,a4 as we}from"./SectionMain.Co2y8BLV.js";import{_ as ke}from"./_plugin-vue_export-helper.DlAUqK2U.js";import"./appContext.Db1VNKoe.js";import"./activityDesignService.DKPfTybd.js";import"./utilizationRequestService.BsNdNhg3.js";import"./liquidationFundService.n_EUG0wO.js";import"./ToasterComponent.C4X8owM8.js";const Ce={key:0,class:"rounded-2xl border bg-white p-6 text-sm text-gray-500"},Ue={class:"relative overflow-hidden rounded-2xl border bg-white shadow-sm"},je={class:"relative h-48 sm:h-80 md:h-[360px] w-full bg-gray-100 group overflow-hidden rounded-t-2xl"},Pe=["src"],Be={key:1,class:"flex h-full w-full items-center justify-center bg-gradient-to-r from-indigo-50 to-blue-50 text-indigo-500"},Se=["disabled"],Fe=["disabled"],Ae={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},Ne=["d"],Ve={class:"relative px-4 sm:px-6 pb-4 sm:pb-6"},$e={class:"-mt-10 sm:-mt-12 flex flex-col sm:flex-row items-start sm:items-end gap-4"},Ie={class:"relative h-24 w-24 sm:h-28 sm:w-28 rounded-full border-4 border-white bg-gray-100 overflow-hidden shadow"},De=["src"],Le={key:1,class:"flex h-full w-full items-center justify-center bg-gray-200 text-gray-600 font-semibold"},ze=["title","disabled"],Ee={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},Ke=["d"],Me={class:"mt-2 sm:mt-11"},Oe={class:"text-xl font-semibold text-gray-900"},Te={class:"text-sm text-gray-500"},Ge={key:0,class:"mt-2 max-w-2xl text-sm text-gray-700 whitespace-pre-line"},Re={class:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6"},qe={class:"lg:col-span-2 space-y-6"},Ze={class:"rounded-2xl border bg-white shadow-sm"},He={class:"border-b px-4 sm:px-6 py-3 flex items-center justify-between"},Je={class:"text-sm font-semibold text-gray-800 inline-flex items-center gap-2"},Qe={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},We=["d"],Xe={class:"px-4 sm:px-6 py-4"},Ye={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},es=["readonly"],ss=["readonly"],ts=["readonly"],ls={class:"sm:col-span-2"},as=["readonly"],os={key:0,class:"mt-4 flex justify-end"},rs=["disabled"],ns={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},is=["d"],ds={class:"rounded-2xl border bg-white shadow-sm"},us={class:"border-b px-4 sm:px-6 py-3 flex items-center justify-between"},cs={class:"text-sm font-semibold text-gray-800 inline-flex items-center gap-2"},ps={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},vs=["d"],ms={class:"text-xs text-gray-500"},gs={class:"p-4 sm:p-6"},fs={key:0,class:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4"},xs={key:1,class:"text-sm text-gray-500"},_s={key:2,class:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4"},ys=["title","onClick","onKeyup"],hs={class:"flex items-center gap-3"},bs={class:"h-10 w-10 rounded-lg bg-gray-100 overflow-hidden flex items-center justify-center text-xs font-semibold text-gray-600 shrink-0"},ws=["src"],ks={key:1},Cs={class:"min-w-0"},Us={class:"truncate text-sm font-medium text-gray-900"},js={class:"truncate text-xs text-gray-500"},Ps={class:"mt-3 flex items-center justify-between"},Bs={class:"inline-flex items-center rounded-full bg-indigo-50 px-2 py-[2px] text-[11px] text-indigo-700 ring-1 ring-indigo-200"},Ss={key:0,class:"inline-flex items-center rounded-full bg-gray-50 px-2 py-[2px] text-[11px] text-gray-700 ring-1 ring-gray-200"},Fs={class:"mt-2 text-[11px] text-gray-500 inline-flex items-center gap-1"},As={style:{width:"14px",height:"14px"},viewBox:"0 0 24 24"},Ns=["d"],Vs={class:"space-y-6"},$s={key:0,class:"rounded-2xl border bg-white shadow-sm"},Is={class:"border-b px-4 sm:px-6 py-3"},Ds={class:"text-sm font-semibold text-gray-800 inline-flex items-center gap-2"},Ls={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},zs=["d"],Es={class:"px-4 sm:px-6 py-4"},Ks={class:"mt-4 flex justify-end"},Ms=["disabled"],Os={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},Ts=["d"],Gs={class:"rounded-2xl border bg-white shadow-sm"},Rs={class:"p-4 sm:p-6 text-sm text-gray-700 space-y-2"},qs={class:"flex items-center justify-between"},Zs={class:"text-gray-500"},Hs={class:"flex items-center justify-between"},Js={class:"text-gray-500"},Qs={class:"flex items-center justify-between"},Ws={class:"text-gray-500"},Xs={__name:"ProfilePage",setup(Ys){const Z=le(),d=ae(),H=oe(),h=m(()=>{const t=H.params.id;return typeof t=="string"&&t.trim()?Number(t):null}),V=m(()=>Z.user||{}),F=m(()=>V.value?.id||null),c=m(()=>h.value||F.value),r=m(()=>!!F.value&&F.value===c.value),A=p(!1),$=async()=>{if(c.value){A.value=!0;try{await d.fetchById(c.value),z(),await se()}finally{A.value=!1}}};re($),G(()=>h.value,async()=>{await $()});const v=m(()=>{if(h.value){const t=d.selectedUser;return t&&t.id===h.value?t:null}return d.selectedUser||V.value||{}}),I=m(()=>v.value?.avatar||""),D=m(()=>v.value?.cover||""),L=m(()=>v.value?.bio||""),i=p({username:"",first_name:"",last_name:"",bio:""}),z=()=>{const t=h.value?d.selectedUser&&d.selectedUser.id===h.value?d.selectedUser:{}:v.value||{};Object.assign(i.value,{username:t.username||"",first_name:t.first_name||"",last_name:t.last_name||"",bio:t.bio||""})};G(v,z);const E=p(null),K=p(null),w=p(!1),k=p(!1),C=p(!1),b=p(!1),U=p(!1),u=p({old_password:"",new_password:"",confirm_password:""}),j=p([]),M=m(()=>{const t=i.value.first_name?.trim()||"",s=i.value.last_name?.trim()||"";return t||s?`${t} ${s}`.trim():v.value?.email||""}),O=t=>(t||"").split(" ").map(s=>s[0]).join("").slice(0,2).toUpperCase(),J=t=>{if(!t)return"—";const s=new Date(t);return isNaN(s)?"—":s.toLocaleDateString()},Q=()=>{r.value&&E.value?.click()},W=async t=>{const s=t.target.files?.[0];if(!(!s||!r.value||!c.value)){C.value=!0;try{const x=await pe(s);await d.uploadAvatar(c.value,x),g.fire("Updated","Profile photo updated!","success")}catch{g.fire("Upload failed",d.error||"Could not upload avatar","error")}finally{C.value=!1,t.target.value=""}}},X=async t=>{const s=t.target.files?.[0];if(!(!s||!r.value||!c.value)){b.value=!0;try{const x=await ce(s);await d.uploadCover(c.value,x),g.fire("Updated","Cover photo updated!","success")}catch{g.fire("Upload failed",d.error||"Could not upload cover","error")}finally{b.value=!1,t.target.value=""}}},Y=async()=>{if(!(!r.value||!c.value)){w.value=!0;try{await d.updateById(c.value,{username:i.value.username||null,first_name:i.value.first_name||null,last_name:i.value.last_name||null,bio:i.value.bio||null}),g.fire("Saved","Profile updated successfully","success")}catch{g.fire("Update failed",d.error||"Could not update profile","error")}finally{w.value=!1}}},ee=async()=>{if(r.value){if(!u.value.old_password||!u.value.new_password){g.fire("Missing fields","Please fill out both current and new password.","warning");return}if(u.value.new_password!==u.value.confirm_password){g.fire("Mismatch","New password and confirmation do not match.","warning");return}k.value=!0;try{await d.changePassword({old_password:u.value.old_password,new_password:u.value.new_password}),g.fire("Success","Password changed successfully","success"),Object.assign(u.value,{old_password:"",new_password:"",confirm_password:""})}catch{g.fire("Failed",d.error||"Could not change password","error")}finally{k.value=!1}}},se=async()=>{if(c.value){U.value=!0;try{const t=await d.fetchUserClubs(c.value,{force:!0});j.value=(t||[]).map(s=>({id:s.id,name:s.name,code:s.code,logo:s.logo||s.logo_url||"",role:s.membership?.role||"member",status:s.membership?.status||"active",joined_at:s.membership?.joined_at||null,category:s.category||null}))}catch(t){console.error(t)}finally{U.value=!1}}},T=t=>{t&&window.open(`/#/club/${t}`,"_self")};return(t,s)=>{const x=ie("pending-click");return a(),ne(ve,null,{default:R(()=>[de(me,null,{default:R(()=>[A.value||!v.value?(a(),o("div",Ce," Loading profile… ")):(a(),o(N,{key:1},[e("div",Ue,[e("div",je,[D.value?(a(),o("img",{key:0,src:D.value,alt:"Cover",class:"h-full w-full object-cover",loading:"lazy"},null,8,Pe)):(a(),o("div",Be,s[8]||(s[8]=[e("span",{class:"text-sm"},"No cover photo",-1)]))),e("input",{ref_key:"coverInput",ref:K,type:"file",accept:"image/*",class:"absolute inset-0 opacity-0 cursor-pointer",disabled:b.value||!r.value,onChange:X},null,40,Se),e("button",{type:"button",class:"absolute right-3 bottom-3 inline-flex items-center gap-2 rounded-xl bg-white/90 px-3 py-1.5 text-xs shadow hover:bg-white z-10 disabled:opacity-60",disabled:b.value||!r.value,onClick:s[0]||(s[0]=l=>K.value?.click())},[(a(),o("svg",Ae,[e("path",{d:_(ge)},null,8,Ne)])),e("span",null,n(b.value?"Uploading…":r.value?"Change cover":"Cover"),1)],8,Fe),s[9]||(s[9]=e("div",{class:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"},null,-1))]),e("div",Ve,[e("div",$e,[e("div",Ie,[I.value?(a(),o("img",{key:0,src:I.value,alt:"Avatar",class:"h-full w-full object-cover",loading:"lazy"},null,8,De)):(a(),o("div",Le,n(O(M.value)),1)),e("button",{type:"button",class:"absolute right-0 bottom-0 m-1 rounded-full bg-white p-1 shadow hover:bg-gray-50 disabled:opacity-60",title:C.value?"Uploading…":r.value?"Change photo":"View only",disabled:C.value||!r.value,onClick:Q},[(a(),o("svg",Ee,[e("path",{d:_(fe)},null,8,Ke)]))],8,ze),e("input",{ref_key:"avatarInput",ref:E,type:"file",accept:"image/*",class:"hidden",onChange:W},null,544)]),e("div",Me,[e("div",Oe,n(M.value),1),e("div",Te,"@"+n(i.value.username||"username"),1),L.value?(a(),o("div",Ge,n(L.value),1)):P("",!0)])])])]),e("div",Re,[e("div",qe,[e("div",Ze,[e("div",He,[e("h3",Je,[(a(),o("svg",Qe,[e("path",{d:_(xe)},null,8,We)])),B(" "+n(r.value?"Edit Profile":"Profile"),1)])]),e("div",Xe,[e("div",Ye,[e("div",null,[s[10]||(s[10]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Username",-1)),f(e("input",{"onUpdate:modelValue":s[1]||(s[1]=l=>i.value.username=l),readonly:!r.value,class:S(["w-full rounded-lg border px-3 py-2 text-sm disabled:bg-gray-50",r.value?"":"bg-gray-50 text-gray-700"]),placeholder:"yourhandle"},null,10,es),[[y,i.value.username]])]),e("div",null,[s[11]||(s[11]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"First name",-1)),f(e("input",{"onUpdate:modelValue":s[2]||(s[2]=l=>i.value.first_name=l),readonly:!r.value,class:S(["w-full rounded-lg border px-3 py-2 text-sm disabled:bg-gray-50",r.value?"":"bg-gray-50 text-gray-700"]),placeholder:"First name"},null,10,ss),[[y,i.value.first_name]])]),e("div",null,[s[12]||(s[12]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Last name",-1)),f(e("input",{"onUpdate:modelValue":s[3]||(s[3]=l=>i.value.last_name=l),readonly:!r.value,class:S(["w-full rounded-lg border px-3 py-2 text-sm disabled:bg-gray-50",r.value?"":"bg-gray-50 text-gray-700"]),placeholder:"Last name"},null,10,ts),[[y,i.value.last_name]])]),e("div",ls,[s[13]||(s[13]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Bio",-1)),f(e("textarea",{"onUpdate:modelValue":s[4]||(s[4]=l=>i.value.bio=l),rows:"4",readonly:!r.value,class:S(["w-full rounded-lg border px-3 py-2 text-sm disabled:bg-gray-50",r.value?"":"bg-gray-50 text-gray-700"]),placeholder:"Tell us about yourself…"},null,10,as),[[y,i.value.bio]])])]),r.value?(a(),o("div",os,[f((a(),o("button",{type:"button",class:"inline-flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-xs font-medium text-white hover:bg-blue-700 disabled:opacity-50",disabled:w.value},[(a(),o("svg",ns,[e("path",{d:_(_e)},null,8,is)])),e("span",null,n(w.value?"Saving…":"Save changes"),1)],8,rs)),[[x,Y]])])):P("",!0)])]),e("div",ds,[e("div",us,[e("h3",cs,[(a(),o("svg",ps,[e("path",{d:_(ye)},null,8,vs)])),s[14]||(s[14]=B(" Clubs ",-1))]),e("div",ms,n(U.value?"Loading…":`${j.value.length} affiliation(s)`),1)]),e("div",gs,[U.value?(a(),o("div",fs,[(a(),o(N,null,q(6,l=>e("div",{key:l,class:"animate-pulse rounded-xl border p-4"},s[15]||(s[15]=[e("div",{class:"flex items-center gap-3"},[e("div",{class:"h-10 w-10 rounded-lg bg-gray-200"}),e("div",{class:"flex-1"},[e("div",{class:"h-3 w-2/3 bg-gray-200 rounded mb-2"}),e("div",{class:"h-3 w-1/3 bg-gray-100 rounded"})])],-1),e("div",{class:"mt-4 h-6 w-24 bg-gray-100 rounded"},null,-1)]))),64))])):j.value.length?(a(),o("div",_s,[(a(!0),o(N,null,q(j.value,l=>(a(),o("div",{key:l.id,class:"group rounded-xl border p-4 hover:shadow-sm transition bg-white cursor-pointer focus:outline-none focus:ring-2 focus:ring-indigo-300",role:"button",tabindex:"0",title:`Open ${l.name}`,onClick:te=>T(l.id),onKeyup:ue(te=>T(l.id),["enter"])},[e("div",hs,[e("div",bs,[l.logo?(a(),o("img",{key:0,src:l.logo,alt:"",class:"h-full w-full object-cover"},null,8,ws)):(a(),o("span",ks,n(O(l.name||l.code)),1))]),e("div",Cs,[e("div",Us,n(l.name),1),e("div",js,"@"+n(l.code),1)])]),e("div",Ps,[e("span",Bs,n(l.role||"member"),1),l.category?(a(),o("span",Ss,n(l.category),1)):P("",!0)]),e("div",Fs,[(a(),o("svg",As,[e("path",{d:_(he)},null,8,Ns)])),B(" since "+n(J(l.joined_at)),1)])],40,ys))),128))])):(a(),o("div",xs," No clubs yet. "))])])]),e("div",Vs,[r.value?(a(),o("div",$s,[e("div",Is,[e("h3",Ds,[(a(),o("svg",Ls,[e("path",{d:_(be)},null,8,zs)])),s[16]||(s[16]=B(" Security ",-1))])]),e("div",Es,[s[17]||(s[17]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Current password",-1)),f(e("input",{"onUpdate:modelValue":s[5]||(s[5]=l=>u.value.old_password=l),type:"password",class:"mb-3 w-full rounded-lg border px-3 py-2 text-sm",placeholder:"••••••••"},null,512),[[y,u.value.old_password]]),s[18]||(s[18]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"New password",-1)),f(e("input",{"onUpdate:modelValue":s[6]||(s[6]=l=>u.value.new_password=l),type:"password",class:"mb-3 w-full rounded-lg border px-3 py-2 text-sm",placeholder:"New password"},null,512),[[y,u.value.new_password]]),s[19]||(s[19]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Confirm new password",-1)),f(e("input",{"onUpdate:modelValue":s[7]||(s[7]=l=>u.value.confirm_password=l),type:"password",class:"w-full rounded-lg border px-3 py-2 text-sm",placeholder:"Confirm password"},null,512),[[y,u.value.confirm_password]]),e("div",Ks,[f((a(),o("button",{type:"button",class:"inline-flex items-center gap-2 rounded-lg bg-emerald-600 px-4 py-2 text-xs font-medium text-white hover:bg-emerald-700 disabled:opacity-50",disabled:k.value},[(a(),o("svg",Os,[e("path",{d:_(we)},null,8,Ts)])),e("span",null,n(k.value?"Updating…":"Update password"),1)],8,Ms)),[[x,ee]])])])])):P("",!0),e("div",Gs,[s[23]||(s[23]=e("div",{class:"border-b px-4 sm:px-6 py-3"},[e("h3",{class:"text-sm font-semibold text-gray-800"},"Account")],-1)),e("div",Rs,[e("div",qs,[s[20]||(s[20]=e("span",null,"Email",-1)),e("span",Zs,n(v.value.email),1)]),e("div",Hs,[s[21]||(s[21]=e("span",null,"Role",-1)),e("span",Js,n(v.value.role||"user"),1)]),e("div",Qs,[s[22]||(s[22]=e("span",null,"2FA",-1)),e("span",Ws,n(v.value.twoFAEnabled?"Enabled":"Disabled"),1)])])])])])],64))]),_:1})]),_:1})}}},dt=ke(Xs,[["__scopeId","data-v-cf8f22ed"]]);export{dt as default};
