import{c as _,u as J,o as Q,r as $,x as G,G as K,a as c,d as x,q as p,e,t as m,k as f,h as n,C as W,g as D,j as b,F as O,B as M,v as i}from"./index.Dki9ofrk.js";import{u as X}from"./liquidationFund.DF8KU7_a.js";import{u as Z}from"./activityDesign.sTihms5S.js";import{u as ee}from"./clubScope.kJ0vNls-.js";const se={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},te={class:"bg-white p-4 md:p-5 rounded-2xl shadow-xl w-[1096px] max-h-screen overflow-auto"},oe={class:"flex items-center justify-between mb-3"},le={class:"flex items-center gap-3"},de={class:"text-lg font-semibold"},ae={class:"text-[11px] px-2 py-1 rounded bg-gray-100"},ne={key:0,class:"mb-3 text-xs px-3 py-2 rounded-lg border bg-amber-50 border-amber-200 text-amber-800"},ie={class:"text-sm mb-3"},ue=["disabled"],re=["value"],ce={key:0,class:"text-red-600 text-[11px] mt-1"},pe={key:1,class:"text-[11px] text-gray-500 mt-1"},_e={key:2,class:"text-[11px] text-amber-700 mt-1"},me={class:"mt-2 p-3 border rounded-lg bg-white"},be={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},ve=["disabled"],fe=["disabled"],ye=["disabled"],xe=["disabled"],ge=["disabled"],he=["disabled"],we={class:"md:col-span-2"},ke=["disabled"],Ue={class:"mt-3 text-sm"},Ve={class:"flex flex-wrap gap-4"},Se={class:"mt-4 text-sm"},Ce={class:"flex items-center justify-between"},Ae=["disabled"],Ne={class:"mt-2 border rounded overflow-hidden"},qe={class:"w-full text-xs"},Fe={class:"p-2"},Le=["onUpdate:modelValue","disabled"],$e={class:"p-2"},De=["onUpdate:modelValue","disabled"],Oe={class:"p-2"},Me=["onUpdate:modelValue","disabled"],Te={class:"p-2"},je=["onUpdate:modelValue","disabled"],Re={class:"p-2"},Be=["onUpdate:modelValue","disabled"],Ee={class:"p-2"},Ie=["onUpdate:modelValue","disabled"],Ye={class:"p-2"},Pe=["onUpdate:modelValue","disabled"],ze={class:"p-2 text-right"},He=["disabled","onClick"],Je={class:"mt-2 text-right text-sm"},Qe={class:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},Ge={key:0},Ke=["disabled"],We=["disabled"],Xe={class:"flex justify-end gap-2 mt-5"},Ze={key:0,class:"px-4 py-2 bg-blue-600 text-white rounded text-xs"},ls={__name:"LiquidationFundFormModal",props:{modelValue:{type:Boolean,default:!1},mode:{type:String,default:"create"},initial:{type:Object,default:()=>({id:null,reference_code:"",date_filed:"",activity_design_id:"",file_by_user_name:"",sources_of_fund:{contribution:0,payment_from_fines:0,solicitations:0,donations:0,other_sources:0,current_available_funds:0,other_sources_note:""},uses_of_fund:[],remarks:"",status:"draft"})}},emits:["update:modelValue","submit"],setup(T,{emit:j}){const y=T,C=j,U=_({get:()=>y.modelValue,set:t=>C("update:modelValue",t)}),V=J();X();const g=Z(),A=_(()=>String(V.user?.role||"").toLowerCase()==="admin"),{isClub:N,activeClubId:h}=ee(),q=_(()=>{const t=Array.isArray(g.items?.data)?g.items.data.filter(s=>String(s.status).toLowerCase()==="approved"):[];if(N.value&&h.value){const s=Number(h.value);return t.filter(a=>Number(a.club_id||a.club?.id)===s)}return t});Q(async()=>{const t={page:1,limit:200,status:"approved"},s=N.value&&h.value?{...t,club_id:h.value}:t;await g.fetchAll(s,!0)});const l=$(structuredClone(y.initial)),r=$({});G(()=>y.initial,t=>{let s=t.sources_of_fund,a=t.uses_of_fund;try{typeof s=="string"&&(s=JSON.parse(s||"{}"))}catch{}try{typeof a=="string"&&(a=JSON.parse(a||"[]"))}catch{}l.value={...t,sources_of_fund:{contribution:0,payment_from_fines:0,solicitations:0,donations:0,other_sources:0,current_available_funds:0,other_sources_note:"",...s||{}},uses_of_fund:Array.isArray(a)?a:[]},r.value={}},{immediate:!0});const R=_(()=>String(l.value?.status||"").toLowerCase()),d=_(()=>y.mode==="edit"&&R.value!=="draft"),B=_(()=>y.mode!=="edit"?"New Liquidation Fund":d.value?"View Liquidation (read-only)":"Edit Liquidation"),E=_(()=>y.mode==="edit"?"Save Changes":"Create"),I=t=>{const s=t?.name_of_activity||"Untitled",a=t?.reference_code?` [${t.reference_code}]`:"",o=t?.date_of_implementation?` • ${t.date_of_implementation}`:"";return`${s}${a}${o}`},v=t=>Number.isFinite(+t)?+t:0,F=_(()=>{const t=l.value.sources_of_fund||{};return v(t.contribution)+v(t.payment_from_fines)+v(t.solicitations)+v(t.donations)+v(t.other_sources)+v(t.current_available_funds)}),S=_(()=>Array.isArray(l.value.uses_of_fund)?l.value.uses_of_fund.reduce((t,s)=>t+v(s?.amount),0):0),L=_(()=>F.value-S.value),w=t=>Number(t).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),Y=()=>{Array.isArray(l.value.uses_of_fund)||(l.value.uses_of_fund=[]),l.value.uses_of_fund.push({date:"",qty:1,unit:"",particulars:"",sheet_no:"",amount:0,in_charge:""})},P=t=>{l.value.uses_of_fund.splice(t,1)},z=()=>{if(d.value)return!1;const t={};l.value.activity_design_id||(t.activity_design_id="Required");const s=l.value.sources_of_fund||{};return["contribution","payment_from_fines","solicitations","donations","other_sources","current_available_funds"].forEach(a=>{s[a]!=null&&Number(s[a])<0&&(t[`src_${a}`]="Must be ≥ 0")}),Array.isArray(l.value.uses_of_fund)&&l.value.uses_of_fund.forEach((a,o)=>{a?.qty!=null&&Number(a.qty)<=0&&(t[`use_${o}_qty`]="Qty must be > 0"),a?.amount!=null&&Number(a.amount)<0&&(t[`use_${o}_amount`]="Must be ≥ 0")}),r.value=t,Object.keys(t).length===0},H=()=>{if(d.value||!z())return;const t={...l.value};!t.filed_by_user_id&&V.user?.id&&(t.filed_by_user_id=V.user.id),A.value||delete t.file_by_user_name,C("submit",t)};return(t,s)=>{const a=K("pending-click");return U.value?(p(),c("div",se,[e("div",te,[e("div",oe,[e("div",le,[e("h2",de,m(B.value),1),e("span",ae,m(l.value.status),1)]),e("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:s[0]||(s[0]=o=>U.value=!1)},"Close")]),d.value?(p(),c("div",ne,[s[12]||(s[12]=f(" This liquidation is ",-1)),e("strong",null,m(l.value.status),1),s[13]||(s[13]=f(". Editing is disabled. ",-1))])):x("",!0),e("div",ie,[s[15]||(s[15]=e("label",{class:"block mb-1"},[f("Activity Design "),e("span",{class:"text-red-500"},"*")],-1)),n(e("select",{"onUpdate:modelValue":s[1]||(s[1]=o=>l.value.activity_design_id=o),class:b(["w-full border rounded px-2.5 py-2",r.value.activity_design_id?"border-red-500":""]),disabled:d.value||D(g).isLoading},[s[14]||(s[14]=e("option",{value:""},"Select approved activity design…",-1)),(p(!0),c(O,null,M(q.value,o=>(p(),c("option",{key:o.id,value:o.id},m(I(o)),9,re))),128))],10,ue),[[W,l.value.activity_design_id]]),r.value.activity_design_id?(p(),c("p",ce,m(r.value.activity_design_id),1)):x("",!0),D(g).isLoading?(p(),c("p",pe,"Loading approved activities…")):q.value.length?x("",!0):(p(),c("p",_e,"No approved activity designs found."))]),e("div",me,[s[27]||(s[27]=e("div",{class:"text-sm font-medium mb-2"},"Sources of Fund",-1)),e("div",be,[e("div",null,[s[16]||(s[16]=e("label",{class:"block mb-1"},"Contribution",-1)),n(e("input",{type:"number",step:"0.01",min:"0",class:b(["w-full border rounded px-2.5 py-2",r.value.src_contribution?"border-red-500":""]),placeholder:"0.00","onUpdate:modelValue":s[2]||(s[2]=o=>l.value.sources_of_fund.contribution=o),disabled:d.value},null,10,ve),[[i,l.value.sources_of_fund.contribution,void 0,{number:!0}]])]),e("div",null,[s[17]||(s[17]=e("label",{class:"block mb-1"},"Payment from Fines",-1)),n(e("input",{type:"number",step:"0.01",min:"0",class:b(["w-full border rounded px-2.5 py-2",r.value.src_payment_from_fines?"border-red-500":""]),placeholder:"0.00","onUpdate:modelValue":s[3]||(s[3]=o=>l.value.sources_of_fund.payment_from_fines=o),disabled:d.value},null,10,fe),[[i,l.value.sources_of_fund.payment_from_fines,void 0,{number:!0}]])]),e("div",null,[s[18]||(s[18]=e("label",{class:"block mb-1"},"Solicitations",-1)),n(e("input",{type:"number",step:"0.01",min:"0",class:b(["w-full border rounded px-2.5 py-2",r.value.src_solicitations?"border-red-500":""]),placeholder:"0.00","onUpdate:modelValue":s[4]||(s[4]=o=>l.value.sources_of_fund.solicitations=o),disabled:d.value},null,10,ye),[[i,l.value.sources_of_fund.solicitations,void 0,{number:!0}]])]),e("div",null,[s[19]||(s[19]=e("label",{class:"block mb-1"},"Donations",-1)),n(e("input",{type:"number",step:"0.01",min:"0",class:b(["w-full border rounded px-2.5 py-2",r.value.src_donations?"border-red-500":""]),placeholder:"0.00","onUpdate:modelValue":s[5]||(s[5]=o=>l.value.sources_of_fund.donations=o),disabled:d.value},null,10,xe),[[i,l.value.sources_of_fund.donations,void 0,{number:!0}]])]),e("div",null,[s[20]||(s[20]=e("label",{class:"block mb-1"},"Other Sources",-1)),n(e("input",{type:"number",step:"0.01",min:"0",class:b(["w-full border rounded px-2.5 py-2",r.value.src_other_sources?"border-red-500":""]),placeholder:"0.00","onUpdate:modelValue":s[6]||(s[6]=o=>l.value.sources_of_fund.other_sources=o),disabled:d.value},null,10,ge),[[i,l.value.sources_of_fund.other_sources,void 0,{number:!0}]])]),e("div",null,[s[21]||(s[21]=e("label",{class:"block mb-1"},"Current Available Funds",-1)),n(e("input",{type:"number",step:"0.01",min:"0",class:b(["w-full border rounded px-2.5 py-2",r.value.src_current_available_funds?"border-red-500":""]),placeholder:"0.00","onUpdate:modelValue":s[7]||(s[7]=o=>l.value.sources_of_fund.current_available_funds=o),disabled:d.value},null,10,he),[[i,l.value.sources_of_fund.current_available_funds,void 0,{number:!0}]])]),e("div",we,[s[22]||(s[22]=e("label",{class:"block mb-1"},"Other Sources Note (optional)",-1)),n(e("textarea",{rows:"2",class:"w-full border rounded px-2.5 py-2","onUpdate:modelValue":s[8]||(s[8]=o=>l.value.sources_of_fund.other_sources_note=o),disabled:d.value,placeholder:"Describe other sources (optional)"},null,8,ke),[[i,l.value.sources_of_fund.other_sources_note]])])]),e("div",Ue,[e("div",Ve,[e("div",null,[s[23]||(s[23]=f("Total Sources: ",-1)),e("strong",null,m(w(F.value)),1)]),e("div",null,[s[24]||(s[24]=f("Total Uses: ",-1)),e("strong",null,m(w(S.value)),1)]),e("div",null,[s[25]||(s[25]=f("Cash on Hand: ",-1)),e("strong",{class:b(L.value<0?"text-red-600":"text-emerald-700")},m(w(L.value)),3)])]),s[26]||(s[26]=e("p",{class:"text-[11px] text-gray-500 mt-1"},"Server recalculates totals on save.",-1))])]),e("div",Se,[e("div",Ce,[s[28]||(s[28]=e("label",{class:"block mb-1 font-medium"},"Use of Fund",-1)),e("button",{class:"px-3 py-1 bg-gray-200 rounded text-xs",disabled:d.value,onClick:Y},"Add Row",8,Ae)]),e("div",Ne,[e("table",qe,[s[29]||(s[29]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"text-left p-2"},"Date"),e("th",{class:"text-left p-2"},"Qty"),e("th",{class:"text-left p-2"},"Unit"),e("th",{class:"text-left p-2"},"Particulars"),e("th",{class:"text-left p-2"},"Sheet No."),e("th",{class:"text-left p-2"},"Amount"),e("th",{class:"text-left p-2"},"In-Charge"),e("th",{class:"p-2 w-16"})])],-1)),e("tbody",null,[(p(!0),c(O,null,M(l.value.uses_of_fund,(o,k)=>(p(),c("tr",{key:k,class:"border-t"},[e("td",Fe,[n(e("input",{type:"date","onUpdate:modelValue":u=>o.date=u,class:"border rounded px-2 py-1",disabled:d.value,placeholder:"YYYY-MM-DD"},null,8,Le),[[i,o.date]])]),e("td",$e,[n(e("input",{type:"number",min:"1","onUpdate:modelValue":u=>o.qty=u,class:b(["w-20 border rounded px-2 py-1",r.value[`use_${k}_qty`]?"border-red-500":""]),disabled:d.value,placeholder:"1"},null,10,De),[[i,o.qty,void 0,{number:!0}]])]),e("td",Oe,[n(e("input",{"onUpdate:modelValue":u=>o.unit=u,class:"w-20 border rounded px-2 py-1",disabled:d.value,placeholder:"e.g., pcs"},null,8,Me),[[i,o.unit]])]),e("td",Te,[n(e("input",{"onUpdate:modelValue":u=>o.particulars=u,class:"w-52 border rounded px-2 py-1",disabled:d.value,placeholder:"Item/service details"},null,8,je),[[i,o.particulars]])]),e("td",Re,[n(e("input",{"onUpdate:modelValue":u=>o.sheet_no=u,class:"w-24 border rounded px-2 py-1",disabled:d.value,placeholder:"Ref / Sheet No."},null,8,Be),[[i,o.sheet_no]])]),e("td",Ee,[n(e("input",{type:"number",step:"0.01",min:"0","onUpdate:modelValue":u=>o.amount=u,class:b(["w-28 border rounded px-2 py-1",r.value[`use_${k}_amount`]?"border-red-500":""]),disabled:d.value,placeholder:"0.00"},null,10,Ie),[[i,o.amount,void 0,{number:!0}]])]),e("td",Ye,[n(e("input",{"onUpdate:modelValue":u=>o.in_charge=u,class:"w-32 border rounded px-2 py-1",disabled:d.value,placeholder:"Person responsible"},null,8,Pe),[[i,o.in_charge]])]),e("td",ze,[e("button",{class:"px-2 py-1 bg-red-50 text-red-700 rounded",disabled:d.value,onClick:u=>P(k)},"Remove",8,He)])]))),128))])])]),e("div",Je,[s[30]||(s[30]=e("span",{class:"mr-4"},"Total Uses:",-1)),e("strong",null,m(w(S.value)),1)])]),e("div",Qe,[A.value?(p(),c("div",Ge,[s[31]||(s[31]=e("label",{class:"block mb-1"},"Filer Name Override (optional)",-1)),n(e("input",{"onUpdate:modelValue":s[9]||(s[9]=o=>l.value.file_by_user_name=o),class:"w-full border rounded px-2.5 py-2",disabled:d.value,placeholder:"If provided, this name appears as the filer"},null,8,Ke),[[i,l.value.file_by_user_name]])])):x("",!0),e("div",null,[s[32]||(s[32]=e("label",{class:"block mb-1"},"Remarks",-1)),n(e("textarea",{"onUpdate:modelValue":s[10]||(s[10]=o=>l.value.remarks=o),rows:"3",class:"w-full border rounded px-2.5 py-2",disabled:d.value,placeholder:"Optional remarks"},null,8,We),[[i,l.value.remarks]])])]),e("div",Xe,[e("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:s[11]||(s[11]=o=>U.value=!1)},"Close"),d.value?x("",!0):n((p(),c("button",Ze,[f(m(E.value),1)])),[[a,H]])])])])):x("",!0)}}};export{ls as _};
