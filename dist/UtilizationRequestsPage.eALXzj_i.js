import{c as q,r as _,x as be,a as C,d as G,q as x,e as s,k as le,t as V,j as Se,g as E,F as ee,B as ie,S,o as he,f as T,h as L,v as Q,C as me,u as qe,z as We,l as j,A as Ce,M as Ge,Q as Ae}from"./index.Dmn8qN4r.js";import{E as Je,a as U,d as xe,Q as ke,_ as Ke}from"./dayjs.min.BtELzcve.js";import{B as Qe,E as He,F as Xe,G as Ze,H as et,I as tt,C as at,D as lt,z as it,_ as st,a as nt,g as ot,J as rt,i as dt,a7 as ct,K as ut,L as mt,M as ft,V as pt}from"./SectionMain.Duzyxrcj.js";import{_ as yt,a as ue}from"./SectionTitleLineWithButton.C-SOgUzU.js";import{_ as vt,B as gt,a as ge}from"./Badge.4-3Jxaei.js";import{_ as $e}from"./UtilizationRequestFormModal.BPmcU0Qj.js";import{u as fe}from"./utilizationRequest.CshDVSxD.js";import{i as bt,a as ht,b as _t,F as xt}from"./index.DpwOedWX.js";import{Q as wt}from"./browser.C_RxLcca.js";import{_ as St}from"./StatusTrailModal.jdA16cxL.js";import{u as Ct}from"./clubScope.C_7kkY_i.js";import"./IconifyButton.B-k6G2nT.js";import"./appContext.HVyTrVxu.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";import"./activityDesignService.GniX2otu.js";import"./utilizationRequestService.BXmSG4gY.js";import"./liquidationFundService.CgSQdmoz.js";import"./ToasterComponent.Xv1dhG9u.js";import"./club.pXFIu5a0.js";import"./activityDesign.9rGiTUHg.js";const At={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},kt={class:"bg-white p-4 rounded-xl shadow-xl w-[980px] max-h-screen overflow-auto"},$t={class:"flex items-center justify-between mb-3"},Tt={class:"text-lg font-semibold"},Et={class:"text-gray-600"},Ft={class:"flex items-center justify-between gap-2"},Rt={class:"text-sm text-gray-600"},Bt={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},zt=["d"],Vt=["disabled"],It={class:"mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"},Ut={class:"aspect-video bg-white border rounded overflow-hidden flex items-center justify-center"},Ot=["src"],Nt={key:1,class:"flex items-center justify-center w-full h-full"},Dt=["d"],Pt={class:"mt-2 text-xs"},Lt=["title"],Yt={class:"text-gray-500 flex items-center justify-between"},Mt={key:0},jt={key:0},qt={class:"mt-2 flex items-center justify-between gap-2"},Wt=["onClick","title"],Gt={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},Jt=["d"],Kt=["onClick"],Qt={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},Ht=["d"],Xt={key:0,class:"mt-6 text-center text-sm text-gray-500"},Zt=10*1024*1024,ea={__name:"UtilizationAttachmentsModal",props:{modelValue:{type:Boolean,default:!1},row:{type:Object,default:null}},emits:["update:modelValue"],setup(t,{emit:i}){const w=t,d=i,g=q({get:()=>w.modelValue,set:l=>d("update:modelValue",l)}),c=fe(),r=_(null),y=_(!1),A=new Set(["image/png","image/jpeg","image/webp","application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]),F=new Set(["png","jpg","jpeg","webp","pdf","docx","xlsx"]),O=(l="")=>String(l).toLowerCase().match(/\.([a-z0-9]+)$/i)?.[1]||"",N=(l="")=>typeof l=="string"&&l.match(/^data:([^;]+);base64,/i)?.[1]||"",P=l=>{const u=l?.type&&A.has(l.type),f=l?.name&&F.has(O(l.name));return u||f},R=(l="")=>String(l).startsWith("image/"),m=(l="")=>l==="application/pdf",n=(l="")=>l==="application/vnd.openxmlformats-officedocument.wordprocessingml.document",p=(l="")=>l==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",$=(l="")=>m(l)?He:n(l)?Xe:p(l)?Ze:R(l)?et:tt,I=(l="")=>m(l)?"PDF":n(l)?"Word":p(l)?"Excel":R(l)?"Image":"File",k=(l="")=>m(l)?"pdf":n(l)?"docx":p(l)?"xlsx":l==="image/png"?"png":l==="image/jpeg"?"jpg":l==="image/webp"?"webp":"",B=(l="attachment",u="")=>/\.[a-z0-9]+$/i.test(l)?l:u?`${l}.${u.startsWith(".")?u.slice(1):u}`:l,v=l=>l<1024?`${l} B`:l<1024*1024?`${(l/1024).toFixed(1)} KB`:`${(l/(1024*1024)).toFixed(1)} MB`,W=q(()=>{const l=r.value?.attachments;if(!l)return[];try{return Array.isArray(l)?l:JSON.parse(l||"[]")}catch{return[]}}),z=q(()=>(W.value||[]).map((l,u)=>{const f=l.mime||N(l.data)||(l.name?O(l.name)==="pdf"&&"application/pdf":"")||"",D=O(l.name||"")||k(f),K=l.size??null,X=l.name||`${I(f)} ${u+1}`;return{id:l.id??u+1,name:X,data:l.data||"",url:l.url||l.href||l.path||"",mime:f,ext:D,size:K,filename:B(X,D)}}));be(()=>w.modelValue,async l=>{l&&w.row?.id&&(await c.fetchById(w.row.id),r.value=c.selected||w.row)},{immediate:!1});const b=async l=>{const u=l.target.files?.[0];if(l.target.value="",!(!u||!r.value?.id)){if(u.size>Zt){await S.fire("File too large","Maximum size is 10 MB.","warning");return}if(!P(u)){await S.fire("Unsupported file","Only images (PNG/JPEG/WEBP), PDF, DOCX, and XLSX are allowed.","warning");return}try{y.value=!0,await c.uploadAttachment(r.value.id,u),await c.fetchById(r.value.id),r.value=c.selected}finally{y.value=!1}}},Y=async l=>{!r.value?.id||!(await S.fire({title:"Remove attachment?",icon:"warning",showCancelButton:!0,confirmButtonText:"Remove",confirmButtonColor:"#d33"})).isConfirmed||(await c.deleteAttachment(r.value.id,l),await c.fetchById(r.value.id),r.value=c.selected)},H=l=>{if(l.data&&String(l.data).startsWith("data:")&&R(l.mime)){const u=window.open();u&&u.document.write(`<img src="${l.data}" style="display:block;max-width:100%;height:auto;margin:0 auto;object-fit:contain"/>`);return}l.url&&window.open(String(l.url),"_blank")},se=l=>{const[u,f]=l.split(","),D=u.match(/data:([^;]+);base64/i)?.[1]||"application/octet-stream",K=atob(f),X=K.length,re=new Uint8Array(X);for(let ae=0;ae<X;ae++)re[ae]=K.charCodeAt(ae);return new Blob([re],{type:D})},J=(l,u)=>{const f=URL.createObjectURL(l),D=document.createElement("a");D.href=f,D.download=u||"download",document.body.appendChild(D),D.click(),D.remove(),setTimeout(()=>URL.revokeObjectURL(f),1e3)},pe=async l=>{if(l.data&&String(l.data).startsWith("data:")){const u=se(l.data);J(u,l.filename);return}if(l.url)try{const f=await(await fetch(l.url,{credentials:"include"})).blob();J(f,l.filename)}catch{const u=document.createElement("a");u.href=String(l.url),u.setAttribute("download",l.filename),document.body.appendChild(u),u.click(),u.remove()}},oe=l=>R(l.mime)?"Open":"Download",ye=l=>R(l.mime)?at:lt,te=l=>R(l.mime)?H(l):pe(l);return(l,u)=>g.value?(x(),C("div",At,[s("div",kt,[s("div",$t,[s("h2",Tt,[u[1]||(u[1]=le(" Utilization Attachments — ",-1)),s("span",Et,V(r.value?.reference_code||""),1)]),s("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:u[0]||(u[0]=f=>g.value=!1)},"Close")]),s("div",Ft,[s("div",Rt,[u[2]||(u[2]=le(" Activity: ",-1)),s("strong",null,V(r.value?.activity_design?.name_of_activity||"—"),1)]),s("label",{class:Se(["inline-flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white rounded text-xs cursor-pointer disabled:opacity-60",{"opacity-60 pointer-events-none":y.value}])},[(x(),C("svg",Bt,[s("path",{d:E(Qe)},null,8,zt)])),s("span",null,V(y.value?"Uploading…":"Upload"),1),s("input",{type:"file",class:"hidden",disabled:y.value,onChange:b,accept:".png,.jpg,.jpeg,.webp,.pdf,.docx,.xlsx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,image/png,image/jpeg,image/webp"},null,40,Vt)],2)]),s("div",It,[(x(!0),C(ee,null,ie(z.value,f=>(x(),C("div",{key:f.id,class:"border rounded-lg p-2 bg-gray-50 flex flex-col"},[s("div",Ut,[R(f.mime)&&f.data&&f.data.startsWith("data:")?(x(),C("img",{key:0,src:f.data,class:"object-contain w-full h-full",alt:"Attachment preview"},null,8,Ot)):(x(),C("div",Nt,[(x(),C("svg",{style:{width:"64px",height:"64px"},viewBox:"0 0 24 24","aria-hidden":"true",class:Se({"text-red-600":m(f.mime),"text-blue-600":n(f.mime),"text-emerald-600":p(f.mime),"text-gray-500":!f.mime||!R(f.mime)&&!m(f.mime)})},[s("path",{d:$(f.mime)},null,8,Dt)],2))]))]),s("div",Pt,[s("div",{class:"font-medium truncate",title:f.name},V(f.name),9,Lt),s("div",Yt,[s("span",null,[le(V(I(f.mime))+" ",1),f.ext?(x(),C("span",Mt,"("+V(f.ext.toUpperCase())+")",1)):G("",!0)]),f.size?(x(),C("span",jt,V(v(f.size)),1)):G("",!0)])]),s("div",qt,[s("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-white border rounded text-xs hover:bg-gray-50",onClick:D=>te(f),title:oe(f)},[(x(),C("svg",Gt,[s("path",{d:ye(f)},null,8,Jt)])),le(" "+V(oe(f)),1)],8,Wt),s("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-red-600 text-white rounded text-xs",onClick:D=>Y(f.id),title:"Remove"},[(x(),C("svg",Qt,[s("path",{d:E(it)},null,8,Ht)])),u[3]||(u[3]=le(" Remove ",-1))],8,Kt)])]))),128))]),z.value.length?G("",!0):(x(),C("div",Xt," No attachments yet. "))])])):G("",!0)}},ta={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/35 backdrop-blur-sm"},aa={class:"bg-white rounded-2xl shadow-2xl w-full sm:w-[1200px] max-w-[100vw] sm:max-w-[95vw] h-[100vh] sm:h-auto sm:max-h-[90vh] overflow-hidden"},la={class:"px-4 py-3 border-b flex items-center justify-between"},ia={class:"p-2 overflow-auto"},sa={__name:"CalendarViewModal",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","open"],setup(t,{emit:i}){const w=t,d=i,g=q({get:()=>w.modelValue,set:m=>d("update:modelValue",m)}),c=fe(),r=_([]),y=(m,n=[])=>{if(Array.isArray(m))return m;try{return JSON.parse(m||"[]")||n}catch{return n}},A=(m=[])=>{r.value=m.map(n=>{const p=y(n.facilities),$=[];n.activity_design?.name_of_activity&&$.push(n.activity_design.name_of_activity),p.length&&$.push(p.join(", "));const I=$.join(" — ")||n.reference_code||"Utilization",k=n.start_date&&n.start_time&&`${n.start_date}T${n.start_time}:00`||n.start_at||null,B=n.end_date&&n.end_time&&`${n.end_date}T${n.end_time}:00`||n.end_at||null;return!k||!B?null:{id:String(n.id),title:I,start:k,end:B,backgroundColor:"#047857",borderColor:"#065f46",textColor:"#ffffff",extendedProps:{reference_code:n.reference_code,facilities:p,availability_status:n.availability_status,status:n.status}}}).filter(Boolean)},F=async()=>{await c.fetchAll({page:1,limit:500,status:"approved",order:"ASC",sort:"start_at"},!0),A(c.items.data||[])},O=m=>{const n=m?.event?.id;n&&d("open",Number(n))},N=_(!1),P=()=>{N.value=window.innerWidth<640};he(()=>{P(),window.addEventListener("resize",P)});const R=q(()=>({plugins:[bt,ht,_t],initialView:"dayGridMonth",headerToolbar:N.value?{left:"prev,next",center:"title",right:"dayGridMonth"}:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},height:"auto",handleWindowResize:!0,expandRows:!0,navLinks:!0,eventDisplay:"block",eventClick:O,events:r.value}));return be(()=>w.modelValue,m=>{m&&F()}),be(()=>c.items.data,m=>{g.value&&A(m||[])},{deep:!0}),he(()=>{g.value&&F()}),(m,n)=>g.value?(x(),C("div",ta,[s("div",aa,[s("div",la,[n[1]||(n[1]=s("h2",{class:"text-base font-semibold"},"Utilization Calendar (Approved)",-1)),s("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:n[0]||(n[0]=p=>g.value=!1)},"Close")]),s("div",ia,[T(E(xt),{options:R.value},null,8,["options"])]),n[2]||(n[2]=s("div",{class:"px-4 py-2 text-[11px] text-gray-500 border-t"}," Click an event to open it. ",-1))])])):G("",!0)}},na={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},oa={class:"bg-white p-3 md:p-4 rounded-xl shadow-lg w-[560px] max-h-[85vh] overflow-y-auto"},ra={class:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm"},da={class:"md:col-span-2"},ca=["value"],ua={__name:"QuickAvailabilityModal",props:{modelValue:{type:Boolean,default:!1},facilities:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(t,{emit:i}){const w=t,d=i,g=fe(),c=_(""),r=_("08:00"),y=_(""),A=_("10:00"),F=_([]),O=q(()=>(F.value||[]).filter(m=>w.facilities.includes(m))),N=()=>d("update:modelValue",!1),P=()=>{c.value="",r.value="08:00",y.value="",A.value="10:00",F.value=[]},R=async()=>{if(!c.value||!y.value||!O.value.length){await S.fire("Missing fields","Start/End dates and at least one facility are required.","info");return}try{const m=await g.checkAvailability({start_date:c.value,start_time:r.value||"00:00",end_date:y.value,end_time:A.value||"00:00",facilities:O.value}),n=m.available_for_all?"All selected facilities are available.":`Conflicts on: ${(m.conflict_facilities||[]).join(", ")||"—"}`;await S.fire({icon:m.available_for_all?"success":"warning",title:"Availability Result",html:`<div class="text-left text-sm">
        <div><strong>Facilities:</strong> ${(m.facilities||[]).join(", ")}</div>
        <div class="mt-2"><strong>Status:</strong> ${n}</div>
        <div class="mt-2"><strong>Conflicts:</strong> ${Array.isArray(m.conflicts)&&m.conflicts.length?`<ul class="list-disc ml-5">${m.conflicts.map(p=>`<li>${p.reference_code} — ${new Date(p.start_at).toLocaleString()} to ${new Date(p.end_at).toLocaleString()}</li>`).join("")}</ul>`:"None"}</div>
      </div>`})}catch(m){await S.fire("Error",g.error||"Failed to check availability.","error"),console.error(m)}};return(m,n)=>t.modelValue?(x(),C("div",na,[s("div",oa,[s("div",{class:"flex items-center justify-between mb-2"},[n[5]||(n[5]=s("h3",{class:"text-base font-semibold"},"Quick Availability Check",-1)),s("button",{class:"px-2.5 py-1 text-[11px] bg-gray-200 rounded",onClick:N},"Close")]),s("div",ra,[s("div",null,[n[6]||(n[6]=s("label",{class:"block mb-0.5"},"Start Date",-1)),L(s("input",{"onUpdate:modelValue":n[0]||(n[0]=p=>c.value=p),type:"date",class:"w-full border rounded px-2 py-1.5"},null,512),[[Q,c.value]])]),s("div",null,[n[7]||(n[7]=s("label",{class:"block mb-0.5"},"Start Time",-1)),L(s("input",{"onUpdate:modelValue":n[1]||(n[1]=p=>r.value=p),type:"time",class:"w-full border rounded px-2 py-1.5"},null,512),[[Q,r.value]])]),s("div",null,[n[8]||(n[8]=s("label",{class:"block mb-0.5"},"End Date",-1)),L(s("input",{"onUpdate:modelValue":n[2]||(n[2]=p=>y.value=p),type:"date",class:"w-full border rounded px-2 py-1.5"},null,512),[[Q,y.value]])]),s("div",null,[n[9]||(n[9]=s("label",{class:"block mb-0.5"},"End Time",-1)),L(s("input",{"onUpdate:modelValue":n[3]||(n[3]=p=>A.value=p),type:"time",class:"w-full border rounded px-2 py-1.5"},null,512),[[Q,A.value]])]),s("div",da,[n[10]||(n[10]=s("label",{class:"block mb-0.5"},"Facilities",-1)),L(s("select",{"onUpdate:modelValue":n[4]||(n[4]=p=>F.value=p),multiple:"",class:"w-full border rounded px-2 py-1.5 min-h-[40px]"},[(x(!0),C(ee,null,ie(t.facilities,p=>(x(),C("option",{key:p,value:p},V(p),9,ca))),128))],512),[[me,F.value]]),n[11]||(n[11]=s("p",{class:"text-[11px] text-gray-500 mt-0.5"},"Hold Ctrl/Cmd to select multiple.",-1))])]),s("div",{class:"flex justify-end gap-1.5 mt-4"},[s("button",{class:"px-3 py-1.5 bg-gray-200 rounded text-xs",onClick:P},"Reset"),s("button",{class:"px-3 py-1.5 bg-indigo-600 text-white rounded text-xs",onClick:R},"Check")])])])):G("",!0)}},ma="KOLEHIYO NG PANTUKAN",fa="Juan A. Sarenas Campus, Kingking, Pantukan, Davao de Oro",pa="https://osas.knp.edu.ph/#/verify-utilization?id=",_e=t=>t?xe(t).format("MMMM DD, YYYY"):"—",Te=t=>t?xe(t).format("MMM DD, YYYY, h:mm A"):"—",Ee=(t,i=0)=>t==null||t===""||Number.isNaN(Number(t))?"—":Number(t).toLocaleString(void 0,{minimumFractionDigits:i,maximumFractionDigits:i}),Fe=(t,i)=>{if(Array.isArray(t))return t;try{return JSON.parse(t||"null")??i}catch{return i}},Be="./",ya=`${Be}images/logo.png`,va=`${Be}images/bg.jpg`;async function Re(t){const w=await(await fetch(t)).blob();return new Promise(d=>{const g=new FileReader;g.onloadend=()=>d(g.result),g.readAsDataURL(w)})}function ga(t){switch(t){case"APPROVED":return[32,141,85];case"PENDING":return[240,158,47];case"REJECTED":return[220,53,69];case"CANCELLED":return[107,114,128];case"COMPLETED":return[37,99,235];default:return[90,90,90]}}function ba(t){switch(String(t||"").toUpperCase()){case"AVAILABLE":return[16,185,129];case"RESERVED":return[99,102,241];case"CONFLICT":return[239,68,68];case"MAINTENANCE":return[245,158,11];case"PENDING-CHECK":return[245,158,11];default:return[107,114,128]}}async function ha(t){const i=t.internal.pageSize.getWidth(),w=110,d=36;try{const g=await Re(va);t.addImage(g,"JPEG",0,0,i,w,void 0,"FAST")}catch{t.setFillColor(21,62,121),t.rect(0,0,i,w,"F")}t.setGState(new t.GState({opacity:.18})),t.setFillColor(0,0,0),t.rect(0,0,i,w,"F"),t.setGState(new t.GState({opacity:1}));try{const g=await Re(ya);t.addImage(g,"PNG",d,20,70,70,void 0,"FAST")}catch{}return t.setTextColor(255,255,255),t.setFont("helvetica","bold"),t.setFontSize(20),t.text(ma,d+86,38),t.setFont("helvetica","normal"),t.setFontSize(10),t.text(fa,d+86,58),t.setTextColor(20),t.setFont("helvetica","bold"),t.setFontSize(14),t.text("UTILIZATION REQUEST",i/2,w+24,{align:"center"}),w+34}async function _a(t,i,w){const d=t.internal.pageSize.getWidth(),g=36,c=i?.id??i?.reference_code??"",r=`${pa}${encodeURIComponent(String(c))}`,y=await wt.toDataURL(r,{margin:0,width:75,errorCorrectionLevel:"M",color:{dark:"#000000",light:"#FFFFFF"}}),A=String(i.status||"").toUpperCase(),[F,O,N]=ga(A),P=String(i.availability_status||"").toUpperCase(),[R,m,n]=ba(P),p=i.approved_at?_e(i.approved_at):i.date_filed?_e(i.date_filed):"—",$=`osas.knp.edu.ph/#/verify-utilization?id=${String(c)}`;return U(t,{startY:w,theme:"plain",styles:{cellPadding:0,fontSize:9},bodyStyles:{minCellHeight:120},margin:{left:g,right:g},tableWidth:d-g*2,body:[[{content:""},{content:""}]],columnStyles:{0:{cellWidth:d-g*2-260},1:{cellWidth:260}},didDrawCell:I=>{if(I.section!=="body")return;const{x:k,y:B,width:v,height:W}=I.cell,z=10;if(I.column.index===0){t.setFillColor(255,255,255),t.roundedRect(k,B,v-1,W,6,6,"F");const b=24,Y=Math.min(160,v-22);t.setFillColor(F,O,N),t.roundedRect(k+z,B+z,Y,b,12,12,"F"),t.setTextColor(255,255,255),t.setFont("helvetica","bold"),t.setFontSize(10),t.text(A||"STATUS",k+z+10,B+z+16);const H=B+z+b+10,se=Math.min(160,v-22);t.setFillColor(R,m,n),t.roundedRect(k+z,H,se,b,12,12,"F"),t.setTextColor(255,255,255),t.text(P||"AVAILABILITY",k+z+10,H+16),t.setTextColor(20),t.setFont("helvetica","normal"),t.setFontSize(9);let J=H+b+12;t.text(`Ref No.: ${i.reference_code||"—"}`,k+z,J),J+=16,t.text(`Date Issued: ${p}`,k+z,J),t.setDrawColor(230),t.roundedRect(k,B,v-1,W,6,6,"S")}if(I.column.index===1){t.setFillColor(255,255,255),t.roundedRect(k,B,v-1,W,6,6,"F"),t.setFillColor(66,103,178),t.roundedRect(k,B,v-1,22,6,6,"F"),t.setTextColor(255,255,255),t.setFont("helvetica","bold"),t.setFontSize(10),t.text("VERIFY",k+z,B+15);const b=k+z,Y=B+28;t.addImage(y,"PNG",b,Y,75,75,void 0,"FAST"),t.setTextColor(20),t.setFont("helvetica","bold"),t.setFontSize(10),t.text("Scan to verify",b+100,Y+14),t.setFont("helvetica","normal"),t.setFontSize(9),t.text("This document can be verified",b+100,Y+32),t.text("online via the OSAS portal.",b+100,Y+46),t.setTextColor(110),t.setFontSize(8),t.text($,b+100,Y+72),t.setDrawColor(230),t.roundedRect(k,B,v-1,W,6,6,"S")}}}),t.lastAutoTable.finalY}async function ze(t){const i=new Je({unit:"pt",format:[612,936],orientation:"portrait"}),w=i.internal.pageSize.getWidth(),d=36,g=Fe(t.facilities,[]),c=Fe(t.equipment_items,[]);let r=await ha(i);r=await _a(i,t,r)+10,U(i,{startY:r,theme:"plain",styles:{fontSize:10},body:[[{content:"LINKED ACTIVITY",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",halign:"left",valign:"middle",cellPadding:6}}]],margin:{left:d,right:d}}),r=i.lastAutoTable.finalY;const y=t.activity_design||{};U(i,{startY:r,theme:"grid",styles:{fontSize:9,cellPadding:6},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},body:[[{content:"NAME OF ACTIVITY",styles:{fillColor:[243,248,255],fontStyle:"bold"}},y.name_of_activity||"—"],[{content:"DATE OF IMPLEMENTATION",styles:{fillColor:[243,248,255],fontStyle:"bold"}},_e(y.date_of_implementation)],[{content:"SEMESTER",styles:{fillColor:[243,248,255],fontStyle:"bold"}},y.semester||"—"],[{content:"SCHOOL YEAR",styles:{fillColor:[243,248,255],fontStyle:"bold"}},y.school_year||"—"],[{content:"OFFICE/DEPARTMENT",styles:{fillColor:[243,248,255],fontStyle:"bold"}},y.office_department||y?.club?.name||"—"]],columnStyles:{0:{cellWidth:200,fontStyle:"bold"},1:{cellWidth:"auto"}},margin:{left:d,right:d}}),r=i.lastAutoTable.finalY+10,U(i,{startY:r,theme:"plain",styles:{fontSize:10},body:[[{content:"SCHEDULE",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:d,right:d}}),r=i.lastAutoTable.finalY;const A=t.start_at||(t.start_date&&t.start_time?`${t.start_date}T${t.start_time}:00`:null),F=t.end_at||(t.end_date&&t.end_time?`${t.end_date}T${t.end_time}:00`:null);U(i,{startY:r,theme:"grid",styles:{fontSize:9,cellPadding:6},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},body:[[{content:"START",styles:{fillColor:[243,248,255],fontStyle:"bold"}},Te(A)],[{content:"END",styles:{fillColor:[243,248,255],fontStyle:"bold"}},Te(F)],[{content:"DURATION (mins)",styles:{fillColor:[243,248,255],fontStyle:"bold"}},Ee(t.duration_minutes)]],columnStyles:{0:{cellWidth:200,fontStyle:"bold"},1:{cellWidth:"auto"}},margin:{left:d,right:d}}),r=i.lastAutoTable.finalY+10,U(i,{startY:r,theme:"plain",styles:{fontSize:10},body:[[{content:"FACILITIES",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:d,right:d}}),r=i.lastAutoTable.finalY;const O=Array.isArray(g)&&g.length?"• "+g.join(`
• `):"—";U(i,{startY:r,theme:"grid",styles:{fontSize:9,cellPadding:8},body:[[O]],margin:{left:d,right:d}}),r=i.lastAutoTable.finalY+10,U(i,{startY:r,theme:"plain",styles:{fontSize:10},body:[[{content:"EQUIPMENT / MATERIALS",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:d,right:d}}),r=i.lastAutoTable.finalY,Array.isArray(c)&&c.length?U(i,{startY:r,theme:"grid",styles:{fontSize:9,cellPadding:6},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},head:[["ITEM","QTY","UNIT"]],body:c.map($=>[$?.name||"—",Ee($?.qty),$?.unit||"—"]),columnStyles:{0:{cellWidth:300},1:{cellWidth:70},2:{cellWidth:"auto"}},margin:{left:d,right:d}}):U(i,{startY:r,theme:"grid",styles:{fontSize:9,cellPadding:8},body:[["—"]],margin:{left:d,right:d}}),r=i.lastAutoTable.finalY+10;const N=[["UTILIZATION DETAILS",t.utilization_details],["REMARKS",t.remarks]];for(const[$,I]of N)U(i,{startY:r,theme:"plain",styles:{fontSize:10},body:[[{content:$,styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:d,right:d}}),r=i.lastAutoTable.finalY,U(i,{startY:r,theme:"grid",styles:{fontSize:9,cellPadding:8},body:[[I&&String(I).trim()?I:"—"]],margin:{left:d,right:d}}),r=i.lastAutoTable.finalY+10;U(i,{startY:r,theme:"plain",styles:{fontSize:10},body:[[{content:"APPROVAL",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:d,right:d}}),r=i.lastAutoTable.finalY;const R=String(t?.file_by_user_name||"").trim()||(t?.filed_by?`${t.filed_by.first_name||""} ${t.filed_by.last_name||""}`.trim():""),m=String(t?.noted_by||"").trim(),n=t?.approver?`${t.approver.first_name||""} ${t.approver.last_name||""}`.trim():"";U(i,{startY:r,theme:"grid",styles:{fontSize:9,cellPadding:10},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},head:[["PREPARED BY:","NOTED BY:","RECOMMENDING APPROVAL:"]],body:[[R||" ",m||" ",n||" "]],columnStyles:{0:{cellWidth:(w-d*2)/2},1:{cellWidth:"auto"}},didParseCell:$=>{$.section==="body"&&($.cell.styles.halign="center",$.cell.styles.fontStyle="bold",$.cell.styles.cellPadding={top:16,right:10,bottom:18,left:10})},margin:{left:d,right:d}}),r=i.lastAutoTable.finalY+6,U(i,{startY:r,theme:"plain",styles:{fontSize:10,halign:"center"},body:[[{content:"Approved by: DR. MARY ANN R. ARAULA (Acting College President)"}]],margin:{left:d,right:d}});const p=i.internal.pageSize.getHeight()-20;return i.setFontSize(8),i.setTextColor(120),i.text(`Generated on ${xe().format("YYYY-MM-DD HH:mm")} • ${window.location.origin}`,d,p),i}async function xa(t){(await ze(t)).save(`${t.reference_code||"Utilization_Request"}.pdf`)}const wa={class:"flex flex-wrap items-center gap-2 w-full sm:w-auto justify-start sm:justify-end"},Sa={class:"p-2 mb-4 rounded-xl border bg-white/60"},Ca={class:"flex items-center gap-2 mb-2 text-gray-700"},Aa={class:"w-4 h-4",viewBox:"0 0 24 24"},ka=["d"],$a={class:"grid grid-cols-1 md:grid-cols-6 gap-2 text-sm"},Ta={class:"md:col-span-2 flex"},Ea={class:"w-5 h-5",viewBox:"0 0 24 24"},Fa=["d"],Ra=["value"],Ba=["value"],za={class:"md:col-span-1"},Va={class:"md:col-span-1"},Ia={class:"md:col-span-2"},Ua=["value"],Oa={class:"flex flex-wrap gap-1 max-w-[380px]"},Na={key:0,class:"text-gray-400"},Da={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30"},Pa={class:"bg-white w-[560px] rounded-xl shadow p-4"},La={class:"flex items-center justify-between mb-2"},Ya={class:"grid grid-cols-1 gap-2 text-sm"},Ma={class:"flex gap-2"},ja={class:"text-[11px] text-gray-600"},qa={class:"mt-3 flex justify-end gap-2"},ml={__name:"UtilizationRequestsPage",setup(t){const i=fe(),{isClub:w,activeClubId:d,withClub:g}=Ct(),c=qe(),r=We(),y=q(()=>{const o=c.user?.last_name||"",e=(c.user?.first_name||"").slice(0,1);return`${o}${o?", ":""}${e?e+".":""}`}),A=o=>{try{return((Array.isArray(o)?o:JSON.parse(o||"[]")||[])||[]).map(a=>(!a||typeof a!="object"||Array.isArray(a.read_by)||(a.read_by=a.user_id!=null?[a.user_id]:[]),a))}catch{return[]}},F=_(!1),O=()=>{F.value=!0},N=_(!1),P=()=>{N.value=!0},R=async o=>{try{await i.fetchById(o);const e=i.selected;e&&await K(e)}catch(e){console.error(e)}finally{F.value=!1}},m=_(!1),n=_(null),p=async o=>{try{await i.fetchById(o.id),n.value=i.selected||o}catch{n.value=o}m.value=!0},$=async o=>{if(!n.value)return;const e=A(n.value.remarks);e.push({user_id:c.user?.id||null,user_name:y.value,message:o?.message||"",datetime:o?.datetime||new Date().toISOString(),is_read:!1,read_by:[c.user?.id||null]});try{n.value.remarks=JSON.stringify(e)}catch{}try{await i.updateById(n.value.id,{remarks:JSON.stringify(e)}),await b({},!0)}catch{}},I=async()=>{if(!n.value)return;const o=c.user?.id||null,a=A(n.value.remarks).map(h=>{if(!h||h.user_id===o)return h;const Z=Array.isArray(h.read_by)?h.read_by.slice():[];return Z.includes(o)||Z.push(o),{...h,read_by:Z}});try{n.value.remarks=JSON.stringify(a)}catch{}try{await i.updateById(n.value.id,{remarks:JSON.stringify(a)}),await b({},!0)}catch{}},k=["EB 101","EB 102","EB 103","NB 104","NB 105","NB Lobby","NB 106","NB 107","NB 201","NB 3SR","OB 108","OB 109","OB 110","OB 111","OB 112","OB 113","OB 114","OB 115","OB 116","OB 117","Gym","AVR","Student Lobby","Activity Center","Library","Ground"],B={range:!0,partialRange:!0,multiCalendars:2,modelType:"yyyy-MM-dd",enableTimePicker:!1,autoApply:!0,clearable:!0},v=_({page:1,limit:10,sort:"created_at",order:"DESC",q:"",status:"",availability_status:"",start_from:"",start_to:"",end_from:"",end_to:"",facilities_any:[]}),W=q({get:()=>{const{start_from:o,start_to:e}=v.value;return o||e?[o||null,e||null]:null},set:o=>{if(!o)v.value.start_from=null,v.value.start_to=null;else{const[e,a]=o;v.value.start_from=e||null,v.value.start_to=a||null}}}),z=q({get:()=>{const{end_from:o,end_to:e}=v.value;return o||e?[o||null,e||null]:null},set:o=>{if(!o)v.value.end_from=null,v.value.end_to=null;else{const[e,a]=o;v.value.end_from=e||null,v.value.end_to=a||null}}}),b=async(o={},e=!0)=>{v.value={...v.value,...o};const a=g({...v.value});["q","status","availability_status","start_from","start_to","end_from","end_to"].forEach(h=>{(a[h]===""||a[h]==null)&&delete a[h]}),(!Array.isArray(a.facilities_any)||!a.facilities_any.length)&&delete a.facilities_any,await i.fetchAll(a,e)};he(async()=>{await b({page:1,limit:10,club_id:w?d:""})});const Y=q(()=>({total:i.items.total||0,totalPages:i.items.totalPages||1,currentPage:i.items.currentPage||1,pageSize:i.items.pageSize||10,data:i.items.data||[]})),H=["draft","pending","approved","rejected","cancelled","completed"],se=["unknown","pending-check","available","conflict","reserved","maintenance"],J=o=>{switch(String(o||"").toLowerCase()){case"draft":return"gray";case"pending":return"amber";case"approved":return"emerald";case"rejected":return"red";case"cancelled":return"zinc";case"completed":return"blue";default:return"gray"}},pe=o=>{switch(String(o||"").toLowerCase()){case"available":return"emerald";case"reserved":return"indigo";case"conflict":return"red";case"maintenance":return"orange";case"pending-check":return"amber";default:return"gray"}},oe=[{key:"reference_code",label:"Ref Code",sortable:!0,width:140},{key:"activity_design",label:"Activity",sortable:!1,minWidth:220,formatter:(o,e)=>e.activity_design?e.activity_design.name_of_activity:""},{key:"facilities",label:"Facilities",sortable:!1,minWidth:260},{key:"start_at",label:"Start",sortable:!0,width:170},{key:"end_at",label:"End",sortable:!0,width:170},{key:"availability_status",label:"Availability",sortable:!0,width:130},{key:"status",label:"Status",sortable:!0,width:120}],ye=async o=>{await b(o)},te=_(!1),l=_(!1),u=_(null),f=()=>{te.value=!0},D=async o=>{await i.create(o),te.value=!1,await b({},!0)},K=async o=>{await i.fetchById(o.id);const e=i.selected||o;let a=[],h=[];try{a=Array.isArray(e.facilities)?e.facilities:JSON.parse(e.facilities||"[]")}catch{}try{h=Array.isArray(e.equipment_items)?e.equipment_items:JSON.parse(e.equipment_items||"[]")}catch{}u.value={id:e.id,reference_code:e.reference_code,date_filed:e.date_filed||"",activity_design_id:e.activity_design_id||"",file_by_user_name:e.file_by_user_name||"",facilities:a,equipment_items:h,utilization_details:e.utilization_details||"",start_date:e.start_date||String(e.start_at||"").slice(0,10),start_time:e.start_time||(e.start_at?new Date(e.start_at).toTimeString().slice(0,5):""),end_date:e.end_date||String(e.end_at||"").slice(0,10),end_time:e.end_time||(e.end_at?new Date(e.end_at).toTimeString().slice(0,5):""),status:e.status||"draft",availability_status:e.availability_status||"pending-check",remarks:e.remarks||""},l.value=!0},X=async o=>{const{id:e,...a}=o;await i.updateById(e,a),l.value=!1,await b({},!0)},re=async o=>{if(!o?.id)return;(await S.fire({title:`Delete utilization "${o.reference_code}"?`,text:"This cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it",cancelButtonText:"Cancel"})).isConfirmed&&(await i.deleteById(o.id),await b({},!0),await S.fire("Deleted","The utilization request has been deleted.","success"))},ae=async o=>{await K(o)},ne=_(!1),de=_(null),M=_({from_email:"",from_name:"",to:"",subject:"",html:"",attachments:[]}),Ve=async o=>{try{await i.fetchById(o.id);const e=i.selected||o,h=(await ze(e)).output("datauristring"),Z=String(h).split(",")[1]||"",je=`${e.reference_code||"Utilization_Request"}.pdf`;de.value=e,M.value={from_email:"osas@knp.edu.ph",from_name:`${c.user?.first_name||""} ${c.user?.last_name||""}`.trim(),to:"",subject:`Utilization Request ${e.reference_code||""}`.trim(),html:"Please see the attached file.",attachments:[{filename:je,content:Z,type:"application/pdf"}]},ne.value=!0}catch{await S.fire("Error",i.error||"Failed to prepare email.","error")}},Ie=async()=>{const o=de.value;if(o)try{await i.sendEmail(o.id,{...M.value}),ne.value=!1,await S.fire("Sent","Email sent successfully.","success")}catch{await S.fire("Error",i.error||"Failed to send email.","error")}},Ue=async o=>{if((await S.fire({title:"Submit for approval?",text:"You can no longer edit after submission.",icon:"question",showCancelButton:!0,confirmButtonText:"Submit",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1})).isConfirmed)try{const a=A(o.remarks);a.push({user_id:c.user?.id||null,user_name:y.value,message:`${y.value} submitted utilization request.`,datetime:new Date().toISOString(),is_read:!1,read_by:[c.user?.id||null]}),await i.updateById(o.id,{remarks:JSON.stringify(a)}),await i.submit(o.id),await b({},!0),await S.fire("Submitted","Utilization request is now pending approval.","success")}catch{await S.fire("Error",i.error||"Failed to submit request.","error")}},Oe=async o=>{const e=await S.fire({title:"Approve utilization?",input:"textarea",inputLabel:"Remarks (optional)",inputPlaceholder:"Add a note…",showCancelButton:!0,confirmButtonText:"Approve",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1});if(!e.isConfirmed)return;const a=e.value||"";try{const h=A(o.remarks);h.push({user_id:c.user?.id||null,user_name:y.value,message:`${y.value} approved utilization request.${a?" - "+a:""}`,datetime:new Date().toISOString(),is_read:!1,read_by:[c.user?.id||null]}),await i.approve(o.id,JSON.stringify(h)),await b({},!0),await S.fire("Approved","Utilization has been approved and reserved.","success")}catch{await S.fire("Error",i.error||"Failed to approve request.","error")}},Ne=async o=>{const e=await S.fire({title:"Reject utilization?",input:"textarea",inputLabel:"Reason (required)",inputPlaceholder:"State the reason…",inputValidator:h=>h?.trim()?void 0:"Reason is required",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Reject",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1});if(!e.isConfirmed)return;const a=e.value;try{const h=A(o.remarks);h.push({user_id:c.user?.id||null,user_name:y.value,message:`${y.value} rejected utilization request - ${a}.`,datetime:new Date().toISOString(),is_read:!1,read_by:[c.user?.id||null]}),await i.reject(o.id,JSON.stringify(h)),await b({},!0),await S.fire("Rejected","Utilization has been rejected.","success")}catch{await S.fire("Error",i.error||"Failed to reject request.","error")}},De=async o=>{const e=await S.fire({title:"Cancel utilization?",input:"textarea",inputLabel:"Reason (required)",inputPlaceholder:"State the reason…",inputValidator:a=>a?.trim()?void 0:"Reason is required",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Cancel Utilization",cancelButtonText:"Keep",allowOutsideClick:!1,allowEscapeKey:!1});if(e.isConfirmed){e.value;try{const a=A(o.remarks);a.push({user_id:c.user?.id||null,user_name:y.value,message:`${y.value} cancelled utilization request - ${e.value}.`,datetime:new Date().toISOString(),is_read:!1,read_by:[c.user?.id||null]}),await i.cancel(o.id,JSON.stringify(a)),await b({},!0),await S.fire("Cancelled","Utilization has been cancelled.","success")}catch{await S.fire("Error",i.error||"Failed to cancel request.","error")}}},Pe=async o=>{if(String(o?.status||"").toLowerCase()!=="approved"){await S.fire("Not allowed","Only approved utilization request can be printed.","info");return}try{await i.fetchById(o.id);const a=i.selected||o;await xa(a)}catch(a){await S.fire("Error",i.error||"Failed to generate PDF.","error"),console.error(a)}},ve=_(!1),we=_(null),Le=async o=>{await i.fetchById(o.id),we.value=i.selected||o,ve.value=!0};_(""),_("08:00"),_(""),_("10:00"),_([]);const ce=_([]),Ye=async()=>{v.value.facilities_any=(ce.value||[]).slice(),await b({page:1})},Me=async()=>{ce.value=[],await b({q:"",status:"",availability_status:"",start_from:"",start_to:"",end_from:"",end_to:"",facilities_any:[],page:1})};return(o,e)=>(x(),C(ee,null,[T(st,null,{default:j(()=>[T(nt,null,{default:j(()=>[E(i).error?(x(),Ce(vt,{key:0,icon:E(ot),color:"danger"},{default:j(()=>[le(V(E(i).error),1)]),_:1},8,["icon"])):G("",!0),T(yt,{icon:E(rt),title:"Utilization Requests",main:""},{default:j(()=>[s("div",wa,[T(ue,{icon:E(dt),color:"info",label:"View Calendar",onClick:O},null,8,["icon"]),T(ue,{icon:E(ct),color:"info",label:"Quick Check",onClick:P},null,8,["icon"]),T(ue,{icon:E(ut),color:"primary",label:"New Request",onClick:f},null,8,["icon"]),T(ue,{icon:E(mt),color:"info",label:"Refresh",onClick:e[0]||(e[0]=a=>b({},!0))},null,8,["icon"])])]),_:1},8,["icon"]),s("div",Sa,[s("div",Ca,[(x(),C("svg",Aa,[s("path",{d:E(ft)},null,8,ka)])),e[22]||(e[22]=s("span",{class:"font-medium text-sm"},"Filters",-1))]),s("div",$a,[s("div",Ta,[L(s("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>v.value.q=a),placeholder:"Search by ref, details, remarks…",class:"border rounded-s px-2 py-2 flex-1",onKeyup:e[2]||(e[2]=Ge(a=>b({page:1}),["enter"]))},null,544),[[Q,v.value.q]]),s("button",{class:"px-3 border border-l-0 rounded-e bg-gray-50",title:"Search",onClick:e[3]||(e[3]=a=>b({page:1}))},[(x(),C("svg",Ea,[s("path",{d:E(pt)},null,8,Fa)]))])]),L(s("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>v.value.status=a),class:"border rounded px-2 py-2"},[e[23]||(e[23]=s("option",{value:""},"All status",-1)),(x(),C(ee,null,ie(H,a=>s("option",{key:a,value:a},V(a),9,Ra)),64))],512),[[me,v.value.status]]),L(s("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>v.value.availability_status=a),class:"border rounded px-2 py-2"},[e[24]||(e[24]=s("option",{value:""},"Any availability",-1)),(x(),C(ee,null,ie(se,a=>s("option",{key:a,value:a},V(a),9,Ba)),64))],512),[[me,v.value.availability_status]]),s("div",za,[T(E(ke),Ae({modelValue:W.value,"onUpdate:modelValue":e[6]||(e[6]=a=>W.value=a)},B,{placeholder:"Start date range"}),null,16,["modelValue"])]),s("div",Va,[T(E(ke),Ae({modelValue:z.value,"onUpdate:modelValue":e[7]||(e[7]=a=>z.value=a)},B,{placeholder:"End date range"}),null,16,["modelValue"])]),s("div",Ia,[e[25]||(e[25]=s("label",{class:"block text-[11px] text-gray-600 mb-1"},"Facilities (any)",-1)),L(s("select",{"onUpdate:modelValue":e[8]||(e[8]=a=>ce.value=a),multiple:"",class:"w-full border rounded px-2 py-2 min-h-[38px]"},[(x(),C(ee,null,ie(k,a=>s("option",{key:a,value:a},V(a),9,Ua)),64))],512),[[me,ce.value]])]),s("div",{class:"flex items-center gap-2 md:col-span-2"},[s("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:Ye}," Apply Filters "),s("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:Me},"Reset")])])]),T(gt,{columns:oe,data:Y.value,loading:E(i).isLoading,onQueryChange:ye},{"cell-facilities":j(({row:a})=>[s("div",Oa,[(x(!0),C(ee,null,ie((()=>{try{return Array.isArray(a.facilities)?a.facilities:JSON.parse(a.facilities||"[]")}catch{return[]}})(),(h,Z)=>(x(),Ce(ge,{key:Z,text:h,tone:"slate"},null,8,["text"]))),128)),a.facilities&&JSON.parse(a.facilities||"[]").length?G("",!0):(x(),C("span",Na,"—"))])]),"cell-start_at":j(({value:a})=>[s("span",null,V(a?new Date(a).toLocaleString():"—"),1)]),"cell-end_at":j(({value:a})=>[s("span",null,V(a?new Date(a).toLocaleString():"—"),1)]),"cell-availability_status":j(({value:a})=>[T(ge,{text:a||"—",tone:pe(a)},null,8,["text","tone"])]),"cell-status":j(({value:a})=>[T(ge,{text:a||"—",tone:J(a)},null,8,["text","tone"])]),"cell-actions":j(({row:a})=>[T(Ke,{row:a,"current-user-id":E(c).user?.id,moderator:["admin","manager"].includes(String(E(c).user?.role||"").toLowerCase()),onAttachments:Le,onSubmit:Ue,onApprove:Oe,onReject:Ne,onEdit:K,onDelete:re,onView:h=>ae(a),onCancel:De,onRemarks:p,onPrint:Pe,onEmail:Ve},null,8,["row","current-user-id","moderator","onView"])]),_:1},8,["data","loading"])]),_:1})]),_:1}),T($e,{modelValue:te.value,"onUpdate:modelValue":e[9]||(e[9]=a=>te.value=a),mode:"create",onSubmit:D},null,8,["modelValue"]),T($e,{modelValue:l.value,"onUpdate:modelValue":e[10]||(e[10]=a=>l.value=a),mode:"edit",initial:u.value||{},onSubmit:X},null,8,["modelValue","initial"]),T(ea,{modelValue:ve.value,"onUpdate:modelValue":e[11]||(e[11]=a=>ve.value=a),row:we.value},null,8,["modelValue","row"]),T(St,{modelValue:m.value,"onUpdate:modelValue":e[12]||(e[12]=a=>m.value=a),title:"Remarks • "+(n.value?.reference_code||n.value?.activity_design?.name_of_activity||"Item"),items:A(n.value?.remarks),"can-add":!0,onAdd:$,onMarkAllRead:I},null,8,["modelValue","title","items"]),T(sa,{modelValue:F.value,"onUpdate:modelValue":e[13]||(e[13]=a=>F.value=a),onOpen:R},null,8,["modelValue"]),T(ua,{modelValue:N.value,"onUpdate:modelValue":e[14]||(e[14]=a=>N.value=a),facilities:k},null,8,["modelValue"]),ne.value?(x(),C("div",Da,[s("div",Pa,[s("div",La,[e[26]||(e[26]=s("h3",{class:"text-base font-semibold"},"Send Email",-1)),s("button",{class:"px-2 py-1 text-xs bg-gray-200 rounded",onClick:e[15]||(e[15]=a=>ne.value=!1)},"Close")]),s("div",Ya,[s("div",null,[e[27]||(e[27]=s("label",{class:"block mb-0.5"},"To",-1)),s("div",Ma,[L(s("input",{"onUpdate:modelValue":e[16]||(e[16]=a=>M.value.to=a),class:"flex-1 border rounded px-2 py-1.5",placeholder:"recipient@example.com"},null,512),[[Q,M.value.to]]),s("button",{class:"px-2 py-1 text-[11px] rounded border bg-gray-50 hover:bg-gray-100",onClick:e[17]||(e[17]=()=>{const a=de.value?.filed_by_user_id||de.value?.filed_by?.id;a&&E(r).fetchById(a).then(()=>{const h=E(r).selectedUser?.email;h&&(M.value.to=h)})})},"Use Filer"),s("button",{class:"px-2 py-1 text-[11px] rounded border bg-rose-50 hover:bg-rose-100",onClick:e[18]||(e[18]=()=>{M.value.attachments=[]})},"Remove Attachment")])]),s("div",null,[e[28]||(e[28]=s("label",{class:"block mb-0.5"},"Subject",-1)),L(s("input",{"onUpdate:modelValue":e[19]||(e[19]=a=>M.value.subject=a),class:"w-full border rounded px-2 py-1.5"},null,512),[[Q,M.value.subject]])]),s("div",null,[e[29]||(e[29]=s("label",{class:"block mb-0.5"},"Message",-1)),L(s("textarea",{"onUpdate:modelValue":e[20]||(e[20]=a=>M.value.html=a),rows:"4",class:"w-full border rounded px-2 py-1.5"},null,512),[[Q,M.value.html]])]),s("div",ja,"Attachment: "+V(M.value.attachments?.[0]?.filename||"utilization.pdf"),1)]),s("div",qa,[s("button",{class:"px-3 py-1.5 text-xs bg-gray-200 rounded",onClick:e[21]||(e[21]=a=>ne.value=!1)},"Cancel"),s("button",{class:"px-3 py-1.5 text-xs bg-emerald-600 text-white rounded",onClick:Ie},"Send")])])])):G("",!0)],64))}};export{ml as default};
