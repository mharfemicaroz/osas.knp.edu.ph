import{c,u as ee,r as q,o as le,x as U,G as te,a as n,d as p,q as d,e as t,h as v,t as o,j as x,k as m,C as A,F as C,B as V,v as b,g as ae}from"./index.C20gUimh.js";import{u as se}from"./club.JOuGjAoF.js";import{u as ue}from"./annualPlan.B6Mnrdy9.js";const ie={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},ne={class:"bg-white p-3 md:p-4 rounded-xl shadow-lg w-[780px] max-h-[85vh] overflow-y-auto"},de={class:"flex items-center justify-between mb-2"},oe={class:"flex items-center gap-2"},re={class:"text-base font-semibold"},ve={key:0,class:"mb-2 text-[11px] px-2.5 py-1.5 rounded-lg border bg-amber-50 border-amber-200 text-amber-800"},pe={class:"p-2 mb-2 rounded-xl border bg-white/70"},me={class:"flex items-center justify-between mb-1"},be={class:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm"},_e=["disabled"],ce=["value"],fe=["disabled"],ye=["value"],xe={key:0,class:"mt-2 text-[11px] rounded-lg border bg-gray-50 px-2.5 py-1.5"},ge={class:"flex flex-wrap gap-3"},ke={key:0},we={key:1},Se={class:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm"},Ae=["disabled"],Ce={key:0,class:"text-red-600 text-[11px] mt-0.5"},Ve=["disabled"],Ne=["value"],qe={key:0,class:"text-red-600 text-[11px] mt-0.5"},Ue=["disabled"],je=["value"],Ie={key:0,class:"text-red-600 text-[11px] mt-0.5"},Re={class:"md:col-span-3"},Pe=["disabled"],he={key:0,class:"text-red-600 text-[11px] mt-0.5"},Fe={class:"mt-2 grid grid-cols-1 md:grid-cols-3 gap-2 text-sm"},Oe={class:"block mb-0.5"},Be={key:0,class:"ml-1 text-[10px] px-1.5 py-0.5 rounded bg-emerald-100 text-emerald-700 align-middle"},De=["disabled"],Le=["value"],Ee={key:0,class:"text-red-600 text-[11px] mt-0.5"},Te=["disabled"],Me=["disabled","aria-invalid"],Ye={key:0,class:"text-red-600 text-[11px] mt-0.5"},$e={class:"mt-2 grid grid-cols-1 md:grid-cols-3 gap-2 text-sm"},ze=["disabled"],Je=["disabled","aria-invalid"],Ge=["value"],Ke={key:0,class:"text-red-600 text-[11px] mt-0.5"},He=["disabled"],Qe={class:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-2 text-sm"},We=["disabled","aria-invalid"],Xe={key:0,class:"text-red-600 text-[11px] mt-0.5"},Ze=["disabled","aria-invalid"],el={key:0,class:"text-red-600 text-[11px] mt-0.5"},ll={class:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-2 text-sm"},tl=["disabled","aria-invalid"],al={key:0,class:"text-red-600 text-[11px] mt-0.5"},sl=["disabled","aria-invalid"],ul={key:0,class:"text-red-600 text-[11px] mt-0.5"},il={key:1,class:"mt-2 text-sm"},nl=["disabled"],dl={class:"mt-2 text-sm"},ol=["disabled"],rl={class:"flex justify-end gap-1.5 mt-4"},vl={key:0,class:"px-3 py-1.5 bg-blue-600 text-white rounded text-xs"},_l={__name:"ActivityDesignFormModal",props:{modelValue:{type:Boolean,default:!1},mode:{type:String,default:"create"},lockedClubId:{type:[String,Number],default:""},initial:{type:Object,default:()=>({id:null,date_filed:"",semester:"",office_department:"",school_year:"",name_of_activity:"",venue:"",date_of_implementation:"",proposed_budget:0,participants:"",nature_of_activity:"Curricular",rationale:"",objectives:"",details_of_activity:"",budgetary_requirements:"",file_by_user_name:"",filed_by_user_id:"",club_id:"",status:"draft",remarks:"",annual_plan_id:"",annual_plan_item:null})}},emits:["update:modelValue","submit"],setup(P,{emit:M}){const f=P,h=M,j=c({get:()=>f.modelValue,set:s=>h("update:modelValue",s)}),F=ee(),N=se(),I=ue(),R=c(()=>F.user?.id||null),O=c(()=>String(F.user?.role||"").toLowerCase()==="admin"),l=q({...f.initial}),u=q({}),g=q(null),Y=["1st Semester","2nd Semester","Summer"],$=["Curricular","Co-Curricular","Extra-Curricular"],B=c(()=>{const s=new Date().getFullYear();return Array.from({length:6},(e,i)=>`${s-i}-${s-i+1}`)}),D=s=>{const e=Number(s);return Number.isFinite(e)?e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},z=(s,e=[])=>{if(Array.isArray(s))return s;try{return JSON.parse(s||"[]")||e}catch{return e}},J=(s,e=null)=>{if(s&&typeof s=="object")return s;try{return JSON.parse(s||"null")??e}catch{return e}},k=s=>{const e=Number(s);return(N.clubs?.data||[]).find(a=>Number(a.id)===e)?.name||""},L=c(()=>{const s=Array.isArray(I.items?.data)?I.items.data.filter(e=>String(e.status||"").toLowerCase()==="approved"):[];if(f.lockedClubId){const e=Number(f.lockedClubId);return s.filter(i=>Number(i.club_id)===e)}return s}),_=c(()=>{const s=Number(l.value.annual_plan_id||0);return s&&L.value.find(e=>Number(e.id)===s)||null}),w=c(()=>{const s=_.value;return s?z(s.plans,[]).map((i,a)=>({key:String(i?.id??i?.plan_id??a),title:i?.title??i?.name??i?.activity??i?.label??`Item #${a+1}`,funds:Number(i?.funds??i?.budget??0)||0,raw:i})):[]}),y=q("");le(async()=>{(!Array.isArray(N.clubs?.data)||!N.clubs.data.length)&&await N.fetchAll({page:1,limit:200},!0),await I.fetchAll({page:1,limit:500,status:"approved"},!0),f.lockedClubId&&(l.value.club_id=Number(f.lockedClubId))}),U(()=>f.initial,s=>{const e=J(s.annual_plan_item,null);if(l.value={...s,annual_plan_item:e},u.value={},g.value=null,l.value.school_year||(l.value.school_year=B.value[0]),!l.value.filed_by_user_id&&R.value&&(l.value.filed_by_user_id=R.value),l.value.club_id){const i=k(l.value.club_id);i&&(l.value.office_department=i)}queueMicrotask(()=>{if(!_.value||!l.value.annual_plan_item){y.value="";return}const a=w.value,T=a.findIndex(Z=>JSON.stringify(Z.raw)===JSON.stringify(l.value.annual_plan_item));y.value=T>=0?a[T].key:""})},{immediate:!0}),U(()=>l.value.club_id,s=>{if(S.value)return;const e=k(s);e&&(l.value.office_department=e)}),U(()=>l.value.annual_plan_id,(s,e)=>{l.value.annual_plan_item=null,y.value="";const i=_.value;i&&(g.value||(g.value={school_year:l.value.school_year,proposed_budget:l.value.proposed_budget,club_id:l.value.club_id,office_department:l.value.office_department}),l.value.club_id=i.club_id,l.value.office_department=i?.club?.name||k(i.club_id)||l.value.office_department)}),U(()=>y.value,s=>{const e=_.value;if(!e||!s){l.value.annual_plan_item=null;return}const i=w.value.find(a=>a.key===s);if(!i){l.value.annual_plan_item=null;return}l.value.annual_plan_item=i.raw,e.school_year&&(l.value.school_year=e.school_year),Number.isFinite(i.funds)&&(l.value.proposed_budget=i.funds),l.value.venue=w.value[0].raw.venue,l.value.date_of_implementation=w.value[0].raw.date_of_implementation,l.value.school_year=e.school_year||l.value.school_year,l.value.club_id=e.club_id,l.value.office_department=e?.club?.name||k(e.club_id)||l.value.office_department});const S=c(()=>!!l.value.annual_plan_id),G=()=>{if(!r.value){if(l.value.annual_plan_id="",l.value.annual_plan_item=null,y.value="",l.value.venue=null,l.value.date_of_implementation=null,g.value){const s=g.value;l.value.school_year=s.school_year,l.value.proposed_budget=s.proposed_budget,l.value.club_id=s.club_id,l.value.office_department=s.office_department}g.value=null}},E=c(()=>String(l.value?.status||"").toLowerCase()),r=c(()=>f.mode==="edit"&&E.value!=="draft"),K=c(()=>f.mode!=="edit"?"New Activity":r.value?"View Activity (read-only)":"Edit Activity"),H=c(()=>f.mode==="edit"?"Save Changes":"Create"),Q=c(()=>{switch(E.value){case"draft":return"bg-gray-100 text-gray-800";case"pending":return"bg-amber-100 text-amber-800";case"approved":return"bg-emerald-100 text-emerald-700";case"rejected":return"bg-rose-100 text-rose-700";case"cancelled":return"bg-zinc-200 text-zinc-800";default:return"bg-gray-100 text-gray-800"}}),W=()=>{if(r.value)return!1;const s={};return l.value.date_filed||(s.date_filed="Required"),l.value.semester?.trim()||(s.semester="Required"),l.value.school_year?.trim()||(s.school_year="Required"),l.value.name_of_activity?.trim()||(s.name_of_activity="Required"),l.value.date_of_implementation||(s.date_of_implementation="Required"),l.value.nature_of_activity||(s.nature_of_activity="Required"),l.value.club_id||(s.club_id="Required"),l.value.rationale?.trim()||(s.rationale="Required"),l.value.objectives?.trim()||(s.objectives="Required"),l.value.details_of_activity?.trim()||(s.details_of_activity="Required"),l.value.budgetary_requirements?.trim()||(s.budgetary_requirements="Required"),u.value=s,Object.keys(s).length===0},X=()=>{if(r.value||!W())return;const s={...l.value};s.proposed_budget===""&&(s.proposed_budget=0),s.filed_by_user_id=R.value,O.value||delete s.file_by_user_name,S.value&&_.value?(s.club_id=_.value.club_id,s.office_department=_.value?.club?.name||k(_.value.club_id)||s.office_department||""):s.office_department=k(s.club_id)||s.office_department||"",s.annual_plan_id===""&&(s.annual_plan_id=null),h("submit",s)};return(s,e)=>{const i=te("pending-click");return j.value?(d(),n("div",ie,[t("div",ne,[t("div",de,[t("div",oe,[t("h2",re,o(K.value),1),t("span",{class:x(["text-[10px] px-1.5 py-0.5 rounded",Q.value])},o(l.value.status),3)]),t("button",{class:"px-2.5 py-1 text-[11px] bg-gray-200 rounded",onClick:e[0]||(e[0]=a=>j.value=!1)},"Close")]),r.value?(d(),n("div",ve,[e[23]||(e[23]=m(" This activity has been submitted and is now ",-1)),t("strong",null,o(l.value.status),1),e[24]||(e[24]=m(". Editing is disabled. ",-1))])):p("",!0),t("div",pe,[t("div",me,[e[25]||(e[25]=t("div",{class:"text-sm font-medium"},"Link to Annual Plan (optional)",-1)),!r.value&&(S.value||l.value.annual_plan_item)?(d(),n("button",{key:0,class:"text-[11px] px-2 py-1 rounded border bg-gray-50 hover:bg-gray-100",onClick:G},"Reset Annual Plan link")):p("",!0)]),t("div",be,[t("div",null,[e[27]||(e[27]=t("label",{class:"block mb-0.5"},"Annual Plan",-1)),v(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.annual_plan_id=a),class:"w-full border rounded px-2 py-1.5",disabled:r.value},[e[26]||(e[26]=t("option",{value:""},"— Not linked —",-1)),(d(!0),n(C,null,V(L.value,a=>(d(),n("option",{key:a.id,value:a.id},o(a.reference_code)+" — SY "+o(a.school_year)+" — "+o(a?.club?.name||"Club#"+a.club_id),9,ce))),128))],8,_e),[[A,l.value.annual_plan_id]])]),t("div",null,[e[29]||(e[29]=t("label",{class:"block mb-0.5"},"Plan Item",-1)),v(t("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>y.value=a),class:"w-full border rounded px-2 py-1.5",disabled:r.value||!l.value.annual_plan_id||!w.value.length},[e[28]||(e[28]=t("option",{value:""},"— Select item —",-1)),(d(!0),n(C,null,V(w.value,a=>(d(),n("option",{key:a.key,value:a.key},o(a.title)+" — ₱"+o(D(a.funds)),9,ye))),128))],8,fe),[[A,y.value]])]),e[30]||(e[30]=t("div",{class:"self-end text-[11px] text-gray-600"},[m(" Choosing an Annual Plan locks the "),t("strong",null,"Club"),m(". Selecting an item also auto-fills "),t("strong",null,"School Year"),m(" and "),t("strong",null,"Proposed Budget"),m(". ")],-1))]),l.value.annual_plan_item?(d(),n("div",xe,[t("div",ge,[t("div",null,[e[31]||(e[31]=t("span",{class:"text-gray-500"},"Item:",-1)),t("strong",null,o(l.value.annual_plan_item.title||l.value.annual_plan_item.name||l.value.annual_plan_item.activity||"—"),1)]),t("div",null,[e[32]||(e[32]=t("span",{class:"text-gray-500"},"Funds:",-1)),t("strong",null,"₱"+o(D(l.value.annual_plan_item.funds||l.value.annual_plan_item.budget||0)),1)]),_.value?(d(),n("div",ke,[e[33]||(e[33]=t("span",{class:"text-gray-500"},"SY:",-1)),t("strong",null,o(_.value.school_year),1)])):p("",!0),_.value?.club?(d(),n("div",we,[e[34]||(e[34]=t("span",{class:"text-gray-500"},"Club:",-1)),t("strong",null,o(_.value.club.name)+" ("+o(_.value.club.code||"—")+")",1)])):p("",!0)])])):p("",!0)]),t("div",Se,[t("div",null,[e[35]||(e[35]=t("label",{class:"block mb-0.5"},[m("Date Filed "),t("span",{class:"text-red-500"},"*")],-1)),v(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.date_filed=a),type:"date",class:"w-full border rounded px-2 py-1.5",disabled:r.value},null,8,Ae),[[b,l.value.date_filed]]),u.value.date_filed?(d(),n("p",Ce,o(u.value.date_filed),1)):p("",!0)]),t("div",null,[e[36]||(e[36]=t("label",{class:"block mb-0.5"},[m("School Year "),t("span",{class:"text-red-500"},"*")],-1)),v(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.school_year=a),class:"w-full border rounded px-2 py-1.5",disabled:r.value||S.value},[(d(!0),n(C,null,V(B.value,a=>(d(),n("option",{key:a,value:a},o(a),9,Ne))),128))],8,Ve),[[A,l.value.school_year]]),u.value.school_year?(d(),n("p",qe,o(u.value.school_year),1)):p("",!0)]),t("div",null,[e[38]||(e[38]=t("label",{class:"block mb-0.5"},[m("Semester "),t("span",{class:"text-red-500"},"*")],-1)),v(t("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.semester=a),class:"w-full border rounded px-2 py-1.5",disabled:r.value},[e[37]||(e[37]=t("option",{disabled:"",value:""},"Select semester…",-1)),(d(),n(C,null,V(Y,a=>t("option",{key:a,value:a},o(a),9,je)),64))],8,Ue),[[A,l.value.semester]]),u.value.semester?(d(),n("p",Ie,o(u.value.semester),1)):p("",!0)]),t("div",Re,[e[39]||(e[39]=t("label",{class:"block mb-0.5"},[m("Name of Activity "),t("span",{class:"text-red-500"},"*")],-1)),v(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.name_of_activity=a),class:"w-full border rounded px-2 py-1.5",disabled:r.value},null,8,Pe),[[b,l.value.name_of_activity]]),u.value.name_of_activity?(d(),n("p",he,o(u.value.name_of_activity),1)):p("",!0)])]),t("div",Fe,[t("div",null,[t("label",Oe,[e[40]||(e[40]=m(" Club ",-1)),e[41]||(e[41]=t("span",{class:"text-red-500"},"*",-1)),S.value?(d(),n("span",Be,"locked by Annual Plan")):p("",!0)]),v(t("select",{"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.club_id=a),class:"w-full border rounded px-2 py-1.5",disabled:r.value||S.value||!!P.lockedClubId},[e[42]||(e[42]=t("option",{value:""},"Select club…",-1)),(d(!0),n(C,null,V(ae(N).clubs.data||[],a=>(d(),n("option",{key:a.id,value:a.id},o(a.name),9,Le))),128))],8,De),[[A,l.value.club_id]]),u.value.club_id?(d(),n("p",Ee,o(u.value.club_id),1)):p("",!0)]),t("div",null,[e[43]||(e[43]=t("label",{class:"block mb-0.5"},"Venue",-1)),v(t("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>l.value.venue=a),class:"w-full border rounded px-2 py-1.5",disabled:r.value},null,8,Te),[[b,l.value.venue]])]),t("div",null,[e[44]||(e[44]=t("label",{class:"block mb-0.5"},[m("Date of Implementation "),t("span",{class:"text-red-500"},"*")],-1)),v(t("input",{"onUpdate:modelValue":e[9]||(e[9]=a=>l.value.date_of_implementation=a),type:"date",class:x(["w-full border rounded px-2 py-1.5",u.value.date_of_implementation?"border-red-500":""]),disabled:r.value,"aria-invalid":!!u.value.date_of_implementation},null,10,Me),[[b,l.value.date_of_implementation]]),u.value.date_of_implementation?(d(),n("p",Ye,o(u.value.date_of_implementation),1)):p("",!0)])]),t("div",$e,[t("div",null,[e[45]||(e[45]=t("label",{class:"block mb-0.5"},"Proposed Budget",-1)),v(t("input",{"onUpdate:modelValue":e[10]||(e[10]=a=>l.value.proposed_budget=a),type:"number",step:"0.01",min:"0",class:"w-full border rounded px-2 py-1.5",disabled:r.value},null,8,ze),[[b,l.value.proposed_budget]])]),t("div",null,[e[46]||(e[46]=t("label",{class:"block mb-0.5"},[m("Nature of Activity "),t("span",{class:"text-red-500"},"*")],-1)),v(t("select",{"onUpdate:modelValue":e[11]||(e[11]=a=>l.value.nature_of_activity=a),class:x(["w-full border rounded px-2 py-1.5",u.value.nature_of_activity?"border-red-500":""]),disabled:r.value,"aria-invalid":!!u.value.nature_of_activity},[(d(),n(C,null,V($,a=>t("option",{key:a,value:a},o(a),9,Ge)),64))],10,Je),[[A,l.value.nature_of_activity]]),u.value.nature_of_activity?(d(),n("p",Ke,o(u.value.nature_of_activity),1)):p("",!0)]),t("div",null,[e[47]||(e[47]=t("label",{class:"block mb-0.5"},"Participants",-1)),v(t("input",{"onUpdate:modelValue":e[12]||(e[12]=a=>l.value.participants=a),class:"w-full border rounded px-2 py-1.5",disabled:r.value},null,8,He),[[b,l.value.participants]])])]),t("div",Qe,[t("div",null,[e[48]||(e[48]=t("label",{class:"block mb-0.5"},[m("Rationale "),t("span",{class:"text-red-500"},"*")],-1)),v(t("textarea",{"onUpdate:modelValue":e[13]||(e[13]=a=>l.value.rationale=a),rows:"3",class:x(["w-full border rounded px-2 py-1.5",u.value.rationale?"border-red-500":""]),disabled:r.value,"aria-invalid":!!u.value.rationale},null,10,We),[[b,l.value.rationale]]),u.value.rationale?(d(),n("p",Xe,o(u.value.rationale),1)):p("",!0)]),t("div",null,[e[49]||(e[49]=t("label",{class:"block mb-0.5"},[m("Objectives "),t("span",{class:"text-red-500"},"*")],-1)),v(t("textarea",{"onUpdate:modelValue":e[14]||(e[14]=a=>l.value.objectives=a),rows:"3",class:x(["w-full border rounded px-2 py-1.5",u.value.objectives?"border-red-500":""]),disabled:r.value,"aria-invalid":!!u.value.objectives},null,10,Ze),[[b,l.value.objectives]]),u.value.objectives?(d(),n("p",el,o(u.value.objectives),1)):p("",!0)])]),t("div",ll,[t("div",null,[e[50]||(e[50]=t("label",{class:"block mb-0.5"},[m("Details of the Activity "),t("span",{class:"text-red-500"},"*")],-1)),v(t("textarea",{"onUpdate:modelValue":e[15]||(e[15]=a=>l.value.details_of_activity=a),rows:"4",class:x(["w-full border rounded px-2 py-1.5",u.value.details_of_activity?"border-red-500":""]),disabled:r.value,"aria-invalid":!!u.value.details_of_activity},null,10,tl),[[b,l.value.details_of_activity]]),u.value.details_of_activity?(d(),n("p",al,o(u.value.details_of_activity),1)):p("",!0)]),t("div",null,[e[51]||(e[51]=t("label",{class:"block mb-0.5"},[m("Budgetary Requirements "),t("span",{class:"text-red-500"},"*")],-1)),v(t("textarea",{"onUpdate:modelValue":e[16]||(e[16]=a=>l.value.budgetary_requirements=a),rows:"4",class:x(["w-full border rounded px-2 py-1.5",u.value.budgetary_requirements?"border-red-500":""]),disabled:r.value,"aria-invalid":!!u.value.budgetary_requirements},null,10,sl),[[b,l.value.budgetary_requirements]]),u.value.budgetary_requirements?(d(),n("p",ul,o(u.value.budgetary_requirements),1)):p("",!0)])]),O.value?(d(),n("div",il,[e[52]||(e[52]=t("label",{class:"block mb-0.5"},"Filer Name Override (optional)",-1)),v(t("input",{"onUpdate:modelValue":e[17]||(e[17]=a=>l.value.file_by_user_name=a),class:"w-full border rounded px-2 py-1.5",disabled:r.value,placeholder:"If provided, this name appears as the filer"},null,8,nl),[[b,l.value.file_by_user_name]])])):p("",!0),t("div",dl,[e[53]||(e[53]=t("label",{class:"block mb-0.5"},"Remarks",-1)),v(t("textarea",{"onUpdate:modelValue":e[18]||(e[18]=a=>l.value.remarks=a),rows:"2",class:"w-full border rounded px-2 py-1.5",disabled:r.value},null,8,ol),[[b,l.value.remarks]])]),v(t("input",{type:"hidden","onUpdate:modelValue":e[19]||(e[19]=a=>l.value.filed_by_user_id=a)},null,512),[[b,l.value.filed_by_user_id]]),v(t("input",{type:"hidden","onUpdate:modelValue":e[20]||(e[20]=a=>l.value.office_department=a)},null,512),[[b,l.value.office_department]]),v(t("input",{type:"hidden","onUpdate:modelValue":e[21]||(e[21]=a=>l.value.status=a)},null,512),[[b,l.value.status]]),t("div",rl,[t("button",{class:"px-3 py-1.5 bg-gray-200 rounded text-xs",onClick:e[22]||(e[22]=a=>j.value=!1)},"Close"),r.value?p("",!0):v((d(),n("button",vl,[m(o(H.value),1)])),[[i,X]])])])])):p("",!0)}}};export{_l as _};
