import{c as q,r as E,x as ee,a as p,d as L,q as v,e,t as g,h as P,k as W,v as Y,C as ae,b as Fe,g as j,z as ze,F as H,B as Z,S as oe,G as Ne,H as We,o as ye,E as Oe,I as Ke,J as Ge,K as Se,n as Ve,j as re,f as N,A as xe,u as qe,l as de,L as Je}from"./index.CogHg4rp.js";import{u as Ye,v as He,w as Xe,x as Qe,y as Ze,z as je,A as et,B as tt,C as nt,D as lt,E as ot,F as at,G as st,H as it,I as rt,_ as ut,a as dt,g as ct,J as mt,K as vt,L as pt,M as ft}from"./SectionMain.Camu0wne.js";import{_ as bt,a as De,b as Ue}from"./Badge.Up2DqiRl.js";import{_ as gt,B as xt}from"./NotificationBar.C_cXw3cK.js";import{u as he}from"./club.B1pxqbVW.js";import{u as yt}from"./clubDoc.D6uaUWQ2.js";import{_ as ve}from"./IconifyButton.C0kYFeFc.js";import"./activityDesignService.Dgqxj02-.js";import"./utilizationRequestService.u4yMTSgC.js";import"./liquidationFundService.COiPrIQO.js";import"./ToasterComponent.CHXBIuQk.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const ht={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},wt={class:"bg-white p-4 rounded-xl shadow-xl w-[920px] max-h-screen overflow-auto"},Ct={class:"flex items-center justify-between mb-3"},_t={class:"text-lg font-semibold"},$t={class:"grid grid-cols-2 gap-4 text-sm"},kt={key:0,class:"text-red-600 text-xs mt-1"},St={key:0,class:"text-red-600 text-xs mt-1"},Vt={class:"col-span-2"},Dt={class:"col-span-2 grid grid-cols-2 gap-4"},Ut={class:"space-y-2"},Et={class:"border-2 border-dashed rounded-xl p-4 flex items-center justify-between gap-3"},At={class:"flex items-center gap-3"},Bt={class:"w-16 h-16 bg-gray-50 border rounded-lg overflow-hidden flex items-center justify-center"},It=["src"],Lt={key:1,class:"text-xs text-gray-400"},Mt={class:"flex items-center gap-2"},Ot={class:"px-3 py-2 bg-gray-800 text-white rounded cursor-pointer text-xs"},jt=["disabled"],Pt={key:0,class:"text-red-600 text-xs mt-1"},Rt={key:1,class:"text-xs text-gray-500 break-all"},Tt={class:"space-y-2"},Ft={class:"border-2 border-dashed rounded-xl p-4 flex items-center justify-between gap-3"},zt={class:"flex items-center gap-3"},Nt={class:"w-40 h-16 bg-gray-50 border rounded-lg overflow-hidden flex items-center justify-center"},Wt=["src"],Kt={key:1,class:"text-xs text-gray-400"},Gt={class:"flex items-center gap-2"},qt={class:"px-3 py-2 bg-gray-800 text-white rounded cursor-pointer text-xs"},Jt=["disabled"],Yt={key:0,class:"text-red-600 text-xs mt-1"},Ht={key:1,class:"text-xs text-gray-500 break-all"},Xt={class:"flex justify-end gap-2 mt-5"},Qt=2*1024*1024,Ee={__name:"ClubFormModal",props:{modelValue:{type:Boolean,default:!1},mode:{type:String,default:"create"},initial:{type:Object,default:()=>({id:null,name:"",code:"",category:"",description:"",is_active:!0,established_at:"",website:"",email:"",phone:"",logo:"",banner:""})}},emits:["update:modelValue","submit"],setup(n,{emit:y}){const o=n,x=y,d=q({get:()=>o.modelValue,set:r=>x("update:modelValue",r)}),D="http://localhost:3000",l=E({...o.initial}),a=E({});ee(()=>o.initial,r=>{l.value={...r},a.value={}},{immediate:!0});const f=q(()=>o.mode==="edit"?"Edit Club":"Add New Club"),w=q(()=>o.mode==="edit"?"Save Changes":"Create"),M=q(()=>{const r=l.value.logo;return r?r.startsWith("data:")?r:`${D}${r}`:""}),F=q(()=>{const r=l.value.banner;return r?r.startsWith("data:")?r:`${D}${r}`:""}),I=()=>{const r={};return l.value.name?.trim()||(r.name="Name is required"),l.value.code?.trim()||(r.code="Code is required"),a.value={...a.value,...r},Object.keys(r).length===0},A=["image/png","image/jpeg"],J=r=>new Promise((s,O)=>{const te=new FileReader;te.onload=X=>s(X.target.result),te.onerror=O,te.readAsDataURL(r)});function T(r,s){return a.value[s]="",A.includes(r.type)?r.size>Qt?(a.value[s]="File too large. Maximum size is 2 MB.",!1):!0:(a.value[s]="Invalid file type. Please upload a PNG or JPEG image.",!1)}const K=async r=>{const s=r.target.files?.[0];if(s){if(!T(s,"logo")){r.target.value="";return}l.value.logo=await J(s)}},z=async r=>{const s=r.target.files?.[0];if(s){if(!T(s,"banner")){r.target.value="";return}l.value.banner=await J(s)}},R=()=>{l.value.logo="",a.value.logo=""},V=()=>{l.value.banner="",a.value.banner=""},$=()=>{if(!I())return;const r={...l.value};Object.keys(r).forEach(s=>{r[s]===""&&(r[s]=null)}),x("submit",r)};return(r,s)=>d.value?(v(),p("div",ht,[e("div",wt,[e("div",Ct,[e("h2",_t,g(f.value),1),e("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:s[0]||(s[0]=O=>d.value=!1)},"Close")]),e("div",$t,[e("div",null,[s[11]||(s[11]=e("label",{class:"block mb-1"},[W("Name "),e("span",{class:"text-red-500"},"*")],-1)),P(e("input",{"onUpdate:modelValue":s[1]||(s[1]=O=>l.value.name=O),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring",placeholder:"e.g. Math Society"},null,512),[[Y,l.value.name]]),a.value.name?(v(),p("p",kt,g(a.value.name),1)):L("",!0)]),e("div",null,[s[12]||(s[12]=e("label",{class:"block mb-1"},[W("Code "),e("span",{class:"text-red-500"},"*")],-1)),P(e("input",{"onUpdate:modelValue":s[2]||(s[2]=O=>l.value.code=O),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring",placeholder:"e.g. MATHSOC"},null,512),[[Y,l.value.code]]),a.value.code?(v(),p("p",St,g(a.value.code),1)):L("",!0)]),e("div",null,[s[14]||(s[14]=e("label",{class:"block mb-1"},"Category",-1)),P(e("select",{"onUpdate:modelValue":s[3]||(s[3]=O=>l.value.category=O),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring"},s[13]||(s[13]=[Fe('<option disabled value="">Select a category</option><option value="Academic">Academic</option><option value="Cultural">Cultural</option><option value="Athletics">Athletics</option><option value="Social">Social</option><option value="Community Service">Community Service</option><option value="Religious/Spiritual">Religious / Spiritual</option><option value="Environmental">Environmental</option><option value="Leadership">Leadership</option><option value="Others">Others</option>',10)]),512),[[ae,l.value.category]])]),e("div",null,[s[16]||(s[16]=e("label",{class:"block mb-1"},"Active?",-1)),P(e("select",{"onUpdate:modelValue":s[4]||(s[4]=O=>l.value.is_active=O),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring"},s[15]||(s[15]=[e("option",{value:!0},"Yes",-1),e("option",{value:!1},"No",-1)]),512),[[ae,l.value.is_active]])]),e("div",Vt,[s[17]||(s[17]=e("label",{class:"block mb-1"},"Description",-1)),P(e("textarea",{"onUpdate:modelValue":s[5]||(s[5]=O=>l.value.description=O),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring",rows:"3"},null,512),[[Y,l.value.description]])]),e("div",null,[s[18]||(s[18]=e("label",{class:"block mb-1"},"Established At",-1)),P(e("input",{"onUpdate:modelValue":s[6]||(s[6]=O=>l.value.established_at=O),type:"date",class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring"},null,512),[[Y,l.value.established_at]])]),e("div",null,[s[19]||(s[19]=e("label",{class:"block mb-1"},"Website",-1)),P(e("input",{"onUpdate:modelValue":s[7]||(s[7]=O=>l.value.website=O),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring",placeholder:"https://…"},null,512),[[Y,l.value.website]])]),e("div",null,[s[20]||(s[20]=e("label",{class:"block mb-1"},"Email",-1)),P(e("input",{"onUpdate:modelValue":s[8]||(s[8]=O=>l.value.email=O),type:"email",class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring",placeholder:"club@example.com"},null,512),[[Y,l.value.email]])]),e("div",null,[s[21]||(s[21]=e("label",{class:"block mb-1"},"Phone",-1)),P(e("input",{"onUpdate:modelValue":s[9]||(s[9]=O=>l.value.phone=O),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring",placeholder:"+63…"},null,512),[[Y,l.value.phone]])]),e("div",Dt,[e("div",Ut,[s[24]||(s[24]=e("label",{class:"block"},"Logo",-1)),e("div",Et,[e("div",At,[e("div",Bt,[M.value?(v(),p("img",{key:0,src:M.value,alt:"Logo",class:"w-full h-full object-contain"},null,8,It)):(v(),p("span",Lt,"No logo"))]),s[22]||(s[22]=e("div",{class:"text-xs text-gray-500"},[e("p",{class:"font-medium text-gray-700"},"PNG/JPEG • ≤ 2MB"),e("p",null,"Square works best")],-1))]),e("div",Mt,[e("label",Ot,[s[23]||(s[23]=W(" Change ",-1)),e("input",{type:"file",class:"hidden",accept:"image/png,image/jpeg",onChange:K},null,32)]),e("button",{class:"px-3 py-2 bg-gray-200 rounded text-xs",onClick:R,disabled:!l.value.logo},"Remove",8,jt)])]),a.value.logo?(v(),p("p",Pt,g(a.value.logo),1)):L("",!0),l.value.logo&&!l.value.logo.startsWith("data:")?(v(),p("p",Rt,g(j(D)+l.value.logo),1)):L("",!0)]),e("div",Tt,[s[27]||(s[27]=e("label",{class:"block"},"Banner",-1)),e("div",Ft,[e("div",zt,[e("div",Nt,[F.value?(v(),p("img",{key:0,src:F.value,alt:"Banner",class:"w-full h-full object-contain"},null,8,Wt)):(v(),p("span",Kt,"No banner"))]),s[25]||(s[25]=e("div",{class:"text-xs text-gray-500"},[e("p",{class:"font-medium text-gray-700"},"PNG/JPEG • ≤ 2MB"),e("p",null,"Wide 5:1 recommended")],-1))]),e("div",Gt,[e("label",qt,[s[26]||(s[26]=W(" Change ",-1)),e("input",{type:"file",class:"hidden",accept:"image/png,image/jpeg",onChange:z},null,32)]),e("button",{class:"px-3 py-2 bg-gray-200 rounded text-xs",onClick:V,disabled:!l.value.banner},"Remove",8,Jt)])]),a.value.banner?(v(),p("p",Yt,g(a.value.banner),1)):L("",!0),l.value.banner&&!l.value.banner.startsWith("data:")?(v(),p("p",Ht,g(j(D)+l.value.banner),1)):L("",!0)])])]),e("div",Xt,[e("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:s[10]||(s[10]=O=>d.value=!1)},"Cancel"),e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:$},g(w.value),1)])])])):L("",!0)}},Zt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},en={class:"bg-white p-4 rounded shadow-lg w-[860px] max-h-screen overflow-auto"},tn={class:"flex items-center justify-between"},nn={class:"text-lg font-semibold"},ln={class:"text-gray-600"},on={class:"mt-3 flex flex-col gap-2"},an={class:"flex items-center gap-2"},sn=["value"],rn={class:"text-[12px] text-gray-600"},un={class:"mt-4"},dn={class:"relative"},cn={key:0,class:"absolute z-10 mt-1 w-full bg-white border rounded shadow max-h-64 overflow-auto"},mn={key:0,class:"px-3 py-2 text-xs text-gray-500"},vn=["onClick"],pn={class:"font-medium"},fn={class:"text-gray-500"},bn={class:"text-xs text-gray-500"},gn={key:0,class:"px-3 py-2 text-xs text-gray-500"},xn={key:0,class:"flex flex-wrap gap-2 mt-2"},yn=["onClick"],hn={class:"flex justify-end mt-2"},wn=["disabled"],Cn={class:"space-y-2 mt-4 max-h-[60vh] overflow-y-auto pr-2 -mr-2"},_n={class:"text-sm"},$n={class:"font-semibold"},kn={class:"text-gray-500 text-xs"},Sn={class:"text-gray-600 text-xs"},Vn={class:"mt-1 text-xs flex flex-wrap items-center gap-3"},Dn=["disabled","value","onChange"],Un=["value"],En=["disabled","value","onChange"],An=["value"],Bn={key:0,class:"text-[11px] text-gray-500"},In=["onClick"],Ln={class:"flex justify-between items-center mt-3 text-xs text-gray-600"},pe=10,Mn={__name:"ClubMembersModal",props:{modelValue:{type:Boolean,default:!1},clubId:{type:[Number,String],required:!0},clubName:{type:String,default:""}},emits:["update:modelValue"],setup(n,{emit:y}){const o=n,x=y,d=he(),D=ze(),l=q({get:()=>o.modelValue,set:m=>x("update:modelValue",m)}),a=E([]),f=E(1),w=E(""),M=E("all"),F=E("all"),I=["president","vice-president","secretary","treasurer","pio","business manager","bod","officer"],A=new Set([...I,"officer"]),J=[...I,"member"],T=["pending","active","inactive"],K=m=>(m??"member").toString().trim().toLowerCase()||"member",z=m=>{const i=K(m);if(i==="member")return 999;const u=I.indexOf(i);return u===-1?I.indexOf("officer"):u},R=m=>A.has(K(m?.UserClub?.role)),V=m=>{const i=(m??"active").toString().trim().toLowerCase();return T.includes(i)?i:"active"},$=m=>{const i=K(m?.UserClub?.role);return i==="member"?"member":J.includes(i)?i:"officer"},r=(m,i)=>{if(!i)return!0;const u=`${m.first_name||""} ${m.last_name||""}`.toLowerCase(),B=(m.username||"").toLowerCase(),ie=(m.email||"").toLowerCase();return u.includes(i)||B.includes(i)||ie.includes(i)},s=q(()=>{const m=w.value.trim().toLowerCase();let i=a.value||[];return M.value==="officers"?i=i.filter(R):M.value==="members"&&(i=i.filter(u=>!R(u))),F.value!=="all"&&(i=i.filter(u=>V(u?.UserClub?.status)===F.value)),m&&(i=i.filter(u=>r(u,m))),i.slice().sort((u,B)=>{const ie=z(u.UserClub?.role),we=z(B.UserClub?.role);if(ie!==we)return ie-we;const Ce=(u.last_name||"").toLowerCase(),_e=(B.last_name||"").toLowerCase();if(Ce!==_e)return Ce.localeCompare(_e);const $e=(u.first_name||"").toLowerCase(),ke=(B.first_name||"").toLowerCase();return $e!==ke?$e.localeCompare(ke):(u.username||"").toLowerCase().localeCompare((B.username||"").toLowerCase())})}),O=q(()=>(a.value||[]).filter(R).length),te=q(()=>(a.value||[]).filter(m=>!R(m)).length),X=q(()=>{const m=s.value.length,i=Math.ceil(Math.max(m,1)/pe),u=Math.min(f.value,i||1),B=(u-1)*pe,ie=s.value.slice(B,B+pe);return{total:m,totalPages:i,currentPage:u,pageSize:pe,data:ie}});ee([w,M,F],()=>f.value=1);const ue=async()=>{await d.fetchById(o.clubId),a.value=Array.isArray(d.selectedClub?.users)?d.selectedClub.users:[],w.value="",M.value="all",F.value="all",f.value=1},U=E(""),c=E([]),k=E(!1),C=E([]);let S=null;const b=m=>{const i={};return m&&(m.includes("@")?i.email=m:i.username=m,i.is_active=!0),i},t=m=>{const i=new Set((a.value||[]).map(B=>B.id)),u=new Set((C.value||[]).map(B=>B.id));return(m||[]).filter(B=>!i.has(B.id)&&!u.has(B.id))},_=async()=>{const m=U.value.trim();if(!m){c.value=[];return}k.value=!0;try{await D.fetchAll({page:1,limit:8,filters:b(m)},!0),c.value=t(D.users.data||[])}finally{k.value=!1}};ee(U,m=>{if(clearTimeout(S),!m?.trim()){c.value=[];return}S=setTimeout(_,250)});const h=m=>{C.value.push(m),c.value=c.value.filter(i=>i.id!==m.id),U.value=""},G=m=>{C.value=C.value.filter(i=>i.id!==m)},le=async()=>{if(!C.value.length)return;const m=C.value.map(i=>i.id);await d.addUsersToClub(o.clubId,m),a.value=Array.isArray(d.selectedClub?.users)?d.selectedClub.users:[],C.value=[],c.value=[],U.value="",f.value=1},Q=E(new Set),se=E(new Set),me=async(m,i)=>{const u=V(i),B=V(m.UserClub?.status);if(B!==u){Q.value.add(m.id),m.UserClub||(m.UserClub={}),m.UserClub.status=u;try{await d.updateMemberStatus(o.clubId,m.id,u)}catch{m.UserClub.status=B,oe.fire("Update failed",d.error||"Unable to update status","error")}finally{Q.value.delete(m.id)}}},Re=async(m,i)=>{const u=K(i),B=K(m.UserClub?.role);if(B!==u){se.value.add(m.id),m.UserClub||(m.UserClub={}),m.UserClub.role=u;try{await d.updateMemberRole(o.clubId,m.id,u)}catch{m.UserClub.role=B,oe.fire("Update failed",d.error||"Unable to update role","error")}finally{se.value.delete(m.id)}}},Te=async m=>{await d.removeUserFromClub(o.clubId,m),a.value=a.value.filter(i=>i.id!==m),U.value.trim()&&c.value.length&&(c.value=t(c.value))};return ee(()=>o.modelValue,m=>{m&&ue()},{immediate:!1}),(m,i)=>l.value?(v(),p("div",Zt,[e("div",en,[e("div",tn,[e("h2",nn,[i[7]||(i[7]=W("Club Members — ",-1)),e("span",ln,g(n.clubName),1)]),e("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:i[0]||(i[0]=u=>l.value=!1)},"Close")]),e("div",on,[e("div",an,[P(e("select",{"onUpdate:modelValue":i[1]||(i[1]=u=>M.value=u),class:"border rounded px-2 py-1 text-sm"},i[8]||(i[8]=[e("option",{value:"all"},"All roles",-1),e("option",{value:"officers"},"Officers",-1),e("option",{value:"members"},"Members",-1)]),512),[[ae,M.value]]),P(e("select",{"onUpdate:modelValue":i[2]||(i[2]=u=>F.value=u),class:"border rounded px-2 py-1 text-sm"},[i[9]||(i[9]=e("option",{value:"all"},"All statuses",-1)),(v(),p(H,null,Z(T,u=>e("option",{key:u,value:u},g(u),9,sn)),64))],512),[[ae,F.value]]),P(e("input",{"onUpdate:modelValue":i[3]||(i[3]=u=>w.value=u),type:"text",placeholder:"Search club members by name, username, or email…",class:"border rounded px-2 py-1 text-sm w-full"},null,512),[[Y,w.value]])]),e("div",rn," Showing "+g(X.value.total)+" result(s). Officers: "+g(O.value)+" • Members: "+g(te.value),1)]),e("div",un,[e("div",dn,[P(e("input",{"onUpdate:modelValue":i[4]||(i[4]=u=>U.value=u),type:"text",placeholder:"Add users: search by username or email…",class:"border rounded px-2 py-1 text-sm w-full",autocomplete:"off"},null,512),[[Y,U.value]]),U.value&&(c.value.length||k.value)?(v(),p("div",cn,[k.value?(v(),p("div",mn,"Searching…")):(v(),p(H,{key:1},[(v(!0),p(H,null,Z(c.value,u=>(v(),p("button",{key:u.id,class:"w-full text-left px-3 py-2 hover:bg-gray-100 text-sm",onClick:B=>h(u)},[e("div",pn,[W(g(u.first_name)+" "+g(u.last_name)+" ",1),e("span",fn,"@"+g(u.username),1)]),e("div",bn,g(u.email),1)],8,vn))),128)),c.value.length?L("",!0):(v(),p("div",gn,"No matches"))],64))])):L("",!0)]),C.value.length?(v(),p("div",xn,[(v(!0),p(H,null,Z(C.value,u=>(v(),p("span",{key:u.id,class:"inline-flex items-center gap-2 px-2 py-1 bg-blue-50 border border-blue-200 rounded text-xs"},[W(g(u.first_name)+" "+g(u.last_name)+" (@"+g(u.username)+") ",1),e("button",{class:"ml-1 text-blue-600",onClick:B=>G(u.id)},"✕",8,yn)]))),128))])):L("",!0),e("div",hn,[e("button",{class:"px-3 py-1 bg-blue-600 text-white rounded text-xs disabled:opacity-50",disabled:!C.value.length,onClick:le}," Add Selected ",8,wn)])]),e("div",Cn,[(v(!0),p(H,null,Z(X.value.data,u=>(v(),p("div",{key:u.id,class:"flex items-start justify-between p-3 border bg-gray-50 rounded"},[e("div",_n,[e("div",$n,[W(g(u.first_name)+" "+g(u.last_name)+" ",1),e("span",kn,"(@"+g(u.username)+")",1)]),e("div",Sn,g(u.email),1),e("div",Vn,[e("span",null,[i[10]||(i[10]=W("Role: ",-1)),e("select",{class:"border rounded px-1 py-0.5 text-xs",disabled:se.value.has(u.id),value:$(u),onChange:B=>Re(u,B.target.value)},[(v(),p(H,null,Z(J,B=>e("option",{key:B,value:B},g(B),9,Un)),64))],40,Dn)]),e("span",null,[i[11]||(i[11]=W("Status: ",-1)),e("select",{class:"border rounded px-1 py-0.5 text-xs",disabled:Q.value.has(u.id),value:V(u.UserClub?.status),onChange:B=>me(u,B.target.value)},[(v(),p(H,null,Z(T,B=>e("option",{key:B,value:B},g(B),9,An)),64))],40,En)]),e("span",null,[i[12]||(i[12]=W("Joined: ",-1)),e("strong",null,g(u.UserClub?.joined_at?new Date(u.UserClub.joined_at).toLocaleDateString():"—"),1)]),se.value.has(u.id)||Q.value.has(u.id)?(v(),p("span",Bn,"Saving…")):L("",!0)])]),e("div",null,[e("button",{class:"px-2 py-1 bg-red-600 text-white rounded text-xs",onClick:B=>Te(u.id)},"Remove",8,In)])]))),128))]),e("div",Ln,[f.value>1?(v(),p("button",{key:0,onClick:i[5]||(i[5]=u=>f.value=f.value-1),class:"px-3 py-1 bg-gray-300 rounded"},"Previous")):L("",!0),e("div",null,"Page "+g(X.value.currentPage)+" of "+g(X.value.totalPages||1),1),f.value<X.value.totalPages?(v(),p("button",{key:1,onClick:i[6]||(i[6]=u=>f.value=f.value+1),class:"px-3 py-1 bg-gray-300 rounded"},"Next")):L("",!0)])])])):L("",!0)}};var On=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCommentChange","onCompositionEnd","onCompositionStart","onCompositionUpdate","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onInput","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],jn=function(n){return On.map(function(y){return y.toLowerCase()}).indexOf(n.toLowerCase())!==-1},Pn=function(n,y,o){Object.keys(y).filter(jn).forEach(function(x){var d=y[x];typeof d=="function"&&(x==="onInit"?d(n,o):o.on(x.substring(2),function(D){return d(D,o)}))})},Rn=function(n,y,o,x){var d=n.modelEvents?n.modelEvents:null,D=Array.isArray(d)?d.join(" "):d;ee(x,function(l,a){o&&typeof l=="string"&&l!==a&&l!==o.getContent({format:n.outputFormat})&&o.setContent(l)}),o.on(D||"change input undo redo",function(){y.emit("update:modelValue",o.getContent({format:n.outputFormat}))})},Tn=function(n,y,o,x,d,D){x.setContent(D()),o.attrs["onUpdate:modelValue"]&&Rn(y,o,x,d),Pn(n,o.attrs,x)},Ae=0,Pe=function(n){var y=Date.now(),o=Math.floor(Math.random()*1e9);return Ae++,n+"_"+o+Ae+String(y)},Fn=function(n){return n!==null&&n.tagName.toLowerCase()==="textarea"},Be=function(n){return typeof n>"u"||n===""?[]:Array.isArray(n)?n:n.split(" ")},zn=function(n,y){return Be(n).concat(Be(y))},Nn=function(n){return n==null},Ie=function(n){var y;return typeof((y=n.options)===null||y===void 0?void 0:y.set)=="function"&&n.options.isRegistered("disabled")},Le=function(){return{listeners:[],scriptId:Pe("tiny-script"),scriptLoaded:!1}},Wn=function(){var n=Le(),y=function(d,D,l,a){var f=D.createElement("script");f.referrerPolicy="origin",f.type="application/javascript",f.id=d,f.src=l;var w=function(){f.removeEventListener("load",w),a()};f.addEventListener("load",w),D.head&&D.head.appendChild(f)},o=function(d,D,l){n.scriptLoaded?l():(n.listeners.push(l),d.getElementById(n.scriptId)||y(n.scriptId,d,D,function(){n.listeners.forEach(function(a){return a()}),n.scriptLoaded=!0}))},x=function(){n=Le()};return{load:o,reinitialize:x}},Kn=Wn(),Gn=function(){return typeof window<"u"?window:global},ce=function(){var n=Gn();return n&&n.tinymce?n.tinymce:null},qn={apiKey:String,licenseKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,readonly:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(n){return n==="html"||n==="text"}}},ne=function(){return ne=Object.assign||function(n){for(var y,o=1,x=arguments.length;o<x;o++){y=arguments[o];for(var d in y)Object.prototype.hasOwnProperty.call(y,d)&&(n[d]=y[d])}return n},ne.apply(this,arguments)},Jn=function(n,y,o,x){return n(x||"div",{id:y,ref:o})},Yn=function(n,y,o){return n("textarea",{id:y,visibility:"hidden",ref:o})},be={selector:void 0,target:void 0},ge=function(n,y){var o;typeof((o=n.mode)===null||o===void 0?void 0:o.set)=="function"?n.mode.set(y):n.setMode(y)},Hn=Ne({props:qn,setup:function(n,y){var o=n.init?ne(ne({},n.init),be):ne({},be),x=We(n),d=x.disabled,D=x.readonly,l=x.modelValue,a=x.tagName,f=E(null),w=null,M=n.id||Pe("tiny-vue"),F=n.init&&n.init.inline||n.inline,I=!!y.attrs["onUpdate:modelValue"],A=!0,J=n.initialValue?n.initialValue:"",T="",K=function(V){return I?function(){return l?.value?l.value:""}:function(){return V?J:T}},z=function(){var V=K(A),$=ne(ne({},o),{disabled:n.disabled,readonly:n.readonly,target:f.value,plugins:zn(o.plugins,n.plugins),toolbar:n.toolbar||o.toolbar,inline:F,license_key:n.licenseKey,setup:function(r){w=r,!Ie(w)&&n.disabled===!0&&ge(w,"readonly"),r.on("init",function(s){return Tn(s,n,y,r,l,V)}),typeof o.setup=="function"&&o.setup(r)}});Fn(f.value)&&(f.value.style.visibility=""),ce().init($),A=!1};ee(D,function(V){w!==null&&ge(w,V?"readonly":"design")}),ee(d,function(V){w!==null&&(Ie(w)?w.options.set("disabled",V):ge(w,V?"readonly":"design"))}),ee(a,function(V){var $;w&&(I||(T=w.getContent()),($=ce())===null||$===void 0||$.remove(w),Ve(function(){return z()}))}),ye(function(){if(ce()!==null)z();else if(f.value&&f.value.ownerDocument){var V=n.cloudChannel?n.cloudChannel:"8",$=n.apiKey?n.apiKey:"no-api-key",r=Nn(n.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat($,"/tinymce/").concat(V,"/tinymce.min.js"):n.tinymceScriptSrc;Kn.load(f.value.ownerDocument,r,z)}}),Oe(function(){ce()!==null&&ce().remove(w)}),F||(Ke(function(){A||z()}),Ge(function(){var V;w&&(I||(T=w.getContent()),(V=ce())===null||V===void 0||V.remove(w))}));var R=function(V){var $;w&&(T=w.getContent(),($=ce())===null||$===void 0||$.remove(w),o=ne(ne(ne({},o),V),be),Ve(function(){return z()}))};return y.expose({rerender:R,getEditor:function(){return w}}),function(){return F?Jn(Se,M,f,n.tagName):Yn(Se,M,f)}}});function Xn(){const n=E(null),y=E(!1);return{editorRef:n,isFullscreen:y,onInit:(l,a)=>{n.value=a},toggleFullscreen:()=>{n.value&&(n.value.execCommand("mceFullScreen"),y.value=!y.value)},ensureExitFullscreen:()=>{y.value&&n.value&&(n.value.execCommand("mceFullScreen"),y.value=!1)},tinymceInit:{menubar:!1,height:320,plugins:"lists link image table code paste fullscreen",toolbar:"undo redo | blocks | bold italic underline strikethrough | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | removeformat | code | fullscreen",paste_data_images:!0,image_dimensions:!0,image_caption:!0,object_resizing:"img",branding:!1,content_style:"body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; font-size:14px}",automatic_uploads:!1,file_picker_types:"image",file_picker_callback:l=>{const a=document.createElement("input");a.type="file",a.accept="image/*",a.onchange=()=>{const f=a.files?.[0];if(!f)return;const w=new FileReader;w.onload=()=>l(w.result),w.readAsDataURL(f)},a.click()}}}}const Qn={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},Zn={class:"bg-white p-4 rounded shadow-lg w-[1024px] max-h-screen overflow-auto"},el={class:"flex items-center justify-between mb-2"},tl={class:"text-lg font-semibold"},nl={class:"flex items-center gap-2"},ll={class:"bg-white w-full max-w-[1024px] max-h-screen rounded-2xl shadow-lg flex flex-col"},ol={class:"p-5 flex-1 overflow-auto"},al={class:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"},sl=["aria-invalid"],il=["value"],rl={key:0,class:"text-red-600 text-xs mt-1"},ul=["aria-invalid"],dl=["value"],cl={key:0,class:"text-red-600 text-xs mt-1"},ml={class:"md:col-span-2"},vl=["aria-invalid"],pl={key:0,class:"text-red-600 text-xs mt-1"},fl={class:"md:col-span-2"},bl={key:0,class:"text-red-600 text-xs mt-1"},gl={class:"md:col-span-2"},xl={class:"border-t p-4 bg-white flex items-center justify-end gap-2"},Me={__name:"DocFormModal",props:{modelValue:{type:Boolean,default:!1},mode:{type:String,default:"create"},initial:{type:Object,default:()=>({id:null,type:"cbl",title:"",content:"",status:"draft",doc_date:""})}},emits:["update:modelValue","submit","closed"],setup(n,{emit:y}){const o=["draft","published","archived"],x=["cbl","resolution","minute"],d=n,D=y,l=q({get:()=>d.modelValue,set:V=>D("update:modelValue",V)}),{isFullscreen:a,onInit:f,toggleFullscreen:w,ensureExitFullscreen:M,tinymceInit:F}=Xn(),I=E({...d.initial}),A=E({});ee(()=>d.initial,V=>{I.value={...V},A.value={}},{immediate:!0});const J=q(()=>d.mode==="edit"?"Edit Document":"Add Document"),T=q(()=>d.mode==="edit"?"Save Changes":"Create"),K=()=>{const V={};return I.value.type||(V.type="Type is required"),I.value.title?.trim()||(V.title="Title is required"),I.value.content?.trim()||(V.content="Content is required"),I.value.status&&!o.includes(I.value.status)&&(V.status="Invalid status"),A.value=V,Object.keys(V).length===0},z=()=>{if(!K())return;const V={...I.value,doc_date:I.value.doc_date||null};D("submit",V)},R=()=>{M(),l.value=!1,D("closed")};return(V,$)=>l.value?(v(),p("div",Qn,[e("div",Zn,[e("div",el,[e("h2",tl,g(J.value),1),e("div",nl,[e("button",{class:"px-3 py-1 text-xs bg-indigo-600 text-white rounded",onClick:$[0]||($[0]=(...r)=>j(w)&&j(w)(...r))},g(j(a)?"Restore":"Maximize"),1),e("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:R},"Close")])]),e("div",ll,[e("div",ol,[e("div",al,[e("div",null,[$[6]||($[6]=e("label",{class:"block mb-1 font-medium text-gray-700"},[W("Type "),e("span",{class:"text-red-500"},"*")],-1)),P(e("select",{"onUpdate:modelValue":$[1]||($[1]=r=>I.value.type=r),"aria-invalid":!!A.value.type,class:re(["w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",A.value.type?"border-red-500":"border-gray-300"])},[(v(),p(H,null,Z(x,r=>e("option",{key:r,value:r},g(r),9,il)),64))],10,sl),[[ae,I.value.type]]),A.value.type?(v(),p("p",rl,g(A.value.type),1)):L("",!0)]),e("div",null,[$[7]||($[7]=e("label",{class:"block mb-1 font-medium text-gray-700"},"Status",-1)),P(e("select",{"onUpdate:modelValue":$[2]||($[2]=r=>I.value.status=r),"aria-invalid":!!A.value.status,class:re(["w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",A.value.status?"border-red-500":"border-gray-300"])},[(v(),p(H,null,Z(["draft","published","archived"],r=>e("option",{key:r,value:r},g(r),9,dl)),64))],10,ul),[[ae,I.value.status]]),A.value.status?(v(),p("p",cl,g(A.value.status),1)):L("",!0)]),e("div",ml,[$[8]||($[8]=e("label",{class:"block mb-1 font-medium text-gray-700"},[W("Title "),e("span",{class:"text-red-500"},"*")],-1)),P(e("input",{"onUpdate:modelValue":$[3]||($[3]=r=>I.value.title=r),"aria-invalid":!!A.value.title,placeholder:"Document title",class:re(["w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",A.value.title?"border-red-500":"border-gray-300"])},null,10,vl),[[Y,I.value.title]]),A.value.title?(v(),p("p",pl,g(A.value.title),1)):L("",!0)]),e("div",fl,[$[9]||($[9]=e("label",{class:"block mb-1 font-medium text-gray-700"},[W("Content "),e("span",{class:"text-red-500"},"*")],-1)),e("div",{class:re(["rounded-lg border",A.value.content?"border-red-500":"border-gray-300"])},[N(j(Hn),{modelValue:I.value.content,"onUpdate:modelValue":$[4]||($[4]=r=>I.value.content=r),init:j(F),onInit:j(f),"tinymce-script-src":"/tinymce/tinymce.min.js",licenseKey:"gpl"},null,8,["modelValue","init","onInit"])],2),A.value.content?(v(),p("p",bl,g(A.value.content),1)):L("",!0)]),e("div",gl,[$[10]||($[10]=e("label",{class:"block mb-1 font-medium text-gray-700"},"Document Date",-1)),P(e("input",{"onUpdate:modelValue":$[5]||($[5]=r=>I.value.doc_date=r),type:"date",class:"w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 border-gray-300"},null,512),[[Y,I.value.doc_date]])])])]),e("div",xl,[e("button",{type:"button",class:"px-4 py-2 rounded-lg text-xs border border-gray-300 hover:bg-gray-100 transition",onClick:R}," Cancel "),e("button",{type:"button",class:re(["px-4 py-2 rounded-lg text-xs",d.mode==="edit"?"bg-emerald-600 text-white hover:bg-emerald-700":"bg-blue-600 text-white hover:bg-blue-700"]),onClick:z},g(T.value),3)])])])])):L("",!0)}},yl={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},hl={class:"bg-white p-4 rounded shadow-lg w-[900px] max-h-screen overflow-auto"},wl={class:"flex items-center justify-between"},Cl={class:"text-lg font-semibold"},_l={class:"text-gray-600"},$l={class:"flex items-center gap-2"},kl={class:"mt-3 flex flex-col gap-2"},Sl={class:"flex items-center gap-2"},Vl=["value"],Dl=["value"],Ul={class:"text-[12px] text-gray-600"},El={class:"space-y-2 mt-4 max-h-[60vh] overflow-y-auto pr-2 -mr-2"},Al={class:"text-sm"},Bl={class:"flex flex-wrap items-center gap-2"},Il={class:"font-semibold"},Ll={class:"px-2 py-[2px] text-[11px] rounded bg-indigo-100 text-indigo-700 uppercase"},Ml={class:"text-xs text-gray-600"},Ol={class:"shrink-0 flex items-center gap-2"},jl=["onClick"],Pl=["onClick"],Rl={class:"flex justify-between items-center mt-3 text-xs text-gray-600"},fe=10,Tl={__name:"ClubDocsModal",props:{modelValue:{type:Boolean,default:!1},clubId:{type:[Number,String],required:!0},clubName:{type:String,default:""}},emits:["update:modelValue"],setup(n,{emit:y}){const o=n,x=y,d=yt(),D=q({get:()=>o.modelValue,set:C=>x("update:modelValue",C)}),l=E([]),a=E(1),f=E(""),w=E("all"),M=E("all"),F=["cbl","resolution","minute"],I=["draft","published","archived"],A=["cbl","resolution","minute"],J=C=>A.includes((C||"").toLowerCase())?(C||"").toLowerCase():"cbl",T=C=>{const S=J(C),b=F.indexOf(S);return b===-1?999:b},K=(C,S)=>{if(!S)return!0;const b=(C.title||"").toLowerCase(),t=(C.content||"").toLowerCase();return b.includes(S)||t.includes(S)},z=q(()=>{const C=f.value.trim().toLowerCase();let S=l.value||[];return w.value!=="all"&&(S=S.filter(b=>(b.type||"").toLowerCase()===w.value)),M.value!=="all"&&(S=S.filter(b=>(b.status||"").toLowerCase()===M.value)),C&&(S=S.filter(b=>K(b,C))),S.slice().sort((b,t)=>{const _=T(b.type),h=T(t.type);if(_!==h)return _-h;const G=b.doc_date||b.created_at,le=t.doc_date||t.created_at,Q=G?new Date(G).getTime():0;return(le?new Date(le).getTime():0)-Q})}),R=q(()=>{const C=z.value.length,S=Math.ceil(Math.max(C,1)/fe),b=Math.min(a.value,S||1),t=(b-1)*fe,_=z.value.slice(t,t+fe);return{total:C,totalPages:S,currentPage:b,pageSize:fe,data:_}});ee([f,w,M],()=>a.value=1);const V=async()=>{f.value="",w.value="all",M.value="all",a.value=1,await d.fetchByClub(o.clubId,{page:1,limit:200}),l.value=Array.isArray(d.docs?.data)?d.docs.data:[]},$=E(!1),r=E(!1),s=E(null),O=()=>{$.value=!0},te=async C=>{const S=await d.create({...C,club_id:o.clubId});l.value.unshift(S),$.value=!1},X=()=>{},ue=C=>{s.value={id:C.id,type:C.type||"cbl",title:C.title||"",content:C.content||"",status:C.status||"draft",doc_date:C.doc_date?String(C.doc_date).slice(0,10):""},r.value=!0},U=async C=>{const{id:S,...b}=C,t=await d.updateById(S,{...b}),_=l.value.findIndex(h=>h.id===S);_!==-1&&(l.value[_]=t),r.value=!1},c=()=>{},k=async C=>{(await oe.fire({title:`Delete document "${C.title}"?`,text:"This cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it",cancelButtonText:"Cancel"})).isConfirmed&&(await d.deleteById(C.id),l.value=l.value.filter(b=>b.id!==C.id),await oe.fire("Deleted!","The document has been deleted.","success"))};return ee(()=>o.modelValue,C=>{C&&V()},{immediate:!1}),(C,S)=>D.value?(v(),p("div",yl,[e("div",hl,[e("div",wl,[e("h2",Cl,[S[8]||(S[8]=W("Club Documents — ",-1)),e("span",_l,g(n.clubName),1)]),e("div",$l,[e("button",{class:"px-3 py-1 text-xs bg-blue-600 text-white rounded",onClick:O},"+ Add Document"),e("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:S[0]||(S[0]=b=>D.value=!1)},"Close")])]),e("div",kl,[e("div",Sl,[P(e("select",{"onUpdate:modelValue":S[1]||(S[1]=b=>w.value=b),class:"border rounded px-2 py-1 text-sm"},[S[9]||(S[9]=e("option",{value:"all"},"All types",-1)),(v(),p(H,null,Z(A,b=>e("option",{key:b,value:b},g(b),9,Vl)),64))],512),[[ae,w.value]]),P(e("select",{"onUpdate:modelValue":S[2]||(S[2]=b=>M.value=b),class:"border rounded px-2 py-1 text-sm"},[S[10]||(S[10]=e("option",{value:"all"},"All statuses",-1)),(v(),p(H,null,Z(I,b=>e("option",{key:b,value:b},g(b),9,Dl)),64))],512),[[ae,M.value]]),P(e("input",{"onUpdate:modelValue":S[3]||(S[3]=b=>f.value=b),type:"text",placeholder:"Search documents by title or content…",class:"border rounded px-2 py-1 text-sm w-full"},null,512),[[Y,f.value]])]),e("div",Ul," Showing "+g(R.value.total)+" document(s). Ordered by type → date. ",1)]),e("div",El,[(v(!0),p(H,null,Z(R.value.data,b=>(v(),p("div",{key:b.id,class:"border rounded p-3 bg-gray-50 flex items-start justify-between gap-4"},[e("div",Al,[e("div",Bl,[e("span",Il,g(b.title),1),e("span",Ll,g(b.type),1),e("span",{class:re(["px-2 py-[2px] text-[11px] rounded",{"bg-yellow-100 text-yellow-700":b.status==="draft","bg-emerald-100 text-emerald-700":b.status==="published","bg-gray-200 text-gray-700":b.status==="archived"}])},g(b.status),3),e("span",Ml,g(b.doc_date?new Date(b.doc_date).toLocaleDateString():b.created_at?new Date(b.created_at).toLocaleDateString():"—"),1)])]),e("div",Ol,[e("button",{class:"px-2 py-1 bg-amber-500 hover:bg-amber-600 text-white rounded text-xs",onClick:t=>ue(b)},"Edit",8,jl),e("button",{class:"px-2 py-1 bg-red-600 text-white rounded text-xs",onClick:t=>k(b)},"Delete",8,Pl)])]))),128))]),e("div",Rl,[a.value>1?(v(),p("button",{key:0,onClick:S[4]||(S[4]=b=>a.value=a.value-1),class:"px-3 py-1 bg-gray-300 rounded"},"Previous")):L("",!0),e("div",null,"Page "+g(R.value.currentPage)+" of "+g(R.value.totalPages||1),1),a.value<R.value.totalPages?(v(),p("button",{key:1,onClick:S[5]||(S[5]=b=>a.value=a.value+1),class:"px-3 py-1 bg-gray-300 rounded"},"Next")):L("",!0)])]),N(Me,{modelValue:$.value,"onUpdate:modelValue":S[6]||(S[6]=b=>$.value=b),mode:"create",initial:{type:"cbl",title:"",content:"",status:"draft",doc_date:""},onSubmit:te,onClosed:X},null,8,["modelValue"]),N(Me,{modelValue:r.value,"onUpdate:modelValue":S[7]||(S[7]=b=>r.value=b),mode:"edit",initial:s.value||{id:null,type:"cbl",title:"",content:"",status:"draft",doc_date:""},onSubmit:U,onClosed:c},null,8,["modelValue","initial"])])):L("",!0)}},Fl={class:"flex items-center gap-1 md:gap-2"},zl=["aria-expanded"],Nl={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24","aria-hidden":"true"},Wl=["d"],Kl={__name:"ClubRowActions",props:{row:{type:Object,required:!0}},emits:["members","docs","edit","delete","view","attachments"],setup(n,{emit:y}){const o=E(!1),x=E(null),d=E(null),D=l=>{if(!o.value)return;const a=x.value,f=d.value;a&&!a.contains(l.target)&&f&&!f.contains(l.target)&&(o.value=!1)};return ye(()=>{document.addEventListener("click",D)}),Oe(()=>{document.removeEventListener("click",D)}),(l,a)=>(v(),p("div",Fl,[N(ve,{"icon-path":j(Ye),color:"text-indigo-600",label:"Attachments",tooltip:"Attachments",size:"sm",onClick:a[0]||(a[0]=f=>l.$emit("attachments",n.row))},null,8,["icon-path"]),N(ve,{"icon-path":j(He),color:"text-gray-700",label:"View",tooltip:"View Club",size:"sm",onClick:a[1]||(a[1]=f=>l.$emit("view",n.row))},null,8,["icon-path"]),N(ve,{"icon-path":j(Xe),color:"text-blue-600",label:"Members",tooltip:"View Members",size:"sm",onClick:a[2]||(a[2]=f=>l.$emit("members",n.row))},null,8,["icon-path"]),N(ve,{"icon-path":j(Qe),color:"text-indigo-600",label:"Docs",tooltip:"View Documents",size:"sm",onClick:a[3]||(a[3]=f=>l.$emit("docs",n.row))},null,8,["icon-path"]),N(ve,{"icon-path":j(Ze),color:"text-emerald-600",label:"Edit",tooltip:"Edit Club",size:"sm",onClick:a[4]||(a[4]=f=>l.$emit("edit",n.row))},null,8,["icon-path"]),l.$attrs.moderator?(v(),xe(ve,{key:0,"icon-path":j(je),color:"text-red-600",label:"Delete",tooltip:"Delete Club",size:"sm",onClick:a[5]||(a[5]=f=>l.$emit("delete",n.row))},null,8,["icon-path"])):L("",!0),e("div",{class:"relative md:hidden",ref_key:"btnRef",ref:d},[e("button",{class:"inline-flex items-center justify-center rounded-xl p-1.5 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-1","aria-expanded":o.value,"aria-haspopup":"menu",title:"More",onClick:a[6]||(a[6]=f=>o.value=!o.value)},[(v(),p("svg",Nl,[e("path",{d:j(et)},null,8,Wl)]))],8,zl),o.value?(v(),p("div",{key:0,ref_key:"menuRef",ref:x,role:"menu",class:"absolute right-0 z-20 mt-1 w-40 overflow-hidden rounded-xl border bg-white shadow-lg"},[e("button",{role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:a[7]||(a[7]=f=>{o.value=!1,l.$emit("attachments",n.row)})}," Attachments "),e("button",{role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:a[8]||(a[8]=f=>{o.value=!1,l.$emit("view",n.row)})}," View Club "),e("button",{role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:a[9]||(a[9]=f=>{o.value=!1,l.$emit("members",n.row)})}," View Members "),e("button",{role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:a[10]||(a[10]=f=>{o.value=!1,l.$emit("docs",n.row)})}," View Documents "),e("button",{role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:a[11]||(a[11]=f=>{o.value=!1,l.$emit("edit",n.row)})}," Edit Club "),l.$attrs.moderator?(v(),p("button",{key:0,role:"menuitem",class:"w-full px-3 py-2 text-left text-sm text-red-600 hover:bg-red-50",onClick:a[12]||(a[12]=f=>{o.value=!1,l.$emit("delete",n.row)})}," Delete ")):L("",!0)],512)):L("",!0)],512)]))}},Gl={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},ql={class:"bg-white p-4 rounded-xl shadow-xl w-[980px] max-h-screen overflow-auto"},Jl={class:"flex items-center justify-between mb-3"},Yl={class:"text-lg font-semibold"},Hl={class:"text-gray-600"},Xl={class:"flex items-center justify-between gap-2"},Ql={class:"text-sm text-gray-600"},Zl={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},eo=["d"],to=["disabled"],no={class:"mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"},lo={class:"aspect-video bg-white border rounded overflow-hidden flex items-center justify-center"},oo=["src"],ao={key:1,class:"flex items-center justify-center w-full h-full"},so=["d"],io={class:"mt-2 text-xs"},ro=["title"],uo={class:"text-gray-500 flex items-center justify-between"},co={key:0},mo={key:0},vo={class:"mt-2 flex items-center justify-between gap-2"},po=["onClick","title"],fo={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},bo=["d"],go=["onClick"],xo={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},yo=["d"],ho={key:0,class:"mt-6 text-center text-sm text-gray-500"},wo=10*1024*1024,Co={__name:"ClubAttachmentsModal",props:{modelValue:{type:Boolean,default:!1},row:{type:Object,default:null}},emits:["update:modelValue"],setup(n,{emit:y}){const o=n,x=y,d=q({get:()=>o.modelValue,set:t=>x("update:modelValue",t)}),D=he(),l=E(null),a=E(!1),f=new Set(["image/png","image/jpeg","image/webp","application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]),w=new Set(["png","jpg","jpeg","webp","pdf","docx","xlsx"]),M=(t="")=>{const _=String(t).toLowerCase().match(/\.([a-z0-9]+)$/i);return _?_[1]:""},F=(t="")=>{if(typeof t!="string")return"";const _=t.match(/^data:([^;]+);base64,/i);return _?_[1]:""},I=t=>{const _=t?.type&&f.has(t.type),h=t?.name&&w.has(M(t.name));return _||h},A=(t="")=>String(t).startsWith("image/"),J=(t="")=>t==="application/pdf",T=(t="")=>t==="application/vnd.openxmlformats-officedocument.wordprocessingml.document",K=(t="")=>t==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",z=(t="")=>J(t)?ot:T(t)?at:K(t)?st:A(t)?it:rt,R=(t="")=>J(t)?"PDF":T(t)?"Word":K(t)?"Excel":A(t)?"Image":"File",V=(t="")=>J(t)?"pdf":T(t)?"docx":K(t)?"xlsx":t==="image/png"?"png":t==="image/jpeg"?"jpg":t==="image/webp"?"webp":"",$=(t="attachment",_="")=>{const h=/\.[a-z0-9]+$/i.test(t),G=_?_.startsWith(".")?_.slice(1):_:"";return h?t:G?`${t}.${G}`:t},r=t=>!t&&t!==0?"":t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`,s=q(()=>{const t=l.value?.attachments;if(!t)return[];try{return Array.isArray(t)?t:JSON.parse(t||"[]")}catch{return[]}}),O=q(()=>(s.value||[]).map((t,_)=>{const h=t.mime||F(t.data)||(t.name?M(t.name)==="pdf"&&"application/pdf":"")||"",G=M(t.name||"")||V(h),le=t.size??null,Q=t.name||`${R(h)} ${_+1}`;return{id:t.id??_+1,name:Q,data:t.data||"",url:t.url||t.href||t.path||"",mime:h,ext:G,size:le,filename:$(Q,G)}}));ee(()=>o.modelValue,async t=>{t&&o.row?.id&&(await D.fetchById(o.row.id),l.value=D.selectedClub||o.row)},{immediate:!1});const te=async t=>{const _=t.target.files?.[0];if(t.target.value="",!(!_||!l.value?.id)){if(_.size>wo){await oe.fire("File too large","Maximum size is 10 MB.","warning");return}if(!I(_)){await oe.fire("Unsupported file","Only images (PNG/JPEG/WEBP), PDF, DOCX, and XLSX are allowed.","warning");return}try{a.value=!0,await D.uploadAttachment(l.value.id,_),await D.fetchById(l.value.id),l.value=D.selectedClub}finally{a.value=!1}}},X=async t=>{!l.value?.id||!(await oe.fire({title:"Remove attachment?",icon:"warning",showCancelButton:!0,confirmButtonText:"Remove",confirmButtonColor:"#d33"})).isConfirmed||(await D.deleteAttachment(l.value.id,t),await D.fetchById(l.value.id),l.value=D.selectedClub)},ue=t=>{if(t.data&&String(t.data).startsWith("data:")&&A(t.mime)){const _=window.open();_&&_.document.write(`<img src="${t.data}" style="display:block;max-width:100%;height:auto;margin:0 auto;object-fit:contain"/>`);return}t.url&&window.open(String(t.url),"_blank")},U=t=>{const[_,h]=t.split(","),G=_.match(/data:([^;]+);base64/i)?.[1]||"application/octet-stream",le=atob(h),Q=le.length,se=new Uint8Array(Q);for(let me=0;me<Q;me++)se[me]=le.charCodeAt(me);return new Blob([se],{type:G})},c=(t,_)=>{const h=URL.createObjectURL(t),G=document.createElement("a");G.href=h,G.download=_||"download",document.body.appendChild(G),G.click(),G.remove(),setTimeout(()=>URL.revokeObjectURL(h),1e3)},k=async t=>{if(t.data&&String(t.data).startsWith("data:")){const _=U(t.data);c(_,t.filename);return}if(t.url)try{const h=await(await fetch(t.url,{credentials:"include"})).blob();c(h,t.filename)}catch{const h=document.createElement("a");h.href=String(t.url),h.setAttribute("download",t.filename),document.body.appendChild(h),h.click(),h.remove()}},C=t=>A(t.mime)?"Open":"Download",S=t=>A(t.mime)?nt:lt,b=t=>A(t.mime)?ue(t):k(t);return(t,_)=>d.value?(v(),p("div",Gl,[e("div",ql,[e("div",Jl,[e("h2",Yl,[_[1]||(_[1]=W(" Attachments — ",-1)),e("span",Hl,g(l.value?.name||""),1)]),e("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:_[0]||(_[0]=h=>d.value=!1)},"Close")]),e("div",Xl,[e("div",Ql,[_[2]||(_[2]=W(" Ref: ",-1)),e("strong",null,g(l.value?.code||"—"),1)]),e("label",{class:re(["inline-flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white rounded text-xs cursor-pointer disabled:opacity-60",{"opacity-60 pointer-events-none":a.value}])},[(v(),p("svg",Zl,[e("path",{d:j(tt)},null,8,eo)])),e("span",null,g(a.value?"Uploading…":"Upload"),1),e("input",{type:"file",class:"hidden",disabled:a.value,onChange:te,accept:".png,.jpg,.jpeg,.webp,.pdf,.docx,.xlsx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,image/png,image/jpeg,image/webp"},null,40,to)],2)]),e("div",no,[(v(!0),p(H,null,Z(O.value,h=>(v(),p("div",{key:h.id,class:"border rounded-lg p-2 bg-gray-50 flex flex-col"},[e("div",lo,[A(h.mime)&&h.data&&h.data.startsWith("data:")?(v(),p("img",{key:0,src:h.data,class:"object-contain w-full h-full",alt:"Attachment preview"},null,8,oo)):(v(),p("div",ao,[(v(),p("svg",{style:{width:"64px",height:"64px"},viewBox:"0 0 24 24","aria-hidden":"true",class:re({"text-red-600":J(h.mime),"text-blue-600":T(h.mime),"text-emerald-600":K(h.mime),"text-gray-500":!h.mime||!A(h.mime)&&!J(h.mime)})},[e("path",{d:z(h.mime)},null,8,so)],2))]))]),e("div",io,[e("div",{class:"font-medium truncate",title:h.name},g(h.name),9,ro),e("div",uo,[e("span",null,[W(g(R(h.mime))+" ",1),h.ext?(v(),p("span",co,"("+g(h.ext.toUpperCase())+")",1)):L("",!0)]),h.size?(v(),p("span",mo,g(r(h.size)),1)):L("",!0)])]),e("div",vo,[e("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-white border rounded text-xs hover:bg-gray-50",onClick:G=>b(h),title:C(h)},[(v(),p("svg",fo,[e("path",{d:S(h)},null,8,bo)])),W(" "+g(C(h)),1)],8,po),e("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-red-600 text-white rounded text-xs",onClick:G=>X(h.id),title:"Remove"},[(v(),p("svg",xo,[e("path",{d:j(je)},null,8,yo)])),_[3]||(_[3]=W(" Remove ",-1))],8,go)])]))),128))]),O.value.length?L("",!0):(v(),p("div",ho," No attachments yet. "))])])):L("",!0)}},_o={class:"flex items-center gap-2"},$o={class:"p-3 mb-4 rounded-xl border bg-white/60"},ko={class:"flex items-center gap-2 mb-2 text-gray-700"},So={class:"w-4 h-4",viewBox:"0 0 24 24"},Vo=["d"],Do={class:"grid grid-cols-1 md:grid-cols-6 gap-2 text-sm"},Uo={class:"flex items-center gap-2 md:col-span-2"},zo={__name:"ClubsOrganizationPage",setup(n){const y=qe(),o=he(),x=E({page:1,limit:10,sort:"established_at",order:"DESC",q:"",name:"",code:"",category:"",is_active:""}),d=async(U={},c=!0)=>{x.value={...x.value,...U},typeof x.value.officer>"u"&&(x.value.officer=!0);const k={...x.value};k.is_active===""?delete k.is_active:k.is_active=k.is_active===!0||k.is_active==="true",["q","name","code","category"].forEach(C=>{(k[C]===""||k[C]==null)&&delete k[C]}),await o.fetchAll(k,c)};ye(()=>d({page:1,limit:10}));const D=q(()=>({total:o.clubs.total||0,totalPages:o.clubs.totalPages||1,currentPage:o.clubs.currentPage||1,pageSize:o.clubs.pageSize||10,data:o.clubs.data||[]})),l=E(!1),a=E(null),f=async U=>{await o.fetchById(U.id),a.value=o.selectedClub||U,l.value=!0},w=E(!1),M=E(!1),F=E(null),I=()=>{w.value=!0},A=async U=>{await o.create(U),w.value=!1,await d(x.value,!0)},J=async U=>{await o.fetchById(U.id);const c=o.selectedClub||U;F.value={id:c.id,name:c.name||"",code:c.code||"",category:c.category||"",description:c.description||"",is_active:c.is_active??!0,established_at:c.established_at?String(c.established_at).slice(0,10):"",website:c.website||"",email:c.email||"",phone:c.phone||"",logo:c.logo||"",banner:c.banner||""},M.value=!0},T=async U=>{const{id:c,...k}=U;await o.updateById(c,k),M.value=!1,await d(x.value,!0)},K=async U=>{if(!U?.id)return;(await oe.fire({title:`Delete club "${U.name}"?`,text:"This cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it",cancelButtonText:"Cancel"})).isConfirmed&&(await o.deleteById(U.id),await d(x.value,!0),await oe.fire("Deleted!","The club has been deleted.","success"))},z=E(!1),R=E(!1),V=E(null),$=E(""),r=U=>{V.value=U.id,$.value=U.name||"",z.value=!0},s=U=>{V.value=U.id,$.value=U.name||"",R.value=!0},O=U=>{U?.id&&window.open(`/#/club/${U.id}`,"_self")},te=async()=>{await d({q:"",name:"",code:"",category:"",is_active:"",page:1})},X=[{key:"name",label:"Name",sortable:!0,filterable:!0},{key:"code",label:"Code",sortable:!0,filterable:!0},{key:"category",label:"Category",sortable:!0,filterable:!0},{key:"is_active",label:"Active",sortable:!0,formatter:U=>U?"Yes":"No"}],ue=async U=>{await d(U)};return(U,c)=>(v(),p(H,null,[N(ut,null,{default:de(()=>[N(dt,null,{default:de(()=>[j(o).error?(v(),xe(gt,{key:0,icon:j(ct),color:"danger"},{default:de(()=>[W(g(j(o).error),1)]),_:1},8,["icon"])):L("",!0),N(bt,{icon:j(mt),title:"Clubs",main:""},{default:de(()=>[e("div",_o,[j(y).user.role==="admin"?(v(),xe(De,{key:0,icon:j(vt),color:"primary",label:"Add Club",onClick:I},null,8,["icon"])):L("",!0),N(De,{icon:j(pt),color:"info",label:"Refresh",onClick:c[0]||(c[0]=k=>d({page:1,limit:D.value.pageSize},!0))},null,8,["icon"])])]),_:1},8,["icon"]),e("div",$o,[e("div",ko,[(v(),p("svg",So,[e("path",{d:j(ft)},null,8,Vo)])),c[13]||(c[13]=e("span",{class:"font-medium text-sm"},"Filters",-1))]),e("div",Do,[P(e("input",{"onUpdate:modelValue":c[1]||(c[1]=k=>x.value.q=k),placeholder:"Search by name, code, category…",class:"border rounded px-2 py-2 md:col-span-2",onKeyup:c[2]||(c[2]=Je(k=>d({page:1}),["enter"]))},null,544),[[Y,x.value.q]]),P(e("input",{"onUpdate:modelValue":c[3]||(c[3]=k=>x.value.name=k),placeholder:"Name contains…",class:"border rounded px-2 py-2"},null,512),[[Y,x.value.name]]),P(e("input",{"onUpdate:modelValue":c[4]||(c[4]=k=>x.value.code=k),placeholder:"Code contains…",class:"border rounded px-2 py-2"},null,512),[[Y,x.value.code]]),P(e("input",{"onUpdate:modelValue":c[5]||(c[5]=k=>x.value.category=k),placeholder:"Category contains…",class:"border rounded px-2 py-2"},null,512),[[Y,x.value.category]]),P(e("select",{"onUpdate:modelValue":c[6]||(c[6]=k=>x.value.is_active=k),class:"border rounded px-2 py-2"},c[14]||(c[14]=[e("option",{value:""},"All status",-1),e("option",{value:!0},"Active",-1),e("option",{value:!1},"Inactive",-1)]),512),[[ae,x.value.is_active]]),e("div",Uo,[e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:c[7]||(c[7]=k=>d({page:1}))}," Apply "),e("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:te}," Reset ")])])]),N(xt,{columns:X,data:D.value,loading:j(o).isLoading,onQueryChange:ue},{"cell-category":de(({value:k})=>[N(Ue,{text:k||"—",tone:"indigo"},null,8,["text"])]),"cell-is_active":de(({value:k})=>[N(Ue,{text:k?"Active":"Inactive",tone:k?"emerald":"gray"},null,8,["text","tone"])]),"cell-actions":de(({row:k})=>[N(Kl,{row:k,moderator:["admin","manager"].includes(String(j(y).user?.role||"").toLowerCase()),onView:O,onMembers:r,onDocs:s,onEdit:J,onDelete:K,onAttachments:f},null,8,["row","moderator"])]),_:1},8,["data","loading"])]),_:1})]),_:1}),N(Ee,{modelValue:w.value,"onUpdate:modelValue":c[8]||(c[8]=k=>w.value=k),mode:"create",onSubmit:A},null,8,["modelValue"]),N(Ee,{modelValue:M.value,"onUpdate:modelValue":c[9]||(c[9]=k=>M.value=k),mode:"edit",initial:F.value||{},onSubmit:T},null,8,["modelValue","initial"]),N(Mn,{modelValue:z.value,"onUpdate:modelValue":c[10]||(c[10]=k=>z.value=k),"club-id":V.value,"club-name":$.value},null,8,["modelValue","club-id","club-name"]),N(Tl,{modelValue:R.value,"onUpdate:modelValue":c[11]||(c[11]=k=>R.value=k),"club-id":V.value,"club-name":$.value},null,8,["modelValue","club-id","club-name"]),N(Co,{modelValue:l.value,"onUpdate:modelValue":c[12]||(c[12]=k=>l.value=k),row:a.value},null,8,["modelValue","row"])],64))}};export{zo as default};
