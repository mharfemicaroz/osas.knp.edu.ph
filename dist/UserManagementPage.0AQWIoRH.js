import{z as Y,u as G,r as g,o as H,c as J,a as i,f as _,d as u,l as x,e as s,t as v,h as c,k as p,v as b,F as k,C,B as U,g as m,q as o,A as X,L as Z,S as F}from"./index.RC4wj1D6.js";import{c as ee,a as se}from"./imageCompression.B77o5uYD.js";import{_ as te,N as le,O as ae,a as oe,w as ie,K as ne,L as re,M as de,v as ue,y as ve,z as ce,P as me}from"./SectionMain.CVNfP0pM.js";import{_ as pe,a as P,b as $}from"./Badge.VdR8f1b3.js";import{_ as be,B as fe}from"./NotificationBar.DYrY9lOB.js";import"./activityDesignService.9xbFeCVr.js";import"./utilizationRequestService.DFnLbwOu.js";import"./liquidationFundService.NeNS3hr9.js";import"./ToasterComponent.DDPgnzSd.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const we={class:"flex items-center gap-2"},_e={class:"p-3 mb-4 rounded-xl border bg-white/60"},xe={class:"flex items-center gap-2 mb-2 text-gray-700"},ye={class:"w-4 h-4",viewBox:"0 0 24 24"},ge=["d"],he={class:"grid grid-cols-1 md:grid-cols-6 gap-2 text-sm"},ke=["value"],Ce=["value"],Ae={class:"flex items-center gap-2 md:col-span-2"},Ue={class:"w-9 h-9 rounded-full overflow-hidden bg-gray-100 border"},Be=["src"],Ve={key:1,class:"w-full h-full flex items-center justify-center text-[10px] text-gray-400"},Ee={class:"inline-flex items-center gap-1"},Fe={class:"w-3.5 h-3.5 opacity-70",viewBox:"0 0 24 24"},Pe=["d"],$e={class:"flex items-center gap-1"},Ne=["onClick"],Se={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},qe=["d"],je=["onClick"],Te={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},De=["d"],Ie=["onClick"],Le={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},ze=["d"],Me={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},Oe={class:"bg-white p-4 md:p-5 rounded-2xl shadow-xl w-[980px] max-h-screen overflow-auto"},Re={class:"flex items-center justify-between mb-3"},We={class:"text-lg font-semibold"},Ke={class:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm"},Qe={class:"md:col-span-3"},Ye=["disabled"],Ge={key:0,class:"text-red-600 text-[11px] mt-1"},He={class:"md:col-span-3"},Je=["disabled"],Xe={key:0,class:"text-red-600 text-[11px] mt-1"},Ze={key:0,class:"md:col-span-3"},es={key:0,class:"text-red-600 text-[11px] mt-1"},ss={key:1,class:"md:col-span-3"},ts={key:0,class:"text-red-600 text-[11px] mt-1"},ls={key:2,class:"md:col-span-3"},as={key:0,class:"text-red-600 text-[11px] mt-1"},os={key:3,class:"md:col-span-3"},is={key:0,class:"text-red-600 text-[11px] mt-1"},ns=["disabled"],rs=["disabled"],ds=["disabled"],us=["value"],vs={key:0,class:"text-red-600 text-[11px] mt-1"},cs=["disabled"],ms=["disabled"],ps={class:"md:col-span-3"},bs=["disabled"],fs={key:0,class:"mt-4 p-3 rounded-xl border bg-white/70"},ws={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},_s={class:"block mb-1 inline-flex items-center gap-2"},xs={class:"w-4 h-4 opacity-80",viewBox:"0 0 24 24"},ys=["d"],gs={class:"flex items-center gap-3"},hs={class:"w-16 h-16 rounded-full overflow-hidden bg-gray-100 border"},ks=["src"],Cs={key:1,class:"w-full h-full flex items-center justify-center text-[10px] text-gray-400"},As=["disabled"],Us={class:"block mb-1 inline-flex items-center gap-2"},Bs={class:"w-4 h-4 opacity-80",viewBox:"0 0 24 24"},Vs=["d"],Es={class:"flex items-center gap-3"},Fs={class:"w-28 h-16 rounded-lg overflow-hidden bg-gray-100 border"},Ps=["src"],$s={key:1,class:"w-full h-full flex items-center justify-center text-[10px] text-gray-400"},Ns=["disabled"],Ss={class:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-3"},qs={class:"p-3 rounded-xl border bg-white/70"},js={key:0,class:"text-xs text-gray-500"},Ts={key:1,class:"text-xs text-gray-500"},Ds={key:2,class:"space-y-1 text-sm"},Is={class:"truncate"},Ls={class:"text-[11px] text-gray-500"},zs={class:"flex justify-end gap-2 mt-5"},Zs={__name:"UserManagementPage",setup(Ms){const r=Y();G();const f=g({page:1,limit:10,q:"",role:"",is_active:""}),V=["admin","manager","officer","student"],N=[{label:"All",value:""},{label:"Yes",value:"true"},{label:"No",value:"false"}],w=async(a={},e=!0)=>{f.value={...f.value,...a};const t={...f.value};["q","role","is_active"].forEach(h=>{(t[h]===""||t[h]==null)&&delete t[h]}),t.q&&(t.username=t.q,delete t.q),await r.fetchAll(t,e)};H(async()=>{await w({page:1,limit:10},!0)});const S=J(()=>({total:r.users.total||0,totalPages:r.users.totalPages||1,currentPage:r.users.currentPage||1,pageSize:r.users.pageSize||10,data:r.users.data||[]})),q=a=>a?"emerald":"zinc",j=a=>a?"indigo":"gray",T=[{key:"avatar",label:"Avatar",width:64,formatter:(a,e)=>e.avatar||null,sortable:!1},{key:"username",label:"Username",sortable:!0,minWidth:160},{key:"name",label:"Name",sortable:!1,minWidth:200,formatter:(a,e)=>`${e.first_name||""} ${e.last_name||""}`.trim()||"—"},{key:"email",label:"Email",sortable:!0,minWidth:220},{key:"role",label:"Role",sortable:!0,width:120},{key:"is_active",label:"Active",sortable:!0,width:100},{key:"twoFAEnabled",label:"2FA",sortable:!0,width:100}],D=async a=>{await w(a)},y=g(!1),n=g("create"),l=g({id:null,username:"",email:"",first_name:"",last_name:"",role:"student",is_active:!0,twoFAEnabled:!1,bio:"",avatar:null,cover:null,password:"",confirm_password:""}),d=g({}),I=()=>{n.value="create",l.value={id:null,username:"",email:"",first_name:"",last_name:"",role:"student",is_active:!0,twoFAEnabled:!1,bio:"",avatar:null,cover:null,password:"",confirm_password:""},d.value={},y.value=!0},L=async a=>{await r.fetchById(a.id);const e=r.selectedUser||a;n.value="view",l.value={id:e.id,username:e.username||"",email:e.email||"",first_name:e.first_name||"",last_name:e.last_name||"",role:e.role||"student",is_active:!!e.is_active,twoFAEnabled:!!e.twoFAEnabled,bio:e.bio||"",avatar:e.avatar||null,cover:e.cover||null,password:"",confirm_password:""},d.value={},y.value=!0,await E(e.id)},z=async a=>{await r.fetchById(a.id);const e=r.selectedUser||a;n.value="edit",l.value={id:e.id,username:e.username||"",email:e.email||"",first_name:e.first_name||"",last_name:e.last_name||"",role:e.role||"student",is_active:!!e.is_active,twoFAEnabled:!!e.twoFAEnabled,bio:e.bio||"",avatar:e.avatar||null,cover:e.cover||null},d.value={},y.value=!0,await E(e.id)},M=a=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(a||"").trim()),O=()=>{const a={};return l.value.username?.trim()||(a.username="Username is required"),M(l.value.email)||(a.email="Valid email is required"),l.value.role?.trim()||(a.role="Role is required"),n.value==="create"?(l.value.password?.trim()||(a.password="Password is required"),(l.value.password||"").length<6&&(a.password="Password must be at least 6 chars"),(l.value.confirm_password||"")!==(l.value.password||"")&&(a.confirm_password="Passwords do not match")):n.value==="edit"&&(l.value.password?.length&&l.value.password.length<6&&(a.password="At least 6 chars"),l.value.password?.length&&l.value.confirm_password!==l.value.password&&(a.confirm_password="Passwords do not match")),d.value=a,Object.keys(a).length===0},R=async()=>{if(n.value==="view"||!O())return;const a={username:l.value.username.trim(),email:l.value.email.trim(),first_name:l.value.first_name?.trim()||"",last_name:l.value.last_name?.trim()||"",role:l.value.role||"student",is_active:!!l.value.is_active,twoFAEnabled:!!l.value.twoFAEnabled,bio:l.value.bio||null};n.value==="create"?(a.password=l.value.password,await r.create(a)):(l.value.password&&(a.password=l.value.password),await r.updateById(l.value.id,a)),y.value=!1,await w({},!0)},W=async a=>{!a?.id||!(await F.fire({title:`Delete @${a.username}?`,text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Delete",cancelButtonText:"Cancel"})).isConfirmed||(await r.deleteById(a.id),await w({},!0),await F.fire("Deleted","User record removed.","success"))},K=async a=>{const e=a?.target?.files?.[0];if(!e||!l.value.id)return;const t=await ee(e);await r.uploadAvatar(l.value.id,t),await r.fetchById(l.value.id),l.value.avatar=r.selectedUser?.avatar||l.value.avatar},Q=async a=>{const e=a?.target?.files?.[0];if(!e||!l.value.id)return;const t=await se(e);await r.uploadCover(l.value.id,t),await r.fetchById(l.value.id),l.value.cover=r.selectedUser?.cover||l.value.cover},A=g([]),B=g(!1),E=async a=>{try{B.value=!0;const e=await r.fetchUserClubs(a,{force:!0});A.value=Array.isArray(e)?e:[]}catch{A.value=[]}finally{B.value=!1}};return(a,e)=>(o(),i(k,null,[_(te,null,{default:x(()=>[_(oe,null,{default:x(()=>[m(r).error?(o(),X(be,{key:0,color:"danger"},{default:x(()=>[p(v(m(r).error),1)]),_:1})):u("",!0),_(pe,{icon:m(ie),title:"Users",main:""},{default:x(()=>[s("div",we,[_(P,{icon:m(ne),color:"primary",label:"New User",onClick:I},null,8,["icon"]),_(P,{icon:m(re),color:"info",label:"Refresh",onClick:e[0]||(e[0]=t=>w({},!0))},null,8,["icon"])])]),_:1},8,["icon"]),s("div",_e,[s("div",xe,[(o(),i("svg",ye,[s("path",{d:m(de)},null,8,ge)])),e[21]||(e[21]=s("span",{class:"font-medium text-sm"},"Filters",-1))]),s("div",he,[c(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>f.value.q=t),placeholder:"Search username, name, email…",class:"border rounded px-2 py-2 md:col-span-2",onKeyup:e[2]||(e[2]=Z(t=>w({page:1}),["enter"]))},null,544),[[b,f.value.q]]),c(s("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>f.value.role=t),class:"border rounded px-2 py-2"},[e[22]||(e[22]=s("option",{value:""},"All roles",-1)),(o(),i(k,null,U(V,t=>s("option",{key:t,value:t},v(t),9,ke)),64))],512),[[C,f.value.role]]),c(s("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>f.value.is_active=t),class:"border rounded px-2 py-2"},[(o(),i(k,null,U(N,t=>s("option",{key:t.label,value:t.value},"Active: "+v(t.label),9,Ce)),64))],512),[[C,f.value.is_active]]),s("div",Ae,[s("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:e[5]||(e[5]=t=>w({page:1}))}," Apply "),s("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:e[6]||(e[6]=t=>w({q:"",role:"",is_active:"",page:1},!0))}," Reset ")])])]),_(fe,{columns:T,data:S.value,loading:m(r).isLoading,onQueryChange:D},{"cell-avatar":x(({value:t})=>[s("div",Ue,[t?(o(),i("img",{key:0,src:t,alt:"avatar",class:"w-full h-full object-cover",loading:"lazy"},null,8,Be)):(o(),i("div",Ve,"N/A "))])]),"cell-is_active":x(({value:t})=>[_($,{text:t?"Active":"Inactive",tone:q(t)},null,8,["text","tone"])]),"cell-twoFAEnabled":x(({value:t})=>[s("div",Ee,[(o(),i("svg",Fe,[s("path",{d:m(me)},null,8,Pe)])),_($,{text:t?"Enabled":"Disabled",tone:j(t)},null,8,["text","tone"])])]),"cell-actions":x(({row:t})=>[s("div",$e,[s("button",{class:"px-2 py-1 text-[12px] rounded bg-gray-100 hover:bg-gray-200 inline-flex items-center gap-1",onClick:h=>L(t),title:"View"},[(o(),i("svg",Se,[s("path",{d:m(ue)},null,8,qe)])),e[23]||(e[23]=p(" View ",-1))],8,Ne),s("button",{class:"px-2 py-1 text-[12px] rounded bg-amber-100 hover:bg-amber-200 inline-flex items-center gap-1",onClick:h=>z(t),title:"Edit"},[(o(),i("svg",Te,[s("path",{d:m(ve)},null,8,De)])),e[24]||(e[24]=p(" Edit ",-1))],8,je),s("button",{class:"px-2 py-1 text-[12px] rounded bg-rose-100 hover:bg-rose-200 inline-flex items-center gap-1",onClick:h=>W(t),title:"Delete"},[(o(),i("svg",Le,[s("path",{d:m(ce)},null,8,ze)])),e[25]||(e[25]=p(" Delete ",-1))],8,Ie)])]),_:1},8,["data","loading"])]),_:1})]),_:1}),y.value?(o(),i("div",Me,[s("div",Oe,[s("div",Re,[s("h2",We,v(n.value==="create"?"New User":n.value==="edit"?"Edit User":"View User"),1),s("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:e[7]||(e[7]=t=>y.value=!1)},"Close")]),s("div",Ke,[s("div",Qe,[e[26]||(e[26]=s("label",{class:"block mb-1"},[p("Username "),s("span",{class:"text-red-500"},"*")],-1)),c(s("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>l.value.username=t),class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},null,8,Ye),[[b,l.value.username]]),d.value.username?(o(),i("p",Ge,v(d.value.username),1)):u("",!0)]),s("div",He,[e[27]||(e[27]=s("label",{class:"block mb-1"},[p("Email "),s("span",{class:"text-red-500"},"*")],-1)),c(s("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>l.value.email=t),type:"email",class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},null,8,Je),[[b,l.value.email]]),d.value.email?(o(),i("p",Xe,v(d.value.email),1)):u("",!0)]),n.value!=="view"?(o(),i(k,{key:0},[n.value==="create"?(o(),i("div",Ze,[e[28]||(e[28]=s("label",{class:"block mb-1"},[p("Password "),s("span",{class:"text-red-500"},"*")],-1)),c(s("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>l.value.password=t),type:"password",autocomplete:"new-password",class:"w-full border rounded px-2.5 py-2"},null,512),[[b,l.value.password]]),d.value.password?(o(),i("p",es,v(d.value.password),1)):u("",!0)])):u("",!0),n.value==="create"?(o(),i("div",ss,[e[29]||(e[29]=s("label",{class:"block mb-1"},[p("Confirm Password "),s("span",{class:"text-red-500"},"*")],-1)),c(s("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>l.value.confirm_password=t),type:"password",autocomplete:"new-password",class:"w-full border rounded px-2.5 py-2"},null,512),[[b,l.value.confirm_password]]),d.value.confirm_password?(o(),i("p",ts,v(d.value.confirm_password),1)):u("",!0)])):u("",!0),n.value==="edit"?(o(),i("div",ls,[e[30]||(e[30]=s("label",{class:"block mb-1"},"New Password (optional)",-1)),c(s("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>l.value.password=t),type:"password",autocomplete:"new-password",class:"w-full border rounded px-2.5 py-2",placeholder:"Leave blank to keep current"},null,512),[[b,l.value.password]]),d.value.password?(o(),i("p",as,v(d.value.password),1)):u("",!0)])):u("",!0),n.value==="edit"&&l.value.password?(o(),i("div",os,[e[31]||(e[31]=s("label",{class:"block mb-1"},"Confirm New Password",-1)),c(s("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>l.value.confirm_password=t),type:"password",autocomplete:"new-password",class:"w-full border rounded px-2.5 py-2"},null,512),[[b,l.value.confirm_password]]),d.value.confirm_password?(o(),i("p",is,v(d.value.confirm_password),1)):u("",!0)])):u("",!0)],64)):u("",!0),s("div",null,[e[32]||(e[32]=s("label",{class:"block mb-1"},"First name",-1)),c(s("input",{"onUpdate:modelValue":e[14]||(e[14]=t=>l.value.first_name=t),class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},null,8,ns),[[b,l.value.first_name]])]),s("div",null,[e[33]||(e[33]=s("label",{class:"block mb-1"},"Last name",-1)),c(s("input",{"onUpdate:modelValue":e[15]||(e[15]=t=>l.value.last_name=t),class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},null,8,rs),[[b,l.value.last_name]])]),s("div",null,[e[34]||(e[34]=s("label",{class:"block mb-1"},[p("Role "),s("span",{class:"text-red-500"},"*")],-1)),c(s("select",{"onUpdate:modelValue":e[16]||(e[16]=t=>l.value.role=t),class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},[(o(),i(k,null,U(V,t=>s("option",{key:t,value:t},v(t),9,us)),64))],8,ds),[[C,l.value.role]]),d.value.role?(o(),i("p",vs,v(d.value.role),1)):u("",!0)]),s("div",null,[e[36]||(e[36]=s("label",{class:"block mb-1"},"Active",-1)),c(s("select",{"onUpdate:modelValue":e[17]||(e[17]=t=>l.value.is_active=t),class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},e[35]||(e[35]=[s("option",{value:!0},"Yes",-1),s("option",{value:!1},"No",-1)]),8,cs),[[C,l.value.is_active]])]),s("div",null,[e[38]||(e[38]=s("label",{class:"block mb-1"},"Two-Factor Auth",-1)),c(s("select",{"onUpdate:modelValue":e[18]||(e[18]=t=>l.value.twoFAEnabled=t),class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},e[37]||(e[37]=[s("option",{value:!0},"Enabled",-1),s("option",{value:!1},"Disabled",-1)]),8,ms),[[C,l.value.twoFAEnabled]])]),s("div",ps,[e[39]||(e[39]=s("label",{class:"block mb-1"},"Bio",-1)),c(s("textarea",{"onUpdate:modelValue":e[19]||(e[19]=t=>l.value.bio=t),rows:"2",class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},null,8,bs),[[b,l.value.bio]])])]),l.value.id?(o(),i("div",fs,[e[42]||(e[42]=s("div",{class:"flex items-center justify-between mb-2"},[s("div",{class:"text-sm font-medium"},"Media")],-1)),s("div",ws,[s("div",null,[s("label",_s,[(o(),i("svg",xs,[s("path",{d:m(le)},null,8,ys)])),e[40]||(e[40]=p(" Avatar ",-1))]),s("div",gs,[s("div",hs,[l.value.avatar?(o(),i("img",{key:0,src:l.value.avatar,class:"w-full h-full object-cover",loading:"lazy"},null,8,ks)):(o(),i("div",Cs,"N/A "))]),s("input",{type:"file",accept:"image/*",disabled:n.value==="view",onChange:K},null,40,As)])]),s("div",null,[s("label",Us,[(o(),i("svg",Bs,[s("path",{d:m(ae)},null,8,Vs)])),e[41]||(e[41]=p(" Cover ",-1))]),s("div",Es,[s("div",Fs,[l.value.cover?(o(),i("img",{key:0,src:l.value.cover,class:"w-full h-full object-cover",loading:"lazy"},null,8,Ps)):(o(),i("div",$s,"N/A "))]),s("input",{type:"file",accept:"image/*",disabled:n.value==="view",onChange:Q},null,40,Ns)])])])])):u("",!0),s("div",Ss,[s("div",qs,[e[43]||(e[43]=s("div",{class:"text-sm font-medium mb-2"},"Clubs",-1)),B.value?(o(),i("div",js,"Loading clubs…")):A.value.length?(o(),i("ul",Ds,[(o(!0),i(k,null,U(A.value,t=>(o(),i("li",{key:t.id,class:"flex items-center justify-between rounded border px-2 py-1 bg-gray-50"},[s("span",Is,v(t.name),1),s("span",Ls,v(t.code||""),1)]))),128))])):(o(),i("div",Ts,"No clubs found for this user."))])]),s("div",zs,[s("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:e[20]||(e[20]=t=>y.value=!1)},"Close"),n.value!=="view"?(o(),i("button",{key:0,class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:R},v(n.value==="edit"?"Save Changes":"Create User"),1)):u("",!0)])])])):u("",!0)],64))}};export{Zs as default};
