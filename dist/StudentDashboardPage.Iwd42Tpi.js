import{r as D,D as ft,x as G,E as xt,o as X,c as l,a as n,q as i,e,u as yt,A as wt,l as K,f as p,h as O,F as W,B as Y,t as v,C as T,g as u,k as C}from"./index.CT4VzfzW.js";import{_ as Ct,a as Mt,q as k,t as St,r as At,n as kt,i as Dt,j as Bt,s as E}from"./SectionMain.DWqlYOdS.js";import{C as Q,L as jt,P as $t,b as Lt,c as Ft,d as Ot,p as Wt,_ as N,a as I}from"./DoughnutChart.D95UeQJz.js";import{u as Yt}from"./club.BUinX3YL.js";import{u as Tt}from"./clubDoc.DAn79aJl.js";import{u as Et}from"./activityDesign.DPQ1gXXL.js";import"./activityDesignService.CAPV_BQ_.js";import"./utilizationRequestService.Dyi1-9Cc.js";import"./liquidationFundService.CtF9j3nI.js";import"./ToasterComponent.C08jrYPC.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const Nt={__name:"LineChart",props:{data:{type:Object,required:!0},loading:{type:Boolean,default:!1}},setup(U){const _=U,f=D(null),B=D(null);let b;Q.register(jt,$t,Lt,Ft,Ot,Wt);const j=ft.useLoading(),m=D(null);G(()=>_.loading,M=>{M?m.value||(m.value=j.show({container:B.value,canCancel:!1,isFullPage:!1,color:"#3b82f6",opacity:.8})):m.value&&(m.value.hide(),m.value=null)},{immediate:!0}),xt(()=>{m.value&&(m.value.hide(),m.value=null)}),X(()=>{b=new Q(f.value,{type:"line",data:_.data,options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{display:!0,title:{display:!0,text:""}},x:{display:!0,title:{display:!0,text:""}}},plugins:{legend:{display:!1}}}})});const $=l(()=>_.data);return G($,M=>{b&&(b.data=M,b.update())}),(M,P)=>(i(),n("div",{ref_key:"chartContainer",ref:B},[e("canvas",{ref_key:"root",ref:f},null,512)],512))}},It={class:"p-3 mb-5 rounded-2xl border bg-white"},Ut={class:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm"},Pt=["value"],Vt=["value"],zt=["value"],Ht={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"},Rt={class:"rounded-2xl border bg-white shadow-sm p-4"},qt={class:"flex items-center justify-between"},Jt={class:"w-5 h-5 text-blue-500",viewBox:"0 0 24 24"},Gt=["d"],Kt={class:"mt-2 text-2xl font-semibold text-gray-900"},Qt={class:"rounded-2xl border bg-white shadow-sm p-4"},Xt={class:"flex items-center justify-between"},Zt={class:"w-5 h-5 text-emerald-600",viewBox:"0 0 24 24"},te=["d"],ee={class:"mt-2 text-2xl font-semibold text-gray-900"},se={class:"rounded-2xl border bg-white shadow-sm p-4"},oe={class:"flex items-center justify-between"},ae={class:"w-5 h-5 text-indigo-600",viewBox:"0 0 24 24"},le=["d"],ie={class:"mt-2 text-2xl font-semibold text-gray-900"},ne={class:"rounded-2xl border bg-white shadow-sm p-4"},re={class:"flex items-center justify-between"},de={class:"w-5 h-5 text-amber-600",viewBox:"0 0 24 24"},ce=["d"],ue={class:"mt-2 text-2xl font-semibold text-gray-900"},me={class:"rounded-2xl border bg-white shadow-sm p-4"},ve={class:"flex items-center justify-between"},be={class:"w-5 h-5 text-blue-600",viewBox:"0 0 24 24"},_e=["d"],he={class:"mt-2 text-2xl font-semibold text-gray-900"},ge={class:"mt-1 text-xs text-gray-500"},pe={class:"rounded-2xl border bg-white shadow-sm p-4"},fe={class:"flex items-center justify-between"},xe={class:"w-5 h-5 text-indigo-600",viewBox:"0 0 24 24"},ye=["d"],we={class:"mt-2 text-2xl font-semibold text-gray-900"},Ce={class:"mt-6 grid grid-cols-1 xl:grid-cols-3 gap-6"},Me={class:"rounded-2xl border bg-white shadow-sm"},Se={class:"px-4 py-3 border-b flex items-center justify-between"},Ae={class:"text-sm font-semibold text-gray-800 flex items-center gap-2"},ke={class:"w-4 h-4 text-emerald-600",viewBox:"0 0 24 24"},De=["d"],Be={class:"p-4"},je={class:"h-72"},$e={class:"rounded-2xl border bg-white shadow-sm"},Le={class:"px-4 py-3 border-b flex items-center justify-between"},Fe={class:"text-sm font-semibold text-gray-800 flex items-center gap-2"},Oe={class:"w-4 h-4 text-blue-600",viewBox:"0 0 24 24"},We=["d"],Ye={class:"p-4"},Te={class:"h-72"},Ee={class:"rounded-2xl border bg-white shadow-sm"},Ne={class:"px-4 py-3 border-b flex items-center justify-between"},Ie={class:"text-sm font-semibold text-gray-800 flex items-center gap-2"},Ue={class:"w-4 h-4 text-blue-600",viewBox:"0 0 24 24"},Pe=["d"],Ve={class:"p-4"},ze={class:"h-72"},He={class:"rounded-2xl border bg-white shadow-sm"},Re={class:"px-4 py-3 border-b flex items-center justify-between"},qe={class:"text-sm font-semibold text-gray-800 flex items-center gap-2"},Je={class:"w-4 h-4 text-blue-600",viewBox:"0 0 24 24"},Ge=["d"],Ke={class:"p-4"},Qe={class:"h-72"},Xe={class:"rounded-2xl border bg-white shadow-sm"},Ze={class:"px-4 py-3 border-b flex items-center justify-between"},ts={class:"text-sm font-semibold text-gray-800 flex items-center gap-2"},es={class:"w-4 h-4 text-emerald-600",viewBox:"0 0 24 24"},ss=["d"],os={class:"p-4"},as={class:"h-72"},ls={class:"rounded-2xl border bg-white shadow-sm"},is={class:"px-4 py-3 border-b flex items-center justify-between"},ns={class:"text-sm font-semibold text-gray-800 flex items-center gap-2"},rs={class:"w-4 h-4 text-blue-600",viewBox:"0 0 24 24"},ds=["d"],cs={class:"p-4"},us={class:"h-72"},ms={class:"rounded-2xl border bg-white shadow-sm xl:col-span-3"},vs={class:"px-4 py-3 border-b flex items-center justify-between"},bs={class:"text-sm font-semibold text-gray-800 flex items-center gap-2"},_s={class:"w-4 h-4 text-indigo-600",viewBox:"0 0 24 24"},hs=["d"],gs={class:"p-4"},ps={class:""},js={__name:"StudentDashboardPage",setup(U){const _=Yt(),f=Tt(),B=yt(),b=Et(),j=D(!0);X(async()=>{try{await Promise.all([_.fetchAll({page:1,limit:1e3,filters:{include:"users"}},!0),f.fetchAll({page:1,limit:2e3},!0),b.fetchAll({page:1,limit:2e3},!0)])}finally{j.value=!1}});const m=l(()=>B.user?.id),$=l(()=>Array.isArray(_.clubs?.data)?_.clubs.data:[]),M=l(()=>Array.isArray(f.docs?.data)?f.docs.data:[]),P=l(()=>Array.isArray(b.items?.data)?b.items.data:[]),h=l(()=>{const o=m.value;return o?$.value.filter(t=>Array.isArray(t.users)&&t.users.some(s=>s.id===o)):[]}),V=l(()=>new Set(h.value.map(o=>o.id))),Z=l(()=>h.value.length),tt=l(()=>h.value.filter(o=>o.is_active!==!1).length),et=l(()=>h.value.reduce((o,t)=>o+(Array.isArray(t.users)?t.users.length:0),0)),st=l(()=>{const o=V.value;return M.value.filter(t=>o.has(t.club_id)).length}),ot=["1st Semester","2nd Semester","Summer"],at=l(()=>{const o=new Date().getFullYear();return Array.from({length:6},(t,s)=>`${o-s}-${o-s+1}`)}),x=D({school_year:"",semester:"",club_id:""}),lt=o=>{const t=(o??"active").toString().trim().toLowerCase();return["pending","active","inactive"].includes(t)?t:"active"},r={blue:"rgba(59,130,246,0.85)",blueSoft:"rgba(59,130,246,0.15)",indigo:"rgba(99,102,241,0.85)",indigoSoft:"rgba(99,102,241,0.15)",emerald:"rgba(16,185,129,0.85)",emeraldSoft:"rgba(16,185,129,0.15)",amber:"rgba(245,158,11,0.85)",amberSoft:"rgba(245,158,11,0.15)",rose:"rgba(244,63,94,0.85)",roseSoft:"rgba(244,63,94,0.15)",slate:"rgba(100,116,139,0.85)",slateSoft:"rgba(100,116,139,0.15)"},z=[r.blue,r.indigo,r.emerald,r.amber,r.rose,r.slate],H=[r.blueSoft,r.indigoSoft,r.emeraldSoft,r.amberSoft,r.roseSoft,r.slateSoft],S=o=>z[o%z.length],L=o=>H[o%H.length],F=o=>{if(!o)return null;const t=new Date(o);return isNaN(t)?null:t},A=new Date,R=(()=>{const o=new Date,t=o.getDay()||7;return t!==1&&o.setHours(-24*(t-1)),o.setHours(0,0,0,0),o})(),it=(()=>{const o=new Date(R);return o.setDate(o.getDate()+6),o.setHours(23,59,59,999),o})(),nt=new Date(A.getFullYear(),A.getMonth(),1),rt=new Date(A.getFullYear(),A.getMonth()+1,0,23,59,59,999),q=(o,t,s)=>{const a=F(o);return a&&a>=t&&a<=s},y=l(()=>{const o=V.value,t=x.value;return P.value.filter(s=>!(!o.has(s.club_id)||t.school_year&&s.school_year!==t.school_year||t.semester&&s.semester!==t.semester||t.club_id&&+s.club_id!=+t.club_id))}),dt=l(()=>y.value.filter(o=>q(o.date_of_implementation,R,it)).length),ct=l(()=>y.value.filter(o=>q(o.date_of_implementation,nt,rt)).length),ut=l(()=>y.value.filter(o=>{const t=F(o.date_of_implementation);if(!t)return!1;const s=(t-A)/864e5;return s>=0&&s<=30}).length),mt=l(()=>{const o={active:0,pending:0,inactive:0},t=m.value;for(const s of h.value){const a=(s.users||[]).find(d=>d.id===t),c=lt(a?.UserClub?.status);o[c]=(o[c]||0)+1}return{labels:["Active","Pending","Inactive"],datasets:[{data:[o.active,o.pending,o.inactive],backgroundColor:[r.emerald,r.amber,r.rose],borderColor:["white","white","white"],borderWidth:2}]}}),vt=l(()=>{const o={};for(const s of h.value){const a=(s.category||"Uncategorized").trim();o[a]=(o[a]||0)+1}const t=Object.keys(o).sort((s,a)=>o[a]-o[s]);return{labels:t,datasets:[{label:"My Clubs",data:t.map(s=>o[s]),backgroundColor:t.map((s,a)=>L(a)),borderColor:t.map((s,a)=>S(a)),borderWidth:1.5}]}}),bt=l(()=>{const o=h.value.map(s=>({name:s.name||s.code||`Club ${s.id}`,count:Array.isArray(s.users)?s.users.length:0})).sort((s,a)=>a.count-s.count),t=o.map(s=>s.name);return{labels:t,datasets:[{label:"Members",data:o.map(s=>s.count),backgroundColor:t.map((s,a)=>L(a)),borderColor:t.map((s,a)=>S(a)),borderWidth:1.5}]}}),_t=l(()=>{const o={draft:0,pending:0,approved:0,rejected:0,cancelled:0};for(const s of y.value)o[s.status]=(o[s.status]||0)+1;const t=Object.keys(o);return{labels:t,datasets:[{data:t.map(s=>o[s]),backgroundColor:t.map((s,a)=>S(a)),borderColor:t.map(()=>"white"),borderWidth:2}]}}),ht=l(()=>{const o={Curricular:0,"Co-Curricular":0,"Extra-Curricular":0};for(const s of y.value)o[s.nature_of_activity]=(o[s.nature_of_activity]||0)+1;const t=Object.keys(o);return{labels:t,datasets:[{data:t.map(s=>o[s]),backgroundColor:t.map((s,a)=>S(a+1)),borderColor:t.map(()=>"white"),borderWidth:2}]}}),gt=l(()=>{const o=new Map;for(const a of y.value){const c=a.club?.name||`Club #${a.club_id}`;o.set(c,(o.get(c)||0)+1)}const t=[...o.entries()].map(([a,c])=>({name:a,count:c})).sort((a,c)=>c.count-a.count),s=t.map(a=>a.name);return{labels:s,datasets:[{label:"# Activities",data:t.map(a=>a.count),backgroundColor:s.map((a,c)=>L(c)),borderColor:s.map((a,c)=>S(c)),borderWidth:1.5}]}}),pt=l(()=>{const o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t=new Date,s=[];for(let d=11;d>=0;d--){const g=new Date(t.getFullYear(),t.getMonth()-d,1);s.push({key:`${g.getFullYear()}-${g.getMonth()}`,y:g.getFullYear(),m:g.getMonth(),v:0})}const a=new Map(s.map(d=>[d.key,d]));for(const d of y.value){const g=F(d.date_filed||d.created_at);if(!g)continue;const J=`${g.getFullYear()}-${g.getMonth()}`;a.has(J)&&a.get(J).v++}return{labels:s.map(d=>`${o[d.m]} ${String(d.y).slice(-2)}`),datasets:[{label:"My clubs’ activities filed",data:s.map(d=>d.v),borderColor:r.indigo,backgroundColor:r.indigoSoft,borderWidth:2,pointRadius:3,pointHoverRadius:4,tension:.3,fill:!0}]}}),w=l(()=>j.value||_.isLoading||f.isLoading||b.isLoading);return(o,t)=>(i(),wt(Ct,null,{default:K(()=>[p(Mt,null,{default:K(()=>[t[24]||(t[24]=e("div",{class:"mb-4"},[e("h1",{class:"text-xl font-semibold text-gray-900"},"Student Dashboard"),e("p",{class:"text-sm text-gray-500"},"Your clubs and their activities—at a glance.")],-1)),e("div",It,[e("div",Ut,[O(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>x.value.school_year=s),class:"border rounded px-2 py-2"},[t[3]||(t[3]=e("option",{value:""},"All School Years",-1)),(i(!0),n(W,null,Y(at.value,s=>(i(),n("option",{key:s,value:s},v(s),9,Pt))),128))],512),[[T,x.value.school_year]]),O(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>x.value.semester=s),class:"border rounded px-2 py-2"},[t[4]||(t[4]=e("option",{value:""},"All Semesters",-1)),(i(),n(W,null,Y(ot,s=>e("option",{key:s,value:s},v(s),9,Vt)),64))],512),[[T,x.value.semester]]),O(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>x.value.club_id=s),class:"border rounded px-2 py-2"},[t[5]||(t[5]=e("option",{value:""},"All My Clubs",-1)),(i(!0),n(W,null,Y(h.value,s=>(i(),n("option",{key:s.id,value:s.id},v(s.name||"Club "+s.id),9,zt))),128))],512),[[T,x.value.club_id]])])]),e("div",Ht,[e("div",Rt,[e("div",qt,[t[6]||(t[6]=e("div",{class:"text-sm text-gray-500"},"My Clubs",-1)),(i(),n("svg",Jt,[e("path",{d:u(k)},null,8,Gt)]))]),e("div",Kt,v(Z.value),1),t[7]||(t[7]=e("div",{class:"mt-1 text-xs text-gray-500"},"You’re a member of these clubs",-1))]),e("div",Qt,[e("div",Xt,[t[8]||(t[8]=e("div",{class:"text-sm text-gray-500"},"Active Memberships",-1)),(i(),n("svg",Zt,[e("path",{d:u(St)},null,8,te)]))]),e("div",ee,v(tt.value),1),t[9]||(t[9]=e("div",{class:"mt-1 text-xs text-gray-500"},"Clubs currently active",-1))]),e("div",se,[e("div",oe,[t[10]||(t[10]=e("div",{class:"text-sm text-gray-500"},"Members in My Clubs",-1)),(i(),n("svg",ae,[e("path",{d:u(At)},null,8,le)]))]),e("div",ie,v(et.value),1),t[11]||(t[11]=e("div",{class:"mt-1 text-xs text-gray-500"},"Total membership size",-1))]),e("div",ne,[e("div",re,[t[12]||(t[12]=e("div",{class:"text-sm text-gray-500"},"Club Documents",-1)),(i(),n("svg",de,[e("path",{d:u(kt)},null,8,ce)]))]),e("div",ue,v(st.value),1),t[13]||(t[13]=e("div",{class:"mt-1 text-xs text-gray-500"},"Across your clubs",-1))]),e("div",me,[e("div",ve,[t[14]||(t[14]=e("div",{class:"text-sm text-gray-500"},"Activities This Week",-1)),(i(),n("svg",be,[e("path",{d:u(Dt)},null,8,_e)]))]),e("div",he,v(dt.value),1),e("div",ge,"This Month: "+v(ct.value),1)]),e("div",pe,[e("div",fe,[t[15]||(t[15]=e("div",{class:"text-sm text-gray-500"},"Upcoming (30 Days)",-1)),(i(),n("svg",xe,[e("path",{d:u(Bt)},null,8,ye)]))]),e("div",we,v(ut.value),1),t[16]||(t[16]=e("div",{class:"mt-1 text-xs text-gray-500"},"Implementation dates ahead",-1))])]),e("div",Ce,[e("div",Me,[e("div",Se,[e("h3",Ae,[(i(),n("svg",ke,[e("path",{d:u(E)},null,8,De)])),t[17]||(t[17]=C(" My Membership Status ",-1))])]),e("div",Be,[e("div",je,[p(N,{data:mt.value,loading:w.value},null,8,["data","loading"])])])]),e("div",$e,[e("div",Le,[e("h3",Fe,[(i(),n("svg",Oe,[e("path",{d:u(k)},null,8,We)])),t[18]||(t[18]=C(" My Clubs by Category ",-1))])]),e("div",Ye,[e("div",Te,[p(I,{data:vt.value,loading:w.value},null,8,["data","loading"])])])]),e("div",Ee,[e("div",Ne,[e("h3",Ie,[(i(),n("svg",Ue,[e("path",{d:u(k)},null,8,Pe)])),t[19]||(t[19]=C(" Members by My Club ",-1))])]),e("div",Ve,[e("div",ze,[p(I,{data:bt.value,loading:w.value,horizontal:!0},null,8,["data","loading"])])])]),e("div",He,[e("div",Re,[e("h3",qe,[(i(),n("svg",Je,[e("path",{d:u(E)},null,8,Ge)])),t[20]||(t[20]=C(" Activities by Status (My Clubs) ",-1))])]),e("div",Ke,[e("div",Qe,[p(N,{data:_t.value,loading:w.value},null,8,["data","loading"])])])]),e("div",Xe,[e("div",Ze,[e("h3",ts,[(i(),n("svg",es,[e("path",{d:u(E)},null,8,ss)])),t[21]||(t[21]=C(" Activities by Nature (My Clubs) ",-1))])]),e("div",os,[e("div",as,[p(N,{data:ht.value,loading:w.value},null,8,["data","loading"])])])]),e("div",ls,[e("div",is,[e("h3",ns,[(i(),n("svg",rs,[e("path",{d:u(k)},null,8,ds)])),t[22]||(t[22]=C(" Activities by My Club ",-1))])]),e("div",cs,[e("div",us,[p(I,{data:gt.value,loading:w.value,horizontal:!0},null,8,["data","loading"])])])]),e("div",ms,[e("div",vs,[e("h3",bs,[(i(),n("svg",_s,[e("path",{d:u(k)},null,8,hs)])),t[23]||(t[23]=C(" My Clubs’ Activity Trend (Monthly) ",-1))])]),e("div",gs,[e("div",ps,[p(Nt,{data:pt.value,loading:w.value},null,8,["data","loading"])])])])])]),_:1,__:[24]})]),_:1}))}};export{js as default};
