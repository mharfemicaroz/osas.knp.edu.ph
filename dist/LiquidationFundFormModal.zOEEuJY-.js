import{c as m,u as P,o as Q,r as L,x as G,a as r,d as y,q as _,e,t as p,k as x,h as a,C as K,g as $,j as c,F as O,B as D,v as n}from"./index.BmXZGcv4.js";import{u as W}from"./liquidationFund.CL5N7rpc.js";import{u as X}from"./activityDesign.Dwg6OXmB.js";import{u as Y}from"./clubScope.DlyCzdae.js";const Z={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},ee={class:"bg-white p-4 md:p-5 rounded-2xl shadow-xl w-[1096px] max-h-screen overflow-auto"},se={class:"flex items-center justify-between mb-3"},te={class:"flex items-center gap-3"},oe={class:"text-lg font-semibold"},le={class:"text-[11px] px-2 py-1 rounded bg-gray-100"},de={key:0,class:"mb-3 text-xs px-3 py-2 rounded-lg border bg-amber-50 border-amber-200 text-amber-800"},ae={class:"text-sm mb-3"},ne=["disabled"],ue=["value"],ie={key:0,class:"text-red-600 text-[11px] mt-1"},re={key:1,class:"text-[11px] text-gray-500 mt-1"},_e={key:2,class:"text-[11px] text-amber-700 mt-1"},me={class:"mt-2 p-3 border rounded-lg bg-white"},pe={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},ce=["disabled"],be=["disabled"],ve=["disabled"],fe=["disabled"],ye=["disabled"],xe=["disabled"],ge={class:"md:col-span-2"},he=["disabled"],we={class:"mt-3 text-sm"},ke={class:"flex flex-wrap gap-4"},Ue={class:"mt-4 text-sm"},Ve={class:"flex items-center justify-between"},Se=["disabled"],Ce={class:"mt-2 border rounded overflow-hidden"},Ae={class:"w-full text-xs"},Ne={class:"p-2"},qe=["onUpdate:modelValue","disabled"],Fe={class:"p-2"},Le=["onUpdate:modelValue","disabled"],$e={class:"p-2"},Oe=["onUpdate:modelValue","disabled"],De={class:"p-2"},Te=["onUpdate:modelValue","disabled"],je={class:"p-2"},Me=["onUpdate:modelValue","disabled"],Re={class:"p-2"},Be=["onUpdate:modelValue","disabled"],Ee={class:"p-2"},Ie=["onUpdate:modelValue","disabled"],ze={class:"p-2 text-right"},He=["disabled","onClick"],Je={class:"mt-2 text-right text-sm"},Pe={class:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},Qe={key:0},Ge=["disabled"],Ke=["disabled"],We={class:"flex justify-end gap-2 mt-5"},ss={__name:"LiquidationFundFormModal",props:{modelValue:{type:Boolean,default:!1},mode:{type:String,default:"create"},initial:{type:Object,default:()=>({id:null,reference_code:"",date_filed:"",activity_design_id:"",file_by_user_name:"",sources_of_fund:{contribution:0,payment_from_fines:0,solicitations:0,donations:0,other_sources:0,current_available_funds:0,other_sources_note:""},uses_of_fund:[],remarks:"",status:"draft"})}},emits:["update:modelValue","submit"],setup(T,{emit:j}){const f=T,S=j,k=m({get:()=>f.modelValue,set:o=>S("update:modelValue",o)}),U=P();W();const g=X(),C=m(()=>String(U.user?.role||"").toLowerCase()==="admin"),{isClub:A,activeClubId:h}=Y(),N=m(()=>{const o=Array.isArray(g.items?.data)?g.items.data.filter(s=>String(s.status).toLowerCase()==="approved"):[];if(A.value&&h.value){const s=Number(h.value);return o.filter(t=>Number(t.club_id||t.club?.id)===s)}return o});Q(async()=>{const o={page:1,limit:200,status:"approved"},s=A.value&&h.value?{...o,club_id:h.value}:o;await g.fetchAll(s,!0)});const l=L(structuredClone(f.initial)),i=L({});G(()=>f.initial,o=>{let s=o.sources_of_fund,t=o.uses_of_fund;try{typeof s=="string"&&(s=JSON.parse(s||"{}"))}catch{}try{typeof t=="string"&&(t=JSON.parse(t||"[]"))}catch{}l.value={...o,sources_of_fund:{contribution:0,payment_from_fines:0,solicitations:0,donations:0,other_sources:0,current_available_funds:0,other_sources_note:"",...s||{}},uses_of_fund:Array.isArray(t)?t:[]},i.value={}},{immediate:!0});const M=m(()=>String(l.value?.status||"").toLowerCase()),d=m(()=>f.mode==="edit"&&M.value!=="draft"),R=m(()=>f.mode!=="edit"?"New Liquidation Fund":d.value?"View Liquidation (read-only)":"Edit Liquidation"),B=m(()=>f.mode==="edit"?"Save Changes":"Create"),E=o=>{const s=o?.name_of_activity||"Untitled",t=o?.reference_code?` [${o.reference_code}]`:"",b=o?.date_of_implementation?` • ${o.date_of_implementation}`:"";return`${s}${t}${b}`},v=o=>Number.isFinite(+o)?+o:0,q=m(()=>{const o=l.value.sources_of_fund||{};return v(o.contribution)+v(o.payment_from_fines)+v(o.solicitations)+v(o.donations)+v(o.other_sources)+v(o.current_available_funds)}),V=m(()=>Array.isArray(l.value.uses_of_fund)?l.value.uses_of_fund.reduce((o,s)=>o+v(s?.amount),0):0),F=m(()=>q.value-V.value),w=o=>Number(o).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),I=()=>{Array.isArray(l.value.uses_of_fund)||(l.value.uses_of_fund=[]),l.value.uses_of_fund.push({date:"",qty:1,unit:"",particulars:"",sheet_no:"",amount:0,in_charge:""})},z=o=>{l.value.uses_of_fund.splice(o,1)},H=()=>{if(d.value)return!1;const o={};l.value.activity_design_id||(o.activity_design_id="Required");const s=l.value.sources_of_fund||{};return["contribution","payment_from_fines","solicitations","donations","other_sources","current_available_funds"].forEach(t=>{s[t]!=null&&Number(s[t])<0&&(o[`src_${t}`]="Must be ≥ 0")}),Array.isArray(l.value.uses_of_fund)&&l.value.uses_of_fund.forEach((t,b)=>{t?.qty!=null&&Number(t.qty)<=0&&(o[`use_${b}_qty`]="Qty must be > 0"),t?.amount!=null&&Number(t.amount)<0&&(o[`use_${b}_amount`]="Must be ≥ 0")}),i.value=o,Object.keys(o).length===0},J=()=>{if(d.value||!H())return;const o={...l.value};!o.filed_by_user_id&&U.user?.id&&(o.filed_by_user_id=U.user.id),C.value||delete o.file_by_user_name,S("submit",o)};return(o,s)=>k.value?(_(),r("div",Z,[e("div",ee,[e("div",se,[e("div",te,[e("h2",oe,p(R.value),1),e("span",le,p(l.value.status),1)]),e("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:s[0]||(s[0]=t=>k.value=!1)},"Close")]),d.value?(_(),r("div",de,[s[12]||(s[12]=x(" This liquidation is ",-1)),e("strong",null,p(l.value.status),1),s[13]||(s[13]=x(". Editing is disabled. ",-1))])):y("",!0),e("div",ae,[s[15]||(s[15]=e("label",{class:"block mb-1"},[x("Activity Design "),e("span",{class:"text-red-500"},"*")],-1)),a(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>l.value.activity_design_id=t),class:c(["w-full border rounded px-2.5 py-2",i.value.activity_design_id?"border-red-500":""]),disabled:d.value||$(g).isLoading},[s[14]||(s[14]=e("option",{value:""},"Select approved activity design…",-1)),(_(!0),r(O,null,D(N.value,t=>(_(),r("option",{key:t.id,value:t.id},p(E(t)),9,ue))),128))],10,ne),[[K,l.value.activity_design_id]]),i.value.activity_design_id?(_(),r("p",ie,p(i.value.activity_design_id),1)):y("",!0),$(g).isLoading?(_(),r("p",re,"Loading approved activities…")):N.value.length?y("",!0):(_(),r("p",_e,"No approved activity designs found."))]),e("div",me,[s[27]||(s[27]=e("div",{class:"text-sm font-medium mb-2"},"Sources of Fund",-1)),e("div",pe,[e("div",null,[s[16]||(s[16]=e("label",{class:"block mb-1"},"Contribution",-1)),a(e("input",{type:"number",step:"0.01",min:"0",class:c(["w-full border rounded px-2.5 py-2",i.value.src_contribution?"border-red-500":""]),"onUpdate:modelValue":s[2]||(s[2]=t=>l.value.sources_of_fund.contribution=t),disabled:d.value},null,10,ce),[[n,l.value.sources_of_fund.contribution,void 0,{number:!0}]])]),e("div",null,[s[17]||(s[17]=e("label",{class:"block mb-1"},"Payment from Fines",-1)),a(e("input",{type:"number",step:"0.01",min:"0",class:c(["w-full border rounded px-2.5 py-2",i.value.src_payment_from_fines?"border-red-500":""]),"onUpdate:modelValue":s[3]||(s[3]=t=>l.value.sources_of_fund.payment_from_fines=t),disabled:d.value},null,10,be),[[n,l.value.sources_of_fund.payment_from_fines,void 0,{number:!0}]])]),e("div",null,[s[18]||(s[18]=e("label",{class:"block mb-1"},"Solicitations",-1)),a(e("input",{type:"number",step:"0.01",min:"0",class:c(["w-full border rounded px-2.5 py-2",i.value.src_solicitations?"border-red-500":""]),"onUpdate:modelValue":s[4]||(s[4]=t=>l.value.sources_of_fund.solicitations=t),disabled:d.value},null,10,ve),[[n,l.value.sources_of_fund.solicitations,void 0,{number:!0}]])]),e("div",null,[s[19]||(s[19]=e("label",{class:"block mb-1"},"Donations",-1)),a(e("input",{type:"number",step:"0.01",min:"0",class:c(["w-full border rounded px-2.5 py-2",i.value.src_donations?"border-red-500":""]),"onUpdate:modelValue":s[5]||(s[5]=t=>l.value.sources_of_fund.donations=t),disabled:d.value},null,10,fe),[[n,l.value.sources_of_fund.donations,void 0,{number:!0}]])]),e("div",null,[s[20]||(s[20]=e("label",{class:"block mb-1"},"Other Sources",-1)),a(e("input",{type:"number",step:"0.01",min:"0",class:c(["w-full border rounded px-2.5 py-2",i.value.src_other_sources?"border-red-500":""]),"onUpdate:modelValue":s[6]||(s[6]=t=>l.value.sources_of_fund.other_sources=t),disabled:d.value},null,10,ye),[[n,l.value.sources_of_fund.other_sources,void 0,{number:!0}]])]),e("div",null,[s[21]||(s[21]=e("label",{class:"block mb-1"},"Current Available Funds",-1)),a(e("input",{type:"number",step:"0.01",min:"0",class:c(["w-full border rounded px-2.5 py-2",i.value.src_current_available_funds?"border-red-500":""]),"onUpdate:modelValue":s[7]||(s[7]=t=>l.value.sources_of_fund.current_available_funds=t),disabled:d.value},null,10,xe),[[n,l.value.sources_of_fund.current_available_funds,void 0,{number:!0}]])]),e("div",ge,[s[22]||(s[22]=e("label",{class:"block mb-1"},"Other Sources Note (optional)",-1)),a(e("textarea",{rows:"2",class:"w-full border rounded px-2.5 py-2","onUpdate:modelValue":s[8]||(s[8]=t=>l.value.sources_of_fund.other_sources_note=t),disabled:d.value},null,8,he),[[n,l.value.sources_of_fund.other_sources_note]])])]),e("div",we,[e("div",ke,[e("div",null,[s[23]||(s[23]=x("Total Sources: ",-1)),e("strong",null,p(w(q.value)),1)]),e("div",null,[s[24]||(s[24]=x("Total Uses: ",-1)),e("strong",null,p(w(V.value)),1)]),e("div",null,[s[25]||(s[25]=x("Cash on Hand: ",-1)),e("strong",{class:c(F.value<0?"text-red-600":"text-emerald-700")},p(w(F.value)),3)])]),s[26]||(s[26]=e("p",{class:"text-[11px] text-gray-500 mt-1"},"Server recalculates totals on save.",-1))])]),e("div",Ue,[e("div",Ve,[s[28]||(s[28]=e("label",{class:"block mb-1 font-medium"},"Use of Fund",-1)),e("button",{class:"px-3 py-1 bg-gray-200 rounded text-xs",disabled:d.value,onClick:I},"Add Row",8,Se)]),e("div",Ce,[e("table",Ae,[s[29]||(s[29]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"text-left p-2"},"Date"),e("th",{class:"text-left p-2"},"Qty"),e("th",{class:"text-left p-2"},"Unit"),e("th",{class:"text-left p-2"},"Particulars"),e("th",{class:"text-left p-2"},"Sheet No."),e("th",{class:"text-left p-2"},"Amount"),e("th",{class:"text-left p-2"},"In-Charge"),e("th",{class:"p-2 w-16"})])],-1)),e("tbody",null,[(_(!0),r(O,null,D(l.value.uses_of_fund,(t,b)=>(_(),r("tr",{key:b,class:"border-t"},[e("td",Ne,[a(e("input",{type:"date","onUpdate:modelValue":u=>t.date=u,class:"border rounded px-2 py-1",disabled:d.value},null,8,qe),[[n,t.date]])]),e("td",Fe,[a(e("input",{type:"number",min:"1","onUpdate:modelValue":u=>t.qty=u,class:c(["w-20 border rounded px-2 py-1",i.value[`use_${b}_qty`]?"border-red-500":""]),disabled:d.value},null,10,Le),[[n,t.qty,void 0,{number:!0}]])]),e("td",$e,[a(e("input",{"onUpdate:modelValue":u=>t.unit=u,class:"w-20 border rounded px-2 py-1",disabled:d.value},null,8,Oe),[[n,t.unit]])]),e("td",De,[a(e("input",{"onUpdate:modelValue":u=>t.particulars=u,class:"w-52 border rounded px-2 py-1",disabled:d.value},null,8,Te),[[n,t.particulars]])]),e("td",je,[a(e("input",{"onUpdate:modelValue":u=>t.sheet_no=u,class:"w-24 border rounded px-2 py-1",disabled:d.value},null,8,Me),[[n,t.sheet_no]])]),e("td",Re,[a(e("input",{type:"number",step:"0.01",min:"0","onUpdate:modelValue":u=>t.amount=u,class:c(["w-28 border rounded px-2 py-1",i.value[`use_${b}_amount`]?"border-red-500":""]),disabled:d.value},null,10,Be),[[n,t.amount,void 0,{number:!0}]])]),e("td",Ee,[a(e("input",{"onUpdate:modelValue":u=>t.in_charge=u,class:"w-32 border rounded px-2 py-1",disabled:d.value},null,8,Ie),[[n,t.in_charge]])]),e("td",ze,[e("button",{class:"px-2 py-1 bg-red-50 text-red-700 rounded",disabled:d.value,onClick:u=>z(b)},"Remove",8,He)])]))),128))])])]),e("div",Je,[s[30]||(s[30]=e("span",{class:"mr-4"},"Total Uses:",-1)),e("strong",null,p(w(V.value)),1)])]),e("div",Pe,[C.value?(_(),r("div",Qe,[s[31]||(s[31]=e("label",{class:"block mb-1"},"Filer Name Override (optional)",-1)),a(e("input",{"onUpdate:modelValue":s[9]||(s[9]=t=>l.value.file_by_user_name=t),class:"w-full border rounded px-2.5 py-2",disabled:d.value,placeholder:"If provided, this name appears as the filer"},null,8,Ge),[[n,l.value.file_by_user_name]])])):y("",!0),e("div",null,[s[32]||(s[32]=e("label",{class:"block mb-1"},"Remarks",-1)),a(e("textarea",{"onUpdate:modelValue":s[10]||(s[10]=t=>l.value.remarks=t),rows:"3",class:"w-full border rounded px-2.5 py-2",disabled:d.value},null,8,Ke),[[n,l.value.remarks]])])]),e("div",We,[e("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:s[11]||(s[11]=t=>k.value=!1)},"Close"),d.value?y("",!0):(_(),r("button",{key:0,class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:J},p(B.value),1))])])])):y("",!0)}};export{ss as _};
