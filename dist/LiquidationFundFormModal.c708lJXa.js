import{c,u as se,o as le,r as A,x as $,G as oe,a as _,d as x,q as b,e as t,t as p,k as v,h as n,C as de,g as j,j as m,F as I,B as E,v as u}from"./index.bm0HPCz8.js";import{u as ae}from"./liquidationFund.CXPjLdsW.js";import{u as ne}from"./activityDesign.CGBY-xgt.js";import{u as ue}from"./clubScope.BJla7Oy8.js";import{u as ie}from"./club.B90eGyu3.js";const re={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},ce={class:"bg-white p-4 md:p-5 rounded-2xl shadow-xl w-[1096px] max-h-screen overflow-auto"},_e={class:"flex items-center justify-between mb-3"},be={class:"flex items-center gap-3"},pe={class:"text-lg font-semibold"},me={class:"text-[11px] px-2 py-1 rounded bg-gray-100"},ve={key:0,class:"mb-3 text-xs px-3 py-2 rounded-lg border bg-amber-50 border-amber-200 text-amber-800"},fe={class:"text-sm mb-3"},ye=["disabled"],xe=["value"],ge={key:0,class:"text-red-600 text-[11px] mt-1"},he={key:1,class:"text-[11px] text-gray-500 mt-1"},we={key:2,class:"text-[11px] text-amber-700 mt-1"},ke={class:"mt-2 p-3 border rounded-lg bg-white"},Ue={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},Ve=["disabled"],Se=["disabled"],Ae=["disabled"],Ce=["disabled"],Ne=["disabled"],qe=["disabled"],Le={class:"md:col-span-2"},Fe=["disabled"],$e={class:"mt-3 text-sm"},De={class:"flex flex-wrap gap-4"},Oe={class:"mt-4 text-sm"},Be={class:"flex items-center justify-between"},Me=["disabled"],Re={class:"mt-2 border rounded overflow-hidden"},Te={class:"w-full text-xs"},je={class:"p-2"},Ie=["onUpdate:modelValue","disabled"],Ee={class:"p-2"},Pe=["onUpdate:modelValue","disabled"],Ye={class:"p-2"},ze=["onUpdate:modelValue","disabled"],He={class:"p-2"},Je=["onUpdate:modelValue","disabled"],Qe={class:"p-2"},Ge=["onUpdate:modelValue","disabled"],Ke={class:"p-2"},We=["onUpdate:modelValue","disabled"],Xe={class:"p-2"},Ze=["onUpdate:modelValue","disabled"],et={class:"p-2 text-right"},tt=["disabled","onClick"],st={class:"mt-2 text-right text-sm"},lt={class:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-3 text-sm"},ot={class:"md:col-span-1"},dt=["disabled"],at={key:0,class:"text-red-600 text-[11px] mt-1"},nt={key:0,class:"md:col-span-1"},ut=["disabled"],it={class:"md:col-span-1 md:col-span-2"},rt=["disabled"],ct={class:"flex justify-end gap-2 mt-5"},_t={key:0,class:"px-4 py-2 bg-blue-600 text-white rounded text-xs"},yt={__name:"LiquidationFundFormModal",props:{modelValue:{type:Boolean,default:!1},mode:{type:String,default:"create"},initial:{type:Object,default:()=>({id:null,reference_code:"",date_filed:"",activity_design_id:"",file_by_user_name:"",noted_by:"",sources_of_fund:{contribution:0,payment_from_fines:0,solicitations:0,donations:0,other_sources:0,current_available_funds:0,other_sources_note:""},uses_of_fund:[],remarks:"",status:"draft"})}},emits:["update:modelValue","submit"],setup(P,{emit:Y}){const g=P,D=Y,C=c({get:()=>g.modelValue,set:s=>D("update:modelValue",s)}),N=se();ae();const w=ne(),h=ie(),O=c(()=>String(N.user?.role||"").toLowerCase()==="admin"),{isClub:B,activeClubId:f}=ue(),q=c(()=>{const s=Array.isArray(w.items?.data)?w.items.data.filter(e=>String(e.status).toLowerCase()==="approved"):[];if(B.value&&f.value){const e=Number(f.value);return s.filter(a=>Number(a.club_id||a.club?.id)===e)}return s});le(async()=>{const s={page:1,limit:200,status:"approved"},e=B.value&&f.value?{...s,club_id:f.value}:s;await w.fetchAll(e,!0),(!Array.isArray(h.clubs?.data)||!h.clubs.data.length)&&await h.fetchAll({page:1,limit:200},!0)});const o=A(structuredClone(g.initial)),i=A({}),U=A(!0),k=A("");$(()=>g.initial,s=>{let e=s.sources_of_fund,a=s.uses_of_fund;try{typeof e=="string"&&(e=JSON.parse(e||"{}"))}catch{}try{typeof a=="string"&&(a=JSON.parse(a||"[]"))}catch{}o.value={...s,sources_of_fund:{contribution:0,payment_from_fines:0,solicitations:0,donations:0,other_sources:0,current_available_funds:0,other_sources_note:"",...e||{}},uses_of_fund:Array.isArray(a)?a:[]},i.value={},U.value=!(s&&String(s.noted_by||"").trim()),k.value=""},{immediate:!0});const z=c(()=>String(o.value?.status||"").toLowerCase()),d=c(()=>g.mode==="edit"&&z.value!=="draft"),H=c(()=>g.mode!=="edit"?"New Liquidation Fund":d.value?"View Liquidation (read-only)":"Edit Liquidation"),J=c(()=>g.mode==="edit"?"Save Changes":"Create"),Q=s=>{const e=s?.name_of_activity||"Untitled",a=s?.reference_code?` [${s.reference_code}]`:"",l=s?.date_of_implementation?` • ${s.date_of_implementation}`:"";return`${e}${a}${l}`},G=c(()=>{const s=Number(o.value.activity_design_id||0);return q.value.find(e=>Number(e.id)===s)||null}),M=c(()=>{const s=G.value;return Number(s?.club_id||s?.club?.id||0)||null}),L=s=>{const e=Number(s);return(h.clubs?.data||[]).find(l=>Number(l.id)===e)?.adviser||""},K=c(()=>{const s=M.value||f.value||null;return s?(L(s)||"").trim():""}),W=c(()=>K.value.length>0);$(()=>[o.value.activity_design_id,h.clubs?.data?.length],()=>{const s=L(M.value)||"";(U.value||o.value.noted_by===k.value)&&(o.value.noted_by=s,k.value=s)},{immediate:!0}),$(()=>[f.value,h.clubs?.data?.length],()=>{const s=L(f.value)||"";(U.value||o.value.noted_by===k.value)&&(o.value.noted_by=s,k.value=s)},{immediate:!0});const y=s=>Number.isFinite(+s)?+s:0,R=c(()=>{const s=o.value.sources_of_fund||{};return y(s.contribution)+y(s.payment_from_fines)+y(s.solicitations)+y(s.donations)+y(s.other_sources)+y(s.current_available_funds)}),F=c(()=>Array.isArray(o.value.uses_of_fund)?o.value.uses_of_fund.reduce((s,e)=>s+y(e?.amount),0):0),T=c(()=>R.value-F.value),V=s=>Number(s).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),X=()=>{Array.isArray(o.value.uses_of_fund)||(o.value.uses_of_fund=[]),o.value.uses_of_fund.push({date:"",qty:1,unit:"",particulars:"",sheet_no:"",amount:0,in_charge:""})},Z=s=>{o.value.uses_of_fund.splice(s,1)},ee=()=>{if(d.value)return!1;const s={};o.value.activity_design_id||(s.activity_design_id="Required"),o.value.noted_by?.trim()||(s.noted_by="Required");const e=o.value.sources_of_fund||{};return["contribution","payment_from_fines","solicitations","donations","other_sources","current_available_funds"].forEach(a=>{e[a]!=null&&Number(e[a])<0&&(s[`src_${a}`]="Must be ≥ 0")}),Array.isArray(o.value.uses_of_fund)&&o.value.uses_of_fund.forEach((a,l)=>{a?.qty!=null&&Number(a.qty)<=0&&(s[`use_${l}_qty`]="Qty must be > 0"),a?.amount!=null&&Number(a.amount)<0&&(s[`use_${l}_amount`]="Must be ≥ 0")}),i.value=s,Object.keys(s).length===0},te=()=>{if(d.value||!ee())return;const s={...o.value};!s.filed_by_user_id&&N.user?.id&&(s.filed_by_user_id=N.user.id),O.value||delete s.file_by_user_name,D("submit",s)};return(s,e)=>{const a=oe("pending-click");return C.value?(b(),_("div",re,[t("div",ce,[t("div",_e,[t("div",be,[t("h2",pe,p(H.value),1),t("span",me,p(o.value.status),1)]),t("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:e[0]||(e[0]=l=>C.value=!1)},"Close")]),d.value?(b(),_("div",ve,[e[14]||(e[14]=v(" This liquidation is ",-1)),t("strong",null,p(o.value.status),1),e[15]||(e[15]=v(". Editing is disabled. ",-1))])):x("",!0),t("div",fe,[e[17]||(e[17]=t("label",{class:"block mb-1"},[v("Activity Design "),t("span",{class:"text-red-500"},"*")],-1)),n(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>o.value.activity_design_id=l),class:m(["w-full border rounded px-2.5 py-2",i.value.activity_design_id?"border-red-500":""]),disabled:d.value||j(w).isLoading},[e[16]||(e[16]=t("option",{value:""},"Select approved activity design…",-1)),(b(!0),_(I,null,E(q.value,l=>(b(),_("option",{key:l.id,value:l.id},p(Q(l)),9,xe))),128))],10,ye),[[de,o.value.activity_design_id]]),i.value.activity_design_id?(b(),_("p",ge,p(i.value.activity_design_id),1)):x("",!0),j(w).isLoading?(b(),_("p",he,"Loading approved activities…")):q.value.length?x("",!0):(b(),_("p",we,"No approved activity designs found."))]),t("div",ke,[e[29]||(e[29]=t("div",{class:"text-sm font-medium mb-2"},"Sources of Fund",-1)),t("div",Ue,[t("div",null,[e[18]||(e[18]=t("label",{class:"block mb-1"},"Contribution",-1)),n(t("input",{type:"number",step:"0.01",min:"0",class:m(["w-full border rounded px-2.5 py-2",i.value.src_contribution?"border-red-500":""]),placeholder:"0.00","onUpdate:modelValue":e[2]||(e[2]=l=>o.value.sources_of_fund.contribution=l),disabled:d.value},null,10,Ve),[[u,o.value.sources_of_fund.contribution,void 0,{number:!0}]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block mb-1"},"Payment from Fines",-1)),n(t("input",{type:"number",step:"0.01",min:"0",class:m(["w-full border rounded px-2.5 py-2",i.value.src_payment_from_fines?"border-red-500":""]),placeholder:"0.00","onUpdate:modelValue":e[3]||(e[3]=l=>o.value.sources_of_fund.payment_from_fines=l),disabled:d.value},null,10,Se),[[u,o.value.sources_of_fund.payment_from_fines,void 0,{number:!0}]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block mb-1"},"Solicitations",-1)),n(t("input",{type:"number",step:"0.01",min:"0",class:m(["w-full border rounded px-2.5 py-2",i.value.src_solicitations?"border-red-500":""]),placeholder:"0.00","onUpdate:modelValue":e[4]||(e[4]=l=>o.value.sources_of_fund.solicitations=l),disabled:d.value},null,10,Ae),[[u,o.value.sources_of_fund.solicitations,void 0,{number:!0}]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block mb-1"},"Donations",-1)),n(t("input",{type:"number",step:"0.01",min:"0",class:m(["w-full border rounded px-2.5 py-2",i.value.src_donations?"border-red-500":""]),placeholder:"0.00","onUpdate:modelValue":e[5]||(e[5]=l=>o.value.sources_of_fund.donations=l),disabled:d.value},null,10,Ce),[[u,o.value.sources_of_fund.donations,void 0,{number:!0}]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block mb-1"},"Other Sources",-1)),n(t("input",{type:"number",step:"0.01",min:"0",class:m(["w-full border rounded px-2.5 py-2",i.value.src_other_sources?"border-red-500":""]),placeholder:"0.00","onUpdate:modelValue":e[6]||(e[6]=l=>o.value.sources_of_fund.other_sources=l),disabled:d.value},null,10,Ne),[[u,o.value.sources_of_fund.other_sources,void 0,{number:!0}]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block mb-1"},"Current Available Funds",-1)),n(t("input",{type:"number",step:"0.01",min:"0",class:m(["w-full border rounded px-2.5 py-2",i.value.src_current_available_funds?"border-red-500":""]),placeholder:"0.00","onUpdate:modelValue":e[7]||(e[7]=l=>o.value.sources_of_fund.current_available_funds=l),disabled:d.value},null,10,qe),[[u,o.value.sources_of_fund.current_available_funds,void 0,{number:!0}]])]),t("div",Le,[e[24]||(e[24]=t("label",{class:"block mb-1"},"Other Sources Note (optional)",-1)),n(t("textarea",{rows:"2",class:"w-full border rounded px-2.5 py-2","onUpdate:modelValue":e[8]||(e[8]=l=>o.value.sources_of_fund.other_sources_note=l),disabled:d.value,placeholder:"Describe other sources (optional)"},null,8,Fe),[[u,o.value.sources_of_fund.other_sources_note]])])]),t("div",$e,[t("div",De,[t("div",null,[e[25]||(e[25]=v("Total Sources: ",-1)),t("strong",null,p(V(R.value)),1)]),t("div",null,[e[26]||(e[26]=v("Total Uses: ",-1)),t("strong",null,p(V(F.value)),1)]),t("div",null,[e[27]||(e[27]=v("Cash on Hand: ",-1)),t("strong",{class:m(T.value<0?"text-red-600":"text-emerald-700")},p(V(T.value)),3)])]),e[28]||(e[28]=t("p",{class:"text-[11px] text-gray-500 mt-1"},"Server recalculates totals on save.",-1))])]),t("div",Oe,[t("div",Be,[e[30]||(e[30]=t("label",{class:"block mb-1 font-medium"},"Use of Fund",-1)),t("button",{class:"px-3 py-1 bg-gray-200 rounded text-xs",disabled:d.value,onClick:X},"Add Row",8,Me)]),t("div",Re,[t("table",Te,[e[31]||(e[31]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"text-left p-2"},"Date"),t("th",{class:"text-left p-2"},"Qty"),t("th",{class:"text-left p-2"},"Unit"),t("th",{class:"text-left p-2"},"Particulars"),t("th",{class:"text-left p-2"},"Sheet No."),t("th",{class:"text-left p-2"},"Amount"),t("th",{class:"text-left p-2"},"In-Charge"),t("th",{class:"p-2 w-16"})])],-1)),t("tbody",null,[(b(!0),_(I,null,E(o.value.uses_of_fund,(l,S)=>(b(),_("tr",{key:S,class:"border-t"},[t("td",je,[n(t("input",{type:"date","onUpdate:modelValue":r=>l.date=r,class:"border rounded px-2 py-1",disabled:d.value,placeholder:"YYYY-MM-DD"},null,8,Ie),[[u,l.date]])]),t("td",Ee,[n(t("input",{type:"number",min:"1","onUpdate:modelValue":r=>l.qty=r,class:m(["w-20 border rounded px-2 py-1",i.value[`use_${S}_qty`]?"border-red-500":""]),disabled:d.value,placeholder:"1"},null,10,Pe),[[u,l.qty,void 0,{number:!0}]])]),t("td",Ye,[n(t("input",{"onUpdate:modelValue":r=>l.unit=r,class:"w-20 border rounded px-2 py-1",disabled:d.value,placeholder:"e.g., pcs"},null,8,ze),[[u,l.unit]])]),t("td",He,[n(t("input",{"onUpdate:modelValue":r=>l.particulars=r,class:"w-52 border rounded px-2 py-1",disabled:d.value,placeholder:"Item/service details"},null,8,Je),[[u,l.particulars]])]),t("td",Qe,[n(t("input",{"onUpdate:modelValue":r=>l.sheet_no=r,class:"w-24 border rounded px-2 py-1",disabled:d.value,placeholder:"Ref / Sheet No."},null,8,Ge),[[u,l.sheet_no]])]),t("td",Ke,[n(t("input",{type:"number",step:"0.01",min:"0","onUpdate:modelValue":r=>l.amount=r,class:m(["w-28 border rounded px-2 py-1",i.value[`use_${S}_amount`]?"border-red-500":""]),disabled:d.value,placeholder:"0.00"},null,10,We),[[u,l.amount,void 0,{number:!0}]])]),t("td",Xe,[n(t("input",{"onUpdate:modelValue":r=>l.in_charge=r,class:"w-32 border rounded px-2 py-1",disabled:d.value,placeholder:"Person responsible"},null,8,Ze),[[u,l.in_charge]])]),t("td",et,[t("button",{class:"px-2 py-1 bg-red-50 text-red-700 rounded",disabled:d.value,onClick:r=>Z(S)},"Remove",8,tt)])]))),128))])])]),t("div",st,[e[32]||(e[32]=t("span",{class:"mr-4"},"Total Uses:",-1)),t("strong",null,p(V(F.value)),1)])]),t("div",lt,[t("div",ot,[e[33]||(e[33]=t("label",{class:"block mb-1"},[v("Adviser (Noted by) "),t("span",{class:"text-red-500"},"*")],-1)),n(t("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.noted_by=l),class:m(["w-full border rounded px-2.5 py-2",i.value.noted_by?"border-red-500":""]),disabled:d.value||W.value,placeholder:"Adviser name (noted by)",onInput:e[10]||(e[10]=l=>U.value=!1)},null,42,dt),[[u,o.value.noted_by]]),i.value.noted_by?(b(),_("p",at,p(i.value.noted_by),1)):x("",!0)]),O.value?(b(),_("div",nt,[e[34]||(e[34]=t("label",{class:"block mb-1"},"Filer Name Override (optional)",-1)),n(t("input",{"onUpdate:modelValue":e[11]||(e[11]=l=>o.value.file_by_user_name=l),class:"w-full border rounded px-2.5 py-2",disabled:d.value,placeholder:"If provided, this name appears as the filer"},null,8,ut),[[u,o.value.file_by_user_name]])])):x("",!0),t("div",it,[e[35]||(e[35]=t("label",{class:"block mb-1"},"Remarks",-1)),n(t("textarea",{"onUpdate:modelValue":e[12]||(e[12]=l=>o.value.remarks=l),rows:"3",class:"w-full border rounded px-2.5 py-2",disabled:d.value,placeholder:"Optional remarks"},null,8,rt),[[u,o.value.remarks]])])]),t("div",ct,[t("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:e[13]||(e[13]=l=>C.value=!1)},"Close"),d.value?x("",!0):n((b(),_("button",_t,[v(p(J.value),1)])),[[a,te]])])])])):x("",!0)}}};export{yt as _};
