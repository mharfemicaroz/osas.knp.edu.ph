import{z as H,u as J,r as h,o as X,c as Z,a as i,f as _,d as u,l as x,e as s,t as c,h as v,k as p,v as b,F as k,C,B as U,g as m,p as ee,q as o,A as se,L as te,S as F}from"./index.BnmwlPkf.js";import{c as le,a as ae}from"./imageCompression.B77o5uYD.js";import{_ as oe,N as ie,O as ne,a as re,w as de,K as ue,L as ce,M as ve,v as me,y as pe,z as be,P as fe}from"./SectionMain.D81BgA1-.js";import{_ as we,a as P,b as $}from"./Badge.D2FYupAy.js";import{_ as _e,B as xe}from"./NotificationBar.Vpr6S-0f.js";import"./activityDesignService.BMqdURYS.js";import"./utilizationRequestService.B94mKcQ2.js";import"./liquidationFundService.CgDeB2MV.js";import"./ToasterComponent.DnGRu12L.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const ye={class:"flex items-center gap-2"},ge={class:"p-3 mb-4 rounded-xl border bg-white/60"},he={class:"flex items-center gap-2 mb-2 text-gray-700"},ke={class:"w-4 h-4",viewBox:"0 0 24 24"},Ce=["d"],Ae={class:"grid grid-cols-1 md:grid-cols-6 gap-2 text-sm"},Ue=["value"],Be=["value"],Ve={class:"flex items-center gap-2 md:col-span-2"},Ee={class:"w-9 h-9 rounded-full overflow-hidden bg-gray-100 border"},Fe=["src"],Pe={key:1,class:"w-full h-full flex items-center justify-center text-[10px] text-gray-400"},$e={class:"inline-flex items-center gap-1"},Ne={class:"w-3.5 h-3.5 opacity-70",viewBox:"0 0 24 24"},Se=["d"],qe={class:"flex items-center gap-1"},je=["onClick"],Te=["onClick"],De={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},Ie=["d"],Le=["onClick"],ze={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},Oe=["d"],Me=["onClick"],Re={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},We=["d"],Ke={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},Qe={class:"bg-white p-4 md:p-5 rounded-2xl shadow-xl w-[980px] max-h-screen overflow-auto"},Ye={class:"flex items-center justify-between mb-3"},Ge={class:"text-lg font-semibold"},He={class:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm"},Je={class:"md:col-span-3"},Xe=["disabled"],Ze={key:0,class:"text-red-600 text-[11px] mt-1"},es={class:"md:col-span-3"},ss=["disabled"],ts={key:0,class:"text-red-600 text-[11px] mt-1"},ls={key:0,class:"md:col-span-3"},as={key:0,class:"text-red-600 text-[11px] mt-1"},os={key:1,class:"md:col-span-3"},is={key:0,class:"text-red-600 text-[11px] mt-1"},ns={key:2,class:"md:col-span-3"},rs={key:0,class:"text-red-600 text-[11px] mt-1"},ds={key:3,class:"md:col-span-3"},us={key:0,class:"text-red-600 text-[11px] mt-1"},cs=["disabled"],vs=["disabled"],ms=["disabled"],ps=["value"],bs={key:0,class:"text-red-600 text-[11px] mt-1"},fs=["disabled"],ws=["disabled"],_s={class:"md:col-span-3"},xs=["disabled"],ys={key:0,class:"mt-4 p-3 rounded-xl border bg-white/70"},gs={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},hs={class:"block mb-1 inline-flex items-center gap-2"},ks={class:"w-4 h-4 opacity-80",viewBox:"0 0 24 24"},Cs=["d"],As={class:"flex items-center gap-3"},Us={class:"w-16 h-16 rounded-full overflow-hidden bg-gray-100 border"},Bs=["src"],Vs={key:1,class:"w-full h-full flex items-center justify-center text-[10px] text-gray-400"},Es=["disabled"],Fs={class:"block mb-1 inline-flex items-center gap-2"},Ps={class:"w-4 h-4 opacity-80",viewBox:"0 0 24 24"},$s=["d"],Ns={class:"flex items-center gap-3"},Ss={class:"w-28 h-16 rounded-lg overflow-hidden bg-gray-100 border"},qs=["src"],js={key:1,class:"w-full h-full flex items-center justify-center text-[10px] text-gray-400"},Ts=["disabled"],Ds={class:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-3"},Is={class:"p-3 rounded-xl border bg-white/70"},Ls={key:0,class:"text-xs text-gray-500"},zs={key:1,class:"text-xs text-gray-500"},Os={key:2,class:"space-y-1 text-sm"},Ms={class:"truncate"},Rs={class:"text-[11px] text-gray-500"},Ws={class:"flex justify-end gap-2 mt-5"},lt={__name:"UserManagementPage",setup(Ks){const r=H();J();const N=ee(),f=h({page:1,limit:10,q:"",role:"",is_active:""}),V=["admin","manager","officer","student"],S=[{label:"All",value:""},{label:"Yes",value:"true"},{label:"No",value:"false"}],w=async(a={},e=!0)=>{f.value={...f.value,...a};const t={...f.value};["q","role","is_active"].forEach(g=>{(t[g]===""||t[g]==null)&&delete t[g]}),t.q&&(t.username=t.q,delete t.q),await r.fetchAll(t,e)};X(async()=>{await w({page:1,limit:10},!0)});const q=Z(()=>({total:r.users.total||0,totalPages:r.users.totalPages||1,currentPage:r.users.currentPage||1,pageSize:r.users.pageSize||10,data:r.users.data||[]})),j=a=>a?"emerald":"zinc",T=a=>a?"indigo":"gray",D=[{key:"avatar",label:"Avatar",width:64,formatter:(a,e)=>e.avatar||null,sortable:!1},{key:"username",label:"Username",sortable:!0,minWidth:160},{key:"name",label:"Name",sortable:!1,minWidth:200,formatter:(a,e)=>`${e.first_name||""} ${e.last_name||""}`.trim()||"—"},{key:"email",label:"Email",sortable:!0,minWidth:220},{key:"role",label:"Role",sortable:!0,width:120},{key:"is_active",label:"Active",sortable:!0,width:100},{key:"twoFAEnabled",label:"2FA",sortable:!0,width:100}],I=async a=>{await w(a)},y=h(!1),n=h("create"),l=h({id:null,username:"",email:"",first_name:"",last_name:"",role:"student",is_active:!0,twoFAEnabled:!1,bio:"",avatar:null,cover:null,password:"",confirm_password:""}),d=h({}),L=()=>{n.value="create",l.value={id:null,username:"",email:"",first_name:"",last_name:"",role:"student",is_active:!0,twoFAEnabled:!1,bio:"",avatar:null,cover:null,password:"",confirm_password:""},d.value={},y.value=!0},z=async a=>{await r.fetchById(a.id);const e=r.selectedUser||a;n.value="view",l.value={id:e.id,username:e.username||"",email:e.email||"",first_name:e.first_name||"",last_name:e.last_name||"",role:e.role||"student",is_active:!!e.is_active,twoFAEnabled:!!e.twoFAEnabled,bio:e.bio||"",avatar:e.avatar||null,cover:e.cover||null,password:"",confirm_password:""},d.value={},y.value=!0,await E(e.id)},O=async a=>{await r.fetchById(a.id);const e=r.selectedUser||a;n.value="edit",l.value={id:e.id,username:e.username||"",email:e.email||"",first_name:e.first_name||"",last_name:e.last_name||"",role:e.role||"student",is_active:!!e.is_active,twoFAEnabled:!!e.twoFAEnabled,bio:e.bio||"",avatar:e.avatar||null,cover:e.cover||null},d.value={},y.value=!0,await E(e.id)},M=a=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(a||"").trim()),R=()=>{const a={};return l.value.username?.trim()||(a.username="Username is required"),M(l.value.email)||(a.email="Valid email is required"),l.value.role?.trim()||(a.role="Role is required"),n.value==="create"?(l.value.password?.trim()||(a.password="Password is required"),(l.value.password||"").length<6&&(a.password="Password must be at least 6 chars"),(l.value.confirm_password||"")!==(l.value.password||"")&&(a.confirm_password="Passwords do not match")):n.value==="edit"&&(l.value.password?.length&&l.value.password.length<6&&(a.password="At least 6 chars"),l.value.password?.length&&l.value.confirm_password!==l.value.password&&(a.confirm_password="Passwords do not match")),d.value=a,Object.keys(a).length===0},W=async()=>{if(n.value==="view"||!R())return;const a={username:l.value.username.trim(),email:l.value.email.trim(),first_name:l.value.first_name?.trim()||"",last_name:l.value.last_name?.trim()||"",role:l.value.role||"student",is_active:!!l.value.is_active,twoFAEnabled:!!l.value.twoFAEnabled,bio:l.value.bio||null};n.value==="create"?(a.password=l.value.password,await r.create(a)):(l.value.password&&(a.password=l.value.password),await r.updateById(l.value.id,a)),y.value=!1,await w({},!0)},K=async a=>{!a?.id||!(await F.fire({title:`Delete @${a.username}?`,text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Delete",cancelButtonText:"Cancel"})).isConfirmed||(await r.deleteById(a.id),await w({},!0),await F.fire("Deleted","User record removed.","success"))},Q=async a=>{const e=a?.target?.files?.[0];if(!e||!l.value.id)return;const t=await le(e);await r.uploadAvatar(l.value.id,t),await r.fetchById(l.value.id),l.value.avatar=r.selectedUser?.avatar||l.value.avatar},Y=async a=>{const e=a?.target?.files?.[0];if(!e||!l.value.id)return;const t=await ae(e);await r.uploadCover(l.value.id,t),await r.fetchById(l.value.id),l.value.cover=r.selectedUser?.cover||l.value.cover},A=h([]),B=h(!1),E=async a=>{try{B.value=!0;const e=await r.fetchUserClubs(a,{force:!0});A.value=Array.isArray(e)?e:[]}catch{A.value=[]}finally{B.value=!1}},G=a=>{a?.id&&N.push({name:"profile",params:{id:a.id}})};return(a,e)=>(o(),i(k,null,[_(oe,null,{default:x(()=>[_(re,null,{default:x(()=>[m(r).error?(o(),se(_e,{key:0,color:"danger"},{default:x(()=>[p(c(m(r).error),1)]),_:1})):u("",!0),_(we,{icon:m(de),title:"Users",main:""},{default:x(()=>[s("div",ye,[_(P,{icon:m(ue),color:"primary",label:"New User",onClick:L},null,8,["icon"]),_(P,{icon:m(ce),color:"info",label:"Refresh",onClick:e[0]||(e[0]=t=>w({},!0))},null,8,["icon"])])]),_:1},8,["icon"]),s("div",ge,[s("div",he,[(o(),i("svg",ke,[s("path",{d:m(ve)},null,8,Ce)])),e[21]||(e[21]=s("span",{class:"font-medium text-sm"},"Filters",-1))]),s("div",Ae,[v(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>f.value.q=t),placeholder:"Search username, name, email…",class:"border rounded px-2 py-2 md:col-span-2",onKeyup:e[2]||(e[2]=te(t=>w({page:1}),["enter"]))},null,544),[[b,f.value.q]]),v(s("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>f.value.role=t),class:"border rounded px-2 py-2"},[e[22]||(e[22]=s("option",{value:""},"All roles",-1)),(o(),i(k,null,U(V,t=>s("option",{key:t,value:t},c(t),9,Ue)),64))],512),[[C,f.value.role]]),v(s("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>f.value.is_active=t),class:"border rounded px-2 py-2"},[(o(),i(k,null,U(S,t=>s("option",{key:t.label,value:t.value},"Active: "+c(t.label),9,Be)),64))],512),[[C,f.value.is_active]]),s("div",Ve,[s("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:e[5]||(e[5]=t=>w({page:1}))}," Apply "),s("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:e[6]||(e[6]=t=>w({q:"",role:"",is_active:"",page:1},!0))}," Reset ")])])]),_(xe,{columns:D,data:q.value,loading:m(r).isLoading,onQueryChange:I},{"cell-avatar":x(({value:t})=>[s("div",Ee,[t?(o(),i("img",{key:0,src:t,alt:"avatar",class:"w-full h-full object-cover",loading:"lazy"},null,8,Fe)):(o(),i("div",Pe,"N/A "))])]),"cell-is_active":x(({value:t})=>[_($,{text:t?"Active":"Inactive",tone:j(t)},null,8,["text","tone"])]),"cell-twoFAEnabled":x(({value:t})=>[s("div",$e,[(o(),i("svg",Ne,[s("path",{d:m(fe)},null,8,Se)])),_($,{text:t?"Enabled":"Disabled",tone:T(t)},null,8,["text","tone"])])]),"cell-actions":x(({row:t})=>[s("div",qe,[s("button",{class:"px-2 py-1 text-[12px] rounded bg-blue-600 text-white inline-flex items-center gap-1",onClick:g=>G(t),title:"Open profile"}," Open ",8,je),s("button",{class:"px-2 py-1 text-[12px] rounded bg-gray-100 hover:bg-gray-200 inline-flex items-center gap-1",onClick:g=>z(t),title:"View"},[(o(),i("svg",De,[s("path",{d:m(me)},null,8,Ie)])),e[23]||(e[23]=p(" View ",-1))],8,Te),s("button",{class:"px-2 py-1 text-[12px] rounded bg-amber-100 hover:bg-amber-200 inline-flex items-center gap-1",onClick:g=>O(t),title:"Edit"},[(o(),i("svg",ze,[s("path",{d:m(pe)},null,8,Oe)])),e[24]||(e[24]=p(" Edit ",-1))],8,Le),s("button",{class:"px-2 py-1 text-[12px] rounded bg-rose-100 hover:bg-rose-200 inline-flex items-center gap-1",onClick:g=>K(t),title:"Delete"},[(o(),i("svg",Re,[s("path",{d:m(be)},null,8,We)])),e[25]||(e[25]=p(" Delete ",-1))],8,Me)])]),_:1},8,["data","loading"])]),_:1})]),_:1}),y.value?(o(),i("div",Ke,[s("div",Qe,[s("div",Ye,[s("h2",Ge,c(n.value==="create"?"New User":n.value==="edit"?"Edit User":"View User"),1),s("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:e[7]||(e[7]=t=>y.value=!1)},"Close")]),s("div",He,[s("div",Je,[e[26]||(e[26]=s("label",{class:"block mb-1"},[p("Username "),s("span",{class:"text-red-500"},"*")],-1)),v(s("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>l.value.username=t),class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},null,8,Xe),[[b,l.value.username]]),d.value.username?(o(),i("p",Ze,c(d.value.username),1)):u("",!0)]),s("div",es,[e[27]||(e[27]=s("label",{class:"block mb-1"},[p("Email "),s("span",{class:"text-red-500"},"*")],-1)),v(s("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>l.value.email=t),type:"email",class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},null,8,ss),[[b,l.value.email]]),d.value.email?(o(),i("p",ts,c(d.value.email),1)):u("",!0)]),n.value!=="view"?(o(),i(k,{key:0},[n.value==="create"?(o(),i("div",ls,[e[28]||(e[28]=s("label",{class:"block mb-1"},[p("Password "),s("span",{class:"text-red-500"},"*")],-1)),v(s("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>l.value.password=t),type:"password",autocomplete:"new-password",class:"w-full border rounded px-2.5 py-2"},null,512),[[b,l.value.password]]),d.value.password?(o(),i("p",as,c(d.value.password),1)):u("",!0)])):u("",!0),n.value==="create"?(o(),i("div",os,[e[29]||(e[29]=s("label",{class:"block mb-1"},[p("Confirm Password "),s("span",{class:"text-red-500"},"*")],-1)),v(s("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>l.value.confirm_password=t),type:"password",autocomplete:"new-password",class:"w-full border rounded px-2.5 py-2"},null,512),[[b,l.value.confirm_password]]),d.value.confirm_password?(o(),i("p",is,c(d.value.confirm_password),1)):u("",!0)])):u("",!0),n.value==="edit"?(o(),i("div",ns,[e[30]||(e[30]=s("label",{class:"block mb-1"},"New Password (optional)",-1)),v(s("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>l.value.password=t),type:"password",autocomplete:"new-password",class:"w-full border rounded px-2.5 py-2",placeholder:"Leave blank to keep current"},null,512),[[b,l.value.password]]),d.value.password?(o(),i("p",rs,c(d.value.password),1)):u("",!0)])):u("",!0),n.value==="edit"&&l.value.password?(o(),i("div",ds,[e[31]||(e[31]=s("label",{class:"block mb-1"},"Confirm New Password",-1)),v(s("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>l.value.confirm_password=t),type:"password",autocomplete:"new-password",class:"w-full border rounded px-2.5 py-2"},null,512),[[b,l.value.confirm_password]]),d.value.confirm_password?(o(),i("p",us,c(d.value.confirm_password),1)):u("",!0)])):u("",!0)],64)):u("",!0),s("div",null,[e[32]||(e[32]=s("label",{class:"block mb-1"},"First name",-1)),v(s("input",{"onUpdate:modelValue":e[14]||(e[14]=t=>l.value.first_name=t),class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},null,8,cs),[[b,l.value.first_name]])]),s("div",null,[e[33]||(e[33]=s("label",{class:"block mb-1"},"Last name",-1)),v(s("input",{"onUpdate:modelValue":e[15]||(e[15]=t=>l.value.last_name=t),class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},null,8,vs),[[b,l.value.last_name]])]),s("div",null,[e[34]||(e[34]=s("label",{class:"block mb-1"},[p("Role "),s("span",{class:"text-red-500"},"*")],-1)),v(s("select",{"onUpdate:modelValue":e[16]||(e[16]=t=>l.value.role=t),class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},[(o(),i(k,null,U(V,t=>s("option",{key:t,value:t},c(t),9,ps)),64))],8,ms),[[C,l.value.role]]),d.value.role?(o(),i("p",bs,c(d.value.role),1)):u("",!0)]),s("div",null,[e[36]||(e[36]=s("label",{class:"block mb-1"},"Active",-1)),v(s("select",{"onUpdate:modelValue":e[17]||(e[17]=t=>l.value.is_active=t),class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},e[35]||(e[35]=[s("option",{value:!0},"Yes",-1),s("option",{value:!1},"No",-1)]),8,fs),[[C,l.value.is_active]])]),s("div",null,[e[38]||(e[38]=s("label",{class:"block mb-1"},"Two-Factor Auth",-1)),v(s("select",{"onUpdate:modelValue":e[18]||(e[18]=t=>l.value.twoFAEnabled=t),class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},e[37]||(e[37]=[s("option",{value:!0},"Enabled",-1),s("option",{value:!1},"Disabled",-1)]),8,ws),[[C,l.value.twoFAEnabled]])]),s("div",_s,[e[39]||(e[39]=s("label",{class:"block mb-1"},"Bio",-1)),v(s("textarea",{"onUpdate:modelValue":e[19]||(e[19]=t=>l.value.bio=t),rows:"2",class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},null,8,xs),[[b,l.value.bio]])])]),l.value.id?(o(),i("div",ys,[e[42]||(e[42]=s("div",{class:"flex items-center justify-between mb-2"},[s("div",{class:"text-sm font-medium"},"Media")],-1)),s("div",gs,[s("div",null,[s("label",hs,[(o(),i("svg",ks,[s("path",{d:m(ie)},null,8,Cs)])),e[40]||(e[40]=p(" Avatar ",-1))]),s("div",As,[s("div",Us,[l.value.avatar?(o(),i("img",{key:0,src:l.value.avatar,class:"w-full h-full object-cover",loading:"lazy"},null,8,Bs)):(o(),i("div",Vs,"N/A "))]),s("input",{type:"file",accept:"image/*",disabled:n.value==="view",onChange:Q},null,40,Es)])]),s("div",null,[s("label",Fs,[(o(),i("svg",Ps,[s("path",{d:m(ne)},null,8,$s)])),e[41]||(e[41]=p(" Cover ",-1))]),s("div",Ns,[s("div",Ss,[l.value.cover?(o(),i("img",{key:0,src:l.value.cover,class:"w-full h-full object-cover",loading:"lazy"},null,8,qs)):(o(),i("div",js,"N/A "))]),s("input",{type:"file",accept:"image/*",disabled:n.value==="view",onChange:Y},null,40,Ts)])])])])):u("",!0),s("div",Ds,[s("div",Is,[e[43]||(e[43]=s("div",{class:"text-sm font-medium mb-2"},"Clubs",-1)),B.value?(o(),i("div",Ls,"Loading clubs…")):A.value.length?(o(),i("ul",Os,[(o(!0),i(k,null,U(A.value,t=>(o(),i("li",{key:t.id,class:"flex items-center justify-between rounded border px-2 py-1 bg-gray-50"},[s("span",Ms,c(t.name),1),s("span",Rs,c(t.code||""),1)]))),128))])):(o(),i("div",zs,"No clubs found for this user."))])]),s("div",Ws,[s("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:e[20]||(e[20]=t=>y.value=!1)},"Close"),n.value!=="view"?(o(),i("button",{key:0,class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:W},c(n.value==="edit"?"Save Changes":"Create User"),1)):u("",!0)])])])):u("",!0)],64))}};export{lt as default};
