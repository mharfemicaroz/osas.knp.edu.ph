import{c as b,u as ee,r as U,o as le,x as N,a as i,d as v,q as n,e as t,h as r,t as d,j as y,k as p,C as A,F as V,B as C,v as m,g as te}from"./index.CogHg4rp.js";import{u as ae}from"./club.B1pxqbVW.js";import{u as se}from"./annualPlan.BRlQKhLM.js";const ue={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},ie={class:"bg-white p-3 md:p-4 rounded-xl shadow-lg w-[780px] max-h-[85vh] overflow-y-auto"},ne={class:"flex items-center justify-between mb-2"},de={class:"flex items-center gap-2"},oe={class:"text-base font-semibold"},re={key:0,class:"mb-2 text-[11px] px-2.5 py-1.5 rounded-lg border bg-amber-50 border-amber-200 text-amber-800"},ve={class:"p-2 mb-2 rounded-xl border bg-white/70"},pe={class:"flex items-center justify-between mb-1"},me={class:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm"},_e=["disabled"],be=["value"],ce=["disabled"],fe=["value"],ye={key:0,class:"mt-2 text-[11px] rounded-lg border bg-gray-50 px-2.5 py-1.5"},xe={class:"flex flex-wrap gap-3"},ge={key:0},ke={key:1},we={class:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm"},Se=["disabled"],Ae={key:0,class:"text-red-600 text-[11px] mt-0.5"},Ve=["disabled"],Ce=["value"],qe={key:0,class:"text-red-600 text-[11px] mt-0.5"},Ue=["disabled"],Ne=["value"],je={key:0,class:"text-red-600 text-[11px] mt-0.5"},Re={class:"md:col-span-3"},Pe=["disabled"],Ie={key:0,class:"text-red-600 text-[11px] mt-0.5"},Fe={class:"mt-2 grid grid-cols-1 md:grid-cols-3 gap-2 text-sm"},Oe={class:"block mb-0.5"},he={key:0,class:"ml-1 text-[10px] px-1.5 py-0.5 rounded bg-emerald-100 text-emerald-700 align-middle"},Be=["disabled"],De=["value"],Le={key:0,class:"text-red-600 text-[11px] mt-0.5"},Ee=["disabled"],Te=["disabled","aria-invalid"],Me={key:0,class:"text-red-600 text-[11px] mt-0.5"},Ye={class:"mt-2 grid grid-cols-1 md:grid-cols-3 gap-2 text-sm"},$e=["disabled"],ze=["disabled","aria-invalid"],Je=["value"],Ke={key:0,class:"text-red-600 text-[11px] mt-0.5"},Ge=["disabled"],He={class:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-2 text-sm"},Qe=["disabled","aria-invalid"],We={key:0,class:"text-red-600 text-[11px] mt-0.5"},Xe=["disabled","aria-invalid"],Ze={key:0,class:"text-red-600 text-[11px] mt-0.5"},el={class:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-2 text-sm"},ll=["disabled","aria-invalid"],tl={key:0,class:"text-red-600 text-[11px] mt-0.5"},al=["disabled","aria-invalid"],sl={key:0,class:"text-red-600 text-[11px] mt-0.5"},ul={key:1,class:"mt-2 text-sm"},il=["disabled"],nl={class:"mt-2 text-sm"},dl=["disabled"],ol={class:"flex justify-end gap-1.5 mt-4"},ml={__name:"ActivityDesignFormModal",props:{modelValue:{type:Boolean,default:!1},mode:{type:String,default:"create"},initial:{type:Object,default:()=>({id:null,date_filed:"",semester:"",office_department:"",school_year:"",name_of_activity:"",venue:"",date_of_implementation:"",proposed_budget:0,participants:"",nature_of_activity:"Curricular",rationale:"",objectives:"",details_of_activity:"",budgetary_requirements:"",file_by_user_name:"",filed_by_user_id:"",club_id:"",status:"draft",remarks:"",annual_plan_id:"",annual_plan_item:null})}},emits:["update:modelValue","submit"],setup(T,{emit:M}){const x=T,I=M,j=b({get:()=>x.modelValue,set:s=>I("update:modelValue",s)}),F=ee(),q=ae(),R=se(),P=b(()=>F.user?.id||null),O=b(()=>String(F.user?.role||"").toLowerCase()==="admin"),l=U({...x.initial}),u=U({}),g=U(null),Y=["1st Semester","2nd Semester","Summer"],$=["Curricular","Co-Curricular","Extra-Curricular"],h=b(()=>{const s=new Date().getFullYear();return Array.from({length:6},(e,a)=>`${s-a}-${s-a+1}`)}),B=s=>{const e=Number(s);return Number.isFinite(e)?e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},z=(s,e=[])=>{if(Array.isArray(s))return s;try{return JSON.parse(s||"[]")||e}catch{return e}},J=(s,e=null)=>{if(s&&typeof s=="object")return s;try{return JSON.parse(s||"null")??e}catch{return e}},k=s=>{const e=Number(s);return(q.clubs?.data||[]).find(c=>Number(c.id)===e)?.name||""},D=b(()=>Array.isArray(R.items?.data)?R.items.data.filter(s=>String(s.status||"").toLowerCase()==="approved"):[]),_=b(()=>{const s=Number(l.value.annual_plan_id||0);return s&&D.value.find(e=>Number(e.id)===s)||null}),w=b(()=>{const s=_.value;return s?z(s.plans,[]).map((a,c)=>({key:String(a?.id??a?.plan_id??c),title:a?.title??a?.name??a?.activity??a?.label??`Item #${c+1}`,funds:Number(a?.funds??a?.budget??0)||0,raw:a})):[]}),f=U("");le(async()=>{(!Array.isArray(q.clubs?.data)||!q.clubs.data.length)&&await q.fetchAll({page:1,limit:200},!0),await R.fetchAll({page:1,limit:500,status:"approved"},!0)}),N(()=>x.initial,s=>{const e=J(s.annual_plan_item,null);if(l.value={...s,annual_plan_item:e},u.value={},g.value=null,l.value.school_year||(l.value.school_year=h.value[0]),!l.value.filed_by_user_id&&P.value&&(l.value.filed_by_user_id=P.value),l.value.club_id){const a=k(l.value.club_id);a&&(l.value.office_department=a)}queueMicrotask(()=>{if(!_.value||!l.value.annual_plan_item){f.value="";return}const c=w.value,E=c.findIndex(Z=>JSON.stringify(Z.raw)===JSON.stringify(l.value.annual_plan_item));f.value=E>=0?c[E].key:""})},{immediate:!0}),N(()=>l.value.club_id,s=>{if(S.value)return;const e=k(s);e&&(l.value.office_department=e)}),N(()=>l.value.annual_plan_id,(s,e)=>{l.value.annual_plan_item=null,f.value="";const a=_.value;a&&(g.value||(g.value={school_year:l.value.school_year,proposed_budget:l.value.proposed_budget,club_id:l.value.club_id,office_department:l.value.office_department}),l.value.club_id=a.club_id,l.value.office_department=a?.club?.name||k(a.club_id)||l.value.office_department)}),N(()=>f.value,s=>{const e=_.value;if(!e||!s){l.value.annual_plan_item=null;return}const a=w.value.find(c=>c.key===s);if(!a){l.value.annual_plan_item=null;return}l.value.annual_plan_item=a.raw,e.school_year&&(l.value.school_year=e.school_year),Number.isFinite(a.funds)&&(l.value.proposed_budget=a.funds),l.value.venue=w.value[0].raw.venue,l.value.date_of_implementation=w.value[0].raw.date_of_implementation,l.value.school_year=e.school_year||l.value.school_year,l.value.club_id=e.club_id,l.value.office_department=e?.club?.name||k(e.club_id)||l.value.office_department});const S=b(()=>!!l.value.annual_plan_id),K=()=>{if(!o.value){if(l.value.annual_plan_id="",l.value.annual_plan_item=null,f.value="",l.value.venue=null,l.value.date_of_implementation=null,g.value){const s=g.value;l.value.school_year=s.school_year,l.value.proposed_budget=s.proposed_budget,l.value.club_id=s.club_id,l.value.office_department=s.office_department}g.value=null}},L=b(()=>String(l.value?.status||"").toLowerCase()),o=b(()=>x.mode==="edit"&&L.value!=="draft"),G=b(()=>x.mode!=="edit"?"New Activity":o.value?"View Activity (read-only)":"Edit Activity"),H=b(()=>x.mode==="edit"?"Save Changes":"Create"),Q=b(()=>{switch(L.value){case"draft":return"bg-gray-100 text-gray-800";case"pending":return"bg-amber-100 text-amber-800";case"approved":return"bg-emerald-100 text-emerald-700";case"rejected":return"bg-rose-100 text-rose-700";case"cancelled":return"bg-zinc-200 text-zinc-800";default:return"bg-gray-100 text-gray-800"}}),W=()=>{if(o.value)return!1;const s={};return l.value.date_filed||(s.date_filed="Required"),l.value.semester?.trim()||(s.semester="Required"),l.value.school_year?.trim()||(s.school_year="Required"),l.value.name_of_activity?.trim()||(s.name_of_activity="Required"),l.value.date_of_implementation||(s.date_of_implementation="Required"),l.value.nature_of_activity||(s.nature_of_activity="Required"),l.value.club_id||(s.club_id="Required"),l.value.rationale?.trim()||(s.rationale="Required"),l.value.objectives?.trim()||(s.objectives="Required"),l.value.details_of_activity?.trim()||(s.details_of_activity="Required"),l.value.budgetary_requirements?.trim()||(s.budgetary_requirements="Required"),u.value=s,Object.keys(s).length===0},X=()=>{if(o.value||!W())return;const s={...l.value};s.proposed_budget===""&&(s.proposed_budget=0),s.filed_by_user_id=P.value,O.value||delete s.file_by_user_name,S.value&&_.value?(s.club_id=_.value.club_id,s.office_department=_.value?.club?.name||k(_.value.club_id)||s.office_department||""):s.office_department=k(s.club_id)||s.office_department||"",s.annual_plan_id===""&&(s.annual_plan_id=null),I("submit",s)};return(s,e)=>j.value?(n(),i("div",ue,[t("div",ie,[t("div",ne,[t("div",de,[t("h2",oe,d(G.value),1),t("span",{class:y(["text-[10px] px-1.5 py-0.5 rounded",Q.value])},d(l.value.status),3)]),t("button",{class:"px-2.5 py-1 text-[11px] bg-gray-200 rounded",onClick:e[0]||(e[0]=a=>j.value=!1)},"Close")]),o.value?(n(),i("div",re,[e[23]||(e[23]=p(" This activity has been submitted and is now ",-1)),t("strong",null,d(l.value.status),1),e[24]||(e[24]=p(". Editing is disabled. ",-1))])):v("",!0),t("div",ve,[t("div",pe,[e[25]||(e[25]=t("div",{class:"text-sm font-medium"},"Link to Annual Plan (optional)",-1)),!o.value&&(S.value||l.value.annual_plan_item)?(n(),i("button",{key:0,class:"text-[11px] px-2 py-1 rounded border bg-gray-50 hover:bg-gray-100",onClick:K},"Reset Annual Plan link")):v("",!0)]),t("div",me,[t("div",null,[e[27]||(e[27]=t("label",{class:"block mb-0.5"},"Annual Plan",-1)),r(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.annual_plan_id=a),class:"w-full border rounded px-2 py-1.5",disabled:o.value},[e[26]||(e[26]=t("option",{value:""},"— Not linked —",-1)),(n(!0),i(V,null,C(D.value,a=>(n(),i("option",{key:a.id,value:a.id},d(a.reference_code)+" — SY "+d(a.school_year)+" — "+d(a?.club?.name||"Club#"+a.club_id),9,be))),128))],8,_e),[[A,l.value.annual_plan_id]])]),t("div",null,[e[29]||(e[29]=t("label",{class:"block mb-0.5"},"Plan Item",-1)),r(t("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>f.value=a),class:"w-full border rounded px-2 py-1.5",disabled:o.value||!l.value.annual_plan_id||!w.value.length},[e[28]||(e[28]=t("option",{value:""},"— Select item —",-1)),(n(!0),i(V,null,C(w.value,a=>(n(),i("option",{key:a.key,value:a.key},d(a.title)+" — ₱"+d(B(a.funds)),9,fe))),128))],8,ce),[[A,f.value]])]),e[30]||(e[30]=t("div",{class:"self-end text-[11px] text-gray-600"},[p(" Choosing an Annual Plan locks the "),t("strong",null,"Club"),p(". Selecting an item also auto-fills "),t("strong",null,"School Year"),p(" and "),t("strong",null,"Proposed Budget"),p(". ")],-1))]),l.value.annual_plan_item?(n(),i("div",ye,[t("div",xe,[t("div",null,[e[31]||(e[31]=t("span",{class:"text-gray-500"},"Item:",-1)),t("strong",null,d(l.value.annual_plan_item.title||l.value.annual_plan_item.name||l.value.annual_plan_item.activity||"—"),1)]),t("div",null,[e[32]||(e[32]=t("span",{class:"text-gray-500"},"Funds:",-1)),t("strong",null,"₱"+d(B(l.value.annual_plan_item.funds||l.value.annual_plan_item.budget||0)),1)]),_.value?(n(),i("div",ge,[e[33]||(e[33]=t("span",{class:"text-gray-500"},"SY:",-1)),t("strong",null,d(_.value.school_year),1)])):v("",!0),_.value?.club?(n(),i("div",ke,[e[34]||(e[34]=t("span",{class:"text-gray-500"},"Club:",-1)),t("strong",null,d(_.value.club.name)+" ("+d(_.value.club.code||"—")+")",1)])):v("",!0)])])):v("",!0)]),t("div",we,[t("div",null,[e[35]||(e[35]=t("label",{class:"block mb-0.5"},[p("Date Filed "),t("span",{class:"text-red-500"},"*")],-1)),r(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.date_filed=a),type:"date",class:"w-full border rounded px-2 py-1.5",disabled:o.value},null,8,Se),[[m,l.value.date_filed]]),u.value.date_filed?(n(),i("p",Ae,d(u.value.date_filed),1)):v("",!0)]),t("div",null,[e[36]||(e[36]=t("label",{class:"block mb-0.5"},[p("School Year "),t("span",{class:"text-red-500"},"*")],-1)),r(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.school_year=a),class:"w-full border rounded px-2 py-1.5",disabled:o.value||S.value},[(n(!0),i(V,null,C(h.value,a=>(n(),i("option",{key:a,value:a},d(a),9,Ce))),128))],8,Ve),[[A,l.value.school_year]]),u.value.school_year?(n(),i("p",qe,d(u.value.school_year),1)):v("",!0)]),t("div",null,[e[38]||(e[38]=t("label",{class:"block mb-0.5"},[p("Semester "),t("span",{class:"text-red-500"},"*")],-1)),r(t("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.semester=a),class:"w-full border rounded px-2 py-1.5",disabled:o.value},[e[37]||(e[37]=t("option",{disabled:"",value:""},"Select semester…",-1)),(n(),i(V,null,C(Y,a=>t("option",{key:a,value:a},d(a),9,Ne)),64))],8,Ue),[[A,l.value.semester]]),u.value.semester?(n(),i("p",je,d(u.value.semester),1)):v("",!0)]),t("div",Re,[e[39]||(e[39]=t("label",{class:"block mb-0.5"},[p("Name of Activity "),t("span",{class:"text-red-500"},"*")],-1)),r(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.name_of_activity=a),class:"w-full border rounded px-2 py-1.5",disabled:o.value},null,8,Pe),[[m,l.value.name_of_activity]]),u.value.name_of_activity?(n(),i("p",Ie,d(u.value.name_of_activity),1)):v("",!0)])]),t("div",Fe,[t("div",null,[t("label",Oe,[e[40]||(e[40]=p(" Club ",-1)),e[41]||(e[41]=t("span",{class:"text-red-500"},"*",-1)),S.value?(n(),i("span",he,"locked by Annual Plan")):v("",!0)]),r(t("select",{"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.club_id=a),class:"w-full border rounded px-2 py-1.5",disabled:o.value||S.value},[e[42]||(e[42]=t("option",{value:""},"Select club…",-1)),(n(!0),i(V,null,C(te(q).clubs.data||[],a=>(n(),i("option",{key:a.id,value:a.id},d(a.name),9,De))),128))],8,Be),[[A,l.value.club_id]]),u.value.club_id?(n(),i("p",Le,d(u.value.club_id),1)):v("",!0)]),t("div",null,[e[43]||(e[43]=t("label",{class:"block mb-0.5"},"Venue",-1)),r(t("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>l.value.venue=a),class:"w-full border rounded px-2 py-1.5",disabled:o.value},null,8,Ee),[[m,l.value.venue]])]),t("div",null,[e[44]||(e[44]=t("label",{class:"block mb-0.5"},[p("Date of Implementation "),t("span",{class:"text-red-500"},"*")],-1)),r(t("input",{"onUpdate:modelValue":e[9]||(e[9]=a=>l.value.date_of_implementation=a),type:"date",class:y(["w-full border rounded px-2 py-1.5",u.value.date_of_implementation?"border-red-500":""]),disabled:o.value,"aria-invalid":!!u.value.date_of_implementation},null,10,Te),[[m,l.value.date_of_implementation]]),u.value.date_of_implementation?(n(),i("p",Me,d(u.value.date_of_implementation),1)):v("",!0)])]),t("div",Ye,[t("div",null,[e[45]||(e[45]=t("label",{class:"block mb-0.5"},"Proposed Budget",-1)),r(t("input",{"onUpdate:modelValue":e[10]||(e[10]=a=>l.value.proposed_budget=a),type:"number",step:"0.01",min:"0",class:"w-full border rounded px-2 py-1.5",disabled:o.value},null,8,$e),[[m,l.value.proposed_budget]])]),t("div",null,[e[46]||(e[46]=t("label",{class:"block mb-0.5"},[p("Nature of Activity "),t("span",{class:"text-red-500"},"*")],-1)),r(t("select",{"onUpdate:modelValue":e[11]||(e[11]=a=>l.value.nature_of_activity=a),class:y(["w-full border rounded px-2 py-1.5",u.value.nature_of_activity?"border-red-500":""]),disabled:o.value,"aria-invalid":!!u.value.nature_of_activity},[(n(),i(V,null,C($,a=>t("option",{key:a,value:a},d(a),9,Je)),64))],10,ze),[[A,l.value.nature_of_activity]]),u.value.nature_of_activity?(n(),i("p",Ke,d(u.value.nature_of_activity),1)):v("",!0)]),t("div",null,[e[47]||(e[47]=t("label",{class:"block mb-0.5"},"Participants",-1)),r(t("input",{"onUpdate:modelValue":e[12]||(e[12]=a=>l.value.participants=a),class:"w-full border rounded px-2 py-1.5",disabled:o.value},null,8,Ge),[[m,l.value.participants]])])]),t("div",He,[t("div",null,[e[48]||(e[48]=t("label",{class:"block mb-0.5"},[p("Rationale "),t("span",{class:"text-red-500"},"*")],-1)),r(t("textarea",{"onUpdate:modelValue":e[13]||(e[13]=a=>l.value.rationale=a),rows:"3",class:y(["w-full border rounded px-2 py-1.5",u.value.rationale?"border-red-500":""]),disabled:o.value,"aria-invalid":!!u.value.rationale},null,10,Qe),[[m,l.value.rationale]]),u.value.rationale?(n(),i("p",We,d(u.value.rationale),1)):v("",!0)]),t("div",null,[e[49]||(e[49]=t("label",{class:"block mb-0.5"},[p("Objectives "),t("span",{class:"text-red-500"},"*")],-1)),r(t("textarea",{"onUpdate:modelValue":e[14]||(e[14]=a=>l.value.objectives=a),rows:"3",class:y(["w-full border rounded px-2 py-1.5",u.value.objectives?"border-red-500":""]),disabled:o.value,"aria-invalid":!!u.value.objectives},null,10,Xe),[[m,l.value.objectives]]),u.value.objectives?(n(),i("p",Ze,d(u.value.objectives),1)):v("",!0)])]),t("div",el,[t("div",null,[e[50]||(e[50]=t("label",{class:"block mb-0.5"},[p("Details of the Activity "),t("span",{class:"text-red-500"},"*")],-1)),r(t("textarea",{"onUpdate:modelValue":e[15]||(e[15]=a=>l.value.details_of_activity=a),rows:"4",class:y(["w-full border rounded px-2 py-1.5",u.value.details_of_activity?"border-red-500":""]),disabled:o.value,"aria-invalid":!!u.value.details_of_activity},null,10,ll),[[m,l.value.details_of_activity]]),u.value.details_of_activity?(n(),i("p",tl,d(u.value.details_of_activity),1)):v("",!0)]),t("div",null,[e[51]||(e[51]=t("label",{class:"block mb-0.5"},[p("Budgetary Requirements "),t("span",{class:"text-red-500"},"*")],-1)),r(t("textarea",{"onUpdate:modelValue":e[16]||(e[16]=a=>l.value.budgetary_requirements=a),rows:"4",class:y(["w-full border rounded px-2 py-1.5",u.value.budgetary_requirements?"border-red-500":""]),disabled:o.value,"aria-invalid":!!u.value.budgetary_requirements},null,10,al),[[m,l.value.budgetary_requirements]]),u.value.budgetary_requirements?(n(),i("p",sl,d(u.value.budgetary_requirements),1)):v("",!0)])]),O.value?(n(),i("div",ul,[e[52]||(e[52]=t("label",{class:"block mb-0.5"},"Filer Name Override (optional)",-1)),r(t("input",{"onUpdate:modelValue":e[17]||(e[17]=a=>l.value.file_by_user_name=a),class:"w-full border rounded px-2 py-1.5",disabled:o.value,placeholder:"If provided, this name appears as the filer"},null,8,il),[[m,l.value.file_by_user_name]])])):v("",!0),t("div",nl,[e[53]||(e[53]=t("label",{class:"block mb-0.5"},"Remarks",-1)),r(t("textarea",{"onUpdate:modelValue":e[18]||(e[18]=a=>l.value.remarks=a),rows:"2",class:"w-full border rounded px-2 py-1.5",disabled:o.value},null,8,dl),[[m,l.value.remarks]])]),r(t("input",{type:"hidden","onUpdate:modelValue":e[19]||(e[19]=a=>l.value.filed_by_user_id=a)},null,512),[[m,l.value.filed_by_user_id]]),r(t("input",{type:"hidden","onUpdate:modelValue":e[20]||(e[20]=a=>l.value.office_department=a)},null,512),[[m,l.value.office_department]]),r(t("input",{type:"hidden","onUpdate:modelValue":e[21]||(e[21]=a=>l.value.status=a)},null,512),[[m,l.value.status]]),t("div",ol,[t("button",{class:"px-3 py-1.5 bg-gray-200 rounded text-xs",onClick:e[22]||(e[22]=a=>j.value=!1)},"Close"),o.value?v("",!0):(n(),i("button",{key:0,class:"px-3 py-1.5 bg-blue-600 text-white rounded text-xs",onClick:X},d(H.value),1))])])])):v("",!0)}};export{ml as _};
