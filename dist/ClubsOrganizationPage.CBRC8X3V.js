import{c as q,r as E,x as te,G as Oe,a as v,d as M,q as m,e,t as b,h as j,k as F,v as Y,C as ae,b as ze,g as P,z as Ne,F as H,B as ee,S as oe,H as We,I as Ke,o as ye,E as je,J as Ge,K as qe,L as Se,n as Ve,j as re,f as W,A as xe,u as Je,l as de,M as Ye}from"./index.DvPuE6YH.js";import{u as He,v as Xe,w as Qe,x as Ze,y as et,z as Pe,A as tt,B as nt,C as lt,D as ot,E as at,F as st,G as it,H as rt,I as ut,_ as dt,a as ct,g as mt,J as vt,K as pt,L as ft,M as bt}from"./SectionMain.CIdsDpEd.js";import{_ as gt,a as De}from"./SectionTitleLineWithButton.BQ-KiHme.js";import{_ as xt,B as yt,a as Ue}from"./Badge.nCP3PgM9.js";import{u as he}from"./club.ncHF6jrH.js";import{u as ht}from"./clubDoc.BCX6e3fZ.js";import{_ as ve}from"./IconifyButton.CvjDbsGk.js";import"./appContext.D68MPlFf.js";import"./activityDesignService.DKcjCC9n.js";import"./utilizationRequestService.wB0sULin.js";import"./liquidationFundService.CyzYQJ2v.js";import"./ToasterComponent.CRqBesU4.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const wt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},_t={class:"bg-white p-4 rounded-xl shadow-xl w-[920px] max-h-screen overflow-auto"},Ct={class:"flex items-center justify-between mb-3"},$t={class:"text-lg font-semibold"},kt={class:"grid grid-cols-2 gap-4 text-sm"},St={key:0,class:"text-red-600 text-xs mt-1"},Vt={key:0,class:"text-red-600 text-xs mt-1"},Dt={class:"col-span-2"},Ut={class:"col-span-2 grid grid-cols-2 gap-4"},Et={class:"space-y-2"},At={class:"border-2 border-dashed rounded-xl p-4 flex items-center justify-between gap-3"},Bt={class:"flex items-center gap-3"},It={class:"w-16 h-16 bg-gray-50 border rounded-lg overflow-hidden flex items-center justify-center"},Lt=["src"],Mt={key:1,class:"text-xs text-gray-400"},Ot={class:"flex items-center gap-2"},jt={class:"px-3 py-2 bg-gray-800 text-white rounded cursor-pointer text-xs"},Pt=["disabled"],Rt={key:0,class:"text-red-600 text-xs mt-1"},Tt={key:1,class:"text-xs text-gray-500 break-all"},Ft={class:"space-y-2"},zt={class:"border-2 border-dashed rounded-xl p-4 flex items-center justify-between gap-3"},Nt={class:"flex items-center gap-3"},Wt={class:"w-40 h-16 bg-gray-50 border rounded-lg overflow-hidden flex items-center justify-center"},Kt=["src"],Gt={key:1,class:"text-xs text-gray-400"},qt={class:"flex items-center gap-2"},Jt={class:"px-3 py-2 bg-gray-800 text-white rounded cursor-pointer text-xs"},Yt=["disabled"],Ht={key:0,class:"text-red-600 text-xs mt-1"},Xt={key:1,class:"text-xs text-gray-500 break-all"},Qt={class:"flex justify-end gap-2 mt-5"},Zt={class:"px-4 py-2 bg-blue-600 text-white rounded text-xs"},en=2*1024*1024,Ee={__name:"ClubFormModal",props:{modelValue:{type:Boolean,default:!1},mode:{type:String,default:"create"},initial:{type:Object,default:()=>({id:null,name:"",code:"",category:"",description:"",is_active:!0,established_at:"",website:"",email:"",phone:"",logo:"",banner:""})}},emits:["update:modelValue","submit"],setup(n,{emit:y}){const a=n,g=y,u=q({get:()=>a.modelValue,set:x=>g("update:modelValue",x)}),D="https://knp.edu.ph",o=E({...a.initial}),s=E({});te(()=>a.initial,x=>{o.value={...x},s.value={}},{immediate:!0});const p=q(()=>a.mode==="edit"?"Edit Club":"Add New Club"),w=q(()=>a.mode==="edit"?"Save Changes":"Create"),O=q(()=>{const x=o.value.logo;return x?x.startsWith("data:")?x:`${D}${x}`:""}),z=q(()=>{const x=o.value.banner;return x?x.startsWith("data:")?x:`${D}${x}`:""}),I=()=>{const x={};return o.value.name?.trim()||(x.name="Name is required"),o.value.code?.trim()||(x.code="Code is required"),s.value={...s.value,...x},Object.keys(x).length===0},A=["image/png","image/jpeg"],J=x=>new Promise((l,Q)=>{const L=new FileReader;L.onload=X=>l(X.target.result),L.onerror=Q,L.readAsDataURL(x)});function T(x,l){return s.value[l]="",A.includes(x.type)?x.size>en?(s.value[l]="File too large. Maximum size is 2 MB.",!1):!0:(s.value[l]="Invalid file type. Please upload a PNG or JPEG image.",!1)}const K=async x=>{const l=x.target.files?.[0];if(l){if(!T(l,"logo")){x.target.value="";return}o.value.logo=await J(l)}},N=async x=>{const l=x.target.files?.[0];if(l){if(!T(l,"banner")){x.target.value="";return}o.value.banner=await J(l)}},R=()=>{o.value.logo="",s.value.logo=""},V=()=>{o.value.banner="",s.value.banner=""},$=()=>{if(!I())return;const x={...o.value};Object.keys(x).forEach(l=>{x[l]===""&&(x[l]=null)}),g("submit",x)};return(x,l)=>{const Q=Oe("pending-click");return u.value?(m(),v("div",wt,[e("div",_t,[e("div",Ct,[e("h2",$t,b(p.value),1),e("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:l[0]||(l[0]=L=>u.value=!1)},"Close")]),e("div",kt,[e("div",null,[l[11]||(l[11]=e("label",{class:"block mb-1"},[F("Name "),e("span",{class:"text-red-500"},"*")],-1)),j(e("input",{"onUpdate:modelValue":l[1]||(l[1]=L=>o.value.name=L),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring",placeholder:"e.g. Math Society"},null,512),[[Y,o.value.name]]),s.value.name?(m(),v("p",St,b(s.value.name),1)):M("",!0)]),e("div",null,[l[12]||(l[12]=e("label",{class:"block mb-1"},[F("Code "),e("span",{class:"text-red-500"},"*")],-1)),j(e("input",{"onUpdate:modelValue":l[2]||(l[2]=L=>o.value.code=L),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring",placeholder:"e.g. MATHSOC"},null,512),[[Y,o.value.code]]),s.value.code?(m(),v("p",Vt,b(s.value.code),1)):M("",!0)]),e("div",null,[l[14]||(l[14]=e("label",{class:"block mb-1"},"Category",-1)),j(e("select",{"onUpdate:modelValue":l[3]||(l[3]=L=>o.value.category=L),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring"},l[13]||(l[13]=[ze('<option disabled value="">Select a category</option><option value="Academic">Academic</option><option value="Cultural">Cultural</option><option value="Athletics">Athletics</option><option value="Social">Social</option><option value="Community Service">Community Service</option><option value="Religious/Spiritual">Religious / Spiritual</option><option value="Environmental">Environmental</option><option value="Leadership">Leadership</option><option value="Others">Others</option>',10)]),512),[[ae,o.value.category]])]),e("div",null,[l[16]||(l[16]=e("label",{class:"block mb-1"},"Active?",-1)),j(e("select",{"onUpdate:modelValue":l[4]||(l[4]=L=>o.value.is_active=L),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring"},l[15]||(l[15]=[e("option",{value:!0},"Yes",-1),e("option",{value:!1},"No",-1)]),512),[[ae,o.value.is_active]])]),e("div",Dt,[l[17]||(l[17]=e("label",{class:"block mb-1"},"Description",-1)),j(e("textarea",{"onUpdate:modelValue":l[5]||(l[5]=L=>o.value.description=L),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring",rows:"3",placeholder:"Brief description of the club (mission, focus, etc.)"},null,512),[[Y,o.value.description]])]),e("div",null,[l[18]||(l[18]=e("label",{class:"block mb-1"},"Established At",-1)),j(e("input",{"onUpdate:modelValue":l[6]||(l[6]=L=>o.value.established_at=L),type:"date",class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring"},null,512),[[Y,o.value.established_at]])]),e("div",null,[l[19]||(l[19]=e("label",{class:"block mb-1"},"Website",-1)),j(e("input",{"onUpdate:modelValue":l[7]||(l[7]=L=>o.value.website=L),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring",placeholder:"https://…"},null,512),[[Y,o.value.website]])]),e("div",null,[l[20]||(l[20]=e("label",{class:"block mb-1"},"Email",-1)),j(e("input",{"onUpdate:modelValue":l[8]||(l[8]=L=>o.value.email=L),type:"email",class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring",placeholder:"club@example.com"},null,512),[[Y,o.value.email]])]),e("div",null,[l[21]||(l[21]=e("label",{class:"block mb-1"},"Phone",-1)),j(e("input",{"onUpdate:modelValue":l[9]||(l[9]=L=>o.value.phone=L),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring",placeholder:"+63…"},null,512),[[Y,o.value.phone]])]),e("div",Ut,[e("div",Et,[l[24]||(l[24]=e("label",{class:"block"},"Logo",-1)),e("div",At,[e("div",Bt,[e("div",It,[O.value?(m(),v("img",{key:0,src:O.value,alt:"Logo",class:"w-full h-full object-contain"},null,8,Lt)):(m(),v("span",Mt,"No logo"))]),l[22]||(l[22]=e("div",{class:"text-xs text-gray-500"},[e("p",{class:"font-medium text-gray-700"},"PNG/JPEG • ≤ 2MB"),e("p",null,"Square works best")],-1))]),e("div",Ot,[e("label",jt,[l[23]||(l[23]=F(" Change ",-1)),e("input",{type:"file",class:"hidden",accept:"image/png,image/jpeg",onChange:K},null,32)]),e("button",{class:"px-3 py-2 bg-gray-200 rounded text-xs",onClick:R,disabled:!o.value.logo},"Remove",8,Pt)])]),s.value.logo?(m(),v("p",Rt,b(s.value.logo),1)):M("",!0),o.value.logo&&!o.value.logo.startsWith("data:")?(m(),v("p",Tt,b(P(D)+o.value.logo),1)):M("",!0)]),e("div",Ft,[l[27]||(l[27]=e("label",{class:"block"},"Banner",-1)),e("div",zt,[e("div",Nt,[e("div",Wt,[z.value?(m(),v("img",{key:0,src:z.value,alt:"Banner",class:"w-full h-full object-contain"},null,8,Kt)):(m(),v("span",Gt,"No banner"))]),l[25]||(l[25]=e("div",{class:"text-xs text-gray-500"},[e("p",{class:"font-medium text-gray-700"},"PNG/JPEG • ≤ 2MB"),e("p",null,"Wide 5:1 recommended")],-1))]),e("div",qt,[e("label",Jt,[l[26]||(l[26]=F(" Change ",-1)),e("input",{type:"file",class:"hidden",accept:"image/png,image/jpeg",onChange:N},null,32)]),e("button",{class:"px-3 py-2 bg-gray-200 rounded text-xs",onClick:V,disabled:!o.value.banner},"Remove",8,Yt)])]),s.value.banner?(m(),v("p",Ht,b(s.value.banner),1)):M("",!0),o.value.banner&&!o.value.banner.startsWith("data:")?(m(),v("p",Xt,b(P(D)+o.value.banner),1)):M("",!0)])])]),e("div",Qt,[e("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:l[10]||(l[10]=L=>u.value=!1)},"Cancel"),j((m(),v("button",Zt,[F(b(w.value),1)])),[[Q,$]])])])])):M("",!0)}}},tn={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},nn={class:"bg-white p-4 rounded shadow-lg w-[860px] max-h-screen overflow-auto"},ln={class:"flex items-center justify-between"},on={class:"text-lg font-semibold"},an={class:"text-gray-600"},sn={class:"mt-3 flex flex-col gap-2"},rn={class:"flex items-center gap-2"},un=["value"],dn={class:"text-[12px] text-gray-600"},cn={class:"mt-4"},mn={class:"relative"},vn={key:0,class:"absolute z-10 mt-1 w-full bg-white border rounded shadow max-h-64 overflow-auto"},pn={key:0,class:"px-3 py-2 text-xs text-gray-500"},fn=["onClick"],bn={class:"font-medium"},gn={class:"text-gray-500"},xn={class:"text-xs text-gray-500"},yn={key:0,class:"px-3 py-2 text-xs text-gray-500"},hn={key:0,class:"flex flex-wrap gap-2 mt-2"},wn=["onClick"],_n={class:"flex justify-end mt-2"},Cn=["disabled"],$n={class:"space-y-2 mt-4 max-h-[60vh] overflow-y-auto pr-2 -mr-2"},kn={class:"text-sm"},Sn={class:"font-semibold"},Vn={class:"text-gray-500 text-xs"},Dn={class:"text-gray-600 text-xs"},Un={class:"mt-1 text-xs flex flex-wrap items-center gap-3"},En=["disabled","value","onChange"],An=["value"],Bn=["disabled","value","onChange"],In=["value"],Ln={key:0,class:"text-[11px] text-gray-500"},Mn=["onClick"],On={class:"flex justify-between items-center mt-3 text-xs text-gray-600"},pe=10,jn={__name:"ClubMembersModal",props:{modelValue:{type:Boolean,default:!1},clubId:{type:[Number,String],required:!0},clubName:{type:String,default:""}},emits:["update:modelValue"],setup(n,{emit:y}){const a=n,g=y,u=he(),D=Ne(),o=q({get:()=>a.modelValue,set:c=>g("update:modelValue",c)}),s=E([]),p=E(1),w=E(""),O=E("all"),z=E("all"),I=["president","vice-president","secretary","treasurer","pio","business manager","bod","officer"],A=new Set([...I,"officer"]),J=[...I,"member"],T=["pending","active","inactive"],K=c=>(c??"member").toString().trim().toLowerCase()||"member",N=c=>{const i=K(c);if(i==="member")return 999;const r=I.indexOf(i);return r===-1?I.indexOf("officer"):r},R=c=>A.has(K(c?.UserClub?.role)),V=c=>{const i=(c??"active").toString().trim().toLowerCase();return T.includes(i)?i:"active"},$=c=>{const i=K(c?.UserClub?.role);return i==="member"?"member":J.includes(i)?i:"officer"},x=(c,i)=>{if(!i)return!0;const r=`${c.first_name||""} ${c.last_name||""}`.toLowerCase(),B=(c.username||"").toLowerCase(),ie=(c.email||"").toLowerCase();return r.includes(i)||B.includes(i)||ie.includes(i)},l=q(()=>{const c=w.value.trim().toLowerCase();let i=s.value||[];return O.value==="officers"?i=i.filter(R):O.value==="members"&&(i=i.filter(r=>!R(r))),z.value!=="all"&&(i=i.filter(r=>V(r?.UserClub?.status)===z.value)),c&&(i=i.filter(r=>x(r,c))),i.slice().sort((r,B)=>{const ie=N(r.UserClub?.role),we=N(B.UserClub?.role);if(ie!==we)return ie-we;const _e=(r.last_name||"").toLowerCase(),Ce=(B.last_name||"").toLowerCase();if(_e!==Ce)return _e.localeCompare(Ce);const $e=(r.first_name||"").toLowerCase(),ke=(B.first_name||"").toLowerCase();return $e!==ke?$e.localeCompare(ke):(r.username||"").toLowerCase().localeCompare((B.username||"").toLowerCase())})}),Q=q(()=>(s.value||[]).filter(R).length),L=q(()=>(s.value||[]).filter(c=>!R(c)).length),X=q(()=>{const c=l.value.length,i=Math.ceil(Math.max(c,1)/pe),r=Math.min(p.value,i||1),B=(r-1)*pe,ie=l.value.slice(B,B+pe);return{total:c,totalPages:i,currentPage:r,pageSize:pe,data:ie}});te([w,O,z],()=>p.value=1);const ue=async()=>{await u.fetchById(a.clubId),s.value=Array.isArray(u.selectedClub?.users)?u.selectedClub.users:[],w.value="",O.value="all",z.value="all",p.value=1},U=E(""),d=E([]),k=E(!1),_=E([]);let S=null;const f=c=>{const i={};return c&&(c.includes("@")?i.email=c:i.username=c,i.is_active=!0),i},t=c=>{const i=new Set((s.value||[]).map(B=>B.id)),r=new Set((_.value||[]).map(B=>B.id));return(c||[]).filter(B=>!i.has(B.id)&&!r.has(B.id))},C=async()=>{const c=U.value.trim();if(!c){d.value=[];return}k.value=!0;try{await D.fetchAll({page:1,limit:8,filters:f(c)},!0),d.value=t(D.users.data||[])}finally{k.value=!1}};te(U,c=>{if(clearTimeout(S),!c?.trim()){d.value=[];return}S=setTimeout(C,250)});const h=c=>{_.value.push(c),d.value=d.value.filter(i=>i.id!==c.id),U.value=""},G=c=>{_.value=_.value.filter(i=>i.id!==c)},le=async()=>{if(!_.value.length)return;const c=_.value.map(i=>i.id);await u.addUsersToClub(a.clubId,c),s.value=Array.isArray(u.selectedClub?.users)?u.selectedClub.users:[],_.value=[],d.value=[],U.value="",p.value=1},Z=E(new Set),se=E(new Set),me=async(c,i)=>{const r=V(i),B=V(c.UserClub?.status);if(B!==r){Z.value.add(c.id),c.UserClub||(c.UserClub={}),c.UserClub.status=r;try{await u.updateMemberStatus(a.clubId,c.id,r)}catch{c.UserClub.status=B,oe.fire("Update failed",u.error||"Unable to update status","error")}finally{Z.value.delete(c.id)}}},Te=async(c,i)=>{const r=K(i),B=K(c.UserClub?.role);if(B!==r){se.value.add(c.id),c.UserClub||(c.UserClub={}),c.UserClub.role=r;try{await u.updateMemberRole(a.clubId,c.id,r)}catch{c.UserClub.role=B,oe.fire("Update failed",u.error||"Unable to update role","error")}finally{se.value.delete(c.id)}}},Fe=async c=>{await u.removeUserFromClub(a.clubId,c),s.value=s.value.filter(i=>i.id!==c),U.value.trim()&&d.value.length&&(d.value=t(d.value))};return te(()=>a.modelValue,c=>{c&&ue()},{immediate:!1}),(c,i)=>o.value?(m(),v("div",tn,[e("div",nn,[e("div",ln,[e("h2",on,[i[7]||(i[7]=F("Club Members — ",-1)),e("span",an,b(n.clubName),1)]),e("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:i[0]||(i[0]=r=>o.value=!1)},"Close")]),e("div",sn,[e("div",rn,[j(e("select",{"onUpdate:modelValue":i[1]||(i[1]=r=>O.value=r),class:"border rounded px-2 py-1 text-sm"},i[8]||(i[8]=[e("option",{value:"all"},"All roles",-1),e("option",{value:"officers"},"Officers",-1),e("option",{value:"members"},"Members",-1)]),512),[[ae,O.value]]),j(e("select",{"onUpdate:modelValue":i[2]||(i[2]=r=>z.value=r),class:"border rounded px-2 py-1 text-sm"},[i[9]||(i[9]=e("option",{value:"all"},"All statuses",-1)),(m(),v(H,null,ee(T,r=>e("option",{key:r,value:r},b(r),9,un)),64))],512),[[ae,z.value]]),j(e("input",{"onUpdate:modelValue":i[3]||(i[3]=r=>w.value=r),type:"text",placeholder:"Search club members by name, username, or email…",class:"border rounded px-2 py-1 text-sm w-full"},null,512),[[Y,w.value]])]),e("div",dn," Showing "+b(X.value.total)+" result(s). Officers: "+b(Q.value)+" • Members: "+b(L.value),1)]),e("div",cn,[e("div",mn,[j(e("input",{"onUpdate:modelValue":i[4]||(i[4]=r=>U.value=r),type:"text",placeholder:"Add users: search by username or email…",class:"border rounded px-2 py-1 text-sm w-full",autocomplete:"off"},null,512),[[Y,U.value]]),U.value&&(d.value.length||k.value)?(m(),v("div",vn,[k.value?(m(),v("div",pn,"Searching…")):(m(),v(H,{key:1},[(m(!0),v(H,null,ee(d.value,r=>(m(),v("button",{key:r.id,class:"w-full text-left px-3 py-2 hover:bg-gray-100 text-sm",onClick:B=>h(r)},[e("div",bn,[F(b(r.first_name)+" "+b(r.last_name)+" ",1),e("span",gn,"@"+b(r.username),1)]),e("div",xn,b(r.email),1)],8,fn))),128)),d.value.length?M("",!0):(m(),v("div",yn,"No matches"))],64))])):M("",!0)]),_.value.length?(m(),v("div",hn,[(m(!0),v(H,null,ee(_.value,r=>(m(),v("span",{key:r.id,class:"inline-flex items-center gap-2 px-2 py-1 bg-blue-50 border border-blue-200 rounded text-xs"},[F(b(r.first_name)+" "+b(r.last_name)+" (@"+b(r.username)+") ",1),e("button",{class:"ml-1 text-blue-600",onClick:B=>G(r.id)},"✕",8,wn)]))),128))])):M("",!0),e("div",_n,[e("button",{class:"px-3 py-1 bg-blue-600 text-white rounded text-xs disabled:opacity-50",disabled:!_.value.length,onClick:le}," Add Selected ",8,Cn)])]),e("div",$n,[(m(!0),v(H,null,ee(X.value.data,r=>(m(),v("div",{key:r.id,class:"flex items-start justify-between p-3 border bg-gray-50 rounded"},[e("div",kn,[e("div",Sn,[F(b(r.first_name)+" "+b(r.last_name)+" ",1),e("span",Vn,"(@"+b(r.username)+")",1)]),e("div",Dn,b(r.email),1),e("div",Un,[e("span",null,[i[10]||(i[10]=F("Role: ",-1)),e("select",{class:"border rounded px-1 py-0.5 text-xs",disabled:se.value.has(r.id),value:$(r),onChange:B=>Te(r,B.target.value)},[(m(),v(H,null,ee(J,B=>e("option",{key:B,value:B},b(B),9,An)),64))],40,En)]),e("span",null,[i[11]||(i[11]=F("Status: ",-1)),e("select",{class:"border rounded px-1 py-0.5 text-xs",disabled:Z.value.has(r.id),value:V(r.UserClub?.status),onChange:B=>me(r,B.target.value)},[(m(),v(H,null,ee(T,B=>e("option",{key:B,value:B},b(B),9,In)),64))],40,Bn)]),e("span",null,[i[12]||(i[12]=F("Joined: ",-1)),e("strong",null,b(r.UserClub?.joined_at?new Date(r.UserClub.joined_at).toLocaleDateString():"—"),1)]),se.value.has(r.id)||Z.value.has(r.id)?(m(),v("span",Ln,"Saving…")):M("",!0)])]),e("div",null,[e("button",{class:"px-2 py-1 bg-red-600 text-white rounded text-xs",onClick:B=>Fe(r.id)},"Remove",8,Mn)])]))),128))]),e("div",On,[p.value>1?(m(),v("button",{key:0,onClick:i[5]||(i[5]=r=>p.value=p.value-1),class:"px-3 py-1 bg-gray-300 rounded"},"Previous")):M("",!0),e("div",null,"Page "+b(X.value.currentPage)+" of "+b(X.value.totalPages||1),1),p.value<X.value.totalPages?(m(),v("button",{key:1,onClick:i[6]||(i[6]=r=>p.value=p.value+1),class:"px-3 py-1 bg-gray-300 rounded"},"Next")):M("",!0)])])])):M("",!0)}};var Pn=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCommentChange","onCompositionEnd","onCompositionStart","onCompositionUpdate","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onInput","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],Rn=function(n){return Pn.map(function(y){return y.toLowerCase()}).indexOf(n.toLowerCase())!==-1},Tn=function(n,y,a){Object.keys(y).filter(Rn).forEach(function(g){var u=y[g];typeof u=="function"&&(g==="onInit"?u(n,a):a.on(g.substring(2),function(D){return u(D,a)}))})},Fn=function(n,y,a,g){var u=n.modelEvents?n.modelEvents:null,D=Array.isArray(u)?u.join(" "):u;te(g,function(o,s){a&&typeof o=="string"&&o!==s&&o!==a.getContent({format:n.outputFormat})&&a.setContent(o)}),a.on(D||"change input undo redo",function(){y.emit("update:modelValue",a.getContent({format:n.outputFormat}))})},zn=function(n,y,a,g,u,D){g.setContent(D()),a.attrs["onUpdate:modelValue"]&&Fn(y,a,g,u),Tn(n,a.attrs,g)},Ae=0,Re=function(n){var y=Date.now(),a=Math.floor(Math.random()*1e9);return Ae++,n+"_"+a+Ae+String(y)},Nn=function(n){return n!==null&&n.tagName.toLowerCase()==="textarea"},Be=function(n){return typeof n>"u"||n===""?[]:Array.isArray(n)?n:n.split(" ")},Wn=function(n,y){return Be(n).concat(Be(y))},Kn=function(n){return n==null},Ie=function(n){var y;return typeof((y=n.options)===null||y===void 0?void 0:y.set)=="function"&&n.options.isRegistered("disabled")},Le=function(){return{listeners:[],scriptId:Re("tiny-script"),scriptLoaded:!1}},Gn=function(){var n=Le(),y=function(u,D,o,s){var p=D.createElement("script");p.referrerPolicy="origin",p.type="application/javascript",p.id=u,p.src=o;var w=function(){p.removeEventListener("load",w),s()};p.addEventListener("load",w),D.head&&D.head.appendChild(p)},a=function(u,D,o){n.scriptLoaded?o():(n.listeners.push(o),u.getElementById(n.scriptId)||y(n.scriptId,u,D,function(){n.listeners.forEach(function(s){return s()}),n.scriptLoaded=!0}))},g=function(){n=Le()};return{load:a,reinitialize:g}},qn=Gn(),Jn=function(){return typeof window<"u"?window:global},ce=function(){var n=Jn();return n&&n.tinymce?n.tinymce:null},Yn={apiKey:String,licenseKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,readonly:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(n){return n==="html"||n==="text"}}},ne=function(){return ne=Object.assign||function(n){for(var y,a=1,g=arguments.length;a<g;a++){y=arguments[a];for(var u in y)Object.prototype.hasOwnProperty.call(y,u)&&(n[u]=y[u])}return n},ne.apply(this,arguments)},Hn=function(n,y,a,g){return n(g||"div",{id:y,ref:a})},Xn=function(n,y,a){return n("textarea",{id:y,visibility:"hidden",ref:a})},be={selector:void 0,target:void 0},ge=function(n,y){var a;typeof((a=n.mode)===null||a===void 0?void 0:a.set)=="function"?n.mode.set(y):n.setMode(y)},Qn=We({props:Yn,setup:function(n,y){var a=n.init?ne(ne({},n.init),be):ne({},be),g=Ke(n),u=g.disabled,D=g.readonly,o=g.modelValue,s=g.tagName,p=E(null),w=null,O=n.id||Re("tiny-vue"),z=n.init&&n.init.inline||n.inline,I=!!y.attrs["onUpdate:modelValue"],A=!0,J=n.initialValue?n.initialValue:"",T="",K=function(V){return I?function(){return o?.value?o.value:""}:function(){return V?J:T}},N=function(){var V=K(A),$=ne(ne({},a),{disabled:n.disabled,readonly:n.readonly,target:p.value,plugins:Wn(a.plugins,n.plugins),toolbar:n.toolbar||a.toolbar,inline:z,license_key:n.licenseKey,setup:function(x){w=x,!Ie(w)&&n.disabled===!0&&ge(w,"readonly"),x.on("init",function(l){return zn(l,n,y,x,o,V)}),typeof a.setup=="function"&&a.setup(x)}});Nn(p.value)&&(p.value.style.visibility=""),ce().init($),A=!1};te(D,function(V){w!==null&&ge(w,V?"readonly":"design")}),te(u,function(V){w!==null&&(Ie(w)?w.options.set("disabled",V):ge(w,V?"readonly":"design"))}),te(s,function(V){var $;w&&(I||(T=w.getContent()),($=ce())===null||$===void 0||$.remove(w),Ve(function(){return N()}))}),ye(function(){if(ce()!==null)N();else if(p.value&&p.value.ownerDocument){var V=n.cloudChannel?n.cloudChannel:"8",$=n.apiKey?n.apiKey:"no-api-key",x=Kn(n.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat($,"/tinymce/").concat(V,"/tinymce.min.js"):n.tinymceScriptSrc;qn.load(p.value.ownerDocument,x,N)}}),je(function(){ce()!==null&&ce().remove(w)}),z||(Ge(function(){A||N()}),qe(function(){var V;w&&(I||(T=w.getContent()),(V=ce())===null||V===void 0||V.remove(w))}));var R=function(V){var $;w&&(T=w.getContent(),($=ce())===null||$===void 0||$.remove(w),a=ne(ne(ne({},a),V),be),Ve(function(){return N()}))};return y.expose({rerender:R,getEditor:function(){return w}}),function(){return z?Hn(Se,O,p,n.tagName):Xn(Se,O,p)}}});function Zn(){const n=E(null),y=E(!1);return{editorRef:n,isFullscreen:y,onInit:(o,s)=>{n.value=s},toggleFullscreen:()=>{n.value&&(n.value.execCommand("mceFullScreen"),y.value=!y.value)},ensureExitFullscreen:()=>{y.value&&n.value&&(n.value.execCommand("mceFullScreen"),y.value=!1)},tinymceInit:{menubar:!1,height:320,plugins:"lists link image table code paste fullscreen",toolbar:"undo redo | blocks | bold italic underline strikethrough | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | removeformat | code | fullscreen",paste_data_images:!0,image_dimensions:!0,image_caption:!0,object_resizing:"img",branding:!1,content_style:"body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; font-size:14px}",automatic_uploads:!1,file_picker_types:"image",file_picker_callback:o=>{const s=document.createElement("input");s.type="file",s.accept="image/*",s.onchange=()=>{const p=s.files?.[0];if(!p)return;const w=new FileReader;w.onload=()=>o(w.result),w.readAsDataURL(p)},s.click()}}}}const el={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},tl={class:"bg-white p-4 rounded shadow-lg w-[1024px] max-h-screen overflow-auto"},nl={class:"flex items-center justify-between mb-2"},ll={class:"text-lg font-semibold"},ol={class:"flex items-center gap-2"},al={class:"bg-white w-full max-w-[1024px] max-h-screen rounded-2xl shadow-lg flex flex-col"},sl={class:"p-5 flex-1 overflow-auto"},il={class:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"},rl=["aria-invalid"],ul=["value"],dl={key:0,class:"text-red-600 text-xs mt-1"},cl=["aria-invalid"],ml=["value"],vl={key:0,class:"text-red-600 text-xs mt-1"},pl={class:"md:col-span-2"},fl=["aria-invalid"],bl={key:0,class:"text-red-600 text-xs mt-1"},gl={class:"md:col-span-2"},xl={key:0,class:"text-red-600 text-xs mt-1"},yl={class:"md:col-span-2"},hl={class:"border-t p-4 bg-white flex items-center justify-end gap-2"},Me={__name:"DocFormModal",props:{modelValue:{type:Boolean,default:!1},mode:{type:String,default:"create"},initial:{type:Object,default:()=>({id:null,type:"cbl",title:"",content:"",status:"draft",doc_date:""})}},emits:["update:modelValue","submit","closed"],setup(n,{emit:y}){const a=["draft","published","archived"],g=["cbl","resolution","minute"],u=n,D=y,o=q({get:()=>u.modelValue,set:V=>D("update:modelValue",V)}),{isFullscreen:s,onInit:p,toggleFullscreen:w,ensureExitFullscreen:O,tinymceInit:z}=Zn(),I=E({...u.initial}),A=E({});te(()=>u.initial,V=>{I.value={...V},A.value={}},{immediate:!0});const J=q(()=>u.mode==="edit"?"Edit Document":"Add Document"),T=q(()=>u.mode==="edit"?"Save Changes":"Create"),K=()=>{const V={};return I.value.type||(V.type="Type is required"),I.value.title?.trim()||(V.title="Title is required"),I.value.content?.trim()||(V.content="Content is required"),I.value.status&&!a.includes(I.value.status)&&(V.status="Invalid status"),A.value=V,Object.keys(V).length===0},N=()=>{if(!K())return;const V={...I.value,doc_date:I.value.doc_date||null};D("submit",V)},R=()=>{O(),o.value=!1,D("closed")};return(V,$)=>{const x=Oe("pending-click");return o.value?(m(),v("div",el,[e("div",tl,[e("div",nl,[e("h2",ll,b(J.value),1),e("div",ol,[e("button",{class:"px-3 py-1 text-xs bg-indigo-600 text-white rounded",onClick:$[0]||($[0]=(...l)=>P(w)&&P(w)(...l))},b(P(s)?"Restore":"Maximize"),1),e("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:R},"Close")])]),e("div",al,[e("div",sl,[e("div",il,[e("div",null,[$[6]||($[6]=e("label",{class:"block mb-1 font-medium text-gray-700"},[F("Type "),e("span",{class:"text-red-500"},"*")],-1)),j(e("select",{"onUpdate:modelValue":$[1]||($[1]=l=>I.value.type=l),"aria-invalid":!!A.value.type,class:re(["w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",A.value.type?"border-red-500":"border-gray-300"])},[(m(),v(H,null,ee(g,l=>e("option",{key:l,value:l},b(l),9,ul)),64))],10,rl),[[ae,I.value.type]]),A.value.type?(m(),v("p",dl,b(A.value.type),1)):M("",!0)]),e("div",null,[$[7]||($[7]=e("label",{class:"block mb-1 font-medium text-gray-700"},"Status",-1)),j(e("select",{"onUpdate:modelValue":$[2]||($[2]=l=>I.value.status=l),"aria-invalid":!!A.value.status,class:re(["w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",A.value.status?"border-red-500":"border-gray-300"])},[(m(),v(H,null,ee(["draft","published","archived"],l=>e("option",{key:l,value:l},b(l),9,ml)),64))],10,cl),[[ae,I.value.status]]),A.value.status?(m(),v("p",vl,b(A.value.status),1)):M("",!0)]),e("div",pl,[$[8]||($[8]=e("label",{class:"block mb-1 font-medium text-gray-700"},[F("Title "),e("span",{class:"text-red-500"},"*")],-1)),j(e("input",{"onUpdate:modelValue":$[3]||($[3]=l=>I.value.title=l),"aria-invalid":!!A.value.title,placeholder:"Document title",class:re(["w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",A.value.title?"border-red-500":"border-gray-300"])},null,10,fl),[[Y,I.value.title]]),A.value.title?(m(),v("p",bl,b(A.value.title),1)):M("",!0)]),e("div",gl,[$[9]||($[9]=e("label",{class:"block mb-1 font-medium text-gray-700"},[F("Content "),e("span",{class:"text-red-500"},"*")],-1)),e("div",{class:re(["rounded-lg border",A.value.content?"border-red-500":"border-gray-300"])},[W(P(Qn),{modelValue:I.value.content,"onUpdate:modelValue":$[4]||($[4]=l=>I.value.content=l),init:P(z),onInit:P(p),"tinymce-script-src":"/tinymce/tinymce.min.js",licenseKey:"gpl"},null,8,["modelValue","init","onInit"])],2),A.value.content?(m(),v("p",xl,b(A.value.content),1)):M("",!0)]),e("div",yl,[$[10]||($[10]=e("label",{class:"block mb-1 font-medium text-gray-700"},"Document Date",-1)),j(e("input",{"onUpdate:modelValue":$[5]||($[5]=l=>I.value.doc_date=l),type:"date",class:"w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 border-gray-300"},null,512),[[Y,I.value.doc_date]])])])]),e("div",hl,[e("button",{type:"button",class:"px-4 py-2 rounded-lg text-xs border border-gray-300 hover:bg-gray-100 transition",onClick:R}," Cancel "),j((m(),v("button",{type:"button",class:re(["px-4 py-2 rounded-lg text-xs",u.mode==="edit"?"bg-emerald-600 text-white hover:bg-emerald-700":"bg-blue-600 text-white hover:bg-blue-700"])},[F(b(T.value),1)],2)),[[x,N]])])])])])):M("",!0)}}},wl={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},_l={class:"bg-white p-4 rounded shadow-lg w-[900px] max-h-screen overflow-auto"},Cl={class:"flex items-center justify-between"},$l={class:"text-lg font-semibold"},kl={class:"text-gray-600"},Sl={class:"flex items-center gap-2"},Vl={class:"mt-3 flex flex-col gap-2"},Dl={class:"flex items-center gap-2"},Ul=["value"],El=["value"],Al={class:"text-[12px] text-gray-600"},Bl={class:"space-y-2 mt-4 max-h-[60vh] overflow-y-auto pr-2 -mr-2"},Il={class:"text-sm"},Ll={class:"flex flex-wrap items-center gap-2"},Ml={class:"font-semibold"},Ol={class:"px-2 py-[2px] text-[11px] rounded bg-indigo-100 text-indigo-700 uppercase"},jl={class:"text-xs text-gray-600"},Pl={class:"shrink-0 flex items-center gap-2"},Rl=["onClick"],Tl=["onClick"],Fl={class:"flex justify-between items-center mt-3 text-xs text-gray-600"},fe=10,zl={__name:"ClubDocsModal",props:{modelValue:{type:Boolean,default:!1},clubId:{type:[Number,String],required:!0},clubName:{type:String,default:""}},emits:["update:modelValue"],setup(n,{emit:y}){const a=n,g=y,u=ht(),D=q({get:()=>a.modelValue,set:_=>g("update:modelValue",_)}),o=E([]),s=E(1),p=E(""),w=E("all"),O=E("all"),z=["cbl","resolution","minute"],I=["draft","published","archived"],A=["cbl","resolution","minute"],J=_=>A.includes((_||"").toLowerCase())?(_||"").toLowerCase():"cbl",T=_=>{const S=J(_),f=z.indexOf(S);return f===-1?999:f},K=(_,S)=>{if(!S)return!0;const f=(_.title||"").toLowerCase(),t=(_.content||"").toLowerCase();return f.includes(S)||t.includes(S)},N=q(()=>{const _=p.value.trim().toLowerCase();let S=o.value||[];return w.value!=="all"&&(S=S.filter(f=>(f.type||"").toLowerCase()===w.value)),O.value!=="all"&&(S=S.filter(f=>(f.status||"").toLowerCase()===O.value)),_&&(S=S.filter(f=>K(f,_))),S.slice().sort((f,t)=>{const C=T(f.type),h=T(t.type);if(C!==h)return C-h;const G=f.doc_date||f.created_at,le=t.doc_date||t.created_at,Z=G?new Date(G).getTime():0;return(le?new Date(le).getTime():0)-Z})}),R=q(()=>{const _=N.value.length,S=Math.ceil(Math.max(_,1)/fe),f=Math.min(s.value,S||1),t=(f-1)*fe,C=N.value.slice(t,t+fe);return{total:_,totalPages:S,currentPage:f,pageSize:fe,data:C}});te([p,w,O],()=>s.value=1);const V=async()=>{p.value="",w.value="all",O.value="all",s.value=1,await u.fetchByClub(a.clubId,{page:1,limit:200}),o.value=Array.isArray(u.docs?.data)?u.docs.data:[]},$=E(!1),x=E(!1),l=E(null),Q=()=>{$.value=!0},L=async _=>{const S=await u.create({..._,club_id:a.clubId});o.value.unshift(S),$.value=!1},X=()=>{},ue=_=>{l.value={id:_.id,type:_.type||"cbl",title:_.title||"",content:_.content||"",status:_.status||"draft",doc_date:_.doc_date?String(_.doc_date).slice(0,10):""},x.value=!0},U=async _=>{const{id:S,...f}=_,t=await u.updateById(S,{...f}),C=o.value.findIndex(h=>h.id===S);C!==-1&&(o.value[C]=t),x.value=!1},d=()=>{},k=async _=>{(await oe.fire({title:`Delete document "${_.title}"?`,text:"This cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it",cancelButtonText:"Cancel"})).isConfirmed&&(await u.deleteById(_.id),o.value=o.value.filter(f=>f.id!==_.id),await oe.fire("Deleted!","The document has been deleted.","success"))};return te(()=>a.modelValue,_=>{_&&V()},{immediate:!1}),(_,S)=>D.value?(m(),v("div",wl,[e("div",_l,[e("div",Cl,[e("h2",$l,[S[8]||(S[8]=F("Club Documents — ",-1)),e("span",kl,b(n.clubName),1)]),e("div",Sl,[e("button",{class:"px-3 py-1 text-xs bg-blue-600 text-white rounded",onClick:Q},"+ Add Document"),e("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:S[0]||(S[0]=f=>D.value=!1)},"Close")])]),e("div",Vl,[e("div",Dl,[j(e("select",{"onUpdate:modelValue":S[1]||(S[1]=f=>w.value=f),class:"border rounded px-2 py-1 text-sm"},[S[9]||(S[9]=e("option",{value:"all"},"All types",-1)),(m(),v(H,null,ee(A,f=>e("option",{key:f,value:f},b(f),9,Ul)),64))],512),[[ae,w.value]]),j(e("select",{"onUpdate:modelValue":S[2]||(S[2]=f=>O.value=f),class:"border rounded px-2 py-1 text-sm"},[S[10]||(S[10]=e("option",{value:"all"},"All statuses",-1)),(m(),v(H,null,ee(I,f=>e("option",{key:f,value:f},b(f),9,El)),64))],512),[[ae,O.value]]),j(e("input",{"onUpdate:modelValue":S[3]||(S[3]=f=>p.value=f),type:"text",placeholder:"Search documents by title or content…",class:"border rounded px-2 py-1 text-sm w-full"},null,512),[[Y,p.value]])]),e("div",Al," Showing "+b(R.value.total)+" document(s). Ordered by type → date. ",1)]),e("div",Bl,[(m(!0),v(H,null,ee(R.value.data,f=>(m(),v("div",{key:f.id,class:"border rounded p-3 bg-gray-50 flex items-start justify-between gap-4"},[e("div",Il,[e("div",Ll,[e("span",Ml,b(f.title),1),e("span",Ol,b(f.type),1),e("span",{class:re(["px-2 py-[2px] text-[11px] rounded",{"bg-yellow-100 text-yellow-700":f.status==="draft","bg-emerald-100 text-emerald-700":f.status==="published","bg-gray-200 text-gray-700":f.status==="archived"}])},b(f.status),3),e("span",jl,b(f.doc_date?new Date(f.doc_date).toLocaleDateString():f.created_at?new Date(f.created_at).toLocaleDateString():"—"),1)])]),e("div",Pl,[e("button",{class:"px-2 py-1 bg-amber-500 hover:bg-amber-600 text-white rounded text-xs",onClick:t=>ue(f)},"Edit",8,Rl),e("button",{class:"px-2 py-1 bg-red-600 text-white rounded text-xs",onClick:t=>k(f)},"Delete",8,Tl)])]))),128))]),e("div",Fl,[s.value>1?(m(),v("button",{key:0,onClick:S[4]||(S[4]=f=>s.value=s.value-1),class:"px-3 py-1 bg-gray-300 rounded"},"Previous")):M("",!0),e("div",null,"Page "+b(R.value.currentPage)+" of "+b(R.value.totalPages||1),1),s.value<R.value.totalPages?(m(),v("button",{key:1,onClick:S[5]||(S[5]=f=>s.value=s.value+1),class:"px-3 py-1 bg-gray-300 rounded"},"Next")):M("",!0)])]),W(Me,{modelValue:$.value,"onUpdate:modelValue":S[6]||(S[6]=f=>$.value=f),mode:"create",initial:{type:"cbl",title:"",content:"",status:"draft",doc_date:""},onSubmit:L,onClosed:X},null,8,["modelValue"]),W(Me,{modelValue:x.value,"onUpdate:modelValue":S[7]||(S[7]=f=>x.value=f),mode:"edit",initial:l.value||{id:null,type:"cbl",title:"",content:"",status:"draft",doc_date:""},onSubmit:U,onClosed:d},null,8,["modelValue","initial"])])):M("",!0)}},Nl={class:"flex items-center gap-1 md:gap-2"},Wl=["aria-expanded"],Kl={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24","aria-hidden":"true"},Gl=["d"],ql={__name:"ClubRowActions",props:{row:{type:Object,required:!0}},emits:["members","docs","edit","delete","view","attachments"],setup(n,{emit:y}){const a=E(!1),g=E(null),u=E(null),D=o=>{if(!a.value)return;const s=g.value,p=u.value;s&&!s.contains(o.target)&&p&&!p.contains(o.target)&&(a.value=!1)};return ye(()=>{document.addEventListener("click",D)}),je(()=>{document.removeEventListener("click",D)}),(o,s)=>(m(),v("div",Nl,[W(ve,{"icon-path":P(He),color:"text-indigo-600",label:"Attachments",tooltip:"Attachments",size:"sm",onClick:s[0]||(s[0]=p=>o.$emit("attachments",n.row))},null,8,["icon-path"]),W(ve,{"icon-path":P(Xe),color:"text-gray-700",label:"View",tooltip:"View Club",size:"sm",onClick:s[1]||(s[1]=p=>o.$emit("view",n.row))},null,8,["icon-path"]),W(ve,{"icon-path":P(Qe),color:"text-blue-600",label:"Members",tooltip:"View Members",size:"sm",onClick:s[2]||(s[2]=p=>o.$emit("members",n.row))},null,8,["icon-path"]),W(ve,{"icon-path":P(Ze),color:"text-indigo-600",label:"Docs",tooltip:"View Documents",size:"sm",onClick:s[3]||(s[3]=p=>o.$emit("docs",n.row))},null,8,["icon-path"]),W(ve,{"icon-path":P(et),color:"text-emerald-600",label:"Edit",tooltip:"Edit Club",size:"sm",onClick:s[4]||(s[4]=p=>o.$emit("edit",n.row))},null,8,["icon-path"]),o.$attrs.moderator?(m(),xe(ve,{key:0,"icon-path":P(Pe),color:"text-red-600",label:"Delete",tooltip:"Delete Club",size:"sm",onClick:s[5]||(s[5]=p=>o.$emit("delete",n.row))},null,8,["icon-path"])):M("",!0),e("div",{class:"relative md:hidden",ref_key:"btnRef",ref:u},[e("button",{class:"inline-flex items-center justify-center rounded-xl p-1.5 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-1","aria-expanded":a.value,"aria-haspopup":"menu",title:"More",onClick:s[6]||(s[6]=p=>a.value=!a.value)},[(m(),v("svg",Kl,[e("path",{d:P(tt)},null,8,Gl)]))],8,Wl),a.value?(m(),v("div",{key:0,ref_key:"menuRef",ref:g,role:"menu",class:"absolute right-0 z-20 mt-1 w-40 overflow-hidden rounded-xl border bg-white shadow-lg"},[e("button",{role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:s[7]||(s[7]=p=>{a.value=!1,o.$emit("attachments",n.row)})}," Attachments "),e("button",{role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:s[8]||(s[8]=p=>{a.value=!1,o.$emit("view",n.row)})}," View Club "),e("button",{role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:s[9]||(s[9]=p=>{a.value=!1,o.$emit("members",n.row)})}," View Members "),e("button",{role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:s[10]||(s[10]=p=>{a.value=!1,o.$emit("docs",n.row)})}," View Documents "),e("button",{role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:s[11]||(s[11]=p=>{a.value=!1,o.$emit("edit",n.row)})}," Edit Club "),o.$attrs.moderator?(m(),v("button",{key:0,role:"menuitem",class:"w-full px-3 py-2 text-left text-sm text-red-600 hover:bg-red-50",onClick:s[12]||(s[12]=p=>{a.value=!1,o.$emit("delete",n.row)})}," Delete ")):M("",!0)],512)):M("",!0)],512)]))}},Jl={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},Yl={class:"bg-white p-4 rounded-xl shadow-xl w-[980px] max-h-screen overflow-auto"},Hl={class:"flex items-center justify-between mb-3"},Xl={class:"text-lg font-semibold"},Ql={class:"text-gray-600"},Zl={class:"flex items-center justify-between gap-2"},eo={class:"text-sm text-gray-600"},to={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},no=["d"],lo=["disabled"],oo={class:"mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"},ao={class:"aspect-video bg-white border rounded overflow-hidden flex items-center justify-center"},so=["src"],io={key:1,class:"flex items-center justify-center w-full h-full"},ro=["d"],uo={class:"mt-2 text-xs"},co=["title"],mo={class:"text-gray-500 flex items-center justify-between"},vo={key:0},po={key:0},fo={class:"mt-2 flex items-center justify-between gap-2"},bo=["onClick","title"],go={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},xo=["d"],yo=["onClick"],ho={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},wo=["d"],_o={key:0,class:"mt-6 text-center text-sm text-gray-500"},Co=10*1024*1024,$o={__name:"ClubAttachmentsModal",props:{modelValue:{type:Boolean,default:!1},row:{type:Object,default:null}},emits:["update:modelValue"],setup(n,{emit:y}){const a=n,g=y,u=q({get:()=>a.modelValue,set:t=>g("update:modelValue",t)}),D=he(),o=E(null),s=E(!1),p=new Set(["image/png","image/jpeg","image/webp","application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]),w=new Set(["png","jpg","jpeg","webp","pdf","docx","xlsx"]),O=(t="")=>{const C=String(t).toLowerCase().match(/\.([a-z0-9]+)$/i);return C?C[1]:""},z=(t="")=>{if(typeof t!="string")return"";const C=t.match(/^data:([^;]+);base64,/i);return C?C[1]:""},I=t=>{const C=t?.type&&p.has(t.type),h=t?.name&&w.has(O(t.name));return C||h},A=(t="")=>String(t).startsWith("image/"),J=(t="")=>t==="application/pdf",T=(t="")=>t==="application/vnd.openxmlformats-officedocument.wordprocessingml.document",K=(t="")=>t==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",N=(t="")=>J(t)?at:T(t)?st:K(t)?it:A(t)?rt:ut,R=(t="")=>J(t)?"PDF":T(t)?"Word":K(t)?"Excel":A(t)?"Image":"File",V=(t="")=>J(t)?"pdf":T(t)?"docx":K(t)?"xlsx":t==="image/png"?"png":t==="image/jpeg"?"jpg":t==="image/webp"?"webp":"",$=(t="attachment",C="")=>{const h=/\.[a-z0-9]+$/i.test(t),G=C?C.startsWith(".")?C.slice(1):C:"";return h?t:G?`${t}.${G}`:t},x=t=>!t&&t!==0?"":t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`,l=q(()=>{const t=o.value?.attachments;if(!t)return[];try{return Array.isArray(t)?t:JSON.parse(t||"[]")}catch{return[]}}),Q=q(()=>(l.value||[]).map((t,C)=>{const h=t.mime||z(t.data)||(t.name?O(t.name)==="pdf"&&"application/pdf":"")||"",G=O(t.name||"")||V(h),le=t.size??null,Z=t.name||`${R(h)} ${C+1}`;return{id:t.id??C+1,name:Z,data:t.data||"",url:t.url||t.href||t.path||"",mime:h,ext:G,size:le,filename:$(Z,G)}}));te(()=>a.modelValue,async t=>{t&&a.row?.id&&(await D.fetchById(a.row.id),o.value=D.selectedClub||a.row)},{immediate:!1});const L=async t=>{const C=t.target.files?.[0];if(t.target.value="",!(!C||!o.value?.id)){if(C.size>Co){await oe.fire("File too large","Maximum size is 10 MB.","warning");return}if(!I(C)){await oe.fire("Unsupported file","Only images (PNG/JPEG/WEBP), PDF, DOCX, and XLSX are allowed.","warning");return}try{s.value=!0,await D.uploadAttachment(o.value.id,C),await D.fetchById(o.value.id),o.value=D.selectedClub}finally{s.value=!1}}},X=async t=>{!o.value?.id||!(await oe.fire({title:"Remove attachment?",icon:"warning",showCancelButton:!0,confirmButtonText:"Remove",confirmButtonColor:"#d33"})).isConfirmed||(await D.deleteAttachment(o.value.id,t),await D.fetchById(o.value.id),o.value=D.selectedClub)},ue=t=>{if(t.data&&String(t.data).startsWith("data:")&&A(t.mime)){const C=window.open();C&&C.document.write(`<img src="${t.data}" style="display:block;max-width:100%;height:auto;margin:0 auto;object-fit:contain"/>`);return}t.url&&window.open(String(t.url),"_blank")},U=t=>{const[C,h]=t.split(","),G=C.match(/data:([^;]+);base64/i)?.[1]||"application/octet-stream",le=atob(h),Z=le.length,se=new Uint8Array(Z);for(let me=0;me<Z;me++)se[me]=le.charCodeAt(me);return new Blob([se],{type:G})},d=(t,C)=>{const h=URL.createObjectURL(t),G=document.createElement("a");G.href=h,G.download=C||"download",document.body.appendChild(G),G.click(),G.remove(),setTimeout(()=>URL.revokeObjectURL(h),1e3)},k=async t=>{if(t.data&&String(t.data).startsWith("data:")){const C=U(t.data);d(C,t.filename);return}if(t.url)try{const h=await(await fetch(t.url,{credentials:"include"})).blob();d(h,t.filename)}catch{const h=document.createElement("a");h.href=String(t.url),h.setAttribute("download",t.filename),document.body.appendChild(h),h.click(),h.remove()}},_=t=>A(t.mime)?"Open":"Download",S=t=>A(t.mime)?lt:ot,f=t=>A(t.mime)?ue(t):k(t);return(t,C)=>u.value?(m(),v("div",Jl,[e("div",Yl,[e("div",Hl,[e("h2",Xl,[C[1]||(C[1]=F(" Attachments — ",-1)),e("span",Ql,b(o.value?.name||""),1)]),e("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:C[0]||(C[0]=h=>u.value=!1)},"Close")]),e("div",Zl,[e("div",eo,[C[2]||(C[2]=F(" Ref: ",-1)),e("strong",null,b(o.value?.code||"—"),1)]),e("label",{class:re(["inline-flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white rounded text-xs cursor-pointer disabled:opacity-60",{"opacity-60 pointer-events-none":s.value}])},[(m(),v("svg",to,[e("path",{d:P(nt)},null,8,no)])),e("span",null,b(s.value?"Uploading…":"Upload"),1),e("input",{type:"file",class:"hidden",disabled:s.value,onChange:L,accept:".png,.jpg,.jpeg,.webp,.pdf,.docx,.xlsx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,image/png,image/jpeg,image/webp"},null,40,lo)],2)]),e("div",oo,[(m(!0),v(H,null,ee(Q.value,h=>(m(),v("div",{key:h.id,class:"border rounded-lg p-2 bg-gray-50 flex flex-col"},[e("div",ao,[A(h.mime)&&h.data&&h.data.startsWith("data:")?(m(),v("img",{key:0,src:h.data,class:"object-contain w-full h-full",alt:"Attachment preview"},null,8,so)):(m(),v("div",io,[(m(),v("svg",{style:{width:"64px",height:"64px"},viewBox:"0 0 24 24","aria-hidden":"true",class:re({"text-red-600":J(h.mime),"text-blue-600":T(h.mime),"text-emerald-600":K(h.mime),"text-gray-500":!h.mime||!A(h.mime)&&!J(h.mime)})},[e("path",{d:N(h.mime)},null,8,ro)],2))]))]),e("div",uo,[e("div",{class:"font-medium truncate",title:h.name},b(h.name),9,co),e("div",mo,[e("span",null,[F(b(R(h.mime))+" ",1),h.ext?(m(),v("span",vo,"("+b(h.ext.toUpperCase())+")",1)):M("",!0)]),h.size?(m(),v("span",po,b(x(h.size)),1)):M("",!0)])]),e("div",fo,[e("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-white border rounded text-xs hover:bg-gray-50",onClick:G=>f(h),title:_(h)},[(m(),v("svg",go,[e("path",{d:S(h)},null,8,xo)])),F(" "+b(_(h)),1)],8,bo),e("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-red-600 text-white rounded text-xs",onClick:G=>X(h.id),title:"Remove"},[(m(),v("svg",ho,[e("path",{d:P(Pe)},null,8,wo)])),C[3]||(C[3]=F(" Remove ",-1))],8,yo)])]))),128))]),Q.value.length?M("",!0):(m(),v("div",_o," No attachments yet. "))])])):M("",!0)}},ko={class:"flex items-center gap-2"},So={class:"p-3 mb-4 rounded-xl border bg-white/60"},Vo={class:"flex items-center gap-2 mb-2 text-gray-700"},Do={class:"w-4 h-4",viewBox:"0 0 24 24"},Uo=["d"],Eo={class:"grid grid-cols-1 md:grid-cols-6 gap-2 text-sm"},Ao={class:"flex items-center gap-2 md:col-span-2"},Ko={__name:"ClubsOrganizationPage",setup(n){const y=Je(),a=he(),g=E({page:1,limit:10,sort:"established_at",order:"DESC",q:"",name:"",code:"",category:"",is_active:""}),u=async(U={},d=!0)=>{g.value={...g.value,...U},typeof g.value.officer>"u"&&(g.value.officer=!0);const k={...g.value};k.is_active===""?delete k.is_active:k.is_active=k.is_active===!0||k.is_active==="true",["q","name","code","category"].forEach(_=>{(k[_]===""||k[_]==null)&&delete k[_]}),await a.fetchAll(k,d)};ye(()=>u({page:1,limit:10}));const D=q(()=>({total:a.clubs.total||0,totalPages:a.clubs.totalPages||1,currentPage:a.clubs.currentPage||1,pageSize:a.clubs.pageSize||10,data:a.clubs.data||[]})),o=E(!1),s=E(null),p=async U=>{await a.fetchById(U.id),s.value=a.selectedClub||U,o.value=!0},w=E(!1),O=E(!1),z=E(null),I=()=>{w.value=!0},A=async U=>{await a.create(U),w.value=!1,await u(g.value,!0)},J=async U=>{await a.fetchById(U.id);const d=a.selectedClub||U;z.value={id:d.id,name:d.name||"",code:d.code||"",category:d.category||"",description:d.description||"",is_active:d.is_active??!0,established_at:d.established_at?String(d.established_at).slice(0,10):"",website:d.website||"",email:d.email||"",phone:d.phone||"",logo:d.logo||"",banner:d.banner||""},O.value=!0},T=async U=>{const{id:d,...k}=U;await a.updateById(d,k),O.value=!1,await u(g.value,!0)},K=async U=>{if(!U?.id)return;(await oe.fire({title:`Delete club "${U.name}"?`,text:"This cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it",cancelButtonText:"Cancel"})).isConfirmed&&(await a.deleteById(U.id),await u(g.value,!0),await oe.fire("Deleted!","The club has been deleted.","success"))},N=E(!1),R=E(!1),V=E(null),$=E(""),x=U=>{V.value=U.id,$.value=U.name||"",N.value=!0},l=U=>{V.value=U.id,$.value=U.name||"",R.value=!0},Q=U=>{U?.id&&window.open(`/#/club/${U.id}`,"_self")},L=async()=>{await u({q:"",name:"",code:"",category:"",is_active:"",page:1})},X=[{key:"name",label:"Name",sortable:!0,filterable:!0},{key:"code",label:"Code",sortable:!0,filterable:!0},{key:"category",label:"Category",sortable:!0,filterable:!0},{key:"is_active",label:"Active",sortable:!0,formatter:U=>U?"Yes":"No"}],ue=async U=>{await u(U)};return(U,d)=>(m(),v(H,null,[W(dt,null,{default:de(()=>[W(ct,null,{default:de(()=>[P(a).error?(m(),xe(xt,{key:0,icon:P(mt),color:"danger"},{default:de(()=>[F(b(P(a).error),1)]),_:1},8,["icon"])):M("",!0),W(gt,{icon:P(vt),title:"Clubs",main:""},{default:de(()=>[e("div",ko,[P(y).user.role==="admin"?(m(),xe(De,{key:0,icon:P(pt),color:"primary",label:"Add Club",onClick:I},null,8,["icon"])):M("",!0),W(De,{icon:P(ft),color:"info",label:"Refresh",onClick:d[0]||(d[0]=k=>u({page:1,limit:D.value.pageSize},!0))},null,8,["icon"])])]),_:1},8,["icon"]),e("div",So,[e("div",Vo,[(m(),v("svg",Do,[e("path",{d:P(bt)},null,8,Uo)])),d[13]||(d[13]=e("span",{class:"font-medium text-sm"},"Filters",-1))]),e("div",Eo,[j(e("input",{"onUpdate:modelValue":d[1]||(d[1]=k=>g.value.q=k),placeholder:"Search by name, code, category…",class:"border rounded px-2 py-2 md:col-span-2",onKeyup:d[2]||(d[2]=Ye(k=>u({page:1}),["enter"]))},null,544),[[Y,g.value.q]]),j(e("input",{"onUpdate:modelValue":d[3]||(d[3]=k=>g.value.name=k),placeholder:"Name contains…",class:"border rounded px-2 py-2"},null,512),[[Y,g.value.name]]),j(e("input",{"onUpdate:modelValue":d[4]||(d[4]=k=>g.value.code=k),placeholder:"Code contains…",class:"border rounded px-2 py-2"},null,512),[[Y,g.value.code]]),j(e("input",{"onUpdate:modelValue":d[5]||(d[5]=k=>g.value.category=k),placeholder:"Category contains…",class:"border rounded px-2 py-2"},null,512),[[Y,g.value.category]]),j(e("select",{"onUpdate:modelValue":d[6]||(d[6]=k=>g.value.is_active=k),class:"border rounded px-2 py-2"},d[14]||(d[14]=[e("option",{value:""},"All status",-1),e("option",{value:!0},"Active",-1),e("option",{value:!1},"Inactive",-1)]),512),[[ae,g.value.is_active]]),e("div",Ao,[e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:d[7]||(d[7]=k=>u({page:1}))}," Apply "),e("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:L}," Reset ")])])]),W(yt,{columns:X,data:D.value,loading:P(a).isLoading,onQueryChange:ue},{"cell-category":de(({value:k})=>[W(Ue,{text:k||"—",tone:"indigo"},null,8,["text"])]),"cell-is_active":de(({value:k})=>[W(Ue,{text:k?"Active":"Inactive",tone:k?"emerald":"gray"},null,8,["text","tone"])]),"cell-actions":de(({row:k})=>[W(ql,{row:k,moderator:["admin","manager"].includes(String(P(y).user?.role||"").toLowerCase()),onView:Q,onMembers:x,onDocs:l,onEdit:J,onDelete:K,onAttachments:p},null,8,["row","moderator"])]),_:1},8,["data","loading"])]),_:1})]),_:1}),W(Ee,{modelValue:w.value,"onUpdate:modelValue":d[8]||(d[8]=k=>w.value=k),mode:"create",onSubmit:A},null,8,["modelValue"]),W(Ee,{modelValue:O.value,"onUpdate:modelValue":d[9]||(d[9]=k=>O.value=k),mode:"edit",initial:z.value||{},onSubmit:T},null,8,["modelValue","initial"]),W(jn,{modelValue:N.value,"onUpdate:modelValue":d[10]||(d[10]=k=>N.value=k),"club-id":V.value,"club-name":$.value},null,8,["modelValue","club-id","club-name"]),W(zl,{modelValue:R.value,"onUpdate:modelValue":d[11]||(d[11]=k=>R.value=k),"club-id":V.value,"club-name":$.value},null,8,["modelValue","club-id","club-name"]),W($o,{modelValue:o.value,"onUpdate:modelValue":d[12]||(d[12]=k=>o.value=k),row:s.value},null,8,["modelValue","row"])],64))}};export{Ko as default};
