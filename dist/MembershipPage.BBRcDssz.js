import{z as I,u as ee,r as u,o as te,c as U,a as n,f as b,d as E,l as h,e as s,t as m,h as w,C as T,F as g,B as C,k as L,g as c,q as o,A as se,L as ae,v as le}from"./index.CcK6oagA.js";import{_ as oe,K as ne,a as ie,w as re,L as ue,M as de,r as me,Y as ce}from"./SectionMain.DrOY7HdA.js";import{_ as ve,a as pe,b as be}from"./Badge.BOI2dODc.js";import{_ as ge,B as fe}from"./NotificationBar.CgtN-fBc.js";import{T as xe}from"./ToasterComponent.B1FkP2mT.js";import{u as _e}from"./club.C7fGv21_.js";import"./activityDesignService.DZ_s6TQa.js";import"./utilizationRequestService.DeWvWHuX.js";import"./liquidationFundService.DC7qQEl2.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const ye={class:"flex items-center gap-2"},he={key:1,class:"p-3 rounded-lg border bg-amber-50 text-amber-800 text-sm"},we={key:2},Ce={class:"p-3 mb-4 rounded-xl border bg-white/60"},ke={class:"flex items-center gap-2 mb-2 text-gray-700"},Se={class:"w-4 h-4",viewBox:"0 0 24 24"},Ae=["d"],Me={class:"grid grid-cols-1 md:grid-cols-6 gap-2 text-sm"},Te=["value"],$e=["value"],Ue={class:"flex items-center gap-2 md:col-span-2"},Le=["onClick"],Re={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},Be=["d"],Ve={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},Ee={class:"bg-white p-4 md:p-5 rounded-2xl shadow-xl w-[820px] max-h-screen overflow-auto"},qe={class:"flex items-center justify-between mb-3"},Fe={class:"text-lg font-semibold"},Ne={class:"mb-3 p-3 rounded-xl border bg-white/70"},Pe={class:"flex items-center gap-2"},Oe=["disabled"],ze=["value"],We=["disabled"],je={class:"w-3.5 h-3.5 inline-block mr-1",viewBox:"0 0 24 24"},Ke=["d"],Qe={key:0,class:"text-xs text-gray-500 mt-1"},De={class:"p-3 rounded-xl border bg-white/70"},Ye={key:0,class:"text-xs text-gray-500"},Ge={key:1,class:"text-xs text-gray-500"},He={key:2,class:"space-y-2"},Je={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-2"},Xe={class:"truncate"},Ze={class:"text-sm font-medium"},Ie={class:"text-[11px] text-gray-500"},et={class:"flex items-center gap-2 flex-wrap"},tt=["onUpdate:modelValue","disabled","onChange"],st=["value"],at=["onUpdate:modelValue","disabled","onChange"],lt=["value"],ot=["onClick"],nt={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},it=["d"],_t={__name:"MembershipPage",setup(rt){const r=I(),f=_e(),q=ee(),F=["admin","manager","officer","student"],N=[{label:"All",value:""},{label:"Yes",value:"true"},{label:"No",value:"false"}],d=u({page:1,limit:10,q:"",role:"",is_active:""}),x=async(a={},e=!0)=>{d.value={...d.value,...a};const t={...d.value};["q","role","is_active"].forEach(l=>{(t[l]===""||t[l]==null)&&delete t[l]}),t.q&&(t.username=t.q,delete t.q),await r.fetchAll(t,e)};te(async()=>{await x({page:1,limit:10},!0)});const P=U(()=>({total:r.users.total||0,totalPages:r.users.totalPages||1,currentPage:r.users.currentPage||1,pageSize:r.users.pageSize||10,data:r.users.data||[]})),O=a=>a?"emerald":"zinc",z=[{key:"username",label:"Username",sortable:!0,minWidth:160},{key:"name",label:"Name",sortable:!1,minWidth:200,formatter:(a,e)=>`${e.first_name||""} ${e.last_name||""}`.trim()||"—"},{key:"email",label:"Email",sortable:!0,minWidth:220},{key:"role",label:"Role",sortable:!0,width:120},{key:"is_active",label:"Active",sortable:!0,width:100}],W=async a=>{await x(a)},R=u(!1),_=u(null),$=u([]),k=u([]),v=u({}),i=u(!1),S=u(""),y=u({}),A=u(null),j=async a=>{_.value=a,R.value=!0,await K(),await B(a.id)},K=async()=>{try{i.value=!0,await f.fetchAll({page:1,limit:500},!0)}finally{i.value=!1}},B=async a=>{try{i.value=!0;const e=await r.fetchUserClubs(a,{force:!0});$.value=Array.isArray(e)?e:[],k.value=$.value.map(l=>({...l,membership:{...l.membership||{}}}));const t={};for(const l of $.value)t[l.id]={role:l.membership?.role||"member",status:l.membership?.status||""};v.value=t}finally{i.value=!1}},Q=U(()=>new Set(($.value||[]).map(a=>a.id))),V=U(()=>(f.clubs.data||[]).filter(e=>!Q.value.has(e.id)).slice().sort((e,t)=>String(e.name||"").localeCompare(String(t.name||""),void 0,{sensitivity:"base"}))),D=["member","officer","bod","business manager","pio","treasurer","secretary","vice-president","president"],Y=["pending","active","inactive"],G=async()=>{const a=S.value,e=_.value?.id;if(!(!a||!e))try{i.value=!0,await f.addUsersToClub(a,[e]),await B(e),S.value=""}finally{i.value=!1}},H=async a=>{const e=_.value?.id;if(!(!a||!e))try{i.value=!0,await f.removeUserFromClub(a,e),await B(e)}finally{i.value=!1}},J=async a=>{const e=_.value?.id;if(!e)return;const t=k.value.find(p=>p.id===a);if(!t)return;const l=String(t.membership?.role||"").toLowerCase(),M=String(v.value[a]?.role||"").toLowerCase();if(!(!l||l===M)){y.value[a]=!0;try{await f.updateMemberRole(a,e,l),v.value[a]={...v.value[a]||{},role:l},A.value?.showToast?.("success","Role updated")}catch(p){t.membership.role=M||"member",A.value?.showToast?.("warning",p?.message||"Failed to update role")}finally{y.value[a]=!1}}},X=async a=>{const e=_.value?.id;if(!e)return;const t=k.value.find(p=>p.id===a);if(!t)return;const l=String(t.membership?.status||"").toLowerCase(),M=String(v.value[a]?.status||"").toLowerCase();if(!(!l||l===M)){y.value[a]=!0;try{await f.updateMemberStatus(a,e,l),v.value[a]={...v.value[a]||{},status:l},A.value?.showToast?.("success","Status updated")}catch(p){t.membership.status=M||"active",A.value?.showToast?.("warning",p?.message||"Failed to update status")}finally{y.value[a]=!1}}},Z=U(()=>String(q.user?.role||"").toLowerCase()==="admin");return(a,e)=>(o(),n(g,null,[b(oe,null,{default:h(()=>[b(ie,null,{default:h(()=>[c(r).error?(o(),se(ge,{key:0,color:"danger"},{default:h(()=>[L(m(c(r).error),1)]),_:1})):E("",!0),b(ve,{icon:c(re),title:"Memberships",main:""},{default:h(()=>[s("div",ye,[b(pe,{icon:c(ue),color:"info",label:"Refresh",onClick:e[0]||(e[0]=t=>x({},!0))},null,8,["icon"])])]),_:1},8,["icon"]),Z.value?(o(),n("div",we,[s("div",Ce,[s("div",ke,[(o(),n("svg",Se,[s("path",{d:c(de)},null,8,Ae)])),e[9]||(e[9]=s("span",{class:"font-medium text-sm"},"Filters",-1))]),s("div",Me,[w(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>d.value.q=t),class:"border rounded px-2 py-2 md:col-span-2",placeholder:"Search username…",onKeyup:e[2]||(e[2]=ae(t=>x({page:1}),["enter"]))},null,544),[[le,d.value.q]]),w(s("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>d.value.role=t),class:"border rounded px-2 py-2"},[e[10]||(e[10]=s("option",{value:""},"All roles",-1)),(o(),n(g,null,C(F,t=>s("option",{key:t,value:t},m(t),9,Te)),64))],512),[[T,d.value.role]]),w(s("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>d.value.is_active=t),class:"border rounded px-2 py-2"},[(o(),n(g,null,C(N,t=>s("option",{key:t.label,value:t.value},"Active: "+m(t.label),9,$e)),64))],512),[[T,d.value.is_active]]),s("div",Ue,[s("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:e[5]||(e[5]=t=>x({page:1}))},"Apply"),s("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:e[6]||(e[6]=t=>x({q:"",role:"",is_active:"",page:1},!0))},"Reset")])])]),b(fe,{columns:z,data:P.value,loading:c(r).isLoading,onQueryChange:W},{"cell-is_active":h(({value:t})=>[b(be,{text:t?"Active":"Inactive",tone:O(t)},null,8,["text","tone"])]),"cell-actions":h(({row:t})=>[s("button",{class:"px-2 py-1 text-[12px] rounded bg-gray-100 hover:bg-gray-200 inline-flex items-center gap-1",onClick:l=>j(t)},[(o(),n("svg",Re,[s("path",{d:c(me)},null,8,Be)])),e[11]||(e[11]=L(" Manage ",-1))],8,Le)]),_:1},8,["data","loading"])])):(o(),n("div",he," This page is only available to administrators. "))]),_:1})]),_:1}),R.value?(o(),n("div",Ve,[s("div",Ee,[s("div",qe,[s("h2",Fe,"Manage Membership — @"+m(_.value?.username),1),s("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:e[7]||(e[7]=t=>R.value=!1)},"Close")]),s("div",Ne,[e[14]||(e[14]=s("div",{class:"text-sm font-medium mb-2"},"Add to a Club",-1)),s("div",Pe,[w(s("select",{"onUpdate:modelValue":e[8]||(e[8]=t=>S.value=t),class:"border rounded px-2.5 py-2 min-w-[260px]",disabled:i.value||!V.value.length},[e[12]||(e[12]=s("option",{value:"",disabled:""},"Select a club…",-1)),(o(!0),n(g,null,C(V.value,t=>(o(),n("option",{key:t.id,value:t.id},m(t.name),9,ze))),128))],8,Oe),[[T,S.value]]),s("button",{class:"px-3 py-2 bg-blue-600 text-white rounded text-xs disabled:opacity-50",disabled:!S.value||i.value,onClick:G},[(o(),n("svg",je,[s("path",{d:c(ne)},null,8,Ke)])),e[13]||(e[13]=L(" Add ",-1))],8,We)]),V.value.length?E("",!0):(o(),n("div",Qe,"No more clubs available to add."))]),s("div",De,[e[18]||(e[18]=s("div",{class:"text-sm font-medium mb-2"},"Current Clubs",-1)),i.value?(o(),n("div",Ye,"Loading…")):k.value.length?(o(),n("ul",He,[(o(!0),n(g,null,C(k.value,t=>(o(),n("li",{key:t.id,class:"rounded border px-2 py-2 bg-gray-50"},[s("div",Je,[s("div",Xe,[s("div",Ze,m(t.name),1),s("div",Ie,"@"+m(t.code||""),1)]),s("div",et,[e[16]||(e[16]=s("div",{class:"text-xs text-gray-600"},"Role",-1)),w(s("select",{"onUpdate:modelValue":l=>t.membership.role=l,class:"border rounded px-2 py-1 text-sm",disabled:i.value||y.value[t.id],onChange:l=>J(t.id)},[(o(),n(g,null,C(D,l=>s("option",{key:l,value:l},m(l),9,st)),64))],40,tt),[[T,t.membership.role]]),e[17]||(e[17]=s("div",{class:"text-xs text-gray-600 ml-2"},"Status",-1)),w(s("select",{"onUpdate:modelValue":l=>t.membership.status=l,class:"border rounded px-2 py-1 text-sm",disabled:i.value||y.value[t.id],onChange:l=>X(t.id)},[(o(),n(g,null,C(Y,l=>s("option",{key:l,value:l},m(l),9,lt)),64))],40,at),[[T,t.membership.status]]),s("button",{class:"px-2 py-1 text-[12px] rounded bg-rose-100 hover:bg-rose-200 inline-flex items-center gap-1",onClick:l=>H(t.id)},[(o(),n("svg",nt,[s("path",{d:c(ce)},null,8,it)])),e[15]||(e[15]=L(" Remove ",-1))],8,ot)])])]))),128))])):(o(),n("div",Ge,"This user is not a member of any club."))])])])):E("",!0),b(xe,{ref_key:"toast",ref:A},null,512)],64))}};export{_t as default};
