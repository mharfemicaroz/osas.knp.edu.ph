import{r as I,o as V,c as A,z as $,l as v,q as o,f as b,d as g,e as n,g as i,k as y,t as w,a as m,h as S,L as N,v as W,B as M,F as K,A as Q,S as _}from"./index.DuRiRdF7.js";import{_ as Y,a as J,J as O,L as G,M as H,a5 as X,Q as Z,a3 as ee,z as te}from"./SectionMain.DFGdWOnK.js";import{_ as ae,a as se,b as ne,B as ie,c as L}from"./Badge.CPwJVr5g.js";import{u as le}from"./annualPlan.D7OJ0rR6.js";import{u as oe}from"./activityDesign.B5Zav7Jq.js";import{u as re}from"./utilizationRequest.BDjvy760.js";import{u as ce}from"./liquidationFund.Bu3QKrDG.js";import"./ToasterComponent.BjE6fu-S.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const de={class:"flex items-center gap-2"},ue={class:"p-3 mb-4 rounded-xl border bg-white/60"},pe={class:"flex items-center gap-2 mb-2 text-gray-700"},fe={class:"w-4 h-4",viewBox:"0 0 24 24"},me=["d"],ve={class:"grid grid-cols-1 md:grid-cols-6 gap-2 text-sm"},be={class:"md:col-span-3 flex items-center gap-2 flex-wrap"},ye=["checked","onChange"],_e={class:"text-xs"},ge={class:"flex items-center gap-2 md:col-span-2"},he={class:"flex items-center gap-1"},ke=["onClick"],xe={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},we=["d"],Ce=["onClick"],Ae={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},$e=["d"],Se=["onClick"],Le={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},De=["d"],Re=["onClick"],Be={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},Pe=["d"],We={__name:"WorkFlowsPage",setup(Ue){const c=le(),d=oe(),u=re(),p=ce(),D=[{key:"AP",label:"Annual Plan"},{key:"AD",label:"Activity Design"},{key:"UR",label:"Utilization"},{key:"LF",label:"Liquidation"}],l=I({page:1,limit:10,q:"",status:"",types:new Set(["AP","AD","UR","LF"])}),R=t=>{const a=l.value.types;a.has(t)?a.delete(t):a.add(t)},f=async(t=!0)=>{const a={limit:300,officer:"true"},{q:s,status:r}=l.value,e=(x={})=>({...a,...s?{q:s}:{},...r?{status:r}:{},...x});await Promise.allSettled([c.fetchAll(e({order:"DESC",sort:"approved_at"}),t),d.fetchAll(e({order:"DESC",sort:"created_at"}),t),u.fetchAll(e({order:"DESC",sort:"start_at"}),t),p.fetchAll(e({order:"DESC",sort:"created_at"}),t)])};V(async()=>{await f(!0)});const h=A(()=>{const t=[];if(l.value.types.has("AP"))for(const e of c.items.data||[])t.push({id:e.id,type:"AP",reference:e.reference_code||`AP-${e.id}`,title:e.school_year?`Annual Plan SY ${e.school_year}`:"Annual Plan",club:e.club?.name||"",date:e.approved_at||e.submitted_at||e.created_at,status:e.status||"",raw:e});if(l.value.types.has("AD"))for(const e of d.items.data||[])t.push({id:e.id,type:"AD",reference:e.reference_code||`AD-${e.id}`,title:e.name_of_activity||"Activity",club:e.club?.name||"",date:e.date_of_implementation||e.created_at,status:e.status||"",raw:e});if(l.value.types.has("UR"))for(const e of u.items.data||[])t.push({id:e.id,type:"UR",reference:e.reference_code||`UR-${e.id}`,title:e.activity_design?.name_of_activity?`Utilization • ${e.activity_design.name_of_activity}`:"Utilization",club:e.activity_design?.club?.name||"",date:e.start_at||e.created_at,status:e.status||"",raw:e});if(l.value.types.has("LF"))for(const e of p.items.data||[])t.push({id:e.id,type:"LF",reference:e.reference_code||`LF-${e.id}`,title:e.purpose||"Liquidation",club:e.activity_design?.club?.name||e.club?.name||"",date:e.date_filed||e.created_at,status:e.status||"",raw:e});const a=(l.value.q||"").trim().toLowerCase();let s=t;a&&(s=s.filter(e=>`${e.reference} ${e.title} ${e.club}`.toLowerCase().includes(a)));const r=(l.value.status||"").trim().toLowerCase();return r&&(s=s.filter(e=>String(e.status||"").toLowerCase()===r)),s.sort((e,x)=>new Date(x.date||0)-new Date(e.date||0))}),B=A(()=>({total:h.value.length,totalPages:1,currentPage:1,pageSize:h.value.length,data:h.value})),P={draft:"gray",pending:"amber",approved:"emerald",rejected:"red",cancelled:"zinc",completed:"indigo"},U=t=>P[String(t||"").toLowerCase()]||"gray",C=t=>String(t?.status||"").toLowerCase()==="pending",F=t=>String(t?.status||"").toLowerCase()==="approved";async function k(t,a){const s=await _.fire({title:t,input:"text",inputLabel:"Remarks (optional)",inputPlaceholder:"Enter remarks...",showCancelButton:!0,confirmButtonText:a||"Confirm",cancelButtonText:"Cancel"});return s.isConfirmed?s.value||"":null}async function T(t){const a=await k(`Approve ${t.type}-${t.reference}?`,"Approve");if(a!==null){switch(t.type){case"AP":await c.approve(t.id,a);break;case"AD":await d.approve(t.id,a);break;case"UR":await u.approve(t.id,a);break;case"LF":await p.approve(t.id,a);break}await f(!0),await _.fire("Approved","Item has been approved.","success")}}async function j(t){const a=await k(`Reject ${t.type}-${t.reference}?`,"Reject");if(a!==null){switch(t.type){case"AP":await c.reject(t.id,a);break;case"AD":await d.reject(t.id,a);break;case"UR":await u.reject(t.id,a);break;case"LF":await p.reject(t.id,a);break}await f(!0),await _.fire("Rejected","Item has been rejected.","success")}}async function q(t){const a=await k(`Cancel ${t.type}-${t.reference}?`,"Cancel");if(a!==null){switch(t.type){case"AP":await c.cancel(t.id,a);break;case"AD":await d.cancel(t.id,a);break;case"UR":await u.cancel(t.id,a);break;case"LF":await p.cancel(t.id,a);break}await f(!0),await _.fire("Cancelled","Item has been cancelled.","success")}}async function z(t){if((await _.fire({title:`Delete ${t.type}-${t.reference}?`,text:"This cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33"})).isConfirmed){switch(t.type){case"AP":await c.deleteById(t.id);break;case"AD":await d.deleteById(t.id);break;case"UR":await u.deleteById(t.id);break;case"LF":await p.deleteById(t.id);break}await f(!0),await _.fire("Deleted","Item removed.","success")}}const E=[{key:"type",label:"Type",sortable:!1,width:110},{key:"reference",label:"Reference",sortable:!0,width:140},{key:"title",label:"Title",sortable:!1,minWidth:240},{key:"club",label:"Club",sortable:!1,minWidth:160},{key:"date",label:"Date",sortable:!0,width:140},{key:"status",label:"Status",sortable:!0,width:120}];return(t,a)=>(o(),$(Y,null,{default:v(()=>[b(J,null,{default:v(()=>[i(c).error||i(d).error||i(u).error||i(p).error?(o(),$(ae,{key:0,color:"danger"},{default:v(()=>[y(w(i(c).error||i(d).error||i(u).error||i(p).error),1)]),_:1})):g("",!0),b(se,{icon:i(O),title:"Workflows",main:""},{default:v(()=>[n("div",de,[b(ne,{icon:i(G),color:"info",label:"Refresh",onClick:a[0]||(a[0]=s=>f(!0))},null,8,["icon"])])]),_:1},8,["icon"]),n("div",ue,[n("div",pe,[(o(),m("svg",fe,[n("path",{d:i(H)},null,8,me)])),a[6]||(a[6]=n("span",{class:"font-medium text-sm"},"Filters",-1))]),n("div",ve,[S(n("input",{"onUpdate:modelValue":a[1]||(a[1]=s=>l.value.q=s),placeholder:"Search title, ref, club…",class:"border rounded px-2 py-2 md:col-span-2",onKeyup:a[2]||(a[2]=N(s=>f(),["enter"]))},null,544),[[W,l.value.q]]),S(n("select",{"onUpdate:modelValue":a[3]||(a[3]=s=>l.value.status=s),class:"border rounded px-2 py-2"},a[7]||(a[7]=[n("option",{value:""},"All status",-1),n("option",{value:"draft"},"draft",-1),n("option",{value:"pending"},"pending",-1),n("option",{value:"approved"},"approved",-1),n("option",{value:"rejected"},"rejected",-1),n("option",{value:"cancelled"},"cancelled",-1),n("option",{value:"completed"},"completed",-1)]),512),[[M,l.value.status]]),n("div",be,[(o(),m(K,null,Q(D,s=>n("label",{key:s.key,class:"inline-flex items-center gap-2 px-2 py-1 rounded-full bg-gray-100"},[n("input",{type:"checkbox",checked:l.value.types.has(s.key),onChange:r=>R(s.key)},null,40,ye),n("span",_e,w(s.label),1)])),64))]),n("div",ge,[n("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:a[4]||(a[4]=s=>f())},"Apply"),n("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:a[5]||(a[5]=s=>(l.value.q="",l.value.status="",l.value.types=new Set(["AP","AD","UR","LF"]),f(!0)))},"Reset")])])]),b(ie,{columns:E,data:B.value,loading:i(c).isLoading||i(d).isLoading||i(u).isLoading||i(p).isLoading},{"cell-type":v(({value:s})=>[b(L,{text:s,tone:"indigo"},null,8,["text"])]),"cell-date":v(({value:s})=>[y(w(s?new Date(s).toLocaleDateString():"—"),1)]),"cell-status":v(({value:s})=>[b(L,{text:s||"—",tone:U(s)},null,8,["text","tone"])]),"cell-actions":v(({row:s})=>[n("div",he,[C(s)?(o(),m("button",{key:0,class:"px-2 py-1 text-[12px] rounded bg-emerald-100 hover:bg-emerald-200 inline-flex items-center gap-1",onClick:r=>T(s),title:"Approve"},[(o(),m("svg",xe,[n("path",{d:i(X)},null,8,we)])),a[8]||(a[8]=y(" Approve ",-1))],8,ke)):g("",!0),C(s)?(o(),m("button",{key:1,class:"px-2 py-1 text-[12px] rounded bg-amber-100 hover:bg-amber-200 inline-flex items-center gap-1",onClick:r=>j(s),title:"Reject"},[(o(),m("svg",Ae,[n("path",{d:i(Z)},null,8,$e)])),a[9]||(a[9]=y(" Reject ",-1))],8,Ce)):g("",!0),F(s)?(o(),m("button",{key:2,class:"px-2 py-1 text-[12px] rounded bg-zinc-100 hover:bg-zinc-200 inline-flex items-center gap-1",onClick:r=>q(s),title:"Cancel"},[(o(),m("svg",Le,[n("path",{d:i(ee)},null,8,De)])),a[10]||(a[10]=y(" Cancel ",-1))],8,Se)):g("",!0),n("button",{class:"px-2 py-1 text-[12px] rounded bg-rose-100 hover:bg-rose-200 inline-flex items-center gap-1",onClick:r=>z(s),title:"Delete"},[(o(),m("svg",Be,[n("path",{d:i(te)},null,8,Pe)])),a[11]||(a[11]=y(" Delete ",-1))],8,Re)])]),_:1},8,["data","loading"])]),_:1})]),_:1}))}};export{We as default};
