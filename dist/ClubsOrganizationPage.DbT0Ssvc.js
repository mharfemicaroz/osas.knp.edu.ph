import{c as J,r as D,E as ee,a as p,d as j,q as m,e,t as b,h as K,k as N,v as Q,C as ue,b as Fe,g as P,z as ze,F as H,B as Z,S as oe,H as Ne,I as We,o as xe,G as je,J as Ge,K as Ke,L as ke,n as Se,j as re,f as F,u as Je,l as de,A as Ve}from"./index.BoABrvm7.js";import{u as Ye,v as He,w as qe,x as Xe,y as Qe,z as Me,A as Ze,B as et,C as tt,D as nt,E as lt,F as ot,G as at,H as st,I as it,_ as rt,a as ut,g as dt,J as ct,K as mt}from"./SectionMain.fMhQq8Wq.js";import{_ as ve,a as vt,b as ft,c as De,B as pt,d as Ee}from"./IconifyButton.Du8mikII.js";import{u as ye}from"./club.CSizmTH7.js";import{u as bt}from"./clubDoc.CLHnzEKO.js";import"./ToasterComponent.CMTvAW6n.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const gt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},xt={class:"bg-white p-4 rounded-xl shadow-xl w-[920px] max-h-screen overflow-auto"},yt={class:"flex items-center justify-between mb-3"},ht={class:"text-lg font-semibold"},wt={class:"grid grid-cols-2 gap-4 text-sm"},Ct={key:0,class:"text-red-600 text-xs mt-1"},_t={key:0,class:"text-red-600 text-xs mt-1"},$t={class:"col-span-2"},kt={class:"col-span-2 grid grid-cols-2 gap-4"},St={class:"space-y-2"},Vt={class:"border-2 border-dashed rounded-xl p-4 flex items-center justify-between gap-3"},Dt={class:"flex items-center gap-3"},Et={class:"w-16 h-16 bg-gray-50 border rounded-lg overflow-hidden flex items-center justify-center"},Ut=["src"],At={key:1,class:"text-xs text-gray-400"},Bt={class:"flex items-center gap-2"},It={class:"px-3 py-2 bg-gray-800 text-white rounded cursor-pointer text-xs"},Lt=["disabled"],Ot={key:0,class:"text-red-600 text-xs mt-1"},jt={key:1,class:"text-xs text-gray-500 break-all"},Mt={class:"space-y-2"},Pt={class:"border-2 border-dashed rounded-xl p-4 flex items-center justify-between gap-3"},Tt={class:"flex items-center gap-3"},Rt={class:"w-40 h-16 bg-gray-50 border rounded-lg overflow-hidden flex items-center justify-center"},Ft=["src"],zt={key:1,class:"text-xs text-gray-400"},Nt={class:"flex items-center gap-2"},Wt={class:"px-3 py-2 bg-gray-800 text-white rounded cursor-pointer text-xs"},Gt=["disabled"],Kt={key:0,class:"text-red-600 text-xs mt-1"},Jt={key:1,class:"text-xs text-gray-500 break-all"},Yt={class:"flex justify-end gap-2 mt-5"},Ht=2*1024*1024,Ue={__name:"ClubFormModal",props:{modelValue:{type:Boolean,default:!1},mode:{type:String,default:"create"},initial:{type:Object,default:()=>({id:null,name:"",code:"",category:"",description:"",is_active:!0,established_at:"",website:"",email:"",phone:"",logo:"",banner:""})}},emits:["update:modelValue","submit"],setup(n,{emit:g}){const o=n,k=g,c=J({get:()=>o.modelValue,set:r=>k("update:modelValue",r)}),S="http://localhost:3000",l=D({...o.initial}),a=D({});ee(()=>o.initial,r=>{l.value={...r},a.value={}},{immediate:!0});const v=J(()=>o.mode==="edit"?"Edit Club":"Add New Club"),y=J(()=>o.mode==="edit"?"Save Changes":"Create"),L=J(()=>{const r=l.value.logo;return r?r.startsWith("data:")?r:`${S}${r}`:""}),R=J(()=>{const r=l.value.banner;return r?r.startsWith("data:")?r:`${S}${r}`:""}),B=()=>{const r={};return l.value.name?.trim()||(r.name="Name is required"),l.value.code?.trim()||(r.code="Code is required"),a.value={...a.value,...r},Object.keys(r).length===0},E=["image/png","image/jpeg"],Y=r=>new Promise((s,O)=>{const te=new FileReader;te.onload=q=>s(q.target.result),te.onerror=O,te.readAsDataURL(r)});function T(r,s){return a.value[s]="",E.includes(r.type)?r.size>Ht?(a.value[s]="File too large. Maximum size is 2 MB.",!1):!0:(a.value[s]="Invalid file type. Please upload a PNG or JPEG image.",!1)}const W=async r=>{const s=r.target.files?.[0];if(s){if(!T(s,"logo")){r.target.value="";return}l.value.logo=await Y(s)}},z=async r=>{const s=r.target.files?.[0];if(s){if(!T(s,"banner")){r.target.value="";return}l.value.banner=await Y(s)}},M=()=>{l.value.logo="",a.value.logo=""},$=()=>{l.value.banner="",a.value.banner=""},w=()=>{if(!B())return;const r={...l.value};Object.keys(r).forEach(s=>{r[s]===""&&(r[s]=null)}),k("submit",r)};return(r,s)=>c.value?(m(),p("div",gt,[e("div",xt,[e("div",yt,[e("h2",ht,b(v.value),1),e("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:s[0]||(s[0]=O=>c.value=!1)},"Close")]),e("div",wt,[e("div",null,[s[11]||(s[11]=e("label",{class:"block mb-1"},[N("Name "),e("span",{class:"text-red-500"},"*")],-1)),K(e("input",{"onUpdate:modelValue":s[1]||(s[1]=O=>l.value.name=O),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring",placeholder:"e.g. Math Society"},null,512),[[Q,l.value.name]]),a.value.name?(m(),p("p",Ct,b(a.value.name),1)):j("",!0)]),e("div",null,[s[12]||(s[12]=e("label",{class:"block mb-1"},[N("Code "),e("span",{class:"text-red-500"},"*")],-1)),K(e("input",{"onUpdate:modelValue":s[2]||(s[2]=O=>l.value.code=O),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring",placeholder:"e.g. MATHSOC"},null,512),[[Q,l.value.code]]),a.value.code?(m(),p("p",_t,b(a.value.code),1)):j("",!0)]),e("div",null,[s[14]||(s[14]=e("label",{class:"block mb-1"},"Category",-1)),K(e("select",{"onUpdate:modelValue":s[3]||(s[3]=O=>l.value.category=O),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring"},s[13]||(s[13]=[Fe('<option disabled value="">Select a category</option><option value="Academic">Academic</option><option value="Cultural">Cultural</option><option value="Athletics">Athletics</option><option value="Social">Social</option><option value="Community Service">Community Service</option><option value="Religious/Spiritual">Religious / Spiritual</option><option value="Environmental">Environmental</option><option value="Leadership">Leadership</option><option value="Others">Others</option>',10)]),512),[[ue,l.value.category]])]),e("div",null,[s[16]||(s[16]=e("label",{class:"block mb-1"},"Active?",-1)),K(e("select",{"onUpdate:modelValue":s[4]||(s[4]=O=>l.value.is_active=O),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring"},s[15]||(s[15]=[e("option",{value:!0},"Yes",-1),e("option",{value:!1},"No",-1)]),512),[[ue,l.value.is_active]])]),e("div",$t,[s[17]||(s[17]=e("label",{class:"block mb-1"},"Description",-1)),K(e("textarea",{"onUpdate:modelValue":s[5]||(s[5]=O=>l.value.description=O),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring",rows:"3"},null,512),[[Q,l.value.description]])]),e("div",null,[s[18]||(s[18]=e("label",{class:"block mb-1"},"Established At",-1)),K(e("input",{"onUpdate:modelValue":s[6]||(s[6]=O=>l.value.established_at=O),type:"date",class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring"},null,512),[[Q,l.value.established_at]])]),e("div",null,[s[19]||(s[19]=e("label",{class:"block mb-1"},"Website",-1)),K(e("input",{"onUpdate:modelValue":s[7]||(s[7]=O=>l.value.website=O),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring",placeholder:"https://…"},null,512),[[Q,l.value.website]])]),e("div",null,[s[20]||(s[20]=e("label",{class:"block mb-1"},"Email",-1)),K(e("input",{"onUpdate:modelValue":s[8]||(s[8]=O=>l.value.email=O),type:"email",class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring",placeholder:"club@example.com"},null,512),[[Q,l.value.email]])]),e("div",null,[s[21]||(s[21]=e("label",{class:"block mb-1"},"Phone",-1)),K(e("input",{"onUpdate:modelValue":s[9]||(s[9]=O=>l.value.phone=O),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring",placeholder:"+63…"},null,512),[[Q,l.value.phone]])]),e("div",kt,[e("div",St,[s[24]||(s[24]=e("label",{class:"block"},"Logo",-1)),e("div",Vt,[e("div",Dt,[e("div",Et,[L.value?(m(),p("img",{key:0,src:L.value,alt:"Logo",class:"w-full h-full object-contain"},null,8,Ut)):(m(),p("span",At,"No logo"))]),s[22]||(s[22]=e("div",{class:"text-xs text-gray-500"},[e("p",{class:"font-medium text-gray-700"},"PNG/JPEG • ≤ 2MB"),e("p",null,"Square works best")],-1))]),e("div",Bt,[e("label",It,[s[23]||(s[23]=N(" Change ",-1)),e("input",{type:"file",class:"hidden",accept:"image/png,image/jpeg",onChange:W},null,32)]),e("button",{class:"px-3 py-2 bg-gray-200 rounded text-xs",onClick:M,disabled:!l.value.logo},"Remove",8,Lt)])]),a.value.logo?(m(),p("p",Ot,b(a.value.logo),1)):j("",!0),l.value.logo&&!l.value.logo.startsWith("data:")?(m(),p("p",jt,b(P(S)+l.value.logo),1)):j("",!0)]),e("div",Mt,[s[27]||(s[27]=e("label",{class:"block"},"Banner",-1)),e("div",Pt,[e("div",Tt,[e("div",Rt,[R.value?(m(),p("img",{key:0,src:R.value,alt:"Banner",class:"w-full h-full object-contain"},null,8,Ft)):(m(),p("span",zt,"No banner"))]),s[25]||(s[25]=e("div",{class:"text-xs text-gray-500"},[e("p",{class:"font-medium text-gray-700"},"PNG/JPEG • ≤ 2MB"),e("p",null,"Wide 5:1 recommended")],-1))]),e("div",Nt,[e("label",Wt,[s[26]||(s[26]=N(" Change ",-1)),e("input",{type:"file",class:"hidden",accept:"image/png,image/jpeg",onChange:z},null,32)]),e("button",{class:"px-3 py-2 bg-gray-200 rounded text-xs",onClick:$,disabled:!l.value.banner},"Remove",8,Gt)])]),a.value.banner?(m(),p("p",Kt,b(a.value.banner),1)):j("",!0),l.value.banner&&!l.value.banner.startsWith("data:")?(m(),p("p",Jt,b(P(S)+l.value.banner),1)):j("",!0)])])]),e("div",Yt,[e("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:s[10]||(s[10]=O=>c.value=!1)},"Cancel"),e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:w},b(y.value),1)])])])):j("",!0)}},qt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},Xt={class:"bg-white p-4 rounded shadow-lg w-[860px] max-h-screen overflow-auto"},Qt={class:"flex items-center justify-between"},Zt={class:"text-lg font-semibold"},en={class:"text-gray-600"},tn={class:"mt-3 flex flex-col gap-2"},nn={class:"flex items-center gap-2"},ln=["value"],on={class:"text-[12px] text-gray-600"},an={class:"mt-4"},sn={class:"relative"},rn={key:0,class:"absolute z-10 mt-1 w-full bg-white border rounded shadow max-h-64 overflow-auto"},un={key:0,class:"px-3 py-2 text-xs text-gray-500"},dn=["onClick"],cn={class:"font-medium"},mn={class:"text-gray-500"},vn={class:"text-xs text-gray-500"},fn={key:0,class:"px-3 py-2 text-xs text-gray-500"},pn={key:0,class:"flex flex-wrap gap-2 mt-2"},bn=["onClick"],gn={class:"flex justify-end mt-2"},xn=["disabled"],yn={class:"space-y-2 mt-4 max-h-[60vh] overflow-y-auto pr-2 -mr-2"},hn={class:"text-sm"},wn={class:"font-semibold"},Cn={class:"text-gray-500 text-xs"},_n={class:"text-gray-600 text-xs"},$n={class:"mt-1 text-xs flex flex-wrap items-center gap-3"},kn=["disabled","value","onChange"],Sn=["value"],Vn=["disabled","value","onChange"],Dn=["value"],En={key:0,class:"text-[11px] text-gray-500"},Un=["onClick"],An={class:"flex justify-between items-center mt-3 text-xs text-gray-600"},fe=10,Bn={__name:"ClubMembersModal",props:{modelValue:{type:Boolean,default:!1},clubId:{type:[Number,String],required:!0},clubName:{type:String,default:""}},emits:["update:modelValue"],setup(n,{emit:g}){const o=n,k=g,c=ye(),S=ze(),l=J({get:()=>o.modelValue,set:d=>k("update:modelValue",d)}),a=D([]),v=D(1),y=D(""),L=D("all"),R=D("all"),B=["president","vice-president","secretary","treasurer","pio","business manager","bod","officer"],E=new Set([...B,"officer"]),Y=[...B,"member"],T=["pending","active","inactive"],W=d=>(d??"member").toString().trim().toLowerCase()||"member",z=d=>{const i=W(d);if(i==="member")return 999;const u=B.indexOf(i);return u===-1?B.indexOf("officer"):u},M=d=>E.has(W(d?.UserClub?.role)),$=d=>{const i=(d??"active").toString().trim().toLowerCase();return T.includes(i)?i:"active"},w=d=>{const i=W(d?.UserClub?.role);return i==="member"?"member":Y.includes(i)?i:"officer"},r=(d,i)=>{if(!i)return!0;const u=`${d.first_name||""} ${d.last_name||""}`.toLowerCase(),A=(d.username||"").toLowerCase(),ie=(d.email||"").toLowerCase();return u.includes(i)||A.includes(i)||ie.includes(i)},s=J(()=>{const d=y.value.trim().toLowerCase();let i=a.value||[];return L.value==="officers"?i=i.filter(M):L.value==="members"&&(i=i.filter(u=>!M(u))),R.value!=="all"&&(i=i.filter(u=>$(u?.UserClub?.status)===R.value)),d&&(i=i.filter(u=>r(u,d))),i.slice().sort((u,A)=>{const ie=z(u.UserClub?.role),he=z(A.UserClub?.role);if(ie!==he)return ie-he;const we=(u.last_name||"").toLowerCase(),Ce=(A.last_name||"").toLowerCase();if(we!==Ce)return we.localeCompare(Ce);const _e=(u.first_name||"").toLowerCase(),$e=(A.first_name||"").toLowerCase();return _e!==$e?_e.localeCompare($e):(u.username||"").toLowerCase().localeCompare((A.username||"").toLowerCase())})}),O=J(()=>(a.value||[]).filter(M).length),te=J(()=>(a.value||[]).filter(d=>!M(d)).length),q=J(()=>{const d=s.value.length,i=Math.ceil(Math.max(d,1)/fe),u=Math.min(v.value,i||1),A=(u-1)*fe,ie=s.value.slice(A,A+fe);return{total:d,totalPages:i,currentPage:u,pageSize:fe,data:ie}});ee([y,L,R],()=>v.value=1);const I=async()=>{await c.fetchById(o.clubId),a.value=Array.isArray(c.selectedClub?.users)?c.selectedClub.users:[],y.value="",L.value="all",R.value="all",v.value=1},V=D(""),U=D([]),ae=D(!1),_=D([]);let C=null;const f=d=>{const i={};return d&&(d.includes("@")?i.email=d:i.username=d,i.is_active=!0),i},t=d=>{const i=new Set((a.value||[]).map(A=>A.id)),u=new Set((_.value||[]).map(A=>A.id));return(d||[]).filter(A=>!i.has(A.id)&&!u.has(A.id))},h=async()=>{const d=V.value.trim();if(!d){U.value=[];return}ae.value=!0;try{await S.fetchAll({page:1,limit:8,filters:f(d)},!0),U.value=t(S.users.data||[])}finally{ae.value=!1}};ee(V,d=>{if(clearTimeout(C),!d?.trim()){U.value=[];return}C=setTimeout(h,250)});const x=d=>{_.value.push(d),U.value=U.value.filter(i=>i.id!==d.id),V.value=""},G=d=>{_.value=_.value.filter(i=>i.id!==d)},le=async()=>{if(!_.value.length)return;const d=_.value.map(i=>i.id);await c.addUsersToClub(o.clubId,d),a.value=Array.isArray(c.selectedClub?.users)?c.selectedClub.users:[],_.value=[],U.value=[],V.value="",v.value=1},X=D(new Set),se=D(new Set),me=async(d,i)=>{const u=$(i),A=$(d.UserClub?.status);if(A!==u){X.value.add(d.id),d.UserClub||(d.UserClub={}),d.UserClub.status=u;try{await c.updateMemberStatus(o.clubId,d.id,u)}catch{d.UserClub.status=A,oe.fire("Update failed",c.error||"Unable to update status","error")}finally{X.value.delete(d.id)}}},Te=async(d,i)=>{const u=W(i),A=W(d.UserClub?.role);if(A!==u){se.value.add(d.id),d.UserClub||(d.UserClub={}),d.UserClub.role=u;try{await c.updateMemberRole(o.clubId,d.id,u)}catch{d.UserClub.role=A,oe.fire("Update failed",c.error||"Unable to update role","error")}finally{se.value.delete(d.id)}}},Re=async d=>{await c.removeUserFromClub(o.clubId,d),a.value=a.value.filter(i=>i.id!==d),V.value.trim()&&U.value.length&&(U.value=t(U.value))};return ee(()=>o.modelValue,d=>{d&&I()},{immediate:!1}),(d,i)=>l.value?(m(),p("div",qt,[e("div",Xt,[e("div",Qt,[e("h2",Zt,[i[7]||(i[7]=N("Club Members — ",-1)),e("span",en,b(n.clubName),1)]),e("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:i[0]||(i[0]=u=>l.value=!1)},"Close")]),e("div",tn,[e("div",nn,[K(e("select",{"onUpdate:modelValue":i[1]||(i[1]=u=>L.value=u),class:"border rounded px-2 py-1 text-sm"},i[8]||(i[8]=[e("option",{value:"all"},"All roles",-1),e("option",{value:"officers"},"Officers",-1),e("option",{value:"members"},"Members",-1)]),512),[[ue,L.value]]),K(e("select",{"onUpdate:modelValue":i[2]||(i[2]=u=>R.value=u),class:"border rounded px-2 py-1 text-sm"},[i[9]||(i[9]=e("option",{value:"all"},"All statuses",-1)),(m(),p(H,null,Z(T,u=>e("option",{key:u,value:u},b(u),9,ln)),64))],512),[[ue,R.value]]),K(e("input",{"onUpdate:modelValue":i[3]||(i[3]=u=>y.value=u),type:"text",placeholder:"Search club members by name, username, or email…",class:"border rounded px-2 py-1 text-sm w-full"},null,512),[[Q,y.value]])]),e("div",on," Showing "+b(q.value.total)+" result(s). Officers: "+b(O.value)+" • Members: "+b(te.value),1)]),e("div",an,[e("div",sn,[K(e("input",{"onUpdate:modelValue":i[4]||(i[4]=u=>V.value=u),type:"text",placeholder:"Add users: search by username or email…",class:"border rounded px-2 py-1 text-sm w-full",autocomplete:"off"},null,512),[[Q,V.value]]),V.value&&(U.value.length||ae.value)?(m(),p("div",rn,[ae.value?(m(),p("div",un,"Searching…")):(m(),p(H,{key:1},[(m(!0),p(H,null,Z(U.value,u=>(m(),p("button",{key:u.id,class:"w-full text-left px-3 py-2 hover:bg-gray-100 text-sm",onClick:A=>x(u)},[e("div",cn,[N(b(u.first_name)+" "+b(u.last_name)+" ",1),e("span",mn,"@"+b(u.username),1)]),e("div",vn,b(u.email),1)],8,dn))),128)),U.value.length?j("",!0):(m(),p("div",fn,"No matches"))],64))])):j("",!0)]),_.value.length?(m(),p("div",pn,[(m(!0),p(H,null,Z(_.value,u=>(m(),p("span",{key:u.id,class:"inline-flex items-center gap-2 px-2 py-1 bg-blue-50 border border-blue-200 rounded text-xs"},[N(b(u.first_name)+" "+b(u.last_name)+" (@"+b(u.username)+") ",1),e("button",{class:"ml-1 text-blue-600",onClick:A=>G(u.id)},"✕",8,bn)]))),128))])):j("",!0),e("div",gn,[e("button",{class:"px-3 py-1 bg-blue-600 text-white rounded text-xs disabled:opacity-50",disabled:!_.value.length,onClick:le}," Add Selected ",8,xn)])]),e("div",yn,[(m(!0),p(H,null,Z(q.value.data,u=>(m(),p("div",{key:u.id,class:"flex items-start justify-between p-3 border bg-gray-50 rounded"},[e("div",hn,[e("div",wn,[N(b(u.first_name)+" "+b(u.last_name)+" ",1),e("span",Cn,"(@"+b(u.username)+")",1)]),e("div",_n,b(u.email),1),e("div",$n,[e("span",null,[i[10]||(i[10]=N("Role: ",-1)),e("select",{class:"border rounded px-1 py-0.5 text-xs",disabled:se.value.has(u.id),value:w(u),onChange:A=>Te(u,A.target.value)},[(m(),p(H,null,Z(Y,A=>e("option",{key:A,value:A},b(A),9,Sn)),64))],40,kn)]),e("span",null,[i[11]||(i[11]=N("Status: ",-1)),e("select",{class:"border rounded px-1 py-0.5 text-xs",disabled:X.value.has(u.id),value:$(u.UserClub?.status),onChange:A=>me(u,A.target.value)},[(m(),p(H,null,Z(T,A=>e("option",{key:A,value:A},b(A),9,Dn)),64))],40,Vn)]),e("span",null,[i[12]||(i[12]=N("Joined: ",-1)),e("strong",null,b(u.UserClub?.joined_at?new Date(u.UserClub.joined_at).toLocaleDateString():"—"),1)]),se.value.has(u.id)||X.value.has(u.id)?(m(),p("span",En,"Saving…")):j("",!0)])]),e("div",null,[e("button",{class:"px-2 py-1 bg-red-600 text-white rounded text-xs",onClick:A=>Re(u.id)},"Remove",8,Un)])]))),128))]),e("div",An,[v.value>1?(m(),p("button",{key:0,onClick:i[5]||(i[5]=u=>v.value=v.value-1),class:"px-3 py-1 bg-gray-300 rounded"},"Previous")):j("",!0),e("div",null,"Page "+b(q.value.currentPage)+" of "+b(q.value.totalPages||1),1),v.value<q.value.totalPages?(m(),p("button",{key:1,onClick:i[6]||(i[6]=u=>v.value=v.value+1),class:"px-3 py-1 bg-gray-300 rounded"},"Next")):j("",!0)])])])):j("",!0)}};var In=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCommentChange","onCompositionEnd","onCompositionStart","onCompositionUpdate","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onInput","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],Ln=function(n){return In.map(function(g){return g.toLowerCase()}).indexOf(n.toLowerCase())!==-1},On=function(n,g,o){Object.keys(g).filter(Ln).forEach(function(k){var c=g[k];typeof c=="function"&&(k==="onInit"?c(n,o):o.on(k.substring(2),function(S){return c(S,o)}))})},jn=function(n,g,o,k){var c=n.modelEvents?n.modelEvents:null,S=Array.isArray(c)?c.join(" "):c;ee(k,function(l,a){o&&typeof l=="string"&&l!==a&&l!==o.getContent({format:n.outputFormat})&&o.setContent(l)}),o.on(S||"change input undo redo",function(){g.emit("update:modelValue",o.getContent({format:n.outputFormat}))})},Mn=function(n,g,o,k,c,S){k.setContent(S()),o.attrs["onUpdate:modelValue"]&&jn(g,o,k,c),On(n,o.attrs,k)},Ae=0,Pe=function(n){var g=Date.now(),o=Math.floor(Math.random()*1e9);return Ae++,n+"_"+o+Ae+String(g)},Pn=function(n){return n!==null&&n.tagName.toLowerCase()==="textarea"},Be=function(n){return typeof n>"u"||n===""?[]:Array.isArray(n)?n:n.split(" ")},Tn=function(n,g){return Be(n).concat(Be(g))},Rn=function(n){return n==null},Ie=function(n){var g;return typeof((g=n.options)===null||g===void 0?void 0:g.set)=="function"&&n.options.isRegistered("disabled")},Le=function(){return{listeners:[],scriptId:Pe("tiny-script"),scriptLoaded:!1}},Fn=function(){var n=Le(),g=function(c,S,l,a){var v=S.createElement("script");v.referrerPolicy="origin",v.type="application/javascript",v.id=c,v.src=l;var y=function(){v.removeEventListener("load",y),a()};v.addEventListener("load",y),S.head&&S.head.appendChild(v)},o=function(c,S,l){n.scriptLoaded?l():(n.listeners.push(l),c.getElementById(n.scriptId)||g(n.scriptId,c,S,function(){n.listeners.forEach(function(a){return a()}),n.scriptLoaded=!0}))},k=function(){n=Le()};return{load:o,reinitialize:k}},zn=Fn(),Nn=function(){return typeof window<"u"?window:global},ce=function(){var n=Nn();return n&&n.tinymce?n.tinymce:null},Wn={apiKey:String,licenseKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,readonly:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(n){return n==="html"||n==="text"}}},ne=function(){return ne=Object.assign||function(n){for(var g,o=1,k=arguments.length;o<k;o++){g=arguments[o];for(var c in g)Object.prototype.hasOwnProperty.call(g,c)&&(n[c]=g[c])}return n},ne.apply(this,arguments)},Gn=function(n,g,o,k){return n(k||"div",{id:g,ref:o})},Kn=function(n,g,o){return n("textarea",{id:g,visibility:"hidden",ref:o})},be={selector:void 0,target:void 0},ge=function(n,g){var o;typeof((o=n.mode)===null||o===void 0?void 0:o.set)=="function"?n.mode.set(g):n.setMode(g)},Jn=Ne({props:Wn,setup:function(n,g){var o=n.init?ne(ne({},n.init),be):ne({},be),k=We(n),c=k.disabled,S=k.readonly,l=k.modelValue,a=k.tagName,v=D(null),y=null,L=n.id||Pe("tiny-vue"),R=n.init&&n.init.inline||n.inline,B=!!g.attrs["onUpdate:modelValue"],E=!0,Y=n.initialValue?n.initialValue:"",T="",W=function($){return B?function(){return l?.value?l.value:""}:function(){return $?Y:T}},z=function(){var $=W(E),w=ne(ne({},o),{disabled:n.disabled,readonly:n.readonly,target:v.value,plugins:Tn(o.plugins,n.plugins),toolbar:n.toolbar||o.toolbar,inline:R,license_key:n.licenseKey,setup:function(r){y=r,!Ie(y)&&n.disabled===!0&&ge(y,"readonly"),r.on("init",function(s){return Mn(s,n,g,r,l,$)}),typeof o.setup=="function"&&o.setup(r)}});Pn(v.value)&&(v.value.style.visibility=""),ce().init(w),E=!1};ee(S,function($){y!==null&&ge(y,$?"readonly":"design")}),ee(c,function($){y!==null&&(Ie(y)?y.options.set("disabled",$):ge(y,$?"readonly":"design"))}),ee(a,function($){var w;y&&(B||(T=y.getContent()),(w=ce())===null||w===void 0||w.remove(y),Se(function(){return z()}))}),xe(function(){if(ce()!==null)z();else if(v.value&&v.value.ownerDocument){var $=n.cloudChannel?n.cloudChannel:"8",w=n.apiKey?n.apiKey:"no-api-key",r=Rn(n.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(w,"/tinymce/").concat($,"/tinymce.min.js"):n.tinymceScriptSrc;zn.load(v.value.ownerDocument,r,z)}}),je(function(){ce()!==null&&ce().remove(y)}),R||(Ge(function(){E||z()}),Ke(function(){var $;y&&(B||(T=y.getContent()),($=ce())===null||$===void 0||$.remove(y))}));var M=function($){var w;y&&(T=y.getContent(),(w=ce())===null||w===void 0||w.remove(y),o=ne(ne(ne({},o),$),be),Se(function(){return z()}))};return g.expose({rerender:M,getEditor:function(){return y}}),function(){return R?Gn(ke,L,v,n.tagName):Kn(ke,L,v)}}});function Yn(){const n=D(null),g=D(!1);return{editorRef:n,isFullscreen:g,onInit:(l,a)=>{n.value=a},toggleFullscreen:()=>{n.value&&(n.value.execCommand("mceFullScreen"),g.value=!g.value)},ensureExitFullscreen:()=>{g.value&&n.value&&(n.value.execCommand("mceFullScreen"),g.value=!1)},tinymceInit:{menubar:!1,height:320,plugins:"lists link image table code paste fullscreen",toolbar:"undo redo | blocks | bold italic underline strikethrough | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | removeformat | code | fullscreen",paste_data_images:!0,image_dimensions:!0,image_caption:!0,object_resizing:"img",branding:!1,content_style:"body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; font-size:14px}",automatic_uploads:!1,file_picker_types:"image",file_picker_callback:l=>{const a=document.createElement("input");a.type="file",a.accept="image/*",a.onchange=()=>{const v=a.files?.[0];if(!v)return;const y=new FileReader;y.onload=()=>l(y.result),y.readAsDataURL(v)},a.click()}}}}const Hn={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},qn={class:"bg-white p-4 rounded shadow-lg w-[1024px] max-h-screen overflow-auto"},Xn={class:"flex items-center justify-between mb-2"},Qn={class:"text-lg font-semibold"},Zn={class:"flex items-center gap-2"},el={class:"bg-white w-full max-w-[1024px] max-h-screen rounded-2xl shadow-lg flex flex-col"},tl={class:"p-5 flex-1 overflow-auto"},nl={class:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"},ll=["aria-invalid"],ol=["value"],al={key:0,class:"text-red-600 text-xs mt-1"},sl=["aria-invalid"],il=["value"],rl={key:0,class:"text-red-600 text-xs mt-1"},ul={class:"md:col-span-2"},dl=["aria-invalid"],cl={key:0,class:"text-red-600 text-xs mt-1"},ml={class:"md:col-span-2"},vl={key:0,class:"text-red-600 text-xs mt-1"},fl={class:"md:col-span-2"},pl={class:"border-t p-4 bg-white flex items-center justify-end gap-2"},Oe={__name:"DocFormModal",props:{modelValue:{type:Boolean,default:!1},mode:{type:String,default:"create"},initial:{type:Object,default:()=>({id:null,type:"cbl",title:"",content:"",status:"draft",doc_date:""})}},emits:["update:modelValue","submit","closed"],setup(n,{emit:g}){const o=["draft","published","archived"],k=["cbl","resolution","minute"],c=n,S=g,l=J({get:()=>c.modelValue,set:$=>S("update:modelValue",$)}),{isFullscreen:a,onInit:v,toggleFullscreen:y,ensureExitFullscreen:L,tinymceInit:R}=Yn(),B=D({...c.initial}),E=D({});ee(()=>c.initial,$=>{B.value={...$},E.value={}},{immediate:!0});const Y=J(()=>c.mode==="edit"?"Edit Document":"Add Document"),T=J(()=>c.mode==="edit"?"Save Changes":"Create"),W=()=>{const $={};return B.value.type||($.type="Type is required"),B.value.title?.trim()||($.title="Title is required"),B.value.content?.trim()||($.content="Content is required"),B.value.status&&!o.includes(B.value.status)&&($.status="Invalid status"),E.value=$,Object.keys($).length===0},z=()=>{if(!W())return;const $={...B.value,doc_date:B.value.doc_date||null};S("submit",$)},M=()=>{L(),l.value=!1,S("closed")};return($,w)=>l.value?(m(),p("div",Hn,[e("div",qn,[e("div",Xn,[e("h2",Qn,b(Y.value),1),e("div",Zn,[e("button",{class:"px-3 py-1 text-xs bg-indigo-600 text-white rounded",onClick:w[0]||(w[0]=(...r)=>P(y)&&P(y)(...r))},b(P(a)?"Restore":"Maximize"),1),e("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:M},"Close")])]),e("div",el,[e("div",tl,[e("div",nl,[e("div",null,[w[6]||(w[6]=e("label",{class:"block mb-1 font-medium text-gray-700"},[N("Type "),e("span",{class:"text-red-500"},"*")],-1)),K(e("select",{"onUpdate:modelValue":w[1]||(w[1]=r=>B.value.type=r),"aria-invalid":!!E.value.type,class:re(["w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",E.value.type?"border-red-500":"border-gray-300"])},[(m(),p(H,null,Z(k,r=>e("option",{key:r,value:r},b(r),9,ol)),64))],10,ll),[[ue,B.value.type]]),E.value.type?(m(),p("p",al,b(E.value.type),1)):j("",!0)]),e("div",null,[w[7]||(w[7]=e("label",{class:"block mb-1 font-medium text-gray-700"},"Status",-1)),K(e("select",{"onUpdate:modelValue":w[2]||(w[2]=r=>B.value.status=r),"aria-invalid":!!E.value.status,class:re(["w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",E.value.status?"border-red-500":"border-gray-300"])},[(m(),p(H,null,Z(["draft","published","archived"],r=>e("option",{key:r,value:r},b(r),9,il)),64))],10,sl),[[ue,B.value.status]]),E.value.status?(m(),p("p",rl,b(E.value.status),1)):j("",!0)]),e("div",ul,[w[8]||(w[8]=e("label",{class:"block mb-1 font-medium text-gray-700"},[N("Title "),e("span",{class:"text-red-500"},"*")],-1)),K(e("input",{"onUpdate:modelValue":w[3]||(w[3]=r=>B.value.title=r),"aria-invalid":!!E.value.title,placeholder:"Document title",class:re(["w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",E.value.title?"border-red-500":"border-gray-300"])},null,10,dl),[[Q,B.value.title]]),E.value.title?(m(),p("p",cl,b(E.value.title),1)):j("",!0)]),e("div",ml,[w[9]||(w[9]=e("label",{class:"block mb-1 font-medium text-gray-700"},[N("Content "),e("span",{class:"text-red-500"},"*")],-1)),e("div",{class:re(["rounded-lg border",E.value.content?"border-red-500":"border-gray-300"])},[F(P(Jn),{modelValue:B.value.content,"onUpdate:modelValue":w[4]||(w[4]=r=>B.value.content=r),init:P(R),onInit:P(v),"tinymce-script-src":"/tinymce/tinymce.min.js",licenseKey:"gpl"},null,8,["modelValue","init","onInit"])],2),E.value.content?(m(),p("p",vl,b(E.value.content),1)):j("",!0)]),e("div",fl,[w[10]||(w[10]=e("label",{class:"block mb-1 font-medium text-gray-700"},"Document Date",-1)),K(e("input",{"onUpdate:modelValue":w[5]||(w[5]=r=>B.value.doc_date=r),type:"date",class:"w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 border-gray-300"},null,512),[[Q,B.value.doc_date]])])])]),e("div",pl,[e("button",{type:"button",class:"px-4 py-2 rounded-lg text-xs border border-gray-300 hover:bg-gray-100 transition",onClick:M}," Cancel "),e("button",{type:"button",class:re(["px-4 py-2 rounded-lg text-xs",c.mode==="edit"?"bg-emerald-600 text-white hover:bg-emerald-700":"bg-blue-600 text-white hover:bg-blue-700"]),onClick:z},b(T.value),3)])])])])):j("",!0)}},bl={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},gl={class:"bg-white p-4 rounded shadow-lg w-[900px] max-h-screen overflow-auto"},xl={class:"flex items-center justify-between"},yl={class:"text-lg font-semibold"},hl={class:"text-gray-600"},wl={class:"flex items-center gap-2"},Cl={class:"mt-3 flex flex-col gap-2"},_l={class:"flex items-center gap-2"},$l=["value"],kl=["value"],Sl={class:"text-[12px] text-gray-600"},Vl={class:"space-y-2 mt-4 max-h-[60vh] overflow-y-auto pr-2 -mr-2"},Dl={class:"text-sm"},El={class:"flex flex-wrap items-center gap-2"},Ul={class:"font-semibold"},Al={class:"px-2 py-[2px] text-[11px] rounded bg-indigo-100 text-indigo-700 uppercase"},Bl={class:"text-xs text-gray-600"},Il={class:"shrink-0 flex items-center gap-2"},Ll=["onClick"],Ol=["onClick"],jl={class:"flex justify-between items-center mt-3 text-xs text-gray-600"},pe=10,Ml={__name:"ClubDocsModal",props:{modelValue:{type:Boolean,default:!1},clubId:{type:[Number,String],required:!0},clubName:{type:String,default:""}},emits:["update:modelValue"],setup(n,{emit:g}){const o=n,k=g,c=bt(),S=J({get:()=>o.modelValue,set:_=>k("update:modelValue",_)}),l=D([]),a=D(1),v=D(""),y=D("all"),L=D("all"),R=["cbl","resolution","minute"],B=["draft","published","archived"],E=["cbl","resolution","minute"],Y=_=>E.includes((_||"").toLowerCase())?(_||"").toLowerCase():"cbl",T=_=>{const C=Y(_),f=R.indexOf(C);return f===-1?999:f},W=(_,C)=>{if(!C)return!0;const f=(_.title||"").toLowerCase(),t=(_.content||"").toLowerCase();return f.includes(C)||t.includes(C)},z=J(()=>{const _=v.value.trim().toLowerCase();let C=l.value||[];return y.value!=="all"&&(C=C.filter(f=>(f.type||"").toLowerCase()===y.value)),L.value!=="all"&&(C=C.filter(f=>(f.status||"").toLowerCase()===L.value)),_&&(C=C.filter(f=>W(f,_))),C.slice().sort((f,t)=>{const h=T(f.type),x=T(t.type);if(h!==x)return h-x;const G=f.doc_date||f.created_at,le=t.doc_date||t.created_at,X=G?new Date(G).getTime():0;return(le?new Date(le).getTime():0)-X})}),M=J(()=>{const _=z.value.length,C=Math.ceil(Math.max(_,1)/pe),f=Math.min(a.value,C||1),t=(f-1)*pe,h=z.value.slice(t,t+pe);return{total:_,totalPages:C,currentPage:f,pageSize:pe,data:h}});ee([v,y,L],()=>a.value=1);const $=async()=>{v.value="",y.value="all",L.value="all",a.value=1,await c.fetchByClub(o.clubId,{page:1,limit:200}),l.value=Array.isArray(c.docs?.data)?c.docs.data:[]},w=D(!1),r=D(!1),s=D(null),O=()=>{w.value=!0},te=async _=>{const C=await c.create({..._,club_id:o.clubId});l.value.unshift(C),w.value=!1},q=()=>{},I=_=>{s.value={id:_.id,type:_.type||"cbl",title:_.title||"",content:_.content||"",status:_.status||"draft",doc_date:_.doc_date?String(_.doc_date).slice(0,10):""},r.value=!0},V=async _=>{const{id:C,...f}=_,t=await c.updateById(C,{...f}),h=l.value.findIndex(x=>x.id===C);h!==-1&&(l.value[h]=t),r.value=!1},U=()=>{},ae=async _=>{(await oe.fire({title:`Delete document "${_.title}"?`,text:"This cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it",cancelButtonText:"Cancel"})).isConfirmed&&(await c.deleteById(_.id),l.value=l.value.filter(f=>f.id!==_.id),await oe.fire("Deleted!","The document has been deleted.","success"))};return ee(()=>o.modelValue,_=>{_&&$()},{immediate:!1}),(_,C)=>S.value?(m(),p("div",bl,[e("div",gl,[e("div",xl,[e("h2",yl,[C[8]||(C[8]=N("Club Documents — ",-1)),e("span",hl,b(n.clubName),1)]),e("div",wl,[e("button",{class:"px-3 py-1 text-xs bg-blue-600 text-white rounded",onClick:O},"+ Add Document"),e("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:C[0]||(C[0]=f=>S.value=!1)},"Close")])]),e("div",Cl,[e("div",_l,[K(e("select",{"onUpdate:modelValue":C[1]||(C[1]=f=>y.value=f),class:"border rounded px-2 py-1 text-sm"},[C[9]||(C[9]=e("option",{value:"all"},"All types",-1)),(m(),p(H,null,Z(E,f=>e("option",{key:f,value:f},b(f),9,$l)),64))],512),[[ue,y.value]]),K(e("select",{"onUpdate:modelValue":C[2]||(C[2]=f=>L.value=f),class:"border rounded px-2 py-1 text-sm"},[C[10]||(C[10]=e("option",{value:"all"},"All statuses",-1)),(m(),p(H,null,Z(B,f=>e("option",{key:f,value:f},b(f),9,kl)),64))],512),[[ue,L.value]]),K(e("input",{"onUpdate:modelValue":C[3]||(C[3]=f=>v.value=f),type:"text",placeholder:"Search documents by title or content…",class:"border rounded px-2 py-1 text-sm w-full"},null,512),[[Q,v.value]])]),e("div",Sl," Showing "+b(M.value.total)+" document(s). Ordered by type → date. ",1)]),e("div",Vl,[(m(!0),p(H,null,Z(M.value.data,f=>(m(),p("div",{key:f.id,class:"border rounded p-3 bg-gray-50 flex items-start justify-between gap-4"},[e("div",Dl,[e("div",El,[e("span",Ul,b(f.title),1),e("span",Al,b(f.type),1),e("span",{class:re(["px-2 py-[2px] text-[11px] rounded",{"bg-yellow-100 text-yellow-700":f.status==="draft","bg-emerald-100 text-emerald-700":f.status==="published","bg-gray-200 text-gray-700":f.status==="archived"}])},b(f.status),3),e("span",Bl,b(f.doc_date?new Date(f.doc_date).toLocaleDateString():f.created_at?new Date(f.created_at).toLocaleDateString():"—"),1)])]),e("div",Il,[e("button",{class:"px-2 py-1 bg-amber-500 hover:bg-amber-600 text-white rounded text-xs",onClick:t=>I(f)},"Edit",8,Ll),e("button",{class:"px-2 py-1 bg-red-600 text-white rounded text-xs",onClick:t=>ae(f)},"Delete",8,Ol)])]))),128))]),e("div",jl,[a.value>1?(m(),p("button",{key:0,onClick:C[4]||(C[4]=f=>a.value=a.value-1),class:"px-3 py-1 bg-gray-300 rounded"},"Previous")):j("",!0),e("div",null,"Page "+b(M.value.currentPage)+" of "+b(M.value.totalPages||1),1),a.value<M.value.totalPages?(m(),p("button",{key:1,onClick:C[5]||(C[5]=f=>a.value=a.value+1),class:"px-3 py-1 bg-gray-300 rounded"},"Next")):j("",!0)])]),F(Oe,{modelValue:w.value,"onUpdate:modelValue":C[6]||(C[6]=f=>w.value=f),mode:"create",initial:{type:"cbl",title:"",content:"",status:"draft",doc_date:""},onSubmit:te,onClosed:q},null,8,["modelValue"]),F(Oe,{modelValue:r.value,"onUpdate:modelValue":C[7]||(C[7]=f=>r.value=f),mode:"edit",initial:s.value||{id:null,type:"cbl",title:"",content:"",status:"draft",doc_date:""},onSubmit:V,onClosed:U},null,8,["modelValue","initial"])])):j("",!0)}},Pl={class:"flex items-center gap-1 md:gap-2"},Tl=["aria-expanded"],Rl={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24","aria-hidden":"true"},Fl=["d"],zl={__name:"ClubRowActions",props:{row:{type:Object,required:!0}},emits:["members","docs","edit","delete","view","attachments"],setup(n,{emit:g}){const o=D(!1),k=D(null),c=D(null),S=l=>{if(!o.value)return;const a=k.value,v=c.value;a&&!a.contains(l.target)&&v&&!v.contains(l.target)&&(o.value=!1)};return xe(()=>{document.addEventListener("click",S)}),je(()=>{document.removeEventListener("click",S)}),(l,a)=>(m(),p("div",Pl,[F(ve,{"icon-path":P(Ye),color:"text-indigo-600",label:"Attachments",tooltip:"Attachments",size:"sm",onClick:a[0]||(a[0]=v=>l.$emit("attachments",n.row))},null,8,["icon-path"]),F(ve,{"icon-path":P(He),color:"text-gray-700",label:"View",tooltip:"View Club",size:"sm",onClick:a[1]||(a[1]=v=>l.$emit("view",n.row))},null,8,["icon-path"]),F(ve,{"icon-path":P(qe),color:"text-blue-600",label:"Members",tooltip:"View Members",size:"sm",onClick:a[2]||(a[2]=v=>l.$emit("members",n.row))},null,8,["icon-path"]),F(ve,{"icon-path":P(Xe),color:"text-indigo-600",label:"Docs",tooltip:"View Documents",size:"sm",onClick:a[3]||(a[3]=v=>l.$emit("docs",n.row))},null,8,["icon-path"]),F(ve,{"icon-path":P(Qe),color:"text-emerald-600",label:"Edit",tooltip:"Edit Club",size:"sm",onClick:a[4]||(a[4]=v=>l.$emit("edit",n.row))},null,8,["icon-path"]),F(ve,{"icon-path":P(Me),color:"text-red-600",label:"Delete",tooltip:"Delete Club",size:"sm",onClick:a[5]||(a[5]=v=>l.$emit("delete",n.row))},null,8,["icon-path"]),e("div",{class:"relative md:hidden",ref_key:"btnRef",ref:c},[e("button",{class:"inline-flex items-center justify-center rounded-xl p-1.5 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-1","aria-expanded":o.value,"aria-haspopup":"menu",title:"More",onClick:a[6]||(a[6]=v=>o.value=!o.value)},[(m(),p("svg",Rl,[e("path",{d:P(Ze)},null,8,Fl)]))],8,Tl),o.value?(m(),p("div",{key:0,ref_key:"menuRef",ref:k,role:"menu",class:"absolute right-0 z-20 mt-1 w-40 overflow-hidden rounded-xl border bg-white shadow-lg"},[e("button",{role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:a[7]||(a[7]=v=>{o.value=!1,l.$emit("attachments",n.row)})}," Attachments "),e("button",{role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:a[8]||(a[8]=v=>{o.value=!1,l.$emit("view",n.row)})}," View Club "),e("button",{role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:a[9]||(a[9]=v=>{o.value=!1,l.$emit("members",n.row)})}," View Members "),e("button",{role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:a[10]||(a[10]=v=>{o.value=!1,l.$emit("docs",n.row)})}," View Documents "),e("button",{role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:a[11]||(a[11]=v=>{o.value=!1,l.$emit("edit",n.row)})}," Edit Club "),e("button",{role:"menuitem",class:"w-full px-3 py-2 text-left text-sm text-red-600 hover:bg-red-50",onClick:a[12]||(a[12]=v=>{o.value=!1,l.$emit("delete",n.row)})}," Delete ")],512)):j("",!0)],512)]))}},Nl={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},Wl={class:"bg-white p-4 rounded-xl shadow-xl w-[980px] max-h-screen overflow-auto"},Gl={class:"flex items-center justify-between mb-3"},Kl={class:"text-lg font-semibold"},Jl={class:"text-gray-600"},Yl={class:"flex items-center justify-between gap-2"},Hl={class:"text-sm text-gray-600"},ql={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},Xl=["d"],Ql=["disabled"],Zl={class:"mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"},eo={class:"aspect-video bg-white border rounded overflow-hidden flex items-center justify-center"},to=["src"],no={key:1,class:"flex items-center justify-center w-full h-full"},lo=["d"],oo={class:"mt-2 text-xs"},ao=["title"],so={class:"text-gray-500 flex items-center justify-between"},io={key:0},ro={key:0},uo={class:"mt-2 flex items-center justify-between gap-2"},co=["onClick","title"],mo={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},vo=["d"],fo=["onClick"],po={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},bo=["d"],go={key:0,class:"mt-6 text-center text-sm text-gray-500"},xo=10*1024*1024,yo={__name:"ClubAttachmentsModal",props:{modelValue:{type:Boolean,default:!1},row:{type:Object,default:null}},emits:["update:modelValue"],setup(n,{emit:g}){const o=n,k=g,c=J({get:()=>o.modelValue,set:t=>k("update:modelValue",t)}),S=ye(),l=D(null),a=D(!1),v=new Set(["image/png","image/jpeg","image/webp","application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]),y=new Set(["png","jpg","jpeg","webp","pdf","docx","xlsx"]),L=(t="")=>{const h=String(t).toLowerCase().match(/\.([a-z0-9]+)$/i);return h?h[1]:""},R=(t="")=>{if(typeof t!="string")return"";const h=t.match(/^data:([^;]+);base64,/i);return h?h[1]:""},B=t=>{const h=t?.type&&v.has(t.type),x=t?.name&&y.has(L(t.name));return h||x},E=(t="")=>String(t).startsWith("image/"),Y=(t="")=>t==="application/pdf",T=(t="")=>t==="application/vnd.openxmlformats-officedocument.wordprocessingml.document",W=(t="")=>t==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",z=(t="")=>Y(t)?lt:T(t)?ot:W(t)?at:E(t)?st:it,M=(t="")=>Y(t)?"PDF":T(t)?"Word":W(t)?"Excel":E(t)?"Image":"File",$=(t="")=>Y(t)?"pdf":T(t)?"docx":W(t)?"xlsx":t==="image/png"?"png":t==="image/jpeg"?"jpg":t==="image/webp"?"webp":"",w=(t="attachment",h="")=>{const x=/\.[a-z0-9]+$/i.test(t),G=h?h.startsWith(".")?h.slice(1):h:"";return x?t:G?`${t}.${G}`:t},r=t=>!t&&t!==0?"":t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`,s=J(()=>{const t=l.value?.attachments;if(!t)return[];try{return Array.isArray(t)?t:JSON.parse(t||"[]")}catch{return[]}}),O=J(()=>(s.value||[]).map((t,h)=>{const x=t.mime||R(t.data)||(t.name?L(t.name)==="pdf"&&"application/pdf":"")||"",G=L(t.name||"")||$(x),le=t.size??null,X=t.name||`${M(x)} ${h+1}`;return{id:t.id??h+1,name:X,data:t.data||"",url:t.url||t.href||t.path||"",mime:x,ext:G,size:le,filename:w(X,G)}}));ee(()=>o.modelValue,async t=>{t&&o.row?.id&&(await S.fetchById(o.row.id),l.value=S.selectedClub||o.row)},{immediate:!1});const te=async t=>{const h=t.target.files?.[0];if(t.target.value="",!(!h||!l.value?.id)){if(h.size>xo){await oe.fire("File too large","Maximum size is 10 MB.","warning");return}if(!B(h)){await oe.fire("Unsupported file","Only images (PNG/JPEG/WEBP), PDF, DOCX, and XLSX are allowed.","warning");return}try{a.value=!0,await S.uploadAttachment(l.value.id,h),await S.fetchById(l.value.id),l.value=S.selectedClub}finally{a.value=!1}}},q=async t=>{!l.value?.id||!(await oe.fire({title:"Remove attachment?",icon:"warning",showCancelButton:!0,confirmButtonText:"Remove",confirmButtonColor:"#d33"})).isConfirmed||(await S.deleteAttachment(l.value.id,t),await S.fetchById(l.value.id),l.value=S.selectedClub)},I=t=>{if(t.data&&String(t.data).startsWith("data:")&&E(t.mime)){const h=window.open();h&&h.document.write(`<img src="${t.data}" style="display:block;max-width:100%;height:auto;margin:0 auto;object-fit:contain"/>`);return}t.url&&window.open(String(t.url),"_blank")},V=t=>{const[h,x]=t.split(","),G=h.match(/data:([^;]+);base64/i)?.[1]||"application/octet-stream",le=atob(x),X=le.length,se=new Uint8Array(X);for(let me=0;me<X;me++)se[me]=le.charCodeAt(me);return new Blob([se],{type:G})},U=(t,h)=>{const x=URL.createObjectURL(t),G=document.createElement("a");G.href=x,G.download=h||"download",document.body.appendChild(G),G.click(),G.remove(),setTimeout(()=>URL.revokeObjectURL(x),1e3)},ae=async t=>{if(t.data&&String(t.data).startsWith("data:")){const h=V(t.data);U(h,t.filename);return}if(t.url)try{const x=await(await fetch(t.url,{credentials:"include"})).blob();U(x,t.filename)}catch{const x=document.createElement("a");x.href=String(t.url),x.setAttribute("download",t.filename),document.body.appendChild(x),x.click(),x.remove()}},_=t=>E(t.mime)?"Open":"Download",C=t=>E(t.mime)?tt:nt,f=t=>E(t.mime)?I(t):ae(t);return(t,h)=>c.value?(m(),p("div",Nl,[e("div",Wl,[e("div",Gl,[e("h2",Kl,[h[1]||(h[1]=N(" Attachments — ",-1)),e("span",Jl,b(l.value?.name||""),1)]),e("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:h[0]||(h[0]=x=>c.value=!1)},"Close")]),e("div",Yl,[e("div",Hl,[h[2]||(h[2]=N(" Ref: ",-1)),e("strong",null,b(l.value?.code||"—"),1)]),e("label",{class:re(["inline-flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white rounded text-xs cursor-pointer disabled:opacity-60",{"opacity-60 pointer-events-none":a.value}])},[(m(),p("svg",ql,[e("path",{d:P(et)},null,8,Xl)])),e("span",null,b(a.value?"Uploading…":"Upload"),1),e("input",{type:"file",class:"hidden",disabled:a.value,onChange:te,accept:".png,.jpg,.jpeg,.webp,.pdf,.docx,.xlsx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,image/png,image/jpeg,image/webp"},null,40,Ql)],2)]),e("div",Zl,[(m(!0),p(H,null,Z(O.value,x=>(m(),p("div",{key:x.id,class:"border rounded-lg p-2 bg-gray-50 flex flex-col"},[e("div",eo,[E(x.mime)&&x.data&&x.data.startsWith("data:")?(m(),p("img",{key:0,src:x.data,class:"object-contain w-full h-full",alt:"Attachment preview"},null,8,to)):(m(),p("div",no,[(m(),p("svg",{style:{width:"64px",height:"64px"},viewBox:"0 0 24 24","aria-hidden":"true",class:re({"text-red-600":Y(x.mime),"text-blue-600":T(x.mime),"text-emerald-600":W(x.mime),"text-gray-500":!x.mime||!E(x.mime)&&!Y(x.mime)})},[e("path",{d:z(x.mime)},null,8,lo)],2))]))]),e("div",oo,[e("div",{class:"font-medium truncate",title:x.name},b(x.name),9,ao),e("div",so,[e("span",null,[N(b(M(x.mime))+" ",1),x.ext?(m(),p("span",io,"("+b(x.ext.toUpperCase())+")",1)):j("",!0)]),x.size?(m(),p("span",ro,b(r(x.size)),1)):j("",!0)])]),e("div",uo,[e("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-white border rounded text-xs hover:bg-gray-50",onClick:G=>f(x),title:_(x)},[(m(),p("svg",mo,[e("path",{d:C(x)},null,8,vo)])),N(" "+b(_(x)),1)],8,co),e("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-red-600 text-white rounded text-xs",onClick:G=>q(x.id),title:"Remove"},[(m(),p("svg",po,[e("path",{d:P(Me)},null,8,bo)])),h[3]||(h[3]=N(" Remove ",-1))],8,fo)])]))),128))]),O.value.length?j("",!0):(m(),p("div",go," No attachments yet. "))])])):j("",!0)}},ho={class:"flex items-center gap-2"},Do={__name:"ClubsOrganizationPage",setup(n){const g=Je(),o=ye(),k=D({page:1,limit:10}),c=async(I={},V=!0)=>{k.value={...k.value,...I},typeof k.value.officer>"u"&&(k.value.officer=!0),await o.fetchAll(k.value,V)};xe(()=>c({page:1,limit:10}));const S=J(()=>({total:o.clubs.total||0,totalPages:o.clubs.totalPages||1,currentPage:o.clubs.currentPage||1,pageSize:o.clubs.pageSize||10,data:o.clubs.data||[]})),l=D(!1),a=D(null),v=async I=>{await o.fetchById(I.id),a.value=o.selectedClub||I,l.value=!0},y=D(!1),L=D(!1),R=D(null),B=()=>{y.value=!0},E=async I=>{await o.create(I),y.value=!1,await c(k.value,!0)},Y=async I=>{await o.fetchById(I.id);const V=o.selectedClub||I;R.value={id:V.id,name:V.name||"",code:V.code||"",category:V.category||"",description:V.description||"",is_active:V.is_active??!0,established_at:V.established_at?String(V.established_at).slice(0,10):"",website:V.website||"",email:V.email||"",phone:V.phone||"",logo:V.logo||"",banner:V.banner||""},L.value=!0},T=async I=>{const{id:V,...U}=I;await o.updateById(V,U),L.value=!1,await c(k.value,!0)},W=async I=>{if(!I?.id)return;(await oe.fire({title:`Delete club "${I.name}"?`,text:"This cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it",cancelButtonText:"Cancel"})).isConfirmed&&(await o.deleteById(I.id),await c(k.value,!0),await oe.fire("Deleted!","The club has been deleted.","success"))},z=D(!1),M=D(!1),$=D(null),w=D(""),r=I=>{$.value=I.id,w.value=I.name||"",z.value=!0},s=I=>{$.value=I.id,w.value=I.name||"",M.value=!0},O=I=>{I?.id&&window.open(`/#/club/${I.id}`,"_self")},te=[{key:"name",label:"Name",sortable:!0,filterable:!0},{key:"code",label:"Code",sortable:!0,filterable:!0},{key:"category",label:"Category",sortable:!0,filterable:!0},{key:"is_active",label:"Active",sortable:!0,formatter:I=>I?"Yes":"No"}],q=async I=>{await c(I)};return(I,V)=>(m(),p(H,null,[F(rt,null,{default:de(()=>[F(ut,null,{default:de(()=>[P(o).error?(m(),Ve(vt,{key:0,icon:P(dt),color:"danger"},{default:de(()=>[N(b(P(o).error),1)]),_:1},8,["icon"])):j("",!0),F(ft,{icon:P(ct),title:"Clubs",main:""},{default:de(()=>[e("div",ho,[P(g).user.role==="admin"?(m(),Ve(De,{key:0,icon:P(mt),color:"primary",label:"Add Club",onClick:B},null,8,["icon"])):j("",!0),F(De,{color:"info",label:"Refresh",onClick:V[0]||(V[0]=U=>c({page:1,limit:S.value.pageSize}))})])]),_:1},8,["icon"]),F(pt,{columns:te,data:S.value,loading:P(o).isLoading,onQueryChange:q},{"cell-category":de(({value:U})=>[F(Ee,{text:U||"—",tone:"indigo"},null,8,["text"])]),"cell-is_active":de(({value:U})=>[F(Ee,{text:U?"Active":"Inactive",tone:U?"emerald":"gray"},null,8,["text","tone"])]),"cell-actions":de(({row:U})=>[F(zl,{row:U,onView:O,onMembers:r,onDocs:s,onEdit:Y,onDelete:W,onAttachments:v},null,8,["row"])]),_:1},8,["data","loading"])]),_:1})]),_:1}),F(Ue,{modelValue:y.value,"onUpdate:modelValue":V[1]||(V[1]=U=>y.value=U),mode:"create",onSubmit:E},null,8,["modelValue"]),F(Ue,{modelValue:L.value,"onUpdate:modelValue":V[2]||(V[2]=U=>L.value=U),mode:"edit",initial:R.value||{},onSubmit:T},null,8,["modelValue","initial"]),F(Bn,{modelValue:z.value,"onUpdate:modelValue":V[3]||(V[3]=U=>z.value=U),"club-id":$.value,"club-name":w.value},null,8,["modelValue","club-id","club-name"]),F(Ml,{modelValue:M.value,"onUpdate:modelValue":V[4]||(V[4]=U=>M.value=U),"club-id":$.value,"club-name":w.value},null,8,["modelValue","club-id","club-name"]),F(yo,{modelValue:l.value,"onUpdate:modelValue":V[5]||(V[5]=U=>l.value=U),row:a.value},null,8,["modelValue","row"])],64))}};export{Do as default};
