import{c as W,r as _,x as me,a as C,d as J,q as h,e as s,k as le,t as U,j as Se,g as E,F as ae,B as ie,S,o as pe,f as T,h as Y,v as X,C as ue,u as Je,z as He,l as q,s as Qe,p as Ke,A as Ce,M as Xe,Q as Ae}from"./index.w1fTWaRQ.js";import{E as Ze,a as D,d as xe,Q as ke,_ as et}from"./dayjs.min.C6Ah_atX.js";import{B as tt,E as at,F as lt,G as it,H as st,I as nt,C as ot,D as rt,z as dt,_ as ct,a as ut,g as mt,J as pt,i as ft,a7 as yt,K as gt,L as vt,M as bt,V as _t}from"./SectionMain.Co2y8BLV.js";import{_ as ht,a as ce}from"./SectionTitleLineWithButton.AVJG-kj_.js";import{_ as xt,B as wt,a as _e}from"./Badge.BfbdF7_K.js";import{_ as $e}from"./UtilizationRequestFormModal.C7ZM3_dm.js";import{u as fe}from"./utilizationRequest.DqqE8-G-.js";import{i as St,a as Ct,b as At,F as kt}from"./index.A6PdmpQc.js";import{Q as $t}from"./browser.CYIVxMbb.js";import{_ as Tt}from"./StatusTrailModal.Dq5INm-V.js";import{u as Et}from"./clubScope.C_EnuWrj.js";import"./IconifyButton.CaN1pAk4.js";import"./appContext.Db1VNKoe.js";import"./activityDesignService.DKPfTybd.js";import"./utilizationRequestService.BsNdNhg3.js";import"./liquidationFundService.n_EUG0wO.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";import"./ToasterComponent.C4X8owM8.js";import"./club.CZEs4jG_.js";import"./activityDesign.DQYQQrXQ.js";const Ft={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},Rt={class:"bg-white p-4 rounded-xl shadow-xl w-[980px] max-h-screen overflow-auto"},Bt={class:"flex items-center justify-between mb-3"},Vt={class:"text-lg font-semibold"},zt={class:"text-gray-600"},It={class:"flex items-center justify-between gap-2"},Ut={class:"text-sm text-gray-600"},Ot={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},Nt=["d"],Dt=["disabled"],Pt={class:"mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"},Lt={class:"aspect-video bg-white border rounded overflow-hidden flex items-center justify-center"},Mt=["src"],Yt={key:1,class:"flex items-center justify-center w-full h-full"},jt=["d"],qt={class:"mt-2 text-xs"},Wt=["title"],Gt={class:"text-gray-500 flex items-center justify-between"},Jt={key:0},Ht={key:0},Qt={class:"mt-2 flex items-center justify-between gap-2"},Kt=["onClick","title"],Xt={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},Zt=["d"],ea=["onClick"],ta={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},aa=["d"],la={key:0,class:"mt-6 text-center text-sm text-gray-500"},ia=10*1024*1024,sa={__name:"UtilizationAttachmentsModal",props:{modelValue:{type:Boolean,default:!1},row:{type:Object,default:null}},emits:["update:modelValue"],setup(t,{emit:l}){const x=t,d=l,b=W({get:()=>x.modelValue,set:i=>d("update:modelValue",i)}),c=fe(),r=_(null),v=_(!1),k=new Set(["image/png","image/jpeg","image/webp","application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]),F=new Set(["png","jpg","jpeg","webp","pdf","docx","xlsx"]),O=(i="")=>String(i).toLowerCase().match(/\.([a-z0-9]+)$/i)?.[1]||"",N=(i="")=>typeof i=="string"&&i.match(/^data:([^;]+);base64,/i)?.[1]||"",P=i=>{const m=i?.type&&k.has(i.type),u=i?.name&&F.has(O(i.name));return m||u},R=(i="")=>String(i).startsWith("image/"),p=(i="")=>i==="application/pdf",o=(i="")=>i==="application/vnd.openxmlformats-officedocument.wordprocessingml.document",f=(i="")=>i==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",A=(i="")=>p(i)?at:o(i)?lt:f(i)?it:R(i)?st:nt,I=(i="")=>p(i)?"PDF":o(i)?"Word":f(i)?"Excel":R(i)?"Image":"File",w=(i="")=>p(i)?"pdf":o(i)?"docx":f(i)?"xlsx":i==="image/png"?"png":i==="image/jpeg"?"jpg":i==="image/webp"?"webp":"",B=(i="attachment",m="")=>/\.[a-z0-9]+$/i.test(i)?i:m?`${i}.${m.startsWith(".")?m.slice(1):m}`:i,L=i=>i<1024?`${i} B`:i<1024*1024?`${(i/1024).toFixed(1)} KB`:`${(i/(1024*1024)).toFixed(1)} MB`,G=W(()=>{const i=r.value?.attachments;if(!i)return[];try{return Array.isArray(i)?i:JSON.parse(i||"[]")}catch{return[]}}),V=W(()=>(G.value||[]).map((i,m)=>{const u=i.mime||N(i.data)||(i.name?O(i.name)==="pdf"&&"application/pdf":"")||"",z=O(i.name||"")||w(u),Z=i.size??null,ee=i.name||`${I(u)} ${m+1}`;return{id:i.id??m+1,name:ee,data:i.data||"",url:i.url||i.href||i.path||"",mime:u,ext:z,size:Z,filename:B(ee,z)}}));me(()=>x.modelValue,async i=>{i&&x.row?.id&&(await c.fetchById(x.row.id),r.value=c.selected||x.row)},{immediate:!1});const y=async i=>{const m=i.target.files?.[0];if(i.target.value="",!(!m||!r.value?.id)){if(m.size>ia){await S.fire("File too large","Maximum size is 10 MB.","warning");return}if(!P(m)){await S.fire("Unsupported file","Only images (PNG/JPEG/WEBP), PDF, DOCX, and XLSX are allowed.","warning");return}try{v.value=!0,await c.uploadAttachment(r.value.id,m),await c.fetchById(r.value.id),r.value=c.selected}finally{v.value=!1}}},M=async i=>{!r.value?.id||!(await S.fire({title:"Remove attachment?",icon:"warning",showCancelButton:!0,confirmButtonText:"Remove",confirmButtonColor:"#d33"})).isConfirmed||(await c.deleteAttachment(r.value.id,i),await c.fetchById(r.value.id),r.value=c.selected)},H=i=>{if(i.data&&String(i.data).startsWith("data:")&&R(i.mime)){const m=window.open();m&&m.document.write(`<img src="${i.data}" style="display:block;max-width:100%;height:auto;margin:0 auto;object-fit:contain"/>`);return}i.url&&window.open(String(i.url),"_blank")},$=i=>{const[m,u]=i.split(","),z=m.match(/data:([^;]+);base64/i)?.[1]||"application/octet-stream",Z=atob(u),ee=Z.length,oe=new Uint8Array(ee);for(let K=0;K<ee;K++)oe[K]=Z.charCodeAt(K);return new Blob([oe],{type:z})},Q=(i,m)=>{const u=URL.createObjectURL(i),z=document.createElement("a");z.href=u,z.download=m||"download",document.body.appendChild(z),z.click(),z.remove(),setTimeout(()=>URL.revokeObjectURL(u),1e3)},ye=async i=>{if(i.data&&String(i.data).startsWith("data:")){const m=$(i.data);Q(m,i.filename);return}if(i.url)try{const u=await(await fetch(i.url,{credentials:"include"})).blob();Q(u,i.filename)}catch{const m=document.createElement("a");m.href=String(i.url),m.setAttribute("download",i.filename),document.body.appendChild(m),m.click(),m.remove()}},ne=i=>R(i.mime)?"Open":"Download",ge=i=>R(i.mime)?ot:rt,ve=i=>R(i.mime)?H(i):ye(i);return(i,m)=>b.value?(h(),C("div",Ft,[s("div",Rt,[s("div",Bt,[s("h2",Vt,[m[1]||(m[1]=le(" Utilization Attachments — ",-1)),s("span",zt,U(r.value?.reference_code||""),1)]),s("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:m[0]||(m[0]=u=>b.value=!1)},"Close")]),s("div",It,[s("div",Ut,[m[2]||(m[2]=le(" Activity: ",-1)),s("strong",null,U(r.value?.activity_design?.name_of_activity||"—"),1)]),s("label",{class:Se(["inline-flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white rounded text-xs cursor-pointer disabled:opacity-60",{"opacity-60 pointer-events-none":v.value}])},[(h(),C("svg",Ot,[s("path",{d:E(tt)},null,8,Nt)])),s("span",null,U(v.value?"Uploading…":"Upload"),1),s("input",{type:"file",class:"hidden",disabled:v.value,onChange:y,accept:".png,.jpg,.jpeg,.webp,.pdf,.docx,.xlsx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,image/png,image/jpeg,image/webp"},null,40,Dt)],2)]),s("div",Pt,[(h(!0),C(ae,null,ie(V.value,u=>(h(),C("div",{key:u.id,class:"border rounded-lg p-2 bg-gray-50 flex flex-col"},[s("div",Lt,[R(u.mime)&&u.data&&u.data.startsWith("data:")?(h(),C("img",{key:0,src:u.data,class:"object-contain w-full h-full",alt:"Attachment preview"},null,8,Mt)):(h(),C("div",Yt,[(h(),C("svg",{style:{width:"64px",height:"64px"},viewBox:"0 0 24 24","aria-hidden":"true",class:Se({"text-red-600":p(u.mime),"text-blue-600":o(u.mime),"text-emerald-600":f(u.mime),"text-gray-500":!u.mime||!R(u.mime)&&!p(u.mime)})},[s("path",{d:A(u.mime)},null,8,jt)],2))]))]),s("div",qt,[s("div",{class:"font-medium truncate",title:u.name},U(u.name),9,Wt),s("div",Gt,[s("span",null,[le(U(I(u.mime))+" ",1),u.ext?(h(),C("span",Jt,"("+U(u.ext.toUpperCase())+")",1)):J("",!0)]),u.size?(h(),C("span",Ht,U(L(u.size)),1)):J("",!0)])]),s("div",Qt,[s("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-white border rounded text-xs hover:bg-gray-50",onClick:z=>ve(u),title:ne(u)},[(h(),C("svg",Xt,[s("path",{d:ge(u)},null,8,Zt)])),le(" "+U(ne(u)),1)],8,Kt),s("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-red-600 text-white rounded text-xs",onClick:z=>M(u.id),title:"Remove"},[(h(),C("svg",ta,[s("path",{d:E(dt)},null,8,aa)])),m[3]||(m[3]=le(" Remove ",-1))],8,ea)])]))),128))]),V.value.length?J("",!0):(h(),C("div",la," No attachments yet. "))])])):J("",!0)}},na={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/35 backdrop-blur-sm"},oa={class:"bg-white rounded-2xl shadow-2xl w-full sm:w-[1200px] max-w-[100vw] sm:max-w-[95vw] h-[100vh] sm:h-auto sm:max-h-[90vh] overflow-hidden"},ra={class:"px-4 py-3 border-b flex items-center justify-between"},da={class:"p-2 overflow-auto"},ca={__name:"CalendarViewModal",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","open"],setup(t,{emit:l}){const x=t,d=l,b=W({get:()=>x.modelValue,set:p=>d("update:modelValue",p)}),c=fe(),r=_([]),v=(p,o=[])=>{if(Array.isArray(p))return p;try{return JSON.parse(p||"[]")||o}catch{return o}},k=(p=[])=>{r.value=p.map(o=>{const f=v(o.facilities),A=[];o.activity_design?.name_of_activity&&A.push(o.activity_design.name_of_activity),f.length&&A.push(f.join(", "));const I=A.join(" — ")||o.reference_code||"Utilization",w=o.start_date&&o.start_time&&`${o.start_date}T${o.start_time}:00`||o.start_at||null,B=o.end_date&&o.end_time&&`${o.end_date}T${o.end_time}:00`||o.end_at||null;return!w||!B?null:{id:String(o.id),title:I,start:w,end:B,backgroundColor:"#047857",borderColor:"#065f46",textColor:"#ffffff",extendedProps:{reference_code:o.reference_code,facilities:f,availability_status:o.availability_status,status:o.status}}}).filter(Boolean)},F=async()=>{await c.fetchAll({page:1,limit:500,status:"approved",order:"ASC",sort:"start_at"},!0),k(c.items.data||[])},O=p=>{const o=p?.event?.id;o&&d("open",Number(o))},N=_(!1),P=()=>{N.value=window.innerWidth<640};pe(()=>{P(),window.addEventListener("resize",P)});const R=W(()=>({plugins:[St,Ct,At],initialView:"dayGridMonth",headerToolbar:N.value?{left:"prev,next",center:"title",right:"dayGridMonth"}:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},height:"auto",handleWindowResize:!0,expandRows:!0,navLinks:!0,eventDisplay:"block",eventClick:O,events:r.value}));return me(()=>x.modelValue,p=>{p&&F()}),me(()=>c.items.data,p=>{b.value&&k(p||[])},{deep:!0}),pe(()=>{b.value&&F()}),(p,o)=>b.value?(h(),C("div",na,[s("div",oa,[s("div",ra,[o[1]||(o[1]=s("h2",{class:"text-base font-semibold"},"Utilization Calendar (Approved)",-1)),s("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:o[0]||(o[0]=f=>b.value=!1)},"Close")]),s("div",da,[T(E(kt),{options:R.value},null,8,["options"])]),o[2]||(o[2]=s("div",{class:"px-4 py-2 text-[11px] text-gray-500 border-t"}," Click an event to open it. ",-1))])])):J("",!0)}},ua={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},ma={class:"bg-white p-3 md:p-4 rounded-xl shadow-lg w-[560px] max-h-[85vh] overflow-y-auto"},pa={class:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm"},fa={class:"md:col-span-2"},ya=["value"],ga={__name:"QuickAvailabilityModal",props:{modelValue:{type:Boolean,default:!1},facilities:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(t,{emit:l}){const x=t,d=l,b=fe(),c=_(""),r=_("08:00"),v=_(""),k=_("10:00"),F=_([]),O=W(()=>(F.value||[]).filter(p=>x.facilities.includes(p))),N=()=>d("update:modelValue",!1),P=()=>{c.value="",r.value="08:00",v.value="",k.value="10:00",F.value=[]},R=async()=>{if(!c.value||!v.value||!O.value.length){await S.fire("Missing fields","Start/End dates and at least one facility are required.","info");return}try{const p=await b.checkAvailability({start_date:c.value,start_time:r.value||"00:00",end_date:v.value,end_time:k.value||"00:00",facilities:O.value}),o=p.available_for_all?"All selected facilities are available.":`Conflicts on: ${(p.conflict_facilities||[]).join(", ")||"—"}`;await S.fire({icon:p.available_for_all?"success":"warning",title:"Availability Result",html:`<div class="text-left text-sm">
        <div><strong>Facilities:</strong> ${(p.facilities||[]).join(", ")}</div>
        <div class="mt-2"><strong>Status:</strong> ${o}</div>
        <div class="mt-2"><strong>Conflicts:</strong> ${Array.isArray(p.conflicts)&&p.conflicts.length?`<ul class="list-disc ml-5">${p.conflicts.map(f=>`<li>${f.reference_code} — ${new Date(f.start_at).toLocaleString()} to ${new Date(f.end_at).toLocaleString()}</li>`).join("")}</ul>`:"None"}</div>
      </div>`})}catch(p){await S.fire("Error",b.error||"Failed to check availability.","error"),console.error(p)}};return(p,o)=>t.modelValue?(h(),C("div",ua,[s("div",ma,[s("div",{class:"flex items-center justify-between mb-2"},[o[5]||(o[5]=s("h3",{class:"text-base font-semibold"},"Quick Availability Check",-1)),s("button",{class:"px-2.5 py-1 text-[11px] bg-gray-200 rounded",onClick:N},"Close")]),s("div",pa,[s("div",null,[o[6]||(o[6]=s("label",{class:"block mb-0.5"},"Start Date",-1)),Y(s("input",{"onUpdate:modelValue":o[0]||(o[0]=f=>c.value=f),type:"date",class:"w-full border rounded px-2 py-1.5"},null,512),[[X,c.value]])]),s("div",null,[o[7]||(o[7]=s("label",{class:"block mb-0.5"},"Start Time",-1)),Y(s("input",{"onUpdate:modelValue":o[1]||(o[1]=f=>r.value=f),type:"time",class:"w-full border rounded px-2 py-1.5"},null,512),[[X,r.value]])]),s("div",null,[o[8]||(o[8]=s("label",{class:"block mb-0.5"},"End Date",-1)),Y(s("input",{"onUpdate:modelValue":o[2]||(o[2]=f=>v.value=f),type:"date",class:"w-full border rounded px-2 py-1.5"},null,512),[[X,v.value]])]),s("div",null,[o[9]||(o[9]=s("label",{class:"block mb-0.5"},"End Time",-1)),Y(s("input",{"onUpdate:modelValue":o[3]||(o[3]=f=>k.value=f),type:"time",class:"w-full border rounded px-2 py-1.5"},null,512),[[X,k.value]])]),s("div",fa,[o[10]||(o[10]=s("label",{class:"block mb-0.5"},"Facilities",-1)),Y(s("select",{"onUpdate:modelValue":o[4]||(o[4]=f=>F.value=f),multiple:"",class:"w-full border rounded px-2 py-1.5 min-h-[40px]"},[(h(!0),C(ae,null,ie(t.facilities,f=>(h(),C("option",{key:f,value:f},U(f),9,ya))),128))],512),[[ue,F.value]]),o[11]||(o[11]=s("p",{class:"text-[11px] text-gray-500 mt-0.5"},"Hold Ctrl/Cmd to select multiple.",-1))])]),s("div",{class:"flex justify-end gap-1.5 mt-4"},[s("button",{class:"px-3 py-1.5 bg-gray-200 rounded text-xs",onClick:P},"Reset"),s("button",{class:"px-3 py-1.5 bg-indigo-600 text-white rounded text-xs",onClick:R},"Check")])])])):J("",!0)}},va="KOLEHIYO NG PANTUKAN",ba="Juan A. Sarenas Campus, Kingking, Pantukan, Davao de Oro",_a="https://osas.knp.edu.ph/#/verify-utilization?id=",he=t=>t?xe(t).format("MMMM DD, YYYY"):"—",Te=t=>t?xe(t).format("MMM DD, YYYY, h:mm A"):"—",Ee=(t,l=0)=>t==null||t===""||Number.isNaN(Number(t))?"—":Number(t).toLocaleString(void 0,{minimumFractionDigits:l,maximumFractionDigits:l}),Fe=(t,l)=>{if(Array.isArray(t))return t;try{return JSON.parse(t||"null")??l}catch{return l}},Be="./",ha=`${Be}images/logo.png`,xa=`${Be}images/bg.jpg`;async function Re(t){const x=await(await fetch(t)).blob();return new Promise(d=>{const b=new FileReader;b.onloadend=()=>d(b.result),b.readAsDataURL(x)})}function wa(t){switch(t){case"APPROVED":return[32,141,85];case"PENDING":return[240,158,47];case"REJECTED":return[220,53,69];case"CANCELLED":return[107,114,128];case"COMPLETED":return[37,99,235];default:return[90,90,90]}}function Sa(t){switch(String(t||"").toUpperCase()){case"AVAILABLE":return[16,185,129];case"RESERVED":return[99,102,241];case"CONFLICT":return[239,68,68];case"MAINTENANCE":return[245,158,11];case"PENDING-CHECK":return[245,158,11];default:return[107,114,128]}}async function Ca(t){const l=t.internal.pageSize.getWidth(),x=110,d=15;try{const b=await Re(xa);t.addImage(b,"JPEG",0,0,l,x,void 0,"FAST")}catch{t.setFillColor(21,62,121),t.rect(0,0,l,x,"F")}t.setGState(new t.GState({opacity:.18})),t.setFillColor(0,0,0),t.rect(0,0,l,x,"F"),t.setGState(new t.GState({opacity:1}));try{const b=await Re(ha);t.addImage(b,"PNG",d,20,70,70,void 0,"FAST")}catch{}return t.setTextColor(255,255,255),t.setFont("helvetica","bold"),t.setFontSize(20),t.text(va,d+86,38),t.setFont("helvetica","normal"),t.setFontSize(10),t.text(ba,d+86,58),t.setTextColor(20),t.setFont("helvetica","bold"),t.setFontSize(14),t.text("UTILIZATION REQUEST",l/2,x+24,{align:"center"}),x+34}async function Aa(t,l,x){const d=t.internal.pageSize.getWidth(),b=15,c=l?.id??l?.reference_code??"",r=`${_a}${encodeURIComponent(String(c))}`,v=await $t.toDataURL(r,{margin:0,width:75,errorCorrectionLevel:"M",color:{dark:"#000000",light:"#FFFFFF"}}),k=String(l.status||"").toUpperCase(),[F,O,N]=wa(k),P=String(l.availability_status||"").toUpperCase(),[R,p,o]=Sa(P),f=l.approved_at?he(l.approved_at):l.date_filed?he(l.date_filed):"—",A=`osas.knp.edu.ph/#/verify-utilization?id=${String(c)}`;return D(t,{startY:x,theme:"plain",styles:{cellPadding:0,fontSize:9},bodyStyles:{minCellHeight:120},margin:{left:b,right:b},tableWidth:d-b*2,body:[[{content:""},{content:""}]],columnStyles:{0:{cellWidth:d-b*2-280},1:{cellWidth:280}},didDrawCell:I=>{if(I.section!=="body")return;const{x:w,y:B,width:L,height:G}=I.cell,V=10;if(I.column.index===0){t.setFillColor(255,255,255),t.roundedRect(w,B,L-1,G,6,6,"F");const y=24,M=Math.min(160,L-22);t.setFillColor(F,O,N),t.roundedRect(w+V,B+V,M,y,12,12,"F"),t.setTextColor(255,255,255),t.setFont("helvetica","bold"),t.setFontSize(10),t.text(k||"STATUS",w+V+10,B+V+16);const H=B+V+y+10,$=Math.min(160,L-22);t.setFillColor(R,p,o),t.roundedRect(w+V,H,$,y,12,12,"F"),t.setTextColor(255,255,255),t.text(P||"AVAILABILITY",w+V+10,H+16),t.setTextColor(20),t.setFont("helvetica","normal"),t.setFontSize(9);let Q=H+y+12;t.text(`Ref No.: ${l.reference_code||"—"}`,w+V,Q),Q+=16,t.text(`Date Issued: ${f}`,w+V,Q),t.setDrawColor(230),t.roundedRect(w,B,L-1,G,6,6,"S")}if(I.column.index===1){t.setFillColor(255,255,255),t.roundedRect(w,B,L-1,G,6,6,"F"),t.setFillColor(66,103,178),t.roundedRect(w,B,L-1,22,6,6,"F"),t.setTextColor(255,255,255),t.setFont("helvetica","bold"),t.setFontSize(10),t.text("VERIFY",w+V,B+15);const y=w+V,M=B+28;t.addImage(v,"PNG",y,M,75,75,void 0,"FAST"),t.setTextColor(20),t.setFont("helvetica","bold"),t.setFontSize(10),t.text("Scan to verify",y+100,M+14),t.setFont("helvetica","normal"),t.setFontSize(9),t.text("This document can be verified",y+100,M+32),t.text("online via the OSAS portal.",y+100,M+46),t.setTextColor(110),t.setFontSize(8),t.text(A,y+100,M+72),t.setDrawColor(230),t.roundedRect(w,B,L-1,G,6,6,"S")}}}),t.lastAutoTable.finalY}async function Ve(t){const l=new Ze({unit:"pt",format:[612,936],orientation:"portrait"}),x=l.internal.pageSize.getWidth(),d=36,b=Fe(t.facilities,[]),c=Fe(t.equipment_items,[]);let r=await Ca(l);r=await Aa(l,t,r)+10,D(l,{startY:r,theme:"plain",styles:{fontSize:10},body:[[{content:"LINKED ACTIVITY",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",halign:"left",valign:"middle",cellPadding:6}}]],margin:{left:d,right:d}}),r=l.lastAutoTable.finalY;const v=t.activity_design||{};D(l,{startY:r,theme:"grid",styles:{fontSize:9,cellPadding:6},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},body:[[{content:"NAME OF ACTIVITY",styles:{fillColor:[243,248,255],fontStyle:"bold"}},v.name_of_activity||"—"],[{content:"DATE OF IMPLEMENTATION",styles:{fillColor:[243,248,255],fontStyle:"bold"}},he(v.date_of_implementation)],[{content:"SEMESTER",styles:{fillColor:[243,248,255],fontStyle:"bold"}},v.semester||"—"],[{content:"SCHOOL YEAR",styles:{fillColor:[243,248,255],fontStyle:"bold"}},v.school_year||"—"],[{content:"OFFICE/DEPARTMENT",styles:{fillColor:[243,248,255],fontStyle:"bold"}},v.office_department||v?.club?.name||"—"]],columnStyles:{0:{cellWidth:200,fontStyle:"bold"},1:{cellWidth:"auto"}},margin:{left:d,right:d}}),r=l.lastAutoTable.finalY+10,D(l,{startY:r,theme:"plain",styles:{fontSize:10},body:[[{content:"SCHEDULE",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:d,right:d}}),r=l.lastAutoTable.finalY;const k=t.start_at||(t.start_date&&t.start_time?`${t.start_date}T${t.start_time}:00`:null),F=t.end_at||(t.end_date&&t.end_time?`${t.end_date}T${t.end_time}:00`:null);D(l,{startY:r,theme:"grid",styles:{fontSize:9,cellPadding:6},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},body:[[{content:"START",styles:{fillColor:[243,248,255],fontStyle:"bold"}},Te(k)],[{content:"END",styles:{fillColor:[243,248,255],fontStyle:"bold"}},Te(F)],[{content:"DURATION (mins)",styles:{fillColor:[243,248,255],fontStyle:"bold"}},Ee(t.duration_minutes)]],columnStyles:{0:{cellWidth:200,fontStyle:"bold"},1:{cellWidth:"auto"}},margin:{left:d,right:d}}),r=l.lastAutoTable.finalY+10,D(l,{startY:r,theme:"plain",styles:{fontSize:10},body:[[{content:"FACILITIES",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:d,right:d}}),r=l.lastAutoTable.finalY;const O=Array.isArray(b)&&b.length?"• "+b.join(`
• `):"—";D(l,{startY:r,theme:"grid",styles:{fontSize:9,cellPadding:8},body:[[O]],margin:{left:d,right:d}}),r=l.lastAutoTable.finalY+10,D(l,{startY:r,theme:"plain",styles:{fontSize:10},body:[[{content:"EQUIPMENT / MATERIALS",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:d,right:d}}),r=l.lastAutoTable.finalY,Array.isArray(c)&&c.length?D(l,{startY:r,theme:"grid",styles:{fontSize:9,cellPadding:6},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},head:[["ITEM","QTY","UNIT"]],body:c.map(A=>[A?.name||"—",Ee(A?.qty),A?.unit||"—"]),columnStyles:{0:{cellWidth:300},1:{cellWidth:70},2:{cellWidth:"auto"}},margin:{left:d,right:d}}):D(l,{startY:r,theme:"grid",styles:{fontSize:9,cellPadding:8},body:[["—"]],margin:{left:d,right:d}}),r=l.lastAutoTable.finalY+10;const N=[["UTILIZATION DETAILS",t.utilization_details],["REMARKS",t.remarks]];for(const[A,I]of N)D(l,{startY:r,theme:"plain",styles:{fontSize:10},body:[[{content:A,styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:d,right:d}}),r=l.lastAutoTable.finalY,D(l,{startY:r,theme:"grid",styles:{fontSize:9,cellPadding:8},body:[[I&&String(I).trim()?I:"—"]],margin:{left:d,right:d}}),r=l.lastAutoTable.finalY+10;{const A=l.internal.pageSize.getHeight();r+180>A-30&&(l.addPage(),r=36)}D(l,{startY:r,theme:"plain",styles:{fontSize:10},body:[[{content:"APPROVAL",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:d,right:d}}),r=l.lastAutoTable.finalY;const R=String(t?.file_by_user_name||"").trim()||(t?.filed_by?`${t.filed_by.first_name||""} ${t.filed_by.last_name||""}`.trim():""),p=String(t?.noted_by||"").trim(),o=t?.approver?`${t.approver.first_name||""} ${t.approver.last_name||""}`.trim():"";D(l,{startY:r,theme:"grid",styles:{fontSize:9,cellPadding:10},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},showHead:"firstPage",rowPageBreak:"avoid",head:[["PREPARED BY:","NOTED BY:","RECOMMENDING APPROVAL:"]],body:[[R||" ",p||" ",o||" "],[{content:`APPROVED BY:


DR. MARY ANN R. ARAULA
Acting College President`,colSpan:3,styles:{halign:"center",fontStyle:"bold",cellPadding:{top:14,right:10,bottom:16,left:10}}}]],columnStyles:{0:{cellWidth:(x-d*2)/2},1:{cellWidth:"auto"}},didParseCell:A=>{A.section==="body"&&A.row.index===0&&(A.cell.styles.halign="center",A.cell.styles.fontStyle="bold",A.cell.styles.cellPadding={top:16,right:10,bottom:4,left:10})},margin:{left:d,right:d}});const f=l.internal.pageSize.getHeight()-20;return l.setFontSize(8),l.setTextColor(120),l.text(`Generated on ${xe().format("YYYY-MM-DD HH:mm")} • ${window.location.origin}`,d,f),l}async function ka(t){(await Ve(t)).save(`${t.reference_code||"Utilization_Request"}.pdf`)}const $a={class:"flex flex-wrap items-center gap-2 w-full sm:w-auto justify-start sm:justify-end"},Ta={class:"p-2 mb-4 rounded-xl border bg-white/60"},Ea={class:"flex items-center gap-2 mb-2 text-gray-700"},Fa={class:"w-4 h-4",viewBox:"0 0 24 24"},Ra=["d"],Ba={class:"grid grid-cols-1 md:grid-cols-6 gap-2 text-sm"},Va={class:"md:col-span-2 flex"},za={class:"w-5 h-5",viewBox:"0 0 24 24"},Ia=["d"],Ua=["value"],Oa=["value"],Na={class:"md:col-span-1"},Da={class:"md:col-span-1"},Pa={class:"md:col-span-2"},La=["value"],Ma={class:"flex flex-wrap gap-1 max-w-[380px]"},Ya={key:0,class:"text-gray-400"},ja={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30"},qa={class:"bg-white w-[560px] rounded-xl shadow p-4"},Wa={class:"flex items-center justify-between mb-2"},Ga={class:"grid grid-cols-1 gap-2 text-sm"},Ja={class:"flex gap-2"},Ha={class:"text-[11px] text-gray-600"},Qa={class:"mt-3 flex justify-end gap-2"},vl={__name:"UtilizationRequestsPage",setup(t){const l=fe(),{isClub:x,activeClubId:d,withClub:b}=Et(),c=Je(),r=He(),v=W(()=>{const n=c.user?.last_name||"",e=(c.user?.first_name||"").slice(0,1);return`${n}${n?", ":""}${e?e+".":""}`}),k=n=>{try{return((Array.isArray(n)?n:JSON.parse(n||"[]")||[])||[]).map(a=>(!a||typeof a!="object"||Array.isArray(a.read_by)||(a.read_by=a.user_id!=null?[a.user_id]:[]),a))}catch{return[]}},F=_(!1),O=()=>{F.value=!0},N=_(!1),P=()=>{N.value=!0},R=async n=>{try{await l.fetchById(n);const e=l.selected;e&&await K(e)}catch(e){console.error(e)}finally{F.value=!1}},p=_(!1),o=_(null),f=async n=>{try{await l.fetchById(n.id),o.value=l.selected||n}catch{o.value=n}p.value=!0},A=async n=>{if(!o.value)return;const e=k(o.value.remarks);e.push({user_id:c.user?.id||null,user_name:v.value,message:n?.message||"",datetime:n?.datetime||new Date().toISOString(),is_read:!1,read_by:[c.user?.id||null]});try{o.value.remarks=JSON.stringify(e)}catch{}try{await l.updateById(o.value.id,{remarks:JSON.stringify(e)}),await $({},!0)}catch{}},I=async()=>{if(!o.value)return;const n=c.user?.id||null,a=k(o.value.remarks).map(g=>{if(!g||g.user_id===n)return g;const te=Array.isArray(g.read_by)?g.read_by.slice():[];return te.includes(n)||te.push(n),{...g,read_by:te}});try{o.value.remarks=JSON.stringify(a)}catch{}try{await l.updateById(o.value.id,{remarks:JSON.stringify(a)}),await $({},!0)}catch{}},w=Qe(),B=Ke(),L=async()=>{const n=String(w.query.open_remarks_type||""),e=Number(w.query.open_remarks_id||"");if(n==="UR"&&Number.isFinite(e)){try{await l.fetchById(e)}catch{}const a=l.selected;a&&await f(a);const g={...w.query};delete g.open_remarks_type,delete g.open_remarks_id,B.replace({query:g})}};pe(L),me(()=>[w.query.open_remarks_type,w.query.open_remarks_id],()=>{L()});const G=["EB 101","EB 102","EB 103","NB 104","NB 105","NB Lobby","NB 106","NB 107","NB 201","NB 3SR","OB 108","OB 109","OB 110","OB 111","OB 112","OB 113","OB 114","OB 115","OB 116","OB 117","Gym","AVR","Student Lobby","Activity Center","Library","Ground"],V={range:!0,partialRange:!0,multiCalendars:2,modelType:"yyyy-MM-dd",enableTimePicker:!1,autoApply:!0,clearable:!0},y=_({page:1,limit:10,sort:"created_at",order:"DESC",q:"",status:"",availability_status:"",start_from:"",start_to:"",end_from:"",end_to:"",facilities_any:[]}),M=W({get:()=>{const{start_from:n,start_to:e}=y.value;return n||e?[n||null,e||null]:null},set:n=>{if(!n)y.value.start_from=null,y.value.start_to=null;else{const[e,a]=n;y.value.start_from=e||null,y.value.start_to=a||null}}}),H=W({get:()=>{const{end_from:n,end_to:e}=y.value;return n||e?[n||null,e||null]:null},set:n=>{if(!n)y.value.end_from=null,y.value.end_to=null;else{const[e,a]=n;y.value.end_from=e||null,y.value.end_to=a||null}}}),$=async(n={},e=!0)=>{y.value={...y.value,...n};const a=b({...y.value});["q","status","availability_status","start_from","start_to","end_from","end_to"].forEach(g=>{(a[g]===""||a[g]==null)&&delete a[g]}),(!Array.isArray(a.facilities_any)||!a.facilities_any.length)&&delete a.facilities_any,await l.fetchAll(a,e)};pe(async()=>{await $({page:1,limit:10,club_id:x?d:""})});const Q=W(()=>({total:l.items.total||0,totalPages:l.items.totalPages||1,currentPage:l.items.currentPage||1,pageSize:l.items.pageSize||10,data:l.items.data||[]})),ye=["draft","pending","approved","rejected","cancelled","completed"],ne=["unknown","pending-check","available","conflict","reserved","maintenance"],ge=n=>{switch(String(n||"").toLowerCase()){case"draft":return"gray";case"pending":return"amber";case"approved":return"emerald";case"rejected":return"red";case"cancelled":return"zinc";case"completed":return"blue";default:return"gray"}},ve=n=>{switch(String(n||"").toLowerCase()){case"available":return"emerald";case"reserved":return"indigo";case"conflict":return"red";case"maintenance":return"orange";case"pending-check":return"amber";default:return"gray"}},i=[{key:"reference_code",label:"Ref Code",sortable:!0,width:140},{key:"activity_design",label:"Activity",sortable:!1,minWidth:220,formatter:(n,e)=>e.activity_design?e.activity_design.name_of_activity:""},{key:"facilities",label:"Facilities",sortable:!1,minWidth:260},{key:"start_at",label:"Start",sortable:!0,width:170},{key:"end_at",label:"End",sortable:!0,width:170},{key:"availability_status",label:"Availability",sortable:!0,width:130},{key:"status",label:"Status",sortable:!0,width:120}],m=async n=>{await $(n)},u=_(!1),z=_(!1),Z=_(null),ee=()=>{u.value=!0},oe=async n=>{await l.create(n),u.value=!1,await $({},!0)},K=async n=>{await l.fetchById(n.id);const e=l.selected||n;let a=[],g=[];try{a=Array.isArray(e.facilities)?e.facilities:JSON.parse(e.facilities||"[]")}catch{}try{g=Array.isArray(e.equipment_items)?e.equipment_items:JSON.parse(e.equipment_items||"[]")}catch{}Z.value={id:e.id,reference_code:e.reference_code,date_filed:e.date_filed||"",activity_design_id:e.activity_design_id||"",file_by_user_name:e.file_by_user_name||"",facilities:a,equipment_items:g,utilization_details:e.utilization_details||"",start_date:e.start_date||String(e.start_at||"").slice(0,10),start_time:e.start_time||(e.start_at?new Date(e.start_at).toTimeString().slice(0,5):""),end_date:e.end_date||String(e.end_at||"").slice(0,10),end_time:e.end_time||(e.end_at?new Date(e.end_at).toTimeString().slice(0,5):""),status:e.status||"draft",availability_status:e.availability_status||"pending-check",remarks:e.remarks||""},z.value=!0},ze=async n=>{const{id:e,...a}=n;await l.updateById(e,a),z.value=!1,await $({},!0)},Ie=async n=>{if(!n?.id)return;(await S.fire({title:`Delete utilization "${n.reference_code}"?`,text:"This cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it",cancelButtonText:"Cancel"})).isConfirmed&&(await l.deleteById(n.id),await $({},!0),await S.fire("Deleted","The utilization request has been deleted.","success"))},Ue=async n=>{await K(n)},se=_(!1),re=_(null),j=_({from_email:"",from_name:"",to:"",subject:"",html:"",attachments:[]}),Oe=async n=>{try{await l.fetchById(n.id);const e=l.selected||n,g=(await Ve(e)).output("datauristring"),te=String(g).split(",")[1]||"",Ge=`${e.reference_code||"Utilization_Request"}.pdf`;re.value=e,j.value={from_email:"osas@knp.edu.ph",from_name:`${c.user?.first_name||""} ${c.user?.last_name||""}`.trim(),to:"",subject:`Utilization Request ${e.reference_code||""}`.trim(),html:"Please see the attached file.",attachments:[{filename:Ge,content:te,type:"application/pdf"}]},se.value=!0}catch{await S.fire("Error",l.error||"Failed to prepare email.","error")}},Ne=async()=>{const n=re.value;if(n)try{await l.sendEmail(n.id,{...j.value}),se.value=!1,await S.fire("Sent","Email sent successfully.","success")}catch{await S.fire("Error",l.error||"Failed to send email.","error")}},De=async n=>{if((await S.fire({title:"Submit for approval?",text:"You can no longer edit after submission.",icon:"question",showCancelButton:!0,confirmButtonText:"Submit",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1})).isConfirmed)try{const a=k(n.remarks);a.push({user_id:c.user?.id||null,user_name:v.value,message:`${v.value} submitted utilization request.`,datetime:new Date().toISOString(),is_read:!1,read_by:[c.user?.id||null]}),await l.updateById(n.id,{remarks:JSON.stringify(a)}),await l.submit(n.id),await $({},!0),await S.fire("Submitted","Utilization request is now pending approval.","success")}catch{await S.fire("Error",l.error||"Failed to submit request.","error")}},Pe=async n=>{const e=await S.fire({title:"Approve utilization?",input:"textarea",inputLabel:"Remarks (optional)",inputPlaceholder:"Add a note…",showCancelButton:!0,confirmButtonText:"Approve",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1});if(!e.isConfirmed)return;const a=e.value||"";try{const g=k(n.remarks);g.push({user_id:c.user?.id||null,user_name:v.value,message:`${v.value} approved utilization request.${a?" - "+a:""}`,datetime:new Date().toISOString(),is_read:!1,read_by:[c.user?.id||null]}),await l.approve(n.id,JSON.stringify(g)),await $({},!0),await S.fire("Approved","Utilization has been approved and reserved.","success")}catch{await S.fire("Error",l.error||"Failed to approve request.","error")}},Le=async n=>{const e=await S.fire({title:"Reject utilization?",input:"textarea",inputLabel:"Reason (required)",inputPlaceholder:"State the reason…",inputValidator:g=>g?.trim()?void 0:"Reason is required",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Reject",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1});if(!e.isConfirmed)return;const a=e.value;try{const g=k(n.remarks);g.push({user_id:c.user?.id||null,user_name:v.value,message:`${v.value} rejected utilization request - ${a}.`,datetime:new Date().toISOString(),is_read:!1,read_by:[c.user?.id||null]}),await l.reject(n.id,JSON.stringify(g)),await $({},!0),await S.fire("Rejected","Utilization has been rejected.","success")}catch{await S.fire("Error",l.error||"Failed to reject request.","error")}},Me=async n=>{const e=await S.fire({title:"Cancel utilization?",input:"textarea",inputLabel:"Reason (required)",inputPlaceholder:"State the reason…",inputValidator:a=>a?.trim()?void 0:"Reason is required",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Cancel Utilization",cancelButtonText:"Keep",allowOutsideClick:!1,allowEscapeKey:!1});if(e.isConfirmed){e.value;try{const a=k(n.remarks);a.push({user_id:c.user?.id||null,user_name:v.value,message:`${v.value} cancelled utilization request - ${e.value}.`,datetime:new Date().toISOString(),is_read:!1,read_by:[c.user?.id||null]}),await l.cancel(n.id,JSON.stringify(a)),await $({},!0),await S.fire("Cancelled","Utilization has been cancelled.","success")}catch{await S.fire("Error",l.error||"Failed to cancel request.","error")}}},Ye=async n=>{if(String(n?.status||"").toLowerCase()!=="approved"){await S.fire("Not allowed","Only approved utilization request can be printed.","info");return}try{await l.fetchById(n.id);const a=l.selected||n;await ka(a)}catch(a){await S.fire("Error",l.error||"Failed to generate PDF.","error"),console.error(a)}},be=_(!1),we=_(null),je=async n=>{await l.fetchById(n.id),we.value=l.selected||n,be.value=!0};_(""),_("08:00"),_(""),_("10:00"),_([]);const de=_([]),qe=async()=>{y.value.facilities_any=(de.value||[]).slice(),await $({page:1})},We=async()=>{de.value=[],await $({q:"",status:"",availability_status:"",start_from:"",start_to:"",end_from:"",end_to:"",facilities_any:[],page:1})};return(n,e)=>(h(),C(ae,null,[T(ct,null,{default:q(()=>[T(ut,null,{default:q(()=>[E(l).error?(h(),Ce(xt,{key:0,icon:E(mt),color:"danger"},{default:q(()=>[le(U(E(l).error),1)]),_:1},8,["icon"])):J("",!0),T(ht,{icon:E(pt),title:"Utilization Requests",main:""},{default:q(()=>[s("div",$a,[T(ce,{icon:E(ft),color:"info",label:"View Calendar",onClick:O},null,8,["icon"]),T(ce,{icon:E(yt),color:"info",label:"Quick Check",onClick:P},null,8,["icon"]),T(ce,{icon:E(gt),color:"primary",label:"New Request",onClick:ee},null,8,["icon"]),T(ce,{icon:E(vt),color:"info",label:"Refresh",onClick:e[0]||(e[0]=a=>$({},!0))},null,8,["icon"])])]),_:1},8,["icon"]),s("div",Ta,[s("div",Ea,[(h(),C("svg",Fa,[s("path",{d:E(bt)},null,8,Ra)])),e[22]||(e[22]=s("span",{class:"font-medium text-sm"},"Filters",-1))]),s("div",Ba,[s("div",Va,[Y(s("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>y.value.q=a),placeholder:"Search by ref, details, remarks…",class:"border rounded-s px-2 py-2 flex-1",onKeyup:e[2]||(e[2]=Xe(a=>$({page:1}),["enter"]))},null,544),[[X,y.value.q]]),s("button",{class:"px-3 border border-l-0 rounded-e bg-gray-50",title:"Search",onClick:e[3]||(e[3]=a=>$({page:1}))},[(h(),C("svg",za,[s("path",{d:E(_t)},null,8,Ia)]))])]),Y(s("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>y.value.status=a),class:"border rounded px-2 py-2"},[e[23]||(e[23]=s("option",{value:""},"All status",-1)),(h(),C(ae,null,ie(ye,a=>s("option",{key:a,value:a},U(a),9,Ua)),64))],512),[[ue,y.value.status]]),Y(s("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>y.value.availability_status=a),class:"border rounded px-2 py-2"},[e[24]||(e[24]=s("option",{value:""},"Any availability",-1)),(h(),C(ae,null,ie(ne,a=>s("option",{key:a,value:a},U(a),9,Oa)),64))],512),[[ue,y.value.availability_status]]),s("div",Na,[T(E(ke),Ae({modelValue:M.value,"onUpdate:modelValue":e[6]||(e[6]=a=>M.value=a)},V,{placeholder:"Start date range"}),null,16,["modelValue"])]),s("div",Da,[T(E(ke),Ae({modelValue:H.value,"onUpdate:modelValue":e[7]||(e[7]=a=>H.value=a)},V,{placeholder:"End date range"}),null,16,["modelValue"])]),s("div",Pa,[e[25]||(e[25]=s("label",{class:"block text-[11px] text-gray-600 mb-1"},"Facilities (any)",-1)),Y(s("select",{"onUpdate:modelValue":e[8]||(e[8]=a=>de.value=a),multiple:"",class:"w-full border rounded px-2 py-2 min-h-[38px]"},[(h(),C(ae,null,ie(G,a=>s("option",{key:a,value:a},U(a),9,La)),64))],512),[[ue,de.value]])]),s("div",{class:"flex items-center gap-2 md:col-span-2"},[s("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:qe}," Apply Filters "),s("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:We},"Reset")])])]),T(wt,{columns:i,data:Q.value,loading:E(l).isLoading,onQueryChange:m},{"cell-facilities":q(({row:a})=>[s("div",Ma,[(h(!0),C(ae,null,ie((()=>{try{return Array.isArray(a.facilities)?a.facilities:JSON.parse(a.facilities||"[]")}catch{return[]}})(),(g,te)=>(h(),Ce(_e,{key:te,text:g,tone:"slate"},null,8,["text"]))),128)),a.facilities&&JSON.parse(a.facilities||"[]").length?J("",!0):(h(),C("span",Ya,"—"))])]),"cell-start_at":q(({value:a})=>[s("span",null,U(a?new Date(a).toLocaleString():"—"),1)]),"cell-end_at":q(({value:a})=>[s("span",null,U(a?new Date(a).toLocaleString():"—"),1)]),"cell-availability_status":q(({value:a})=>[T(_e,{text:a||"—",tone:ve(a)},null,8,["text","tone"])]),"cell-status":q(({value:a})=>[T(_e,{text:a||"—",tone:ge(a)},null,8,["text","tone"])]),"cell-actions":q(({row:a})=>[T(et,{row:a,"current-user-id":E(c).user?.id,moderator:["admin","manager"].includes(String(E(c).user?.role||"").toLowerCase()),onAttachments:je,onSubmit:De,onApprove:Pe,onReject:Le,onEdit:K,onDelete:Ie,onView:g=>Ue(a),onCancel:Me,onRemarks:f,onPrint:Ye,onEmail:Oe},null,8,["row","current-user-id","moderator","onView"])]),_:1},8,["data","loading"])]),_:1})]),_:1}),T($e,{modelValue:u.value,"onUpdate:modelValue":e[9]||(e[9]=a=>u.value=a),mode:"create",onSubmit:oe},null,8,["modelValue"]),T($e,{modelValue:z.value,"onUpdate:modelValue":e[10]||(e[10]=a=>z.value=a),mode:"edit",initial:Z.value||{},onSubmit:ze},null,8,["modelValue","initial"]),T(sa,{modelValue:be.value,"onUpdate:modelValue":e[11]||(e[11]=a=>be.value=a),row:we.value},null,8,["modelValue","row"]),T(Tt,{modelValue:p.value,"onUpdate:modelValue":e[12]||(e[12]=a=>p.value=a),title:"Remarks • "+(o.value?.reference_code||o.value?.activity_design?.name_of_activity||"Item"),items:k(o.value?.remarks),"can-add":!0,onAdd:A,onMarkAllRead:I},null,8,["modelValue","title","items"]),T(ca,{modelValue:F.value,"onUpdate:modelValue":e[13]||(e[13]=a=>F.value=a),onOpen:R},null,8,["modelValue"]),T(ga,{modelValue:N.value,"onUpdate:modelValue":e[14]||(e[14]=a=>N.value=a),facilities:G},null,8,["modelValue"]),se.value?(h(),C("div",ja,[s("div",qa,[s("div",Wa,[e[26]||(e[26]=s("h3",{class:"text-base font-semibold"},"Send Email",-1)),s("button",{class:"px-2 py-1 text-xs bg-gray-200 rounded",onClick:e[15]||(e[15]=a=>se.value=!1)},"Close")]),s("div",Ga,[s("div",null,[e[27]||(e[27]=s("label",{class:"block mb-0.5"},"To",-1)),s("div",Ja,[Y(s("input",{"onUpdate:modelValue":e[16]||(e[16]=a=>j.value.to=a),class:"flex-1 border rounded px-2 py-1.5",placeholder:"recipient@example.com"},null,512),[[X,j.value.to]]),s("button",{class:"px-2 py-1 text-[11px] rounded border bg-gray-50 hover:bg-gray-100",onClick:e[17]||(e[17]=()=>{const a=re.value?.filed_by_user_id||re.value?.filed_by?.id;a&&E(r).fetchById(a).then(()=>{const g=E(r).selectedUser?.email;g&&(j.value.to=g)})})},"Use Filer"),s("button",{class:"px-2 py-1 text-[11px] rounded border bg-rose-50 hover:bg-rose-100",onClick:e[18]||(e[18]=()=>{j.value.attachments=[]})},"Remove Attachment")])]),s("div",null,[e[28]||(e[28]=s("label",{class:"block mb-0.5"},"Subject",-1)),Y(s("input",{"onUpdate:modelValue":e[19]||(e[19]=a=>j.value.subject=a),class:"w-full border rounded px-2 py-1.5"},null,512),[[X,j.value.subject]])]),s("div",null,[e[29]||(e[29]=s("label",{class:"block mb-0.5"},"Message",-1)),Y(s("textarea",{"onUpdate:modelValue":e[20]||(e[20]=a=>j.value.html=a),rows:"4",class:"w-full border rounded px-2 py-1.5"},null,512),[[X,j.value.html]])]),s("div",Ha,"Attachment: "+U(j.value.attachments?.[0]?.filename||"utilization.pdf"),1)]),s("div",Qa,[s("button",{class:"px-3 py-1.5 text-xs bg-gray-200 rounded",onClick:e[21]||(e[21]=a=>se.value=!1)},"Cancel"),s("button",{class:"px-3 py-1.5 text-xs bg-emerald-600 text-white rounded",onClick:Ne},"Send")])])])):J("",!0)],64))}};export{vl as default};
