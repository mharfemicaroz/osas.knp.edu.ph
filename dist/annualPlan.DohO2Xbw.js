import{M as u,N as I,r as p}from"./index.RC4wj1D6.js";function b(t={}){const{filters:a={},page:n,limit:i,sort:r,order:o,q:f,status:m,school_year:y,club_id:g,filed_by_user_id:h,approver_user_id:w,...B}=t,d={page:n,limit:i,sort:r,order:o,q:f,status:m,school_year:y,club_id:g,filed_by_user_id:h,approver_user_id:w,...B,filters:{...a}};return Object.keys(d).forEach(v=>d[v]===void 0&&delete d[v]),d}function $(t){return typeof Blob<"u"&&(t instanceof Blob||t instanceof File)}function A(t,a=!0){if(typeof t=="string")return t;if(t==null)return a?"[]":"null";try{return JSON.stringify(t)}catch{return a?"[]":"null"}}function F(t={}){const a={...t};return a.plans!==void 0&&(a.plans=A(a.plans,!0)),a}const c={async create(t){const{data:a}=await u.post("/annual-plans",F(t));return a},async getById(t){const{data:a}=await u.get(`/annual-plans/${t}`);return a},async updateById(t,a){const{data:n}=await u.put(`/annual-plans/${t}`,F(a));return n},async delete(t){const{data:a}=await u.delete(`/annual-plans/${t}`);return a},async list(t={}){const a={officer:!1,...b(t)},{data:n}=await u.get("/annual-plans",{params:a});return n},async submit(t){const{data:a}=await u.post(`/annual-plans/${t}/submit`);return a},async approve(t,{remarks:a}={}){const{data:n}=await u.post(`/annual-plans/${t}/approve`,{remarks:a});return n},async reject(t,{remarks:a}={}){const{data:n}=await u.post(`/annual-plans/${t}/reject`,{remarks:a});return n},async cancel(t,{remarks:a}={}){const{data:n}=await u.post(`/annual-plans/${t}/cancel`,{remarks:a});return n},async uploadAttachment(t,a){if($(a)){const n=new FormData;n.append("file",a);const{data:i}=await u.post(`/annual-plans/${t}/attachments`,n,{headers:{"Content-Type":"multipart/form-data"}});return i}else{const{data:n}=await u.post(`/annual-plans/${t}/attachments`,{file:a});return n}},async deleteAttachment(t,a){const{data:n}=await u.delete(`/annual-plans/${t}/attachments/${a}`);return n}},x=I("annualPlan",()=>{const t=p({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),a=p(!1),n=p(null),i=p(!1),r=p(null),o=l=>{if(!l?.id)return;const s=t.value.data.findIndex(e=>e.id===l.id);s!==-1&&(t.value.data[s]=l)};return{items:t,selected:r,isLoading:a,error:n,isLoaded:i,fetchAll:async(l={},s=!1)=>{if(n.value=null,!(!s&&i.value))try{a.value=!0;const e=await c.list(l);Object.assign(t.value,{total:e.total||0,totalPages:e.totalPages||1,currentPage:l.page||1,pageSize:l.limit||10,data:e.data||[]}),i.value=!0}catch(e){n.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to fetch annual plans"}finally{a.value=!1}},fetchById:async l=>{n.value=null;try{a.value=!0;const s=await c.getById(l);r.value=s,o(s)}catch(s){n.value=s?.response?.data?.message||s?.response?.message||s?.message||"Failed to fetch annual plan"}finally{a.value=!1}},create:async l=>{n.value=null;try{a.value=!0;const s=await c.create(l);return t.value.data.push(s),t.value.total+=1,s}catch(s){throw n.value=s?.response?.data?.message||s?.response?.message||s?.message||"Failed to create annual plan",s}finally{a.value=!1}},updateById:async(l,s)=>{n.value=null;try{a.value=!0;const e=await c.updateById(l,s);return o(e),r.value?.id===l&&(r.value=e),e}catch(e){throw n.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to update annual plan",e}finally{a.value=!1}},deleteById:async l=>{n.value=null;try{a.value=!0,await c.delete(l),t.value.data=t.value.data.filter(s=>s.id!==l),t.value.total=Math.max(0,t.value.total-1),r.value?.id===l&&(r.value=null)}catch(s){n.value=s?.response?.data?.message||s?.response?.message||s?.message||"Failed to delete annual plan"}finally{a.value=!1}},submit:async l=>{n.value=null;try{a.value=!0;const s=await c.submit(l);return o(s),r.value?.id===l&&(r.value=s),s}catch(s){throw n.value=s?.response?.data?.message||s?.response?.message||s?.message||"Failed to submit annual plan",s}finally{a.value=!1}},approve:async(l,s)=>{n.value=null;try{a.value=!0;const e=await c.approve(l,{remarks:s});return o(e),r.value?.id===l&&(r.value=e),e}catch(e){throw n.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to approve annual plan",e}finally{a.value=!1}},reject:async(l,s)=>{n.value=null;try{a.value=!0;const e=await c.reject(l,{remarks:s});return o(e),r.value?.id===l&&(r.value=e),e}catch(e){throw n.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to reject annual plan",e}finally{a.value=!1}},cancel:async(l,s)=>{n.value=null;try{a.value=!0;const e=await c.cancel(l,{remarks:s});return o(e),r.value?.id===l&&(r.value=e),e}catch(e){throw n.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to cancel annual plan",e}finally{a.value=!1}},uploadAttachment:async(l,s)=>{n.value=null;try{a.value=!0;const e=await c.uploadAttachment(l,s);return o(e),r.value?.id===l&&(r.value=e),e}catch(e){throw n.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to upload attachment",e}finally{a.value=!1}},deleteAttachment:async(l,s)=>{n.value=null;try{a.value=!0;const e=await c.deleteAttachment(l,s);return o(e),r.value?.id===l&&(r.value=e),e}catch(e){throw n.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to delete attachment",e}finally{a.value=!1}},resetStore:()=>{t.value={total:0,totalPages:1,currentPage:1,pageSize:10,data:[]},r.value=null,i.value=!1,a.value=!1,n.value=null}}});export{x as u};
