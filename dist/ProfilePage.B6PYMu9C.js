import{u as se,z as te,c as p,s as le,o as ae,x as M,r as v,A as oe,l as O,q as a,f as ne,e,a as o,g as f,t as r,d as U,k as j,h as x,j as P,v as _,F as T,B as R,L as re,S as m}from"./index.BYRo1iHr.js";import{a as ie,c as de}from"./imageCompression.B77o5uYD.js";import{_ as ue,a as ce,Z as pe,y as ve,$ as me,a0 as ge,r as fe,W as xe,a1 as _e,a2 as be}from"./SectionMain.C-utUymm.js";import{_ as he}from"./_plugin-vue_export-helper.DlAUqK2U.js";import"./activityDesignService.BdbRWSU9.js";import"./utilizationRequestService.DnRjYVep.js";import"./liquidationFundService.BJck3R3V.js";import"./ToasterComponent.CYeIIgn8.js";const ye={class:"relative overflow-hidden rounded-2xl border bg-white shadow-sm"},we={class:"relative h-48 sm:h-64 w-full bg-gray-100 group overflow-hidden rounded-t-2xl"},ke=["src"],Ce={key:1,class:"flex h-full w-full items-center justify-center bg-gradient-to-r from-indigo-50 to-blue-50 text-indigo-500"},Ue=["disabled"],je=["disabled"],Pe={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},Be=["d"],Se={class:"relative px-4 sm:px-6 pb-4 sm:pb-6"},Fe={class:"-mt-10 sm:-mt-12 flex flex-col sm:flex-row items-start sm:items-end gap-4"},Ae={class:"relative h-24 w-24 sm:h-28 sm:w-28 rounded-full border-4 border-white bg-gray-100 overflow-hidden shadow"},Ne=["src"],Ve={key:1,class:"flex h-full w-full items-center justify-center bg-gray-200 text-gray-600 font-semibold"},$e=["title","disabled"],Ie={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},De=["d"],Le={class:"mt-2 sm:mt-11"},ze={class:"text-xl font-semibold text-gray-900"},Ee={class:"text-sm text-gray-500"},Ke={key:0,class:"mt-2 max-w-2xl text-sm text-gray-700 whitespace-pre-line"},Me={class:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6"},Oe={class:"lg:col-span-2 space-y-6"},Te={class:"rounded-2xl border bg-white shadow-sm"},Re={class:"border-b px-4 sm:px-6 py-3 flex items-center justify-between"},qe={class:"text-sm font-semibold text-gray-800 inline-flex items-center gap-2"},Ge={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},We=["d"],Ze={class:"px-4 sm:px-6 py-4"},He={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},Je=["readonly"],Qe=["readonly"],Xe=["readonly"],Ye={class:"sm:col-span-2"},es=["readonly"],ss={key:0,class:"mt-4 flex justify-end"},ts=["disabled"],ls={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},as=["d"],os={class:"rounded-2xl border bg-white shadow-sm"},ns={class:"border-b px-4 sm:px-6 py-3 flex items-center justify-between"},rs={class:"text-sm font-semibold text-gray-800 inline-flex items-center gap-2"},is={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},ds=["d"],us={class:"text-xs text-gray-500"},cs={class:"p-4 sm:p-6"},ps={key:0,class:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4"},vs={key:1,class:"text-sm text-gray-500"},ms={key:2,class:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4"},gs=["title","onClick","onKeyup"],fs={class:"flex items-center gap-3"},xs={class:"h-10 w-10 rounded-lg bg-gray-100 overflow-hidden flex items-center justify-center text-xs font-semibold text-gray-600 shrink-0"},_s=["src"],bs={key:1},hs={class:"min-w-0"},ys={class:"truncate text-sm font-medium text-gray-900"},ws={class:"truncate text-xs text-gray-500"},ks={class:"mt-3 flex items-center justify-between"},Cs={class:"inline-flex items-center rounded-full bg-indigo-50 px-2 py-[2px] text-[11px] text-indigo-700 ring-1 ring-indigo-200"},Us={key:0,class:"inline-flex items-center rounded-full bg-gray-50 px-2 py-[2px] text-[11px] text-gray-700 ring-1 ring-gray-200"},js={class:"mt-2 text-[11px] text-gray-500 inline-flex items-center gap-1"},Ps={style:{width:"14px",height:"14px"},viewBox:"0 0 24 24"},Bs=["d"],Ss={class:"space-y-6"},Fs={key:0,class:"rounded-2xl border bg-white shadow-sm"},As={class:"border-b px-4 sm:px-6 py-3"},Ns={class:"text-sm font-semibold text-gray-800 inline-flex items-center gap-2"},Vs={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},$s=["d"],Is={class:"px-4 sm:px-6 py-4"},Ds={class:"mt-4 flex justify-end"},Ls=["disabled"],zs={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},Es=["d"],Ks={class:"rounded-2xl border bg-white shadow-sm"},Ms={class:"p-4 sm:p-6 text-sm text-gray-700 space-y-2"},Os={class:"flex items-center justify-between"},Ts={class:"text-gray-500"},Rs={class:"flex items-center justify-between"},qs={class:"text-gray-500"},Gs={class:"flex items-center justify-between"},Ws={class:"text-gray-500"},Zs={__name:"ProfilePage",setup(Hs){const q=se(),u=te(),G=le(),S=p(()=>{const l=G.params.id;return typeof l=="string"&&l.trim()?Number(l):null}),F=p(()=>q.user||{}),B=p(()=>F.value?.id||null),c=p(()=>S.value||B.value),n=p(()=>!!B.value&&B.value===c.value),A=async()=>{c.value&&await u.fetchById(c.value),I(),await Y()};ae(A),M(()=>S.value,async()=>{await A()});const g=p(()=>u.selectedUser||F.value||{}),N=p(()=>g.value?.avatar||""),V=p(()=>g.value?.cover||""),$=p(()=>g.value?.bio||""),i=v({username:"",first_name:"",last_name:"",bio:""}),I=()=>{const l=g.value||{};Object.assign(i.value,{username:l.username||"",first_name:l.first_name||"",last_name:l.last_name||"",bio:l.bio||""})};M(g,I);const D=v(null),L=v(null),h=v(!1),y=v(!1),w=v(!1),b=v(!1),k=v(!1),d=v({old_password:"",new_password:"",confirm_password:""}),C=v([]),z=p(()=>{const l=i.value.first_name?.trim()||"",s=i.value.last_name?.trim()||"";return l||s?`${l} ${s}`.trim():g.value?.email||""}),E=l=>(l||"").split(" ").map(s=>s[0]).join("").slice(0,2).toUpperCase(),W=l=>{if(!l)return"—";const s=new Date(l);return isNaN(s)?"—":s.toLocaleDateString()},Z=()=>{n.value&&D.value?.click()},H=async l=>{const s=l.target.files?.[0];if(!(!s||!n.value||!c.value)){w.value=!0;try{const t=await de(s);await u.uploadAvatar(c.value,t),m.fire("Updated","Profile photo updated!","success")}catch{m.fire("Upload failed",u.error||"Could not upload avatar","error")}finally{w.value=!1,l.target.value=""}}},J=async l=>{const s=l.target.files?.[0];if(!(!s||!n.value||!c.value)){b.value=!0;try{const t=await ie(s);await u.uploadCover(c.value,t),m.fire("Updated","Cover photo updated!","success")}catch{m.fire("Upload failed",u.error||"Could not upload cover","error")}finally{b.value=!1,l.target.value=""}}},Q=async()=>{if(!(!n.value||!c.value)){h.value=!0;try{await u.updateById(c.value,{username:i.value.username||null,first_name:i.value.first_name||null,last_name:i.value.last_name||null,bio:i.value.bio||null}),m.fire("Saved","Profile updated successfully","success")}catch{m.fire("Update failed",u.error||"Could not update profile","error")}finally{h.value=!1}}},X=async()=>{if(n.value){if(!d.value.old_password||!d.value.new_password){m.fire("Missing fields","Please fill out both current and new password.","warning");return}if(d.value.new_password!==d.value.confirm_password){m.fire("Mismatch","New password and confirmation do not match.","warning");return}y.value=!0;try{await u.changePassword({old_password:d.value.old_password,new_password:d.value.new_password}),m.fire("Success","Password changed successfully","success"),Object.assign(d.value,{old_password:"",new_password:"",confirm_password:""})}catch{m.fire("Failed",u.error||"Could not change password","error")}finally{y.value=!1}}},Y=async()=>{if(c.value){k.value=!0;try{const l=await u.fetchUserClubs(c.value,{force:!0});C.value=(l||[]).map(s=>({id:s.id,name:s.name,code:s.code,logo:s.logo||s.logo_url||"",role:s.membership?.role||"member",status:s.membership?.status||"active",joined_at:s.membership?.joined_at||null,category:s.category||null}))}catch(l){console.error(l)}finally{k.value=!1}}},K=l=>{l&&window.open(`/#/club/${l}`,"_self")};return(l,s)=>(a(),oe(ue,null,{default:O(()=>[ne(ce,null,{default:O(()=>[e("div",ye,[e("div",we,[V.value?(a(),o("img",{key:0,src:V.value,alt:"Cover",class:"h-full w-full object-cover",loading:"lazy"},null,8,ke)):(a(),o("div",Ce,s[8]||(s[8]=[e("span",{class:"text-sm"},"No cover photo",-1)]))),e("input",{ref_key:"coverInput",ref:L,type:"file",accept:"image/*",class:"absolute inset-0 opacity-0 cursor-pointer",disabled:b.value||!n.value,onChange:J},null,40,Ue),e("button",{type:"button",class:"absolute right-3 bottom-3 inline-flex items-center gap-2 rounded-xl bg-white/90 px-3 py-1.5 text-xs shadow hover:bg-white z-10 disabled:opacity-60",disabled:b.value||!n.value,onClick:s[0]||(s[0]=t=>L.value?.click())},[(a(),o("svg",Pe,[e("path",{d:f(pe)},null,8,Be)])),e("span",null,r(b.value?"Uploading…":n.value?"Change cover":"Cover"),1)],8,je),s[9]||(s[9]=e("div",{class:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"},null,-1))]),e("div",Se,[e("div",Fe,[e("div",Ae,[N.value?(a(),o("img",{key:0,src:N.value,alt:"Avatar",class:"h-full w-full object-cover",loading:"lazy"},null,8,Ne)):(a(),o("div",Ve,r(E(z.value)),1)),e("button",{type:"button",class:"absolute right-0 bottom-0 m-1 rounded-full bg-white p-1 shadow hover:bg-gray-50 disabled:opacity-60",title:w.value?"Uploading…":n.value?"Change photo":"View only",disabled:w.value||!n.value,onClick:Z},[(a(),o("svg",Ie,[e("path",{d:f(ve)},null,8,De)]))],8,$e),e("input",{ref_key:"avatarInput",ref:D,type:"file",accept:"image/*",class:"hidden",onChange:H},null,544)]),e("div",Le,[e("div",ze,r(z.value),1),e("div",Ee,"@"+r(i.value.username||"username"),1),$.value?(a(),o("div",Ke,r($.value),1)):U("",!0)])])])]),e("div",Me,[e("div",Oe,[e("div",Te,[e("div",Re,[e("h3",qe,[(a(),o("svg",Ge,[e("path",{d:f(me)},null,8,We)])),j(" "+r(n.value?"Edit Profile":"Profile"),1)])]),e("div",Ze,[e("div",He,[e("div",null,[s[10]||(s[10]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Username",-1)),x(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>i.value.username=t),readonly:!n.value,class:P(["w-full rounded-lg border px-3 py-2 text-sm disabled:bg-gray-50",n.value?"":"bg-gray-50 text-gray-700"]),placeholder:"yourhandle"},null,10,Je),[[_,i.value.username]])]),e("div",null,[s[11]||(s[11]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"First name",-1)),x(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>i.value.first_name=t),readonly:!n.value,class:P(["w-full rounded-lg border px-3 py-2 text-sm disabled:bg-gray-50",n.value?"":"bg-gray-50 text-gray-700"]),placeholder:"First name"},null,10,Qe),[[_,i.value.first_name]])]),e("div",null,[s[12]||(s[12]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Last name",-1)),x(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>i.value.last_name=t),readonly:!n.value,class:P(["w-full rounded-lg border px-3 py-2 text-sm disabled:bg-gray-50",n.value?"":"bg-gray-50 text-gray-700"]),placeholder:"Last name"},null,10,Xe),[[_,i.value.last_name]])]),e("div",Ye,[s[13]||(s[13]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Bio",-1)),x(e("textarea",{"onUpdate:modelValue":s[4]||(s[4]=t=>i.value.bio=t),rows:"4",readonly:!n.value,class:P(["w-full rounded-lg border px-3 py-2 text-sm disabled:bg-gray-50",n.value?"":"bg-gray-50 text-gray-700"]),placeholder:"Tell us about yourself…"},null,10,es),[[_,i.value.bio]])])]),n.value?(a(),o("div",ss,[e("button",{type:"button",class:"inline-flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-xs font-medium text-white hover:bg-blue-700 disabled:opacity-50",disabled:h.value,onClick:Q},[(a(),o("svg",ls,[e("path",{d:f(ge)},null,8,as)])),e("span",null,r(h.value?"Saving…":"Save changes"),1)],8,ts)])):U("",!0)])]),e("div",os,[e("div",ns,[e("h3",rs,[(a(),o("svg",is,[e("path",{d:f(fe)},null,8,ds)])),s[14]||(s[14]=j(" Clubs ",-1))]),e("div",us,r(k.value?"Loading…":`${C.value.length} affiliation(s)`),1)]),e("div",cs,[k.value?(a(),o("div",ps,[(a(),o(T,null,R(6,t=>e("div",{key:t,class:"animate-pulse rounded-xl border p-4"},s[15]||(s[15]=[e("div",{class:"flex items-center gap-3"},[e("div",{class:"h-10 w-10 rounded-lg bg-gray-200"}),e("div",{class:"flex-1"},[e("div",{class:"h-3 w-2/3 bg-gray-200 rounded mb-2"}),e("div",{class:"h-3 w-1/3 bg-gray-100 rounded"})])],-1),e("div",{class:"mt-4 h-6 w-24 bg-gray-100 rounded"},null,-1)]))),64))])):C.value.length?(a(),o("div",ms,[(a(!0),o(T,null,R(C.value,t=>(a(),o("div",{key:t.id,class:"group rounded-xl border p-4 hover:shadow-sm transition bg-white cursor-pointer focus:outline-none focus:ring-2 focus:ring-indigo-300",role:"button",tabindex:"0",title:`Open ${t.name}`,onClick:ee=>K(t.id),onKeyup:re(ee=>K(t.id),["enter"])},[e("div",fs,[e("div",xs,[t.logo?(a(),o("img",{key:0,src:t.logo,alt:"",class:"h-full w-full object-cover"},null,8,_s)):(a(),o("span",bs,r(E(t.name||t.code)),1))]),e("div",hs,[e("div",ys,r(t.name),1),e("div",ws,"@"+r(t.code),1)])]),e("div",ks,[e("span",Cs,r(t.role||"member"),1),t.category?(a(),o("span",Us,r(t.category),1)):U("",!0)]),e("div",js,[(a(),o("svg",Ps,[e("path",{d:f(xe)},null,8,Bs)])),j(" since "+r(W(t.joined_at)),1)])],40,gs))),128))])):(a(),o("div",vs," No clubs yet. "))])])]),e("div",Ss,[n.value?(a(),o("div",Fs,[e("div",As,[e("h3",Ns,[(a(),o("svg",Vs,[e("path",{d:f(_e)},null,8,$s)])),s[16]||(s[16]=j(" Security ",-1))])]),e("div",Is,[s[17]||(s[17]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Current password",-1)),x(e("input",{"onUpdate:modelValue":s[5]||(s[5]=t=>d.value.old_password=t),type:"password",class:"mb-3 w-full rounded-lg border px-3 py-2 text-sm",placeholder:"••••••••"},null,512),[[_,d.value.old_password]]),s[18]||(s[18]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"New password",-1)),x(e("input",{"onUpdate:modelValue":s[6]||(s[6]=t=>d.value.new_password=t),type:"password",class:"mb-3 w-full rounded-lg border px-3 py-2 text-sm",placeholder:"New password"},null,512),[[_,d.value.new_password]]),s[19]||(s[19]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Confirm new password",-1)),x(e("input",{"onUpdate:modelValue":s[7]||(s[7]=t=>d.value.confirm_password=t),type:"password",class:"w-full rounded-lg border px-3 py-2 text-sm",placeholder:"Confirm password"},null,512),[[_,d.value.confirm_password]]),e("div",Ds,[e("button",{type:"button",class:"inline-flex items-center gap-2 rounded-lg bg-emerald-600 px-4 py-2 text-xs font-medium text-white hover:bg-emerald-700 disabled:opacity-50",disabled:y.value,onClick:X},[(a(),o("svg",zs,[e("path",{d:f(be)},null,8,Es)])),e("span",null,r(y.value?"Updating…":"Update password"),1)],8,Ls)])])])):U("",!0),e("div",Ks,[s[23]||(s[23]=e("div",{class:"border-b px-4 sm:px-6 py-3"},[e("h3",{class:"text-sm font-semibold text-gray-800"},"Account")],-1)),e("div",Ms,[e("div",Os,[s[20]||(s[20]=e("span",null,"Email",-1)),e("span",Ts,r(g.value.email),1)]),e("div",Rs,[s[21]||(s[21]=e("span",null,"Role",-1)),e("span",qs,r(g.value.role||"user"),1)]),e("div",Gs,[s[22]||(s[22]=e("span",null,"2FA",-1)),e("span",Ws,r(g.value.twoFAEnabled?"Enabled":"Disabled"),1)])])])])])]),_:1})]),_:1}))}},at=he(Zs,[["__scopeId","data-v-44e88728"]]);export{at as default};
