import{M as c,N as $,r as f}from"./index.BmXZGcv4.js";function B(s){return typeof Blob<"u"&&(s instanceof Blob||s instanceof File)}const o={async create(s){const{data:a}=await c.post("/clubs",s);return a},async getById(s){const{data:a}=await c.get(`/clubs/${s}`);return a},async updateById(s,a){const{data:l}=await c.put(`/clubs/${s}`,a);return l?.data??l},async delete(s){const{data:a}=await c.delete(`/clubs/${s}`);return a},async list(s={}){const a={officer:!1,...s},{data:l}=await c.get("/clubs",{params:a});return l},async addUsers(s,a){const{data:l}=await c.post(`/clubs/${s}/users`,{userIds:a});return l},async removeUser(s,a){const{data:l}=await c.delete(`/clubs/${s}/users/${a}`);return l},async updateMember(s,a,l){const{data:d}=await c.patch(`/clubs/${s}/users/${a}`,l);return d?.data},async uploadAttachment(s,a){if(B(a)){const l=new FormData;l.append("file",a);const{data:d}=await c.post(`/clubs/${s}/attachments`,l,{headers:{"Content-Type":"multipart/form-data"}});return d}else{const{data:l}=await c.post(`/clubs/${s}/attachments`,{file:a});return l}},async deleteAttachment(s,a){const{data:l}=await c.delete(`/clubs/${s}/attachments/${a}`);return l}},L=$("club",()=>{const s=f({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),a=f(!1),l=f(null),d=f(!1),n=f(null),v=r=>{if(!r?.id)return;const t=s.value.data.findIndex(e=>e.id===r.id);t!==-1&&(s.value.data[t]=r)},y=(r,t)=>{if(!t)return;if(n.value?.id===r&&Array.isArray(n.value.users)){const u=n.value.users.findIndex(i=>i.id===t.user_id);if(u!==-1){const i=n.value.users[u];n.value.users[u]={...i,UserClub:{...i.UserClub||{},...t}}}}const e=s.value.data.findIndex(u=>u.id===r);if(e!==-1&&Array.isArray(s.value.data[e].users)){const u=s.value.data[e].users,i=u.findIndex(m=>m.id===t.user_id);if(i!==-1){const m=u[i];u[i]={...m,UserClub:{...m.UserClub||{},...t}}}}},p=async(r={},t=!1)=>{if(l.value=null,!(!t&&d.value))try{a.value=!0;const e=await o.list(r);Object.assign(s.value,{total:e.total||0,totalPages:e.totalPages||1,currentPage:r.page||1,pageSize:r.limit||10,data:e.data||[]}),d.value=!0}catch(e){l.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to fetch clubs"}finally{a.value=!1}},g=async r=>{l.value=null;try{a.value=!0;const t=await o.getById(r);n.value=t,v(t)}catch(t){l.value=t?.response?.data?.message||t?.response?.message||t?.message||"Failed to fetch club"}finally{a.value=!1}},h=async r=>{l.value=null;try{a.value=!0;const t=await o.create(r);s.value.data.push(t),s.value.total+=1}catch(t){l.value=t?.response?.data?.message||t?.response?.message||t?.message||"Failed to create club"}finally{a.value=!1}},b=async(r,t)=>{l.value=null;try{a.value=!0;const e=await o.updateById(r,t);v(e),n.value?.id===r&&(n.value=e)}catch(e){l.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to update club"}finally{a.value=!1}},w=async r=>{l.value=null;try{a.value=!0,await o.delete(r),s.value.data=s.value.data.filter(t=>t.id!==r),s.value.total=Math.max(0,s.value.total-1),n.value?.id===r&&(n.value=null)}catch(t){l.value=t?.response?.data?.message||t?.response?.message||t?.message||"Failed to delete club"}finally{a.value=!1}},A=async(r,t)=>{l.value=null;try{a.value=!0;const e=await o.addUsers(r,t);v(e),n.value?.id===r&&(n.value=e)}catch(e){l.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to add users to club"}finally{a.value=!1}},F=async(r,t)=>{l.value=null;try{a.value=!0,await o.removeUser(r,t),n.value?.id===r&&Array.isArray(n.value.users)&&(n.value.users=n.value.users.filter(u=>u.id!==t));const e=s.value.data.findIndex(u=>u.id===r);e!==-1&&Array.isArray(s.value.data[e].users)&&(s.value.data[e].users=s.value.data[e].users.filter(u=>u.id!==t))}catch(e){l.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to remove user from club"}finally{a.value=!1}};async function x(r,t,e){try{a.value=!0;const u=await o.updateMember(r,t,{status:e});return y(r,u),u}catch(u){throw l.value=u?.response?.data?.message||u?.response?.message||u?.message||"Failed to update member status",u}finally{a.value=!1}}async function I(r,t,e){try{a.value=!0;const u=await o.updateMember(r,t,{role:e});return y(r,u),u}catch(u){throw l.value=u?.response?.data?.message||u?.response?.message||u?.message||"Failed to update member role",u}finally{a.value=!1}}return{clubs:s,selectedClub:n,isLoading:a,error:l,isLoaded:d,fetchAll:p,fetchById:g,create:h,updateById:b,deleteById:w,addUsersToClub:A,removeUserFromClub:F,updateMemberRole:I,updateMemberStatus:x,uploadAttachment:async(r,t)=>{l.value=null;try{a.value=!0;const e=await o.uploadAttachment(r,t);return v(e),n.value?.id===r&&(n.value=e),e}catch(e){throw l.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to upload attachment",e}finally{a.value=!1}},deleteAttachment:async(r,t)=>{l.value=null;try{a.value=!0;const e=await o.deleteAttachment(r,t);return v(e),n.value?.id===r&&(n.value=e),e}catch(e){throw l.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to delete attachment",e}finally{a.value=!1}},resetStore:()=>{s.value={total:0,totalPages:1,currentPage:1,pageSize:10,data:[]},n.value=null,d.value=!1,a.value=!1,l.value=null}}});export{L as u};
