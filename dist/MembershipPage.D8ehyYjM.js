import{y as X,u as Z,r as m,o as ee,c as M,a as n,f as x,d as R,l as g,e as s,t as u,h as _,B as w,F as v,A as f,k as U,g as c,q as o,z as te,L as se,v as ae}from"./index.C4ttRr7x.js";import{_ as le,K as oe,a as ne,w as ie,L as re,M as de,r as ue,Q as ce}from"./SectionMain.gJa-xx1u.js";import{_ as me,a as ve,b as pe,B as be,c as xe}from"./Badge.DkMygoqP.js";import{u as ge}from"./club.D8oVuprA.js";import"./ToasterComponent.BkcYJvl0.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const _e={class:"flex items-center gap-2"},fe={key:1,class:"p-3 rounded-lg border bg-amber-50 text-amber-800 text-sm"},ye={key:2},he={class:"p-3 mb-4 rounded-xl border bg-white/60"},we={class:"flex items-center gap-2 mb-2 text-gray-700"},Ce={class:"w-4 h-4",viewBox:"0 0 24 24"},ke=["d"],Se={class:"grid grid-cols-1 md:grid-cols-6 gap-2 text-sm"},Ae=["value"],Me=["value"],Ue={class:"flex items-center gap-2 md:col-span-2"},$e=["onClick"],Le={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},Be=["d"],Ve={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},Re={class:"bg-white p-4 md:p-5 rounded-2xl shadow-xl w-[820px] max-h-screen overflow-auto"},Te={class:"flex items-center justify-between mb-3"},Ee={class:"text-lg font-semibold"},qe={class:"mb-3 p-3 rounded-xl border bg-white/70"},Ne={class:"flex items-center gap-2"},Pe=["disabled"],Fe=["value"],Oe=["disabled"],ze={class:"w-3.5 h-3.5 inline-block mr-1",viewBox:"0 0 24 24"},Qe=["d"],We={key:0,class:"text-xs text-gray-500 mt-1"},je={class:"p-3 rounded-xl border bg-white/70"},Ke={key:0,class:"text-xs text-gray-500"},De={key:1,class:"text-xs text-gray-500"},Ge={key:2,class:"space-y-2"},Ie={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-2"},Ye={class:"truncate"},He={class:"text-sm font-medium"},Je={class:"text-[11px] text-gray-500"},Xe={class:"flex items-center gap-2 flex-wrap"},Ze=["onUpdate:modelValue"],et=["value"],tt=["onUpdate:modelValue"],st=["value"],at=["onClick"],lt=["onClick"],ot={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},nt=["d"],pt={__name:"MembershipPage",setup(it){const r=X(),p=ge(),E=Z(),q=["admin","manager","officer","student"],N=[{label:"All",value:""},{label:"Yes",value:"true"},{label:"No",value:"false"}],d=m({page:1,limit:10,q:"",role:"",is_active:""}),b=async(l={},e=!0)=>{d.value={...d.value,...l};const t={...d.value};["q","role","is_active"].forEach(a=>{(t[a]===""||t[a]==null)&&delete t[a]}),t.q&&(t.username=t.q,delete t.q),await r.fetchAll(t,e)};ee(async()=>{await b({page:1,limit:10},!0)});const P=M(()=>({total:r.users.total||0,totalPages:r.users.totalPages||1,currentPage:r.users.currentPage||1,pageSize:r.users.pageSize||10,data:r.users.data||[]})),F=l=>l?"emerald":"zinc",O=[{key:"username",label:"Username",sortable:!0,minWidth:160},{key:"name",label:"Name",sortable:!1,minWidth:200,formatter:(l,e)=>`${e.first_name||""} ${e.last_name||""}`.trim()||"—"},{key:"email",label:"Email",sortable:!0,minWidth:220},{key:"role",label:"Role",sortable:!0,width:120},{key:"is_active",label:"Active",sortable:!0,width:100}],z=async l=>{await b(l)},$=m(!1),y=m(null),C=m([]),k=m([]),T=m({}),i=m(!1),h=m(""),Q=async l=>{y.value=l,$.value=!0,await W(),await S(l.id)},W=async()=>{try{i.value=!0,await p.fetchAll({page:1,limit:500},!0)}finally{i.value=!1}},S=async l=>{try{i.value=!0;const e=await r.fetchUserClubs(l,{force:!0});C.value=Array.isArray(e)?e:[],k.value=C.value.map(a=>({...a,membership:{...a.membership||{}}}));const t={};for(const a of C.value)t[a.id]={role:a.membership?.role||"member",status:a.membership?.status||"active"};T.value=t}finally{i.value=!1}},j=M(()=>new Set((C.value||[]).map(l=>l.id))),L=M(()=>(p.clubs.data||[]).filter(l=>!j.value.has(l.id))),K=["member","officer","bod","business manager","pio","treasurer","secretary","vice-president","president"],D=["pending","active","inactive"],G=async()=>{const l=h.value,e=y.value?.id;if(!(!l||!e))try{i.value=!0,await p.addUsersToClub(l,[e]),await S(e),h.value=""}finally{i.value=!1}},I=async l=>{const e=y.value?.id;if(!(!l||!e))try{i.value=!0,await p.removeUserFromClub(l,e),await S(e)}finally{i.value=!1}},Y=async l=>{const e=y.value?.id;if(!e)return;const t=k.value.find(J=>J.id===l);if(!t)return;const a=T.value[l]||{},A=[],B=String(t.membership?.role||"").toLowerCase(),V=String(t.membership?.status||"").toLowerCase();if(B&&B!==String(a.role||"").toLowerCase()&&A.push(p.updateMemberRole(l,e,B)),V&&V!==String(a.status||"").toLowerCase()&&A.push(p.updateMemberStatus(l,e,V)),!!A.length)try{i.value=!0,await Promise.all(A),await S(e)}finally{i.value=!1}},H=M(()=>String(E.user?.role||"").toLowerCase()==="admin");return(l,e)=>(o(),n(v,null,[x(le,null,{default:g(()=>[x(ne,null,{default:g(()=>[c(r).error?(o(),te(me,{key:0,color:"danger"},{default:g(()=>[U(u(c(r).error),1)]),_:1})):R("",!0),x(ve,{icon:c(ie),title:"Memberships",main:""},{default:g(()=>[s("div",_e,[x(pe,{icon:c(re),color:"info",label:"Refresh",onClick:e[0]||(e[0]=t=>b({},!0))},null,8,["icon"])])]),_:1},8,["icon"]),H.value?(o(),n("div",ye,[s("div",he,[s("div",we,[(o(),n("svg",Ce,[s("path",{d:c(de)},null,8,ke)])),e[9]||(e[9]=s("span",{class:"font-medium text-sm"},"Filters",-1))]),s("div",Se,[_(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>d.value.q=t),class:"border rounded px-2 py-2 md:col-span-2",placeholder:"Search username…",onKeyup:e[2]||(e[2]=se(t=>b({page:1}),["enter"]))},null,544),[[ae,d.value.q]]),_(s("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>d.value.role=t),class:"border rounded px-2 py-2"},[e[10]||(e[10]=s("option",{value:""},"All roles",-1)),(o(),n(v,null,f(q,t=>s("option",{key:t,value:t},u(t),9,Ae)),64))],512),[[w,d.value.role]]),_(s("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>d.value.is_active=t),class:"border rounded px-2 py-2"},[(o(),n(v,null,f(N,t=>s("option",{key:t.label,value:t.value},"Active: "+u(t.label),9,Me)),64))],512),[[w,d.value.is_active]]),s("div",Ue,[s("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:e[5]||(e[5]=t=>b({page:1}))},"Apply"),s("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:e[6]||(e[6]=t=>b({q:"",role:"",is_active:"",page:1},!0))},"Reset")])])]),x(be,{columns:O,data:P.value,loading:c(r).isLoading,onQueryChange:z},{"cell-is_active":g(({value:t})=>[x(xe,{text:t?"Active":"Inactive",tone:F(t)},null,8,["text","tone"])]),"cell-actions":g(({row:t})=>[s("button",{class:"px-2 py-1 text-[12px] rounded bg-gray-100 hover:bg-gray-200 inline-flex items-center gap-1",onClick:a=>Q(t)},[(o(),n("svg",Le,[s("path",{d:c(ue)},null,8,Be)])),e[11]||(e[11]=U(" Manage ",-1))],8,$e)]),_:1},8,["data","loading"])])):(o(),n("div",fe," This page is only available to administrators. "))]),_:1})]),_:1}),$.value?(o(),n("div",Ve,[s("div",Re,[s("div",Te,[s("h2",Ee,"Manage Membership — @"+u(y.value?.username),1),s("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:e[7]||(e[7]=t=>$.value=!1)},"Close")]),s("div",qe,[e[14]||(e[14]=s("div",{class:"text-sm font-medium mb-2"},"Add to a Club",-1)),s("div",Ne,[_(s("select",{"onUpdate:modelValue":e[8]||(e[8]=t=>h.value=t),class:"border rounded px-2.5 py-2 min-w-[260px]",disabled:i.value||!L.value.length},[e[12]||(e[12]=s("option",{value:"",disabled:""},"Select a club…",-1)),(o(!0),n(v,null,f(L.value,t=>(o(),n("option",{key:t.id,value:t.id},u(t.name),9,Fe))),128))],8,Pe),[[w,h.value]]),s("button",{class:"px-3 py-2 bg-blue-600 text-white rounded text-xs disabled:opacity-50",disabled:!h.value||i.value,onClick:G},[(o(),n("svg",ze,[s("path",{d:c(oe)},null,8,Qe)])),e[13]||(e[13]=U(" Add ",-1))],8,Oe)]),L.value.length?R("",!0):(o(),n("div",We,"No more clubs available to add."))]),s("div",je,[e[18]||(e[18]=s("div",{class:"text-sm font-medium mb-2"},"Current Clubs",-1)),i.value?(o(),n("div",Ke,"Loading…")):k.value.length?(o(),n("ul",Ge,[(o(!0),n(v,null,f(k.value,t=>(o(),n("li",{key:t.id,class:"rounded border px-2 py-2 bg-gray-50"},[s("div",Ie,[s("div",Ye,[s("div",He,u(t.name),1),s("div",Je,"@"+u(t.code||""),1)]),s("div",Xe,[e[16]||(e[16]=s("div",{class:"text-xs text-gray-600"},"Role",-1)),_(s("select",{"onUpdate:modelValue":a=>t.membership.role=a,class:"border rounded px-2 py-1 text-sm"},[(o(),n(v,null,f(K,a=>s("option",{key:a,value:a},u(a),9,et)),64))],8,Ze),[[w,t.membership.role]]),e[17]||(e[17]=s("div",{class:"text-xs text-gray-600 ml-2"},"Status",-1)),_(s("select",{"onUpdate:modelValue":a=>t.membership.status=a,class:"border rounded px-2 py-1 text-sm"},[(o(),n(v,null,f(D,a=>s("option",{key:a,value:a},u(a),9,st)),64))],8,tt),[[w,t.membership.status]]),s("button",{class:"px-2 py-1 text-[12px] rounded bg-blue-600 text-white",onClick:a=>Y(t.id)},"Save",8,at),s("button",{class:"px-2 py-1 text-[12px] rounded bg-rose-100 hover:bg-rose-200 inline-flex items-center gap-1",onClick:a=>I(t.id)},[(o(),n("svg",ot,[s("path",{d:c(ce)},null,8,nt)])),e[15]||(e[15]=U(" Remove ",-1))],8,lt)])])]))),128))])):(o(),n("div",De,"This user is not a member of any club."))])])])):R("",!0)],64))}};export{pt as default};
