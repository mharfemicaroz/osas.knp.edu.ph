import{_ as q,a as E,m as w,b as G,c as K,d as Q,e as C}from"./SectionMain.D1ShbFuh.js";import{_ as L,a as S}from"./DoughnutChart.B9HxZOl7.js";import{z as X,r as Z,o as tt,c as d,A as st,l as N,q as r,f as m,e as s,a as c,g as u,t as f,k as v}from"./index.lmxhTYcw.js";import{u as et}from"./club.DV_5lPHG.js";import{u as ot}from"./clubDoc.BgwAU7s0.js";import"./ToasterComponent.BiIukvsf.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const at={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"},lt={class:"rounded-2xl border bg-white shadow-sm p-4"},it={class:"flex items-center justify-between"},dt={style:{width:"20px",height:"20px"},viewBox:"0 0 24 24",class:"text-blue-500"},nt=["d"],rt={class:"mt-2 text-2xl font-semibold text-gray-900"},ct={class:"rounded-2xl border bg-white shadow-sm p-4"},ut={class:"flex items-center justify-between"},bt={style:{width:"20px",height:"20px"},viewBox:"0 0 24 24",class:"text-emerald-600"},gt=["d"],mt={class:"mt-2 text-2xl font-semibold text-gray-900"},ht={class:"rounded-2xl border bg-white shadow-sm p-4"},xt={class:"flex items-center justify-between"},_t={style:{width:"20px",height:"20px"},viewBox:"0 0 24 24",class:"text-indigo-600"},pt=["d"],vt={class:"mt-2 text-2xl font-semibold text-gray-900"},ft={class:"rounded-2xl border bg-white shadow-sm p-4"},yt={class:"flex items-center justify-between"},wt={style:{width:"20px",height:"20px"},viewBox:"0 0 24 24",class:"text-amber-600"},Ct=["d"],St={class:"mt-2 text-2xl font-semibold text-gray-900"},At={class:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6"},kt={class:"rounded-2xl border bg-white shadow-sm"},Bt={class:"px-4 py-3 border-b flex items-center justify-between"},Dt={class:"text-sm font-semibold text-gray-800 flex items-center gap-2"},Mt={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24",class:"text-blue-600"},$t=["d"],jt={class:"p-4"},Lt={class:"h-72"},Nt={class:"rounded-2xl border bg-white shadow-sm"},Ft={class:"px-4 py-3 border-b flex items-center justify-between"},Tt={class:"text-sm font-semibold text-gray-800 flex items-center gap-2"},Ut={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24",class:"text-emerald-600"},Wt=["d"],Ot={class:"p-4"},zt={class:"h-72"},Pt={class:"rounded-2xl border bg-white shadow-sm"},Yt={class:"px-4 py-3 border-b flex items-center justify-between"},Jt={class:"text-sm font-semibold text-gray-800 flex items-center gap-2"},Rt={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24",class:"text-amber-600"},Vt=["d"],Ht={class:"p-4"},It={class:"h-72"},qt={class:"rounded-2xl border bg-white shadow-sm"},Et={class:"px-4 py-3 border-b flex items-center justify-between"},Gt={class:"text-sm font-semibold text-gray-800 flex items-center gap-2"},Kt={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24",class:"text-indigo-600"},Qt=["d"],Xt={class:"p-4"},Zt={class:"h-72"},ts={class:"rounded-2xl border bg-white shadow-sm lg:col-span-2"},ss={class:"px-4 py-3 border-b flex items-center justify-between"},es={class:"text-sm font-semibold text-gray-800 flex items-center gap-2"},os={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24",class:"text-blue-600"},as=["d"],ls={class:"p-4"},is={class:"h-72"},hs={__name:"IndexPage",setup(ds){const h=et(),x=ot(),b=X(),A=Z(!0);tt(async()=>{try{await Promise.all([h.fetchAll({page:1,limit:1e3,filters:{include:"users"}},!0),x.fetchAll({page:1,limit:2e3},!0),b.fetchAll({page:1,limit:2e3},!0)]);const t=(Array.isArray(b.users?.data)?b.users.data:[]).slice(0,500);await Promise.all(t.map(i=>b.fetchUserClubs(i.id).catch(()=>[])))}finally{A.value=!1}});const g=d(()=>Array.isArray(h.clubs?.data)?h.clubs.data:[]),y=d(()=>Array.isArray(x.docs?.data)?x.docs.data:[]),F=d(()=>Array.isArray(b.users?.data)?b.users.data:[]),k=d(()=>h.clubs?.total||g.value.length||0),B=d(()=>g.value.filter(e=>e.is_active!==!1).length),T=d(()=>b.users?.total||F.value.length||0),U=d(()=>x.docs?.total||y.value.length||0),W=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],O=e=>{const t=e?new Date(e):null;return t&&!isNaN(t)?t:null},z=e=>{const t=(e??"active").toString().trim().toLowerCase();return["pending","active","inactive"].includes(t)?t:"active"},l={blue:"rgba(59,130,246,0.85)",blueSoft:"rgba(59,130,246,0.15)",indigo:"rgba(99,102,241,0.85)",indigoSoft:"rgba(99,102,241,0.15)",emerald:"rgba(16,185,129,0.85)",emeraldSoft:"rgba(16,185,129,0.15)",amber:"rgba(245,158,11,0.85)",amberSoft:"rgba(245,158,11,0.15)",rose:"rgba(244,63,94,0.85)",roseSoft:"rgba(244,63,94,0.15)",slate:"rgba(100,116,139,0.85)",slateSoft:"rgba(100,116,139,0.15)"},D=e=>t=>e[t%e.length],P=[l.blue,l.indigo,l.emerald,l.amber,l.rose,l.slate],Y=[l.blueSoft,l.indigoSoft,l.emeraldSoft,l.amberSoft,l.roseSoft,l.slateSoft],M=D(P),$=D(Y),J=d(()=>{const e={};for(const o of g.value){const a=(o.category||"Uncategorized").trim();e[a]=(e[a]||0)+1}const t=Object.keys(e).sort((o,a)=>e[a]-e[o]),i=t.map(o=>e[o]),n=t.map((o,a)=>$(a)),p=t.map((o,a)=>M(a));return{labels:t,datasets:[{label:"Clubs",data:i,backgroundColor:n,borderColor:p,borderWidth:1.5}]}}),R=d(()=>{const e=B.value,t=Math.max(0,k.value-e);return{labels:["Active","Inactive"],datasets:[{data:[e,t],backgroundColor:[l.emerald,l.slate],borderColor:["white","white"],borderWidth:2}]}}),V=d(()=>{const e={cbl:0,resolution:0,minute:0};for(const i of y.value){const n=(i.type||"").toLowerCase();e.hasOwnProperty(n)&&e[n]++}const t=["cbl","resolution","minute"];return{labels:t,datasets:[{data:t.map(i=>e[i]||0),backgroundColor:[l.indigo,l.amber,l.blue],borderColor:["white","white","white"],borderWidth:2}]}});d(()=>{const e=new Date,t=[];for(let o=11;o>=0;o--){const a=new Date(e.getFullYear(),e.getMonth()-o,1);t.push({y:a.getFullYear(),m:a.getMonth(),key:`${a.getFullYear()}-${a.getMonth()}`,count:0})}const i=new Map(t.map(o=>[o.key,o]));for(const o of y.value){const a=O(o.doc_date||o.created_at||o.updated_at);if(!a)continue;const j=`${a.getFullYear()}-${a.getMonth()}`;i.has(j)&&i.get(j).count++}const n=t.map(o=>`${W[o.m]} ${String(o.y).slice(-2)}`),p=t.map(o=>o.count);return{labels:n,datasets:[{label:"Docs / month",data:p,borderColor:l.blue,backgroundColor:l.blueSoft,borderWidth:2,pointRadius:3,pointHoverRadius:4,tension:.3,fill:!0}]}});const H=d(()=>{const e={pending:0,active:0,inactive:0};console.log("Calculating membership status from clubs:",g.value);for(const t of g.value)if(Array.isArray(t.users))for(const i of t.users){const n=z(i?.UserClub?.status);e[n]=(e[n]||0)+1}return{labels:["active","pending","inactive"],datasets:[{data:[e.active,e.pending,e.inactive],backgroundColor:["rgba(16,185,129,0.85)","rgba(245,158,11,0.85)","rgba(244,63,94,0.85)"],borderColor:["white","white","white"],borderWidth:2}]}}),I=d(()=>{const e=g.value.map(o=>({name:o.name||o.code||`Club ${o.id}`,count:Array.isArray(o.users)?o.users.length:0})).sort((o,a)=>a.count-o.count).slice(0,10),t=e.map(o=>o.name),i=e.map(o=>o.count),n=t.map((o,a)=>$(a)),p=t.map((o,a)=>M(a));return{labels:t,datasets:[{label:"Members",data:i,backgroundColor:n,borderColor:p,borderWidth:1.5}]}}),_=d(()=>A.value||h.isLoading||x.isLoading||b.isLoading);return(e,t)=>(r(),st(q,null,{default:N(()=>[m(E,null,{default:N(()=>[t[13]||(t[13]=s("div",{class:"mb-4"},[s("h1",{class:"text-xl font-semibold text-gray-900"},"Dashboard"),s("p",{class:"text-sm text-gray-500"},"At-a-glance metrics & trends across clubs, documents, and users.")],-1)),s("div",at,[s("div",lt,[s("div",it,[t[0]||(t[0]=s("div",{class:"text-sm text-gray-500"},"Total Clubs",-1)),(r(),c("svg",dt,[s("path",{d:u(w)},null,8,nt)]))]),s("div",rt,f(k.value),1),t[1]||(t[1]=s("div",{class:"mt-1 text-xs text-gray-500"},"All clubs in the system",-1))]),s("div",ct,[s("div",ut,[t[2]||(t[2]=s("div",{class:"text-sm text-gray-500"},"Active Clubs",-1)),(r(),c("svg",bt,[s("path",{d:u(G)},null,8,gt)]))]),s("div",mt,f(B.value),1),t[3]||(t[3]=s("div",{class:"mt-1 text-xs text-gray-500"},"Currently active",-1))]),s("div",ht,[s("div",xt,[t[4]||(t[4]=s("div",{class:"text-sm text-gray-500"},"Users",-1)),(r(),c("svg",_t,[s("path",{d:u(K)},null,8,pt)]))]),s("div",vt,f(T.value),1),t[5]||(t[5]=s("div",{class:"mt-1 text-xs text-gray-500"},"Registered accounts",-1))]),s("div",ft,[s("div",yt,[t[6]||(t[6]=s("div",{class:"text-sm text-gray-500"},"Documents",-1)),(r(),c("svg",wt,[s("path",{d:u(Q)},null,8,Ct)]))]),s("div",St,f(U.value),1),t[7]||(t[7]=s("div",{class:"mt-1 text-xs text-gray-500"},"CBLs, resolutions & minutes",-1))])]),s("div",At,[s("div",kt,[s("div",Bt,[s("h3",Dt,[(r(),c("svg",Mt,[s("path",{d:u(w)},null,8,$t)])),t[8]||(t[8]=v(" Clubs by Category ",-1))])]),s("div",jt,[s("div",Lt,[m(L,{data:J.value,loading:_.value},null,8,["data","loading"])])])]),s("div",Nt,[s("div",Ft,[s("h3",Tt,[(r(),c("svg",Ut,[s("path",{d:u(C)},null,8,Wt)])),t[9]||(t[9]=v(" Club Activity ",-1))])]),s("div",Ot,[s("div",zt,[m(S,{data:R.value,loading:_.value},null,8,["data","loading"])])])]),s("div",Pt,[s("div",Yt,[s("h3",Jt,[(r(),c("svg",Rt,[s("path",{d:u(C)},null,8,Vt)])),t[10]||(t[10]=v(" Documents by Type ",-1))])]),s("div",Ht,[s("div",It,[m(S,{data:V.value,loading:_.value},null,8,["data","loading"])])])]),s("div",qt,[s("div",Et,[s("h3",Gt,[(r(),c("svg",Kt,[s("path",{d:u(C)},null,8,Qt)])),t[11]||(t[11]=v(" Membership Status ",-1))])]),s("div",Xt,[s("div",Zt,[m(S,{data:H.value,loading:_.value},null,8,["data","loading"])])])]),s("div",ts,[s("div",ss,[s("h3",es,[(r(),c("svg",os,[s("path",{d:u(w)},null,8,as)])),t[12]||(t[12]=v(" Members by Club (Top 10) ",-1))])]),s("div",ls,[s("div",is,[m(L,{data:I.value,loading:_.value,horizontal:!0},null,8,["data","loading"])])])])])]),_:1,__:[13]})]),_:1}))}};export{hs as default};
