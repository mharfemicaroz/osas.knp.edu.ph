import{M as r,N as B,r as c}from"./index.BbiYfjGA.js";function I(t){const e={...t};return Object.keys(e).forEach(n=>e[n]===void 0&&delete e[n]),e}function _(t){return typeof Blob<"u"&&(t instanceof Blob||t instanceof File)}function f(t,e){if(typeof t=="string")return t;if(t==null)return e;try{return JSON.stringify(t)}catch{return e}}function F(t={}){const e={...t};return e.sources_of_fund!==void 0&&(e.sources_of_fund=f(e.sources_of_fund,"{}")),e.uses_of_fund!==void 0&&(e.uses_of_fund=f(e.uses_of_fund,"[]")),e.attachments!==void 0&&(e.attachments=f(e.attachments,"[]")),delete e.date_filed,e}const i={async create(t){const{data:e}=await r.post("/liquidation-funds",F(t));return e},async getById(t){const{data:e}=await r.get(`/liquidation-funds/${t}`);return e},async updateById(t,e){const{data:n}=await r.put(`/liquidation-funds/${t}`,F(e));return n},async delete(t){const{data:e}=await r.delete(`/liquidation-funds/${t}`);return e},async list(t={}){const{page:e,limit:n,sort:d,order:u,q:o,status:v,activity_design_id:p,filed_by_user_id:m,date_filed_from:y,date_filed_to:g,...h}=t,w=I({page:e,limit:n,sort:d,order:u,q:o,status:v,activity_design_id:p,filed_by_user_id:m,date_filed_from:y,date_filed_to:g,...h}),{data:q}=await r.get("/liquidation-funds",{params:w});return q},async submit(t){const{data:e}=await r.post(`/liquidation-funds/${t}/submit`);return e},async approve(t,{remarks:e}={}){const{data:n}=await r.post(`/liquidation-funds/${t}/approve`,{remarks:e});return n},async reject(t,{remarks:e}={}){const{data:n}=await r.post(`/liquidation-funds/${t}/reject`,{remarks:e});return n},async cancel(t,{remarks:e}={}){const{data:n}=await r.post(`/liquidation-funds/${t}/cancel`,{remarks:e});return n},async uploadAttachment(t,e){if(_(e)){const n=new FormData;n.append("file",e);const{data:d}=await r.post(`/liquidation-funds/${t}/attachments`,n,{headers:{"Content-Type":"multipart/form-data"}});return d}else{const{data:n}=await r.post(`/liquidation-funds/${t}/attachments`,_(e)?{}:{file:e});return n}},async deleteAttachment(t,e){const{data:n}=await r.delete(`/liquidation-funds/${t}/attachments/${e}`);return n}},x=B("liquidationFund",()=>{const t=c({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),e=c(!1),n=c(null),d=c(!1),u=c(null),o=l=>{if(!l?.id)return;const s=t.value.data.findIndex(a=>a.id===l.id);s!==-1&&(t.value.data[s]=l)};return{items:t,selected:u,isLoading:e,error:n,isLoaded:d,fetchAll:async(l={},s=!1)=>{if(n.value=null,!(!s&&d.value))try{e.value=!0;const a=await i.list(l);Object.assign(t.value,{total:a.total||a.count||0,totalPages:a.totalPages||Math.max(1,Math.ceil((a.total||0)/(l.limit||10))),currentPage:l.page||1,pageSize:l.limit||10,data:a.data||a.rows||[]}),d.value=!0}catch(a){n.value=a?.response?.data?.message||a?.response?.message||a?.message||"Failed to fetch liquidation funds"}finally{e.value=!1}},fetchById:async l=>{n.value=null;try{e.value=!0;const s=await i.getById(l);u.value=s,o(s)}catch(s){n.value=s?.response?.data?.message||s?.response?.message||s?.message||"Failed to fetch liquidation fund"}finally{e.value=!1}},create:async l=>{n.value=null;try{e.value=!0;const s=await i.create(l);return t.value.data.unshift(s),t.value.total+=1,s}catch(s){throw n.value=s?.response?.data?.message||s?.response?.message||s?.message||"Failed to create liquidation fund",s}finally{e.value=!1}},updateById:async(l,s)=>{n.value=null;try{e.value=!0;const a=await i.updateById(l,s);return o(a),u.value?.id===l&&(u.value=a),a}catch(a){throw n.value=a?.response?.data?.message||a?.response?.message||a?.message||"Failed to update liquidation fund",a}finally{e.value=!1}},deleteById:async l=>{n.value=null;try{e.value=!0,await i.delete(l),t.value.data=t.value.data.filter(s=>s.id!==l),t.value.total=Math.max(0,t.value.total-1),u.value?.id===l&&(u.value=null)}catch(s){n.value=s?.response?.data?.message||s?.response?.message||s?.message||"Failed to delete liquidation fund"}finally{e.value=!1}},submit:async l=>{n.value=null;try{e.value=!0;const s=await i.submit(l);return o(s),u.value?.id===l&&(u.value=s),s}catch(s){throw n.value=s?.response?.data?.message||s?.response?.message||s?.message||"Failed to submit liquidation fund",s}finally{e.value=!1}},approve:async(l,s)=>{n.value=null;try{e.value=!0;const a=await i.approve(l,{remarks:s});return o(a),u.value?.id===l&&(u.value=a),a}catch(a){throw n.value=a?.response?.data?.message||a?.response?.message||a?.message||"Failed to approve liquidation fund",a}finally{e.value=!1}},reject:async(l,s)=>{n.value=null;try{e.value=!0;const a=await i.reject(l,{remarks:s});return o(a),u.value?.id===l&&(u.value=a),a}catch(a){throw n.value=a?.response?.data?.message||a?.response?.message||a?.message||"Failed to reject liquidation fund",a}finally{e.value=!1}},cancel:async(l,s)=>{n.value=null;try{e.value=!0;const a=await i.cancel(l,{remarks:s});return o(a),u.value?.id===l&&(u.value=a),a}catch(a){throw n.value=a?.response?.data?.message||a?.response?.message||a?.message||"Failed to cancel liquidation fund",a}finally{e.value=!1}},uploadAttachment:async(l,s)=>{n.value=null;try{e.value=!0;const a=await i.uploadAttachment(l,s);return o(a),u.value?.id===l&&(u.value=a),a}catch(a){throw n.value=a?.response?.data?.message||a?.response?.message||a?.message||"Failed to upload attachment",a}finally{e.value=!1}},deleteAttachment:async(l,s)=>{n.value=null;try{e.value=!0;const a=await i.deleteAttachment(l,s);return o(a),u.value?.id===l&&(u.value=a),a}catch(a){throw n.value=a?.response?.data?.message||a?.response?.message||a?.message||"Failed to delete attachment",a}finally{e.value=!1}},resetStore:()=>{t.value={total:0,totalPages:1,currentPage:1,pageSize:10,data:[]},u.value=null,d.value=!1,e.value=!1,n.value=null}}});export{x as u};
