import{z as I,u as ee,r as u,o as te,c as U,a as n,f as b,d as E,l as h,e as s,t as m,h as w,C as T,F as g,B as C,k as L,g as c,q as o,A as se,L as ae,v as le}from"./index.CogHg4rp.js";import{_ as oe,K as ne,a as ie,w as re,L as ue,M as de,r as me,Y as ce}from"./SectionMain.Camu0wne.js";import{_ as ve,a as pe,b as be}from"./Badge.Up2DqiRl.js";import{_ as ge,B as fe}from"./NotificationBar.C_cXw3cK.js";import{T as xe}from"./ToasterComponent.CHXBIuQk.js";import{u as _e}from"./club.B1pxqbVW.js";import"./activityDesignService.Dgqxj02-.js";import"./utilizationRequestService.u4yMTSgC.js";import"./liquidationFundService.COiPrIQO.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const ye={class:"flex items-center gap-2"},he={key:1,class:"p-3 rounded-lg border bg-amber-50 text-amber-800 text-sm"},we={key:2},Ce={class:"p-3 mb-4 rounded-xl border bg-white/60"},ke={class:"flex items-center gap-2 mb-2 text-gray-700"},Se={class:"w-4 h-4",viewBox:"0 0 24 24"},Ae=["d"],Me={class:"grid grid-cols-1 md:grid-cols-6 gap-2 text-sm"},Te=["value"],$e=["value"],Ue={class:"flex items-center gap-2 md:col-span-2"},Le=["onClick"],Re={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},Be=["d"],Ve={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},Ee={class:"bg-white p-4 md:p-5 rounded-2xl shadow-xl w-[820px] max-h-screen overflow-auto"},qe={class:"flex items-center justify-between mb-3"},Fe={class:"text-lg font-semibold"},Ne={class:"mb-3 p-3 rounded-xl border bg-white/70"},Pe={class:"flex items-center gap-2"},Oe=["disabled"],ze=["value"],We=["disabled"],je={class:"w-3.5 h-3.5 inline-block mr-1",viewBox:"0 0 24 24"},Ke=["d"],Qe={key:0,class:"text-xs text-gray-500 mt-1"},De={class:"p-3 rounded-xl border bg-white/70"},Ye={key:0,class:"text-xs text-gray-500"},Ge={key:1,class:"text-xs text-gray-500"},He={key:2,class:"space-y-2"},Je={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-2"},Xe={class:"truncate"},Ze={class:"text-sm font-medium"},Ie={class:"text-[11px] text-gray-500"},et={class:"flex items-center gap-2 flex-wrap"},tt=["onUpdate:modelValue","disabled","onChange"],st=["value"],at=["onUpdate:modelValue","disabled","onChange"],lt=["value"],ot=["onClick"],nt={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},it=["d"],_t={__name:"MembershipPage",setup(rt){const r=I(),f=_e(),q=ee(),F=["admin","manager","officer","student"],N=[{label:"All",value:""},{label:"Yes",value:"true"},{label:"No",value:"false"}],d=u({page:1,limit:10,q:"",role:"",is_active:""}),x=async(a={},t=!0)=>{d.value={...d.value,...a};const e={...d.value};["q","role","is_active"].forEach(l=>{(e[l]===""||e[l]==null)&&delete e[l]}),e.q&&(e.username=e.q,delete e.q),await r.fetchAll(e,t)};te(async()=>{await x({page:1,limit:10},!0)});const P=U(()=>({total:r.users.total||0,totalPages:r.users.totalPages||1,currentPage:r.users.currentPage||1,pageSize:r.users.pageSize||10,data:r.users.data||[]})),O=a=>a?"emerald":"zinc",z=[{key:"username",label:"Username",sortable:!0,minWidth:160},{key:"name",label:"Name",sortable:!1,minWidth:200,formatter:(a,t)=>`${t.first_name||""} ${t.last_name||""}`.trim()||"—"},{key:"email",label:"Email",sortable:!0,minWidth:220},{key:"role",label:"Role",sortable:!0,width:120},{key:"is_active",label:"Active",sortable:!0,width:100}],W=async a=>{await x(a)},R=u(!1),_=u(null),$=u([]),k=u([]),v=u({}),i=u(!1),S=u(""),y=u({}),A=u(null),j=async a=>{_.value=a,R.value=!0,await K(),await B(a.id)},K=async()=>{try{i.value=!0,await f.fetchAll({page:1,limit:500},!0)}finally{i.value=!1}},B=async a=>{try{i.value=!0;const t=await r.fetchUserClubs(a,{force:!0});$.value=Array.isArray(t)?t:[],k.value=$.value.map(l=>({...l,membership:{...l.membership||{}}}));const e={};for(const l of $.value)e[l.id]={role:l.membership?.role||"member",status:l.membership?.status||"active"};v.value=e}finally{i.value=!1}},Q=U(()=>new Set(($.value||[]).map(a=>a.id))),V=U(()=>(f.clubs.data||[]).filter(a=>!Q.value.has(a.id))),D=["member","officer","bod","business manager","pio","treasurer","secretary","vice-president","president"],Y=["pending","active","inactive"],G=async()=>{const a=S.value,t=_.value?.id;if(!(!a||!t))try{i.value=!0,await f.addUsersToClub(a,[t]),await B(t),S.value=""}finally{i.value=!1}},H=async a=>{const t=_.value?.id;if(!(!a||!t))try{i.value=!0,await f.removeUserFromClub(a,t),await B(t)}finally{i.value=!1}},J=async a=>{const t=_.value?.id;if(!t)return;const e=k.value.find(p=>p.id===a);if(!e)return;const l=String(e.membership?.role||"").toLowerCase(),M=String(v.value[a]?.role||"").toLowerCase();if(!(!l||l===M)){y.value[a]=!0;try{await f.updateMemberRole(a,t,l),v.value[a]={...v.value[a]||{},role:l},A.value?.showToast?.("success","Role updated")}catch(p){e.membership.role=M||"member",A.value?.showToast?.("warning",p?.message||"Failed to update role")}finally{y.value[a]=!1}}},X=async a=>{const t=_.value?.id;if(!t)return;const e=k.value.find(p=>p.id===a);if(!e)return;const l=String(e.membership?.status||"").toLowerCase(),M=String(v.value[a]?.status||"").toLowerCase();if(!(!l||l===M)){y.value[a]=!0;try{await f.updateMemberStatus(a,t,l),v.value[a]={...v.value[a]||{},status:l},A.value?.showToast?.("success","Status updated")}catch(p){e.membership.status=M||"active",A.value?.showToast?.("warning",p?.message||"Failed to update status")}finally{y.value[a]=!1}}},Z=U(()=>String(q.user?.role||"").toLowerCase()==="admin");return(a,t)=>(o(),n(g,null,[b(oe,null,{default:h(()=>[b(ie,null,{default:h(()=>[c(r).error?(o(),se(ge,{key:0,color:"danger"},{default:h(()=>[L(m(c(r).error),1)]),_:1})):E("",!0),b(ve,{icon:c(re),title:"Memberships",main:""},{default:h(()=>[s("div",ye,[b(pe,{icon:c(ue),color:"info",label:"Refresh",onClick:t[0]||(t[0]=e=>x({},!0))},null,8,["icon"])])]),_:1},8,["icon"]),Z.value?(o(),n("div",we,[s("div",Ce,[s("div",ke,[(o(),n("svg",Se,[s("path",{d:c(de)},null,8,Ae)])),t[9]||(t[9]=s("span",{class:"font-medium text-sm"},"Filters",-1))]),s("div",Me,[w(s("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>d.value.q=e),class:"border rounded px-2 py-2 md:col-span-2",placeholder:"Search username…",onKeyup:t[2]||(t[2]=ae(e=>x({page:1}),["enter"]))},null,544),[[le,d.value.q]]),w(s("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>d.value.role=e),class:"border rounded px-2 py-2"},[t[10]||(t[10]=s("option",{value:""},"All roles",-1)),(o(),n(g,null,C(F,e=>s("option",{key:e,value:e},m(e),9,Te)),64))],512),[[T,d.value.role]]),w(s("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>d.value.is_active=e),class:"border rounded px-2 py-2"},[(o(),n(g,null,C(N,e=>s("option",{key:e.label,value:e.value},"Active: "+m(e.label),9,$e)),64))],512),[[T,d.value.is_active]]),s("div",Ue,[s("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:t[5]||(t[5]=e=>x({page:1}))},"Apply"),s("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:t[6]||(t[6]=e=>x({q:"",role:"",is_active:"",page:1},!0))},"Reset")])])]),b(fe,{columns:z,data:P.value,loading:c(r).isLoading,onQueryChange:W},{"cell-is_active":h(({value:e})=>[b(be,{text:e?"Active":"Inactive",tone:O(e)},null,8,["text","tone"])]),"cell-actions":h(({row:e})=>[s("button",{class:"px-2 py-1 text-[12px] rounded bg-gray-100 hover:bg-gray-200 inline-flex items-center gap-1",onClick:l=>j(e)},[(o(),n("svg",Re,[s("path",{d:c(me)},null,8,Be)])),t[11]||(t[11]=L(" Manage ",-1))],8,Le)]),_:1},8,["data","loading"])])):(o(),n("div",he," This page is only available to administrators. "))]),_:1})]),_:1}),R.value?(o(),n("div",Ve,[s("div",Ee,[s("div",qe,[s("h2",Fe,"Manage Membership — @"+m(_.value?.username),1),s("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:t[7]||(t[7]=e=>R.value=!1)},"Close")]),s("div",Ne,[t[14]||(t[14]=s("div",{class:"text-sm font-medium mb-2"},"Add to a Club",-1)),s("div",Pe,[w(s("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>S.value=e),class:"border rounded px-2.5 py-2 min-w-[260px]",disabled:i.value||!V.value.length},[t[12]||(t[12]=s("option",{value:"",disabled:""},"Select a club…",-1)),(o(!0),n(g,null,C(V.value,e=>(o(),n("option",{key:e.id,value:e.id},m(e.name),9,ze))),128))],8,Oe),[[T,S.value]]),s("button",{class:"px-3 py-2 bg-blue-600 text-white rounded text-xs disabled:opacity-50",disabled:!S.value||i.value,onClick:G},[(o(),n("svg",je,[s("path",{d:c(ne)},null,8,Ke)])),t[13]||(t[13]=L(" Add ",-1))],8,We)]),V.value.length?E("",!0):(o(),n("div",Qe,"No more clubs available to add."))]),s("div",De,[t[18]||(t[18]=s("div",{class:"text-sm font-medium mb-2"},"Current Clubs",-1)),i.value?(o(),n("div",Ye,"Loading…")):k.value.length?(o(),n("ul",He,[(o(!0),n(g,null,C(k.value,e=>(o(),n("li",{key:e.id,class:"rounded border px-2 py-2 bg-gray-50"},[s("div",Je,[s("div",Xe,[s("div",Ze,m(e.name),1),s("div",Ie,"@"+m(e.code||""),1)]),s("div",et,[t[16]||(t[16]=s("div",{class:"text-xs text-gray-600"},"Role",-1)),w(s("select",{"onUpdate:modelValue":l=>e.membership.role=l,class:"border rounded px-2 py-1 text-sm",disabled:i.value||y.value[e.id],onChange:l=>J(e.id)},[(o(),n(g,null,C(D,l=>s("option",{key:l,value:l},m(l),9,st)),64))],40,tt),[[T,e.membership.role]]),t[17]||(t[17]=s("div",{class:"text-xs text-gray-600 ml-2"},"Status",-1)),w(s("select",{"onUpdate:modelValue":l=>e.membership.status=l,class:"border rounded px-2 py-1 text-sm",disabled:i.value||y.value[e.id],onChange:l=>X(e.id)},[(o(),n(g,null,C(Y,l=>s("option",{key:l,value:l},m(l),9,lt)),64))],40,at),[[T,e.membership.status]]),s("button",{class:"px-2 py-1 text-[12px] rounded bg-rose-100 hover:bg-rose-200 inline-flex items-center gap-1",onClick:l=>H(e.id)},[(o(),n("svg",nt,[s("path",{d:c(ce)},null,8,it)])),t[15]||(t[15]=L(" Remove ",-1))],8,ot)])])]))),128))])):(o(),n("div",Ge,"This user is not a member of any club."))])])])):E("",!0),b(xe,{ref_key:"toast",ref:A},null,512)],64))}};export{_t as default};
