import{z as Y,u as G,r as g,o as H,c as J,a as i,f,d as w,l as _,e as t,t as u,h as c,k as p,v as h,C as k,F as C,B as U,g as r,q as o,A as X,O as Z,S as F}from"./index.DPBVxXpV.js";import{_ as ee,L as te,M as se,a as le,w as ae,K as oe,N as ie,O as ne,v as de,y as re,z as ue,P as ce}from"./SectionMain.zWpJ8iur.js";import{_ as ve,a as me,b as $,B as pe,c as N}from"./Badge.uALBx_aa.js";import"./ToasterComponent.CYegXfee.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const be={class:"flex items-center gap-2"},fe={class:"p-3 mb-4 rounded-xl border bg-white/60"},_e={class:"flex items-center gap-2 mb-2 text-gray-700"},xe={class:"w-4 h-4",viewBox:"0 0 24 24"},ge=["d"],we={class:"grid grid-cols-1 md:grid-cols-6 gap-2 text-sm"},ye=["value"],he=["value"],ke={class:"flex items-center gap-2 md:col-span-2"},Ce={class:"w-9 h-9 rounded-full overflow-hidden bg-gray-100 border"},Ae=["src"],Ue={key:1,class:"w-full h-full flex items-center justify-center text-[10px] text-gray-400"},Be={class:"inline-flex items-center gap-1"},Ee={class:"w-3.5 h-3.5 opacity-70",viewBox:"0 0 24 24"},Ve=["d"],Fe={class:"flex items-center gap-1"},$e=["onClick"],Ne={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},Pe=["d"],Se=["onClick"],je={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},Te=["d"],qe=["onClick"],De={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},Ie=["d"],Le={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},Me={class:"bg-white p-4 md:p-5 rounded-2xl shadow-xl w-[980px] max-h-screen overflow-auto"},Oe={class:"flex items-center justify-between mb-3"},Re={class:"text-lg font-semibold"},ze={class:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm"},We={class:"md:col-span-3"},Ke=["disabled"],Qe={key:0,class:"text-red-600 text-[11px] mt-1"},Ye={class:"md:col-span-3"},Ge=["disabled"],He={key:0,class:"text-red-600 text-[11px] mt-1"},Je=["disabled"],Xe=["disabled"],Ze=["disabled"],et=["value"],tt={key:0,class:"text-red-600 text-[11px] mt-1"},st=["disabled"],lt=["disabled"],at={class:"md:col-span-3"},ot=["disabled"],it={key:0,class:"mt-4 p-3 rounded-xl border bg-white/70"},nt={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},dt={class:"block mb-1 inline-flex items-center gap-2"},rt={class:"w-4 h-4 opacity-80",viewBox:"0 0 24 24"},ut=["d"],ct={class:"flex items-center gap-3"},vt={class:"w-16 h-16 rounded-full overflow-hidden bg-gray-100 border"},mt=["src"],pt={key:1,class:"w-full h-full flex items-center justify-center text-[10px] text-gray-400"},bt=["disabled"],ft={class:"block mb-1 inline-flex items-center gap-2"},_t={class:"w-4 h-4 opacity-80",viewBox:"0 0 24 24"},xt=["d"],gt={class:"flex items-center gap-3"},wt={class:"w-28 h-16 rounded-lg overflow-hidden bg-gray-100 border"},yt=["src"],ht={key:1,class:"w-full h-full flex items-center justify-center text-[10px] text-gray-400"},kt=["disabled"],Ct={class:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-3"},At={class:"p-3 rounded-xl border bg-white/70"},Ut={key:0,class:"text-xs text-gray-500"},Bt={key:1,class:"text-xs text-gray-500"},Et={key:2,class:"space-y-1 text-sm"},Vt={class:"truncate"},Ft={class:"text-[11px] text-gray-500"},$t={class:"flex justify-end gap-2 mt-5"},Dt={__name:"UserManagementPage",setup(Nt){const n=Y();G();const m=g({page:1,limit:10,q:"",role:"",is_active:""}),E=["admin","manager","officer","student"],P=[{label:"All",value:""},{label:"Yes",value:"true"},{label:"No",value:"false"}],b=async(a={},e=!0)=>{m.value={...m.value,...a};const s={...m.value};["q","role","is_active"].forEach(y=>{(s[y]===""||s[y]==null)&&delete s[y]}),await n.fetchAll(s,e)};H(async()=>{await b({page:1,limit:10},!0)});const S=J(()=>({total:n.users.total||0,totalPages:n.users.totalPages||1,currentPage:n.users.currentPage||1,pageSize:n.users.pageSize||10,data:n.users.data||[]})),j=a=>a?"emerald":"zinc",T=a=>a?"indigo":"gray",q=[{key:"avatar",label:"Avatar",width:64,formatter:(a,e)=>e.avatar||null,sortable:!1},{key:"username",label:"Username",sortable:!0,minWidth:160},{key:"name",label:"Name",sortable:!1,minWidth:200,formatter:(a,e)=>`${e.first_name||""} ${e.last_name||""}`.trim()||"—"},{key:"email",label:"Email",sortable:!0,minWidth:220},{key:"role",label:"Role",sortable:!0,width:120},{key:"is_active",label:"Active",sortable:!0,width:100},{key:"twoFAEnabled",label:"2FA",sortable:!0,width:100}],D=async a=>{await b(a)},x=g(!1),d=g("create"),l=g({id:null,username:"",email:"",first_name:"",last_name:"",role:"student",is_active:!0,twoFAEnabled:!1,bio:"",avatar:null,cover:null}),v=g({}),I=()=>{d.value="create",l.value={id:null,username:"",email:"",first_name:"",last_name:"",role:"student",is_active:!0,twoFAEnabled:!1,bio:"",avatar:null,cover:null},v.value={},x.value=!0},L=async a=>{await n.fetchById(a.id);const e=n.selectedUser||a;d.value="view",l.value={id:e.id,username:e.username||"",email:e.email||"",first_name:e.first_name||"",last_name:e.last_name||"",role:e.role||"student",is_active:!!e.is_active,twoFAEnabled:!!e.twoFAEnabled,bio:e.bio||"",avatar:e.avatar||null,cover:e.cover||null},v.value={},x.value=!0,await V(e.id)},M=async a=>{await n.fetchById(a.id);const e=n.selectedUser||a;d.value="edit",l.value={id:e.id,username:e.username||"",email:e.email||"",first_name:e.first_name||"",last_name:e.last_name||"",role:e.role||"student",is_active:!!e.is_active,twoFAEnabled:!!e.twoFAEnabled,bio:e.bio||"",avatar:e.avatar||null,cover:e.cover||null},v.value={},x.value=!0,await V(e.id)},O=a=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(a||"").trim()),R=()=>{const a={};return l.value.username?.trim()||(a.username="Username is required"),O(l.value.email)||(a.email="Valid email is required"),l.value.role?.trim()||(a.role="Role is required"),d.value==="create"?(l.value.password?.trim()||(a.password="Password is required"),(l.value.password||"").length<6&&(a.password="Password must be at least 6 chars"),(l.value.confirm_password||"")!==(l.value.password||"")&&(a.confirm_password="Passwords do not match")):d.value==="edit"&&(l.value.password?.length&&l.value.password.length<6&&(a.password="At least 6 chars"),l.value.password?.length&&l.value.confirm_password!==l.value.password&&(a.confirm_password="Passwords do not match")),v.value=a,Object.keys(a).length===0},z=async()=>{if(d.value==="view"||!R())return;const a={username:l.value.username.trim(),email:l.value.email.trim(),first_name:l.value.first_name?.trim()||"",last_name:l.value.last_name?.trim()||"",role:l.value.role||"student",is_active:!!l.value.is_active,twoFAEnabled:!!l.value.twoFAEnabled,bio:l.value.bio||null};d.value==="create"?await n.create(a):await n.updateById(l.value.id,a),x.value=!1,await b({},!0)},W=async a=>{!a?.id||!(await F.fire({title:`Delete @${a.username}?`,text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Delete",cancelButtonText:"Cancel"})).isConfirmed||(await n.deleteById(a.id),await b({},!0),await F.fire("Deleted","User record removed.","success"))},K=async a=>{const e=a?.target?.files?.[0];!e||!l.value.id||(await n.uploadAvatar(l.value.id,e),await n.fetchById(l.value.id),l.value.avatar=n.selectedUser?.avatar||l.value.avatar)},Q=async a=>{const e=a?.target?.files?.[0];!e||!l.value.id||(await n.uploadCover(l.value.id,e),await n.fetchById(l.value.id),l.value.cover=n.selectedUser?.cover||l.value.cover)},A=g([]),B=g(!1),V=async a=>{try{B.value=!0;const e=await n.fetchUserClubs(a,{force:!0});A.value=Array.isArray(e)?e:[]}catch{A.value=[]}finally{B.value=!1}};return(a,e)=>(o(),i(C,null,[f(ee,null,{default:_(()=>[f(le,null,{default:_(()=>[r(n).error?(o(),X(ve,{key:0,color:"danger"},{default:_(()=>[p(u(r(n).error),1)]),_:1})):w("",!0),f(me,{icon:r(ae),title:"Users",main:""},{default:_(()=>[t("div",be,[f($,{icon:r(oe),color:"primary",label:"New User",onClick:I},null,8,["icon"]),f($,{icon:r(ie),color:"info",label:"Refresh",onClick:e[0]||(e[0]=s=>b({},!0))},null,8,["icon"])])]),_:1},8,["icon"]),t("div",fe,[t("div",_e,[(o(),i("svg",xe,[t("path",{d:r(ne)},null,8,ge)])),e[17]||(e[17]=t("span",{class:"font-medium text-sm"},"Filters",-1))]),t("div",we,[c(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>m.value.q=s),placeholder:"Search username, name, email…",class:"border rounded px-2 py-2 md:col-span-2",onKeyup:e[2]||(e[2]=Z(s=>b({page:1}),["enter"]))},null,544),[[h,m.value.q]]),c(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>m.value.role=s),class:"border rounded px-2 py-2"},[e[18]||(e[18]=t("option",{value:""},"All roles",-1)),(o(),i(C,null,U(E,s=>t("option",{key:s,value:s},u(s),9,ye)),64))],512),[[k,m.value.role]]),c(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>m.value.is_active=s),class:"border rounded px-2 py-2"},[(o(),i(C,null,U(P,s=>t("option",{key:s.label,value:s.value},"Active: "+u(s.label),9,he)),64))],512),[[k,m.value.is_active]]),t("div",ke,[t("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:e[5]||(e[5]=s=>b({page:1}))}," Apply "),t("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:e[6]||(e[6]=s=>b({q:"",role:"",is_active:"",page:1},!0))}," Reset ")])])]),f(pe,{columns:q,data:S.value,loading:r(n).isLoading,onQueryChange:D},{"cell-avatar":_(({value:s})=>[t("div",Ce,[s?(o(),i("img",{key:0,src:s,alt:"avatar",class:"w-full h-full object-cover"},null,8,Ae)):(o(),i("div",Ue,"N/A "))])]),"cell-is_active":_(({value:s})=>[f(N,{text:s?"Active":"Inactive",tone:j(s)},null,8,["text","tone"])]),"cell-twoFAEnabled":_(({value:s})=>[t("div",Be,[(o(),i("svg",Ee,[t("path",{d:r(ce)},null,8,Ve)])),f(N,{text:s?"Enabled":"Disabled",tone:T(s)},null,8,["text","tone"])])]),"cell-actions":_(({row:s})=>[t("div",Fe,[t("button",{class:"px-2 py-1 text-[12px] rounded bg-gray-100 hover:bg-gray-200 inline-flex items-center gap-1",onClick:y=>L(s),title:"View"},[(o(),i("svg",Ne,[t("path",{d:r(de)},null,8,Pe)])),e[19]||(e[19]=p(" View ",-1))],8,$e),t("button",{class:"px-2 py-1 text-[12px] rounded bg-amber-100 hover:bg-amber-200 inline-flex items-center gap-1",onClick:y=>M(s),title:"Edit"},[(o(),i("svg",je,[t("path",{d:r(re)},null,8,Te)])),e[20]||(e[20]=p(" Edit ",-1))],8,Se),t("button",{class:"px-2 py-1 text-[12px] rounded bg-rose-100 hover:bg-rose-200 inline-flex items-center gap-1",onClick:y=>W(s),title:"Delete"},[(o(),i("svg",De,[t("path",{d:r(ue)},null,8,Ie)])),e[21]||(e[21]=p(" Delete ",-1))],8,qe)])]),_:1},8,["data","loading"])]),_:1})]),_:1}),x.value?(o(),i("div",Le,[t("div",Me,[t("div",Oe,[t("h2",Re,u(d.value==="create"?"New User":d.value==="edit"?"Edit User":"View User"),1),t("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:e[7]||(e[7]=s=>x.value=!1)},"Close")]),t("div",ze,[t("div",We,[e[22]||(e[22]=t("label",{class:"block mb-1"},[p("Username "),t("span",{class:"text-red-500"},"*")],-1)),c(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>l.value.username=s),class:"w-full border rounded px-2.5 py-2",disabled:d.value==="view"},null,8,Ke),[[h,l.value.username]]),v.value.username?(o(),i("p",Qe,u(v.value.username),1)):w("",!0)]),t("div",Ye,[e[23]||(e[23]=t("label",{class:"block mb-1"},[p("Email "),t("span",{class:"text-red-500"},"*")],-1)),c(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>l.value.email=s),type:"email",class:"w-full border rounded px-2.5 py-2",disabled:d.value==="view"},null,8,Ge),[[h,l.value.email]]),v.value.email?(o(),i("p",He,u(v.value.email),1)):w("",!0)]),t("div",null,[e[24]||(e[24]=t("label",{class:"block mb-1"},"First name",-1)),c(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>l.value.first_name=s),class:"w-full border rounded px-2.5 py-2",disabled:d.value==="view"},null,8,Je),[[h,l.value.first_name]])]),t("div",null,[e[25]||(e[25]=t("label",{class:"block mb-1"},"Last name",-1)),c(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>l.value.last_name=s),class:"w-full border rounded px-2.5 py-2",disabled:d.value==="view"},null,8,Xe),[[h,l.value.last_name]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"block mb-1"},[p("Role "),t("span",{class:"text-red-500"},"*")],-1)),c(t("select",{"onUpdate:modelValue":e[12]||(e[12]=s=>l.value.role=s),class:"w-full border rounded px-2.5 py-2",disabled:d.value==="view"},[(o(),i(C,null,U(E,s=>t("option",{key:s,value:s},u(s),9,et)),64))],8,Ze),[[k,l.value.role]]),v.value.role?(o(),i("p",tt,u(v.value.role),1)):w("",!0)]),t("div",null,[e[28]||(e[28]=t("label",{class:"block mb-1"},"Active",-1)),c(t("select",{"onUpdate:modelValue":e[13]||(e[13]=s=>l.value.is_active=s),class:"w-full border rounded px-2.5 py-2",disabled:d.value==="view"},e[27]||(e[27]=[t("option",{value:!0},"Yes",-1),t("option",{value:!1},"No",-1)]),8,st),[[k,l.value.is_active]])]),t("div",null,[e[30]||(e[30]=t("label",{class:"block mb-1"},"Two-Factor Auth",-1)),c(t("select",{"onUpdate:modelValue":e[14]||(e[14]=s=>l.value.twoFAEnabled=s),class:"w-full border rounded px-2.5 py-2",disabled:d.value==="view"},e[29]||(e[29]=[t("option",{value:!0},"Enabled",-1),t("option",{value:!1},"Disabled",-1)]),8,lt),[[k,l.value.twoFAEnabled]])]),t("div",at,[e[31]||(e[31]=t("label",{class:"block mb-1"},"Bio",-1)),c(t("textarea",{"onUpdate:modelValue":e[15]||(e[15]=s=>l.value.bio=s),rows:"2",class:"w-full border rounded px-2.5 py-2",disabled:d.value==="view"},null,8,ot),[[h,l.value.bio]])])]),l.value.id?(o(),i("div",it,[e[34]||(e[34]=t("div",{class:"flex items-center justify-between mb-2"},[t("div",{class:"text-sm font-medium"},"Media")],-1)),t("div",nt,[t("div",null,[t("label",dt,[(o(),i("svg",rt,[t("path",{d:r(te)},null,8,ut)])),e[32]||(e[32]=p(" Avatar ",-1))]),t("div",ct,[t("div",vt,[l.value.avatar?(o(),i("img",{key:0,src:l.value.avatar,class:"w-full h-full object-cover"},null,8,mt)):(o(),i("div",pt,"N/A "))]),t("input",{type:"file",accept:"image/*",disabled:d.value==="view",onChange:K},null,40,bt)])]),t("div",null,[t("label",ft,[(o(),i("svg",_t,[t("path",{d:r(se)},null,8,xt)])),e[33]||(e[33]=p(" Cover ",-1))]),t("div",gt,[t("div",wt,[l.value.cover?(o(),i("img",{key:0,src:l.value.cover,class:"w-full h-full object-cover"},null,8,yt)):(o(),i("div",ht,"N/A "))]),t("input",{type:"file",accept:"image/*",disabled:d.value==="view",onChange:Q},null,40,kt)])])])])):w("",!0),t("div",Ct,[t("div",At,[e[35]||(e[35]=t("div",{class:"text-sm font-medium mb-2"},"Clubs",-1)),B.value?(o(),i("div",Ut,"Loading clubs…")):A.value.length?(o(),i("ul",Et,[(o(!0),i(C,null,U(A.value,s=>(o(),i("li",{key:s.id,class:"flex items-center justify-between rounded border px-2 py-1 bg-gray-50"},[t("span",Vt,u(s.name),1),t("span",Ft,u(s.code||""),1)]))),128))])):(o(),i("div",Bt,"No clubs found for this user."))])]),t("div",$t,[t("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:e[16]||(e[16]=s=>x.value=!1)},"Close"),d.value!=="view"?(o(),i("button",{key:0,class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:z},u(d.value==="edit"?"Save Changes":"Create User"),1)):w("",!0)])])])):w("",!0)],64))}};export{Dt as default};
