import{N as c,O as C,r as m}from"./index.B0nDbTtE.js";function B(s){return typeof Blob<"u"&&(s instanceof Blob||s instanceof File)}const o={async create(s){const{data:a}=await c.post("/clubs",s);return a},async getById(s){const{data:a}=await c.get(`/clubs/${s}`);return a},async updateById(s,a){const{data:r}=await c.put(`/clubs/${s}`,a);return r?.data??r},async canEditMedia(s){const{data:a}=await c.get(`/clubs/${s}/can-edit-media`);return{can_edit:!!a?.can_edit,member_role:a?.member_role||null}},async delete(s){const{data:a}=await c.delete(`/clubs/${s}`);return a},async list(s={}){const a={officer:!1,...s},{data:r}=await c.get("/clubs",{params:a});return r},async addUsers(s,a){const{data:r}=await c.post(`/clubs/${s}/users`,{userIds:a});return r},async removeUser(s,a){const{data:r}=await c.delete(`/clubs/${s}/users/${a}`);return r},async updateMember(s,a,r){const{data:i}=await c.patch(`/clubs/${s}/users/${a}`,r);return i?.data},async uploadAttachment(s,a){if(B(a)){const r=new FormData;r.append("file",a);const{data:i}=await c.post(`/clubs/${s}/attachments`,r,{headers:{"Content-Type":"multipart/form-data"}});return i}else{const{data:r}=await c.post(`/clubs/${s}/attachments`,{file:a});return r}},async deleteAttachment(s,a){const{data:r}=await c.delete(`/clubs/${s}/attachments/${a}`);return r}},P=C("club",()=>{const s=m({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),a=m(!1),r=m(null),i=m(!1),n=m(null),v=m({}),f=l=>{if(!l?.id)return;const t=s.value.data.findIndex(e=>e.id===l.id);t!==-1&&(s.value.data[t]=l)},p=(l,t)=>{if(!t)return;if(n.value?.id===l&&Array.isArray(n.value.users)){const u=n.value.users.findIndex(d=>d.id===t.user_id);if(u!==-1){const d=n.value.users[u];n.value.users[u]={...d,UserClub:{...d.UserClub||{},...t}}}}const e=s.value.data.findIndex(u=>u.id===l);if(e!==-1&&Array.isArray(s.value.data[e].users)){const u=s.value.data[e].users,d=u.findIndex(y=>y.id===t.user_id);if(d!==-1){const y=u[d];u[d]={...y,UserClub:{...y.UserClub||{},...t}}}}},g=async(l={},t=!1)=>{if(r.value=null,!(!t&&i.value))try{a.value=!0;const e=await o.list(l);Object.assign(s.value,{total:e.total||0,totalPages:e.totalPages||1,currentPage:l.page||1,pageSize:l.limit||10,data:e.data||[]}),i.value=!0}catch(e){r.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to fetch clubs"}finally{a.value=!1}},h=async l=>{r.value=null;try{a.value=!0;const t=await o.getById(l);n.value=t,f(t)}catch(t){r.value=t?.response?.data?.message||t?.response?.message||t?.message||"Failed to fetch club"}finally{a.value=!1}},b=async l=>{r.value=null;try{a.value=!0;const t=await o.create(l);s.value.data.push(t),s.value.total+=1}catch(t){r.value=t?.response?.data?.message||t?.response?.message||t?.message||"Failed to create club"}finally{a.value=!1}},w=async(l,t)=>{r.value=null;try{a.value=!0;const e=await o.updateById(l,t);f(e),n.value?.id===l&&(n.value=e)}catch(e){r.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to update club"}finally{a.value=!1}},A=async l=>{r.value=null;try{a.value=!0,await o.delete(l),s.value.data=s.value.data.filter(t=>t.id!==l),s.value.total=Math.max(0,s.value.total-1),n.value?.id===l&&(n.value=null)}catch(t){r.value=t?.response?.data?.message||t?.response?.message||t?.message||"Failed to delete club"}finally{a.value=!1}},F=async(l,t)=>{r.value=null;try{a.value=!0;const e=await o.addUsers(l,t);f(e),n.value?.id===l&&(n.value=e)}catch(e){r.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to add users to club"}finally{a.value=!1}},_=async(l,t)=>{r.value=null;try{a.value=!0,await o.removeUser(l,t),n.value?.id===l&&Array.isArray(n.value.users)&&(n.value.users=n.value.users.filter(u=>u.id!==t));const e=s.value.data.findIndex(u=>u.id===l);e!==-1&&Array.isArray(s.value.data[e].users)&&(s.value.data[e].users=s.value.data[e].users.filter(u=>u.id!==t))}catch(e){r.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to remove user from club"}finally{a.value=!1}};async function $(l,t,e){try{a.value=!0;const u=await o.updateMember(l,t,{status:e});return p(l,u),u}catch(u){throw r.value=u?.response?.data?.message||u?.response?.message||u?.message||"Failed to update member status",u}finally{a.value=!1}}async function x(l,t,e){try{a.value=!0;const u=await o.updateMember(l,t,{role:e});return p(l,u),u}catch(u){throw r.value=u?.response?.data?.message||u?.response?.message||u?.message||"Failed to update member role",u}finally{a.value=!1}}return{clubs:s,selectedClub:n,permissionByClub:v,isLoading:a,error:r,isLoaded:i,fetchAll:g,fetchById:h,create:b,updateById:w,deleteById:A,addUsersToClub:F,removeUserFromClub:_,updateMemberRole:x,updateMemberStatus:$,uploadAttachment:async(l,t)=>{r.value=null;try{a.value=!0;const e=await o.uploadAttachment(l,t);return f(e),n.value?.id===l&&(n.value=e),e}catch(e){throw r.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to upload attachment",e}finally{a.value=!1}},deleteAttachment:async(l,t)=>{r.value=null;try{a.value=!0;const e=await o.deleteAttachment(l,t);return f(e),n.value?.id===l&&(n.value=e),e}catch(e){throw r.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to delete attachment",e}finally{a.value=!1}},checkCanEditMedia:async(l,{force:t=!1}={})=>{if(!l)return{can_edit:!1,member_role:null};const e=String(l);if(!t&&v.value[e])return v.value[e];try{const u=await o.canEditMedia(l),d={can_edit:!!u?.can_edit,member_role:u?.member_role||null};return v.value[e]=d,d}catch{return v.value[e]={can_edit:!1,member_role:null},v.value[e]}},resetStore:()=>{s.value={total:0,totalPages:1,currentPage:1,pageSize:10,data:[]},n.value=null,i.value=!1,a.value=!1,r.value=null}}});export{P as u};
