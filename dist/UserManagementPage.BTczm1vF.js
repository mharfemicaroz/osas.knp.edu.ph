import{y as Y,u as G,r as g,o as H,c as J,a as i,f as _,d as u,l as x,e as s,t as v,h as c,k as p,v as b,F as k,B as C,A as U,g as m,q as o,z as X,L as Z,S as F}from"./index.DuRiRdF7.js";import{_ as ee,N as se,O as te,a as le,w as ae,K as oe,L as ie,M as ne,v as de,y as re,z as ue,P as ve}from"./SectionMain.DFGdWOnK.js";import{_ as ce,a as me,b as P,B as pe,c as $}from"./Badge.CPwJVr5g.js";import"./ToasterComponent.BjE6fu-S.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const be={class:"flex items-center gap-2"},fe={class:"p-3 mb-4 rounded-xl border bg-white/60"},we={class:"flex items-center gap-2 mb-2 text-gray-700"},_e={class:"w-4 h-4",viewBox:"0 0 24 24"},xe=["d"],ye={class:"grid grid-cols-1 md:grid-cols-6 gap-2 text-sm"},ge=["value"],he=["value"],ke={class:"flex items-center gap-2 md:col-span-2"},Ce={class:"w-9 h-9 rounded-full overflow-hidden bg-gray-100 border"},Ae=["src"],Ue={key:1,class:"w-full h-full flex items-center justify-center text-[10px] text-gray-400"},Be={class:"inline-flex items-center gap-1"},Ve={class:"w-3.5 h-3.5 opacity-70",viewBox:"0 0 24 24"},Ee=["d"],Fe={class:"flex items-center gap-1"},Pe=["onClick"],$e={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},Ne=["d"],Se=["onClick"],qe={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},je=["d"],Te=["onClick"],De={class:"w-3.5 h-3.5",viewBox:"0 0 24 24"},Ie=["d"],Le={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},Me={class:"bg-white p-4 md:p-5 rounded-2xl shadow-xl w-[980px] max-h-screen overflow-auto"},Oe={class:"flex items-center justify-between mb-3"},Re={class:"text-lg font-semibold"},ze={class:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm"},We={class:"md:col-span-3"},Ke=["disabled"],Qe={key:0,class:"text-red-600 text-[11px] mt-1"},Ye={class:"md:col-span-3"},Ge=["disabled"],He={key:0,class:"text-red-600 text-[11px] mt-1"},Je={key:0,class:"md:col-span-3"},Xe={key:0,class:"text-red-600 text-[11px] mt-1"},Ze={key:1,class:"md:col-span-3"},es={key:0,class:"text-red-600 text-[11px] mt-1"},ss={key:2,class:"md:col-span-3"},ts={key:0,class:"text-red-600 text-[11px] mt-1"},ls={key:3,class:"md:col-span-3"},as={key:0,class:"text-red-600 text-[11px] mt-1"},os=["disabled"],is=["disabled"],ns=["disabled"],ds=["value"],rs={key:0,class:"text-red-600 text-[11px] mt-1"},us=["disabled"],vs=["disabled"],cs={class:"md:col-span-3"},ms=["disabled"],ps={key:0,class:"mt-4 p-3 rounded-xl border bg-white/70"},bs={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},fs={class:"block mb-1 inline-flex items-center gap-2"},ws={class:"w-4 h-4 opacity-80",viewBox:"0 0 24 24"},_s=["d"],xs={class:"flex items-center gap-3"},ys={class:"w-16 h-16 rounded-full overflow-hidden bg-gray-100 border"},gs=["src"],hs={key:1,class:"w-full h-full flex items-center justify-center text-[10px] text-gray-400"},ks=["disabled"],Cs={class:"block mb-1 inline-flex items-center gap-2"},As={class:"w-4 h-4 opacity-80",viewBox:"0 0 24 24"},Us=["d"],Bs={class:"flex items-center gap-3"},Vs={class:"w-28 h-16 rounded-lg overflow-hidden bg-gray-100 border"},Es=["src"],Fs={key:1,class:"w-full h-full flex items-center justify-center text-[10px] text-gray-400"},Ps=["disabled"],$s={class:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-3"},Ns={class:"p-3 rounded-xl border bg-white/70"},Ss={key:0,class:"text-xs text-gray-500"},qs={key:1,class:"text-xs text-gray-500"},js={key:2,class:"space-y-1 text-sm"},Ts={class:"truncate"},Ds={class:"text-[11px] text-gray-500"},Is={class:"flex justify-end gap-2 mt-5"},Ks={__name:"UserManagementPage",setup(Ls){const d=Y();G();const f=g({page:1,limit:10,q:"",role:"",is_active:""}),V=["admin","manager","officer","student"],N=[{label:"All",value:""},{label:"Yes",value:"true"},{label:"No",value:"false"}],w=async(a={},e=!0)=>{f.value={...f.value,...a};const t={...f.value};["q","role","is_active"].forEach(h=>{(t[h]===""||t[h]==null)&&delete t[h]}),t.q&&(t.username=t.q,delete t.q),await d.fetchAll(t,e)};H(async()=>{await w({page:1,limit:10},!0)});const S=J(()=>({total:d.users.total||0,totalPages:d.users.totalPages||1,currentPage:d.users.currentPage||1,pageSize:d.users.pageSize||10,data:d.users.data||[]})),q=a=>a?"emerald":"zinc",j=a=>a?"indigo":"gray",T=[{key:"avatar",label:"Avatar",width:64,formatter:(a,e)=>e.avatar||null,sortable:!1},{key:"username",label:"Username",sortable:!0,minWidth:160},{key:"name",label:"Name",sortable:!1,minWidth:200,formatter:(a,e)=>`${e.first_name||""} ${e.last_name||""}`.trim()||"—"},{key:"email",label:"Email",sortable:!0,minWidth:220},{key:"role",label:"Role",sortable:!0,width:120},{key:"is_active",label:"Active",sortable:!0,width:100},{key:"twoFAEnabled",label:"2FA",sortable:!0,width:100}],D=async a=>{await w(a)},y=g(!1),n=g("create"),l=g({id:null,username:"",email:"",first_name:"",last_name:"",role:"student",is_active:!0,twoFAEnabled:!1,bio:"",avatar:null,cover:null,password:"",confirm_password:""}),r=g({}),I=()=>{n.value="create",l.value={id:null,username:"",email:"",first_name:"",last_name:"",role:"student",is_active:!0,twoFAEnabled:!1,bio:"",avatar:null,cover:null,password:"",confirm_password:""},r.value={},y.value=!0},L=async a=>{await d.fetchById(a.id);const e=d.selectedUser||a;n.value="view",l.value={id:e.id,username:e.username||"",email:e.email||"",first_name:e.first_name||"",last_name:e.last_name||"",role:e.role||"student",is_active:!!e.is_active,twoFAEnabled:!!e.twoFAEnabled,bio:e.bio||"",avatar:e.avatar||null,cover:e.cover||null,password:"",confirm_password:""},r.value={},y.value=!0,await E(e.id)},M=async a=>{await d.fetchById(a.id);const e=d.selectedUser||a;n.value="edit",l.value={id:e.id,username:e.username||"",email:e.email||"",first_name:e.first_name||"",last_name:e.last_name||"",role:e.role||"student",is_active:!!e.is_active,twoFAEnabled:!!e.twoFAEnabled,bio:e.bio||"",avatar:e.avatar||null,cover:e.cover||null},r.value={},y.value=!0,await E(e.id)},O=a=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(a||"").trim()),R=()=>{const a={};return l.value.username?.trim()||(a.username="Username is required"),O(l.value.email)||(a.email="Valid email is required"),l.value.role?.trim()||(a.role="Role is required"),n.value==="create"?(l.value.password?.trim()||(a.password="Password is required"),(l.value.password||"").length<6&&(a.password="Password must be at least 6 chars"),(l.value.confirm_password||"")!==(l.value.password||"")&&(a.confirm_password="Passwords do not match")):n.value==="edit"&&(l.value.password?.length&&l.value.password.length<6&&(a.password="At least 6 chars"),l.value.password?.length&&l.value.confirm_password!==l.value.password&&(a.confirm_password="Passwords do not match")),r.value=a,Object.keys(a).length===0},z=async()=>{if(n.value==="view"||!R())return;const a={username:l.value.username.trim(),email:l.value.email.trim(),first_name:l.value.first_name?.trim()||"",last_name:l.value.last_name?.trim()||"",role:l.value.role||"student",is_active:!!l.value.is_active,twoFAEnabled:!!l.value.twoFAEnabled,bio:l.value.bio||null};n.value==="create"?(a.password=l.value.password,await d.create(a)):(l.value.password&&(a.password=l.value.password),await d.updateById(l.value.id,a)),y.value=!1,await w({},!0)},W=async a=>{!a?.id||!(await F.fire({title:`Delete @${a.username}?`,text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Delete",cancelButtonText:"Cancel"})).isConfirmed||(await d.deleteById(a.id),await w({},!0),await F.fire("Deleted","User record removed.","success"))},K=async a=>{const e=a?.target?.files?.[0];!e||!l.value.id||(await d.uploadAvatar(l.value.id,e),await d.fetchById(l.value.id),l.value.avatar=d.selectedUser?.avatar||l.value.avatar)},Q=async a=>{const e=a?.target?.files?.[0];!e||!l.value.id||(await d.uploadCover(l.value.id,e),await d.fetchById(l.value.id),l.value.cover=d.selectedUser?.cover||l.value.cover)},A=g([]),B=g(!1),E=async a=>{try{B.value=!0;const e=await d.fetchUserClubs(a,{force:!0});A.value=Array.isArray(e)?e:[]}catch{A.value=[]}finally{B.value=!1}};return(a,e)=>(o(),i(k,null,[_(ee,null,{default:x(()=>[_(le,null,{default:x(()=>[m(d).error?(o(),X(ce,{key:0,color:"danger"},{default:x(()=>[p(v(m(d).error),1)]),_:1})):u("",!0),_(me,{icon:m(ae),title:"Users",main:""},{default:x(()=>[s("div",be,[_(P,{icon:m(oe),color:"primary",label:"New User",onClick:I},null,8,["icon"]),_(P,{icon:m(ie),color:"info",label:"Refresh",onClick:e[0]||(e[0]=t=>w({},!0))},null,8,["icon"])])]),_:1},8,["icon"]),s("div",fe,[s("div",we,[(o(),i("svg",_e,[s("path",{d:m(ne)},null,8,xe)])),e[21]||(e[21]=s("span",{class:"font-medium text-sm"},"Filters",-1))]),s("div",ye,[c(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>f.value.q=t),placeholder:"Search username, name, email…",class:"border rounded px-2 py-2 md:col-span-2",onKeyup:e[2]||(e[2]=Z(t=>w({page:1}),["enter"]))},null,544),[[b,f.value.q]]),c(s("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>f.value.role=t),class:"border rounded px-2 py-2"},[e[22]||(e[22]=s("option",{value:""},"All roles",-1)),(o(),i(k,null,U(V,t=>s("option",{key:t,value:t},v(t),9,ge)),64))],512),[[C,f.value.role]]),c(s("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>f.value.is_active=t),class:"border rounded px-2 py-2"},[(o(),i(k,null,U(N,t=>s("option",{key:t.label,value:t.value},"Active: "+v(t.label),9,he)),64))],512),[[C,f.value.is_active]]),s("div",ke,[s("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:e[5]||(e[5]=t=>w({page:1}))}," Apply "),s("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:e[6]||(e[6]=t=>w({q:"",role:"",is_active:"",page:1},!0))}," Reset ")])])]),_(pe,{columns:T,data:S.value,loading:m(d).isLoading,onQueryChange:D},{"cell-avatar":x(({value:t})=>[s("div",Ce,[t?(o(),i("img",{key:0,src:t,alt:"avatar",class:"w-full h-full object-cover"},null,8,Ae)):(o(),i("div",Ue,"N/A "))])]),"cell-is_active":x(({value:t})=>[_($,{text:t?"Active":"Inactive",tone:q(t)},null,8,["text","tone"])]),"cell-twoFAEnabled":x(({value:t})=>[s("div",Be,[(o(),i("svg",Ve,[s("path",{d:m(ve)},null,8,Ee)])),_($,{text:t?"Enabled":"Disabled",tone:j(t)},null,8,["text","tone"])])]),"cell-actions":x(({row:t})=>[s("div",Fe,[s("button",{class:"px-2 py-1 text-[12px] rounded bg-gray-100 hover:bg-gray-200 inline-flex items-center gap-1",onClick:h=>L(t),title:"View"},[(o(),i("svg",$e,[s("path",{d:m(de)},null,8,Ne)])),e[23]||(e[23]=p(" View ",-1))],8,Pe),s("button",{class:"px-2 py-1 text-[12px] rounded bg-amber-100 hover:bg-amber-200 inline-flex items-center gap-1",onClick:h=>M(t),title:"Edit"},[(o(),i("svg",qe,[s("path",{d:m(re)},null,8,je)])),e[24]||(e[24]=p(" Edit ",-1))],8,Se),s("button",{class:"px-2 py-1 text-[12px] rounded bg-rose-100 hover:bg-rose-200 inline-flex items-center gap-1",onClick:h=>W(t),title:"Delete"},[(o(),i("svg",De,[s("path",{d:m(ue)},null,8,Ie)])),e[25]||(e[25]=p(" Delete ",-1))],8,Te)])]),_:1},8,["data","loading"])]),_:1})]),_:1}),y.value?(o(),i("div",Le,[s("div",Me,[s("div",Oe,[s("h2",Re,v(n.value==="create"?"New User":n.value==="edit"?"Edit User":"View User"),1),s("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:e[7]||(e[7]=t=>y.value=!1)},"Close")]),s("div",ze,[s("div",We,[e[26]||(e[26]=s("label",{class:"block mb-1"},[p("Username "),s("span",{class:"text-red-500"},"*")],-1)),c(s("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>l.value.username=t),class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},null,8,Ke),[[b,l.value.username]]),r.value.username?(o(),i("p",Qe,v(r.value.username),1)):u("",!0)]),s("div",Ye,[e[27]||(e[27]=s("label",{class:"block mb-1"},[p("Email "),s("span",{class:"text-red-500"},"*")],-1)),c(s("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>l.value.email=t),type:"email",class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},null,8,Ge),[[b,l.value.email]]),r.value.email?(o(),i("p",He,v(r.value.email),1)):u("",!0)]),n.value!=="view"?(o(),i(k,{key:0},[n.value==="create"?(o(),i("div",Je,[e[28]||(e[28]=s("label",{class:"block mb-1"},[p("Password "),s("span",{class:"text-red-500"},"*")],-1)),c(s("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>l.value.password=t),type:"password",autocomplete:"new-password",class:"w-full border rounded px-2.5 py-2"},null,512),[[b,l.value.password]]),r.value.password?(o(),i("p",Xe,v(r.value.password),1)):u("",!0)])):u("",!0),n.value==="create"?(o(),i("div",Ze,[e[29]||(e[29]=s("label",{class:"block mb-1"},[p("Confirm Password "),s("span",{class:"text-red-500"},"*")],-1)),c(s("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>l.value.confirm_password=t),type:"password",autocomplete:"new-password",class:"w-full border rounded px-2.5 py-2"},null,512),[[b,l.value.confirm_password]]),r.value.confirm_password?(o(),i("p",es,v(r.value.confirm_password),1)):u("",!0)])):u("",!0),n.value==="edit"?(o(),i("div",ss,[e[30]||(e[30]=s("label",{class:"block mb-1"},"New Password (optional)",-1)),c(s("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>l.value.password=t),type:"password",autocomplete:"new-password",class:"w-full border rounded px-2.5 py-2",placeholder:"Leave blank to keep current"},null,512),[[b,l.value.password]]),r.value.password?(o(),i("p",ts,v(r.value.password),1)):u("",!0)])):u("",!0),n.value==="edit"&&l.value.password?(o(),i("div",ls,[e[31]||(e[31]=s("label",{class:"block mb-1"},"Confirm New Password",-1)),c(s("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>l.value.confirm_password=t),type:"password",autocomplete:"new-password",class:"w-full border rounded px-2.5 py-2"},null,512),[[b,l.value.confirm_password]]),r.value.confirm_password?(o(),i("p",as,v(r.value.confirm_password),1)):u("",!0)])):u("",!0)],64)):u("",!0),s("div",null,[e[32]||(e[32]=s("label",{class:"block mb-1"},"First name",-1)),c(s("input",{"onUpdate:modelValue":e[14]||(e[14]=t=>l.value.first_name=t),class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},null,8,os),[[b,l.value.first_name]])]),s("div",null,[e[33]||(e[33]=s("label",{class:"block mb-1"},"Last name",-1)),c(s("input",{"onUpdate:modelValue":e[15]||(e[15]=t=>l.value.last_name=t),class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},null,8,is),[[b,l.value.last_name]])]),s("div",null,[e[34]||(e[34]=s("label",{class:"block mb-1"},[p("Role "),s("span",{class:"text-red-500"},"*")],-1)),c(s("select",{"onUpdate:modelValue":e[16]||(e[16]=t=>l.value.role=t),class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},[(o(),i(k,null,U(V,t=>s("option",{key:t,value:t},v(t),9,ds)),64))],8,ns),[[C,l.value.role]]),r.value.role?(o(),i("p",rs,v(r.value.role),1)):u("",!0)]),s("div",null,[e[36]||(e[36]=s("label",{class:"block mb-1"},"Active",-1)),c(s("select",{"onUpdate:modelValue":e[17]||(e[17]=t=>l.value.is_active=t),class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},e[35]||(e[35]=[s("option",{value:!0},"Yes",-1),s("option",{value:!1},"No",-1)]),8,us),[[C,l.value.is_active]])]),s("div",null,[e[38]||(e[38]=s("label",{class:"block mb-1"},"Two-Factor Auth",-1)),c(s("select",{"onUpdate:modelValue":e[18]||(e[18]=t=>l.value.twoFAEnabled=t),class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},e[37]||(e[37]=[s("option",{value:!0},"Enabled",-1),s("option",{value:!1},"Disabled",-1)]),8,vs),[[C,l.value.twoFAEnabled]])]),s("div",cs,[e[39]||(e[39]=s("label",{class:"block mb-1"},"Bio",-1)),c(s("textarea",{"onUpdate:modelValue":e[19]||(e[19]=t=>l.value.bio=t),rows:"2",class:"w-full border rounded px-2.5 py-2",disabled:n.value==="view"},null,8,ms),[[b,l.value.bio]])])]),l.value.id?(o(),i("div",ps,[e[42]||(e[42]=s("div",{class:"flex items-center justify-between mb-2"},[s("div",{class:"text-sm font-medium"},"Media")],-1)),s("div",bs,[s("div",null,[s("label",fs,[(o(),i("svg",ws,[s("path",{d:m(se)},null,8,_s)])),e[40]||(e[40]=p(" Avatar ",-1))]),s("div",xs,[s("div",ys,[l.value.avatar?(o(),i("img",{key:0,src:l.value.avatar,class:"w-full h-full object-cover"},null,8,gs)):(o(),i("div",hs,"N/A "))]),s("input",{type:"file",accept:"image/*",disabled:n.value==="view",onChange:K},null,40,ks)])]),s("div",null,[s("label",Cs,[(o(),i("svg",As,[s("path",{d:m(te)},null,8,Us)])),e[41]||(e[41]=p(" Cover ",-1))]),s("div",Bs,[s("div",Vs,[l.value.cover?(o(),i("img",{key:0,src:l.value.cover,class:"w-full h-full object-cover"},null,8,Es)):(o(),i("div",Fs,"N/A "))]),s("input",{type:"file",accept:"image/*",disabled:n.value==="view",onChange:Q},null,40,Ps)])])])])):u("",!0),s("div",$s,[s("div",Ns,[e[43]||(e[43]=s("div",{class:"text-sm font-medium mb-2"},"Clubs",-1)),B.value?(o(),i("div",Ss,"Loading clubs…")):A.value.length?(o(),i("ul",js,[(o(!0),i(k,null,U(A.value,t=>(o(),i("li",{key:t.id,class:"flex items-center justify-between rounded border px-2 py-1 bg-gray-50"},[s("span",Ts,v(t.name),1),s("span",Ds,v(t.code||""),1)]))),128))])):(o(),i("div",qs,"No clubs found for this user."))])]),s("div",Is,[s("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:e[20]||(e[20]=t=>y.value=!1)},"Close"),n.value!=="view"?(o(),i("button",{key:0,class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:z},v(n.value==="edit"?"Save Changes":"Create User"),1)):u("",!0)])])])):u("",!0)],64))}};export{Ks as default};
