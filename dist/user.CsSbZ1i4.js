import{M as o,N as h,r as d}from"./index.DIg0rV2V.js";function v(t){if(!t||typeof t!="object")return t;const e={...t};return e.avatar=t.avatar??null,e.cover=t.cover??null,e}function g(t,e){return typeof e=="string"?o.post(t,{file:e}):new Promise((s,c)=>{const u=new FileReader;u.onload=()=>{o.post(t,{file:u.result}).then(s).catch(c)},u.onerror=c,u.readAsDataURL(e)})}const n={async create(t){const{data:e}=await o.post("/users",t);return v(e)},async getById(t){const{data:e}=await o.get(`/users/${t}`);return v(e)},async updateById(t,e){const{data:s}=await o.put(`/users/${t}`,e);return v(s)},async delete(t){const{data:e}=await o.delete(`/users/${t}`);return e},async list(t){const{data:e}=await o.get("/users",{params:t});return{...e,data:Array.isArray(e?.data)?e.data.map(v):[]}},async uploadAvatar(t,e){const{data:s}=await g(`/users/${t}/avatar`,e);return v(s)},async uploadCover(t,e){const{data:s}=await g(`/users/${t}/cover`,e);return v(s)},async changePassword({old_password:t,new_password:e}){const{data:s}=await o.post("/auth/change-password",{old_password:t,new_password:e});return s},async getClubs(t){const{data:e}=await o.get(`/users/${t}/clubs`);return Array.isArray(e?.clubs)?e.clubs:[]}},$=h("user",()=>{const t=d({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),e=d(!1),s=d(null),c=d(!1),u=d(null),i=d({}),f=d([]),y=r=>{if(!r?.id)return;const l=t.value.data.findIndex(a=>a.id===r.id);l!==-1&&(t.value.data[l]=r)};return{users:t,selectedUser:u,selectedUserClubs:f,clubsByUser:i,isLoading:e,error:s,isLoaded:c,fetchAll:async(r={},l=!1)=>{if(s.value=null,!(!l&&c.value))try{e.value=!0;const a=await n.list(r);Object.assign(t.value,{total:a.total||0,totalPages:a.totalPages||1,currentPage:r.page||1,pageSize:r.limit||10,data:a.data||[]}),c.value=!0}catch(a){s.value=a?.response?.data?.message||a?.message||"Failed to fetch users"}finally{e.value=!1}},fetchById:async r=>{s.value=null;try{e.value=!0;const l=await n.getById(r);u.value=l,y(l)}catch(l){s.value=l?.response?.data?.message||l?.message||"Failed to fetch user"}finally{e.value=!1}},create:async r=>{s.value=null;try{e.value=!0;const l=await n.create(r);t.value.data.push(l),t.value.total+=1}catch(l){s.value=l?.response?.data?.message||l?.message||"Failed to create user"}finally{e.value=!1}},updateById:async(r,l)=>{s.value=null;try{e.value=!0;const a=await n.updateById(r,l);return y(a),u.value?.id===r&&(u.value=a),a}catch(a){throw s.value=a?.response?.data?.message||a?.message||"Failed to update user",a}finally{e.value=!1}},deleteById:async r=>{s.value=null;try{e.value=!0,await n.delete(r),t.value.data=t.value.data.filter(l=>l.id!==r),t.value.total=Math.max(0,(t.value.total||1)-1),u.value?.id===r&&(u.value=null)}catch(l){s.value=l?.response?.data?.message||l?.message||"Failed to delete user"}finally{e.value=!1}},uploadAvatar:async(r,l)=>{s.value=null;try{e.value=!0;const a=await n.uploadAvatar(r,l);return y(a),u.value?.id===r&&(u.value=a),a}catch(a){throw s.value=a?.response?.data?.message||a?.message||"Failed to upload avatar",a}finally{e.value=!1}},uploadCover:async(r,l)=>{s.value=null;try{e.value=!0;const a=await n.uploadCover(r,l);return y(a),u.value?.id===r&&(u.value=a),a}catch(a){throw s.value=a?.response?.data?.message||a?.message||"Failed to upload cover",a}finally{e.value=!1}},changePassword:async({old_password:r,new_password:l})=>{s.value=null;try{return e.value=!0,await n.changePassword({old_password:r,new_password:l})}catch(a){throw s.value=a?.response?.data?.message||a?.message||"Failed to change password",a}finally{e.value=!1}},fetchUserClubs:async(r,{force:l=!1}={})=>{s.value=null;try{const a=String(r);if(!l&&Array.isArray(i.value[a]))return f.value=i.value[a],i.value[a];e.value=!0;const p=await n.getClubs(r);return i.value[a]=p,f.value=p,p}catch(a){throw s.value=a?.response?.data?.message||a?.message||"Failed to fetch user's clubs",a}finally{e.value=!1}},resetStore:()=>{t.value={total:0,totalPages:1,currentPage:1,pageSize:10,data:[]},u.value=null,c.value=!1,e.value=!1,s.value=null}}});export{$ as u};
