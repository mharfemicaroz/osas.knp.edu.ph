import{M as i,N as A,r as v}from"./index.DuRiRdF7.js";function $(s={}){const{filters:e={},page:l,limit:c,sort:r,order:d,q:u,status:m,availability_status:y,activity_design_id:g,filed_by_user_id:h,start_from:w,start_to:z,end_from:q,end_to:b,facilities_any:_,...F}=s,f={page:l,limit:c,sort:r,order:d,q:u,status:m,availability_status:y,activity_design_id:g,filed_by_user_id:h,start_from:w,start_to:z,end_from:q,end_to:b,facilities_any:_,...F,filters:{...e}};return Object.keys(f).forEach(p=>f[p]===void 0&&delete f[p]),f}function S(s){return typeof Blob<"u"&&(s instanceof Blob||s instanceof File)}function B(s,e=!0){if(typeof s=="string")return s;if(s==null)return e?"[]":"null";try{return JSON.stringify(s)}catch{return e?"[]":"null"}}function I(s={}){const e={...s};return e.facilities!==void 0&&(e.facilities=B(e.facilities,!0)),e.equipment_items!==void 0&&(e.equipment_items=B(e.equipment_items,!0)),e}const o={async create(s){const{data:e}=await i.post("/utilization-requests",I(s));return e},async getById(s){const{data:e}=await i.get(`/utilization-requests/${s}`);return e},async updateById(s,e){const{data:l}=await i.put(`/utilization-requests/${s}`,I(e));return l},async delete(s){const{data:e}=await i.delete(`/utilization-requests/${s}`);return e},async list(s={}){const e=$(s),{data:l}=await i.get("/utilization-requests",{params:e});return l},async submit(s){const{data:e}=await i.post(`/utilization-requests/${s}/submit`);return e},async approve(s,{remarks:e}={}){const{data:l}=await i.post(`/utilization-requests/${s}/approve`,{remarks:e});return l},async reject(s,{remarks:e}={}){const{data:l}=await i.post(`/utilization-requests/${s}/reject`,{remarks:e});return l},async cancel(s,{remarks:e}={}){const{data:l}=await i.post(`/utilization-requests/${s}/cancel`,{remarks:e});return l},async uploadAttachment(s,e){if(S(e)){const l=new FormData;l.append("file",e);const{data:c}=await i.post(`/utilization-requests/${s}/attachments`,l,{headers:{"Content-Type":"multipart/form-data"}});return c}else{const{data:l}=await i.post(`/utilization-requests/${s}/attachments`,{file:e});return l}},async deleteAttachment(s,e){const{data:l}=await i.delete(`/utilization-requests/${s}/attachments/${e}`);return l},async availability({start_date:s,start_time:e,end_date:l,end_time:c,facilities:r=[]}){const d={start_date:s,start_time:e,end_date:l,end_time:c,facilities:r},{data:u}=await i.get("/utilization-requests/_utils/availability",{params:d});return u}},x=A("utilizationRequest",()=>{const s=v({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),e=v(!1),l=v(null),c=v(!1),r=v(null),d=v(null),u=n=>{if(!n?.id)return;const a=s.value.data.findIndex(t=>t.id===n.id);a!==-1&&(s.value.data[a]=n)};return{items:s,selected:r,availabilityProbe:d,isLoading:e,error:l,isLoaded:c,fetchAll:async(n={},a=!1)=>{if(l.value=null,!(!a&&c.value))try{e.value=!0;const t=await o.list(n);Object.assign(s.value,{total:t.total||0,totalPages:t.totalPages||1,currentPage:n.page||1,pageSize:n.limit||10,data:t.data||[]}),c.value=!0}catch(t){l.value=t?.response?.data?.message||t?.response?.message||t?.message||"Failed to fetch utilization requests"}finally{e.value=!1}},fetchById:async n=>{l.value=null;try{e.value=!0;const a=await o.getById(n);r.value=a,u(a)}catch(a){l.value=a?.response?.data?.message||a?.response?.message||a?.message||"Failed to fetch utilization request"}finally{e.value=!1}},create:async n=>{l.value=null;try{e.value=!0;const a=await o.create(n);return s.value.data.push(a),s.value.total+=1,a}catch(a){throw l.value=a?.response?.data?.message||a?.response?.message||a?.message||"Failed to create utilization request",a}finally{e.value=!1}},updateById:async(n,a)=>{l.value=null;try{e.value=!0;const t=await o.updateById(n,a);return u(t),r.value?.id===n&&(r.value=t),t}catch(t){throw l.value=t?.response?.data?.message||t?.response?.message||t?.message||"Failed to update utilization request",t}finally{e.value=!1}},deleteById:async n=>{l.value=null;try{e.value=!0,await o.delete(n),s.value.data=s.value.data.filter(a=>a.id!==n),s.value.total=Math.max(0,s.value.total-1),r.value?.id===n&&(r.value=null)}catch(a){l.value=a?.response?.data?.message||a?.response?.message||a?.message||"Failed to delete utilization request"}finally{e.value=!1}},submit:async n=>{l.value=null;try{e.value=!0;const a=await o.submit(n);return u(a),r.value?.id===n&&(r.value=a),a}catch(a){throw l.value=a?.response?.data?.message||a?.response?.message||a?.message||"Failed to submit utilization request",a}finally{e.value=!1}},approve:async(n,a)=>{l.value=null;try{e.value=!0;const t=await o.approve(n,{remarks:a});return u(t),r.value?.id===n&&(r.value=t),t}catch(t){throw l.value=t?.response?.data?.message||t?.response?.message||t?.message||"Failed to approve utilization request",t}finally{e.value=!1}},reject:async(n,a)=>{l.value=null;try{e.value=!0;const t=await o.reject(n,{remarks:a});return u(t),r.value?.id===n&&(r.value=t),t}catch(t){throw l.value=t?.response?.data?.message||t?.response?.message||t?.message||"Failed to reject utilization request",t}finally{e.value=!1}},cancel:async(n,a)=>{l.value=null;try{e.value=!0;const t=await o.cancel(n,{remarks:a});return u(t),r.value?.id===n&&(r.value=t),t}catch(t){throw l.value=t?.response?.data?.message||t?.response?.message||t?.message||"Failed to cancel utilization request",t}finally{e.value=!1}},uploadAttachment:async(n,a)=>{l.value=null;try{e.value=!0;const t=await o.uploadAttachment(n,a);return u(t),r.value?.id===n&&(r.value=t),t}catch(t){throw l.value=t?.response?.data?.message||t?.response?.message||t?.message||"Failed to upload attachment",t}finally{e.value=!1}},deleteAttachment:async(n,a)=>{l.value=null;try{e.value=!0;const t=await o.deleteAttachment(n,a);return u(t),r.value?.id===n&&(r.value=t),t}catch(t){throw l.value=t?.response?.data?.message||t?.response?.message||t?.message||"Failed to delete attachment",t}finally{e.value=!1}},checkAvailability:async n=>{l.value=null;try{e.value=!0;const a=await o.availability(n);return d.value=a,a}catch(a){throw l.value=a?.response?.data?.message||a?.response?.message||a?.message||"Failed to check availability",a}finally{e.value=!1}},resetStore:()=>{s.value={total:0,totalPages:1,currentPage:1,pageSize:10,data:[]},r.value=null,d.value=null,c.value=!1,e.value=!1,l.value=null}}});export{x as u};
