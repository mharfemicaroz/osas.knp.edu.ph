import{M as W,N as we,r as O,c as Y,u as ye,o as ve,C as ge,a as F,d as Q,q as S,e as a,t as $,k as H,h as R,E as be,g as D,j as M,F as ne,G as le,v as P,S as B,f as G,l as X,A as Se,O as Ce,P as Fe}from"./index.lmxhTYcw.js";import{u as Ae,E as $e,a as N,d as he,Q as Te,b as ke,_ as Ue}from"./browser.Dip7GxFC.js";import{n as Ee,q as Be,r as Re,s as qe,t as Le,u as Pe,o as Ve,p as Ie,k as Ne,_ as De,a as Oe,v as Ye,w as ze,x as Me,H as je,I as We,K as Ge}from"./SectionMain.D1ShbFuh.js";import{a as He,b as Ke,c as ue,B as Je,d as Qe}from"./IconifyButton.deiAo8Lt.js";import"./ToasterComponent.BiIukvsf.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";function Xe(t){const e={...t};return Object.keys(e).forEach(l=>e[l]===void 0&&delete e[l]),e}function ce(t){return typeof Blob<"u"&&(t instanceof Blob||t instanceof File)}function re(t,e){if(typeof t=="string")return t;if(t==null)return e;try{return JSON.stringify(t)}catch{return e}}function me(t={}){const e={...t};return e.sources_of_fund!==void 0&&(e.sources_of_fund=re(e.sources_of_fund,"{}")),e.uses_of_fund!==void 0&&(e.uses_of_fund=re(e.uses_of_fund,"[]")),e.attachments!==void 0&&(e.attachments=re(e.attachments,"[]")),delete e.date_filed,e}const J={async create(t){const{data:e}=await W.post("/liquidation-funds",me(t));return e},async getById(t){const{data:e}=await W.get(`/liquidation-funds/${t}`);return e},async updateById(t,e){const{data:l}=await W.put(`/liquidation-funds/${t}`,me(e));return l},async delete(t){const{data:e}=await W.delete(`/liquidation-funds/${t}`);return e},async list(t={}){const{page:e,limit:l,sort:m,order:u,q:h,status:i,activity_design_id:T,filed_by_user_id:_,date_filed_from:A,date_filed_to:q,...x}=t,C=Xe({page:e,limit:l,sort:m,order:u,q:h,status:i,activity_design_id:T,filed_by_user_id:_,date_filed_from:A,date_filed_to:q,...x}),{data:k}=await W.get("/liquidation-funds",{params:C});return k},async submit(t){const{data:e}=await W.post(`/liquidation-funds/${t}/submit`);return e},async approve(t,{remarks:e}={}){const{data:l}=await W.post(`/liquidation-funds/${t}/approve`,{remarks:e});return l},async reject(t,{remarks:e}={}){const{data:l}=await W.post(`/liquidation-funds/${t}/reject`,{remarks:e});return l},async cancel(t,{remarks:e}={}){const{data:l}=await W.post(`/liquidation-funds/${t}/cancel`,{remarks:e});return l},async uploadAttachment(t,e){if(ce(e)){const l=new FormData;l.append("file",e);const{data:m}=await W.post(`/liquidation-funds/${t}/attachments`,l,{headers:{"Content-Type":"multipart/form-data"}});return m}else{const{data:l}=await W.post(`/liquidation-funds/${t}/attachments`,ce(e)?{}:{file:e});return l}},async deleteAttachment(t,e){const{data:l}=await W.delete(`/liquidation-funds/${t}/attachments/${e}`);return l}},de=we("liquidationFund",()=>{const t=O({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),e=O(!1),l=O(null),m=O(!1),u=O(null),h=p=>{if(!p?.id)return;const d=t.value.data.findIndex(n=>n.id===p.id);d!==-1&&(t.value.data[d]=p)};return{items:t,selected:u,isLoading:e,error:l,isLoaded:m,fetchAll:async(p={},d=!1)=>{if(l.value=null,!(!d&&m.value))try{e.value=!0;const n=await J.list(p);Object.assign(t.value,{total:n.total||n.count||0,totalPages:n.totalPages||Math.max(1,Math.ceil((n.total||0)/(p.limit||10))),currentPage:p.page||1,pageSize:p.limit||10,data:n.data||n.rows||[]}),m.value=!0}catch(n){l.value=n?.response?.data?.message||n?.response?.message||n?.message||"Failed to fetch liquidation funds"}finally{e.value=!1}},fetchById:async p=>{l.value=null;try{e.value=!0;const d=await J.getById(p);u.value=d,h(d)}catch(d){l.value=d?.response?.data?.message||d?.response?.message||d?.message||"Failed to fetch liquidation fund"}finally{e.value=!1}},create:async p=>{l.value=null;try{e.value=!0;const d=await J.create(p);return t.value.data.unshift(d),t.value.total+=1,d}catch(d){throw l.value=d?.response?.data?.message||d?.response?.message||d?.message||"Failed to create liquidation fund",d}finally{e.value=!1}},updateById:async(p,d)=>{l.value=null;try{e.value=!0;const n=await J.updateById(p,d);return h(n),u.value?.id===p&&(u.value=n),n}catch(n){throw l.value=n?.response?.data?.message||n?.response?.message||n?.message||"Failed to update liquidation fund",n}finally{e.value=!1}},deleteById:async p=>{l.value=null;try{e.value=!0,await J.delete(p),t.value.data=t.value.data.filter(d=>d.id!==p),t.value.total=Math.max(0,t.value.total-1),u.value?.id===p&&(u.value=null)}catch(d){l.value=d?.response?.data?.message||d?.response?.message||d?.message||"Failed to delete liquidation fund"}finally{e.value=!1}},submit:async p=>{l.value=null;try{e.value=!0;const d=await J.submit(p);return h(d),u.value?.id===p&&(u.value=d),d}catch(d){throw l.value=d?.response?.data?.message||d?.response?.message||d?.message||"Failed to submit liquidation fund",d}finally{e.value=!1}},approve:async(p,d)=>{l.value=null;try{e.value=!0;const n=await J.approve(p,{remarks:d});return h(n),u.value?.id===p&&(u.value=n),n}catch(n){throw l.value=n?.response?.data?.message||n?.response?.message||n?.message||"Failed to approve liquidation fund",n}finally{e.value=!1}},reject:async(p,d)=>{l.value=null;try{e.value=!0;const n=await J.reject(p,{remarks:d});return h(n),u.value?.id===p&&(u.value=n),n}catch(n){throw l.value=n?.response?.data?.message||n?.response?.message||n?.message||"Failed to reject liquidation fund",n}finally{e.value=!1}},cancel:async(p,d)=>{l.value=null;try{e.value=!0;const n=await J.cancel(p,{remarks:d});return h(n),u.value?.id===p&&(u.value=n),n}catch(n){throw l.value=n?.response?.data?.message||n?.response?.message||n?.message||"Failed to cancel liquidation fund",n}finally{e.value=!1}},uploadAttachment:async(p,d)=>{l.value=null;try{e.value=!0;const n=await J.uploadAttachment(p,d);return h(n),u.value?.id===p&&(u.value=n),n}catch(n){throw l.value=n?.response?.data?.message||n?.response?.message||n?.message||"Failed to upload attachment",n}finally{e.value=!1}},deleteAttachment:async(p,d)=>{l.value=null;try{e.value=!0;const n=await J.deleteAttachment(p,d);return h(n),u.value?.id===p&&(u.value=n),n}catch(n){throw l.value=n?.response?.data?.message||n?.response?.message||n?.message||"Failed to delete attachment",n}finally{e.value=!1}},resetStore:()=>{t.value={total:0,totalPages:1,currentPage:1,pageSize:10,data:[]},u.value=null,m.value=!1,e.value=!1,l.value=null}}}),Ze={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},et={class:"bg-white p-4 md:p-5 rounded-2xl shadow-xl w-[1096px] max-h-screen overflow-auto"},tt={class:"flex items-center justify-between mb-3"},at={class:"flex items-center gap-3"},st={class:"text-lg font-semibold"},nt={class:"text-[11px] px-2 py-1 rounded bg-gray-100"},ot={key:0,class:"mb-3 text-xs px-3 py-2 rounded-lg border bg-amber-50 border-amber-200 text-amber-800"},lt={class:"text-sm mb-3"},it=["disabled"],rt=["value"],dt={key:0,class:"text-red-600 text-[11px] mt-1"},ut={key:1,class:"text-[11px] text-gray-500 mt-1"},ct={key:2,class:"text-[11px] text-amber-700 mt-1"},mt={class:"mt-2 p-3 border rounded-lg bg-white"},ft={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},pt=["disabled"],_t=["disabled"],yt=["disabled"],vt=["disabled"],gt=["disabled"],bt=["disabled"],ht={class:"md:col-span-2"},xt=["disabled"],wt={class:"mt-3 text-sm"},St={class:"flex flex-wrap gap-4"},Ct={class:"mt-4 text-sm"},Ft={class:"flex items-center justify-between"},At=["disabled"],$t={class:"mt-2 border rounded overflow-hidden"},Tt={class:"w-full text-xs"},kt={class:"p-2"},Ut=["onUpdate:modelValue","disabled"],Et={class:"p-2"},Bt=["onUpdate:modelValue","disabled"],Rt={class:"p-2"},qt=["onUpdate:modelValue","disabled"],Lt={class:"p-2"},Pt=["onUpdate:modelValue","disabled"],Vt={class:"p-2"},It=["onUpdate:modelValue","disabled"],Nt={class:"p-2"},Dt=["onUpdate:modelValue","disabled"],Ot={class:"p-2"},Yt=["onUpdate:modelValue","disabled"],zt={class:"p-2 text-right"},Mt=["disabled","onClick"],jt={class:"mt-2 text-right text-sm"},Wt={class:"mt-4 text-sm"},Gt=["disabled"],Ht={class:"flex justify-end gap-2 mt-5"},fe={__name:"LiquidationFundFormModal",props:{modelValue:{type:Boolean,default:!1},mode:{type:String,default:"create"},initial:{type:Object,default:()=>({id:null,reference_code:"",date_filed:"",activity_design_id:"",sources_of_fund:{contribution:0,payment_from_fines:0,solicitations:0,donations:0,other_sources:0,current_available_funds:0,other_sources_note:""},uses_of_fund:[],remarks:"",status:"draft"})}},emits:["update:modelValue","submit"],setup(t,{emit:e}){const l=t,m=e,u=Y({get:()=>l.modelValue,set:v=>m("update:modelValue",v)}),h=ye();de();const i=Ae(),T=Y(()=>Array.isArray(i.items?.data)?i.items.data.filter(v=>String(v.status).toLowerCase()==="approved"):[]);ve(async()=>{await i.fetchAll({page:1,limit:200,status:"approved"},!0)});const _=O(structuredClone(l.initial)),A=O({});ge(()=>l.initial,v=>{let o=v.sources_of_fund,c=v.uses_of_fund;try{typeof o=="string"&&(o=JSON.parse(o||"{}"))}catch{}try{typeof c=="string"&&(c=JSON.parse(c||"[]"))}catch{}_.value={...v,sources_of_fund:{contribution:0,payment_from_fines:0,solicitations:0,donations:0,other_sources:0,current_available_funds:0,other_sources_note:"",...o||{}},uses_of_fund:Array.isArray(c)?c:[]},A.value={}},{immediate:!0});const q=Y(()=>String(_.value?.status||"").toLowerCase()),x=Y(()=>l.mode==="edit"&&q.value!=="draft"),C=Y(()=>l.mode!=="edit"?"New Liquidation Fund":x.value?"View Liquidation (read-only)":"Edit Liquidation"),k=Y(()=>l.mode==="edit"?"Save Changes":"Create"),L=v=>{const o=v?.name_of_activity||"Untitled",c=v?.reference_code?` [${v.reference_code}]`:"",I=v?.date_of_implementation?` • ${v.date_of_implementation}`:"";return`${o}${c}${I}`},w=v=>Number.isFinite(+v)?+v:0,U=Y(()=>{const v=_.value.sources_of_fund||{};return w(v.contribution)+w(v.payment_from_fines)+w(v.solicitations)+w(v.donations)+w(v.other_sources)+w(v.current_available_funds)}),V=Y(()=>Array.isArray(_.value.uses_of_fund)?_.value.uses_of_fund.reduce((v,o)=>v+w(o?.amount),0):0),p=Y(()=>U.value-V.value),d=v=>Number(v).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),n=()=>{Array.isArray(_.value.uses_of_fund)||(_.value.uses_of_fund=[]),_.value.uses_of_fund.push({date:"",qty:1,unit:"",particulars:"",sheet_no:"",amount:0,in_charge:""})},z=v=>{_.value.uses_of_fund.splice(v,1)},K=()=>{if(x.value)return!1;const v={};_.value.activity_design_id||(v.activity_design_id="Required");const o=_.value.sources_of_fund||{};return["contribution","payment_from_fines","solicitations","donations","other_sources","current_available_funds"].forEach(c=>{o[c]!=null&&Number(o[c])<0&&(v[`src_${c}`]="Must be ≥ 0")}),Array.isArray(_.value.uses_of_fund)&&_.value.uses_of_fund.forEach((c,I)=>{c?.qty!=null&&Number(c.qty)<=0&&(v[`use_${I}_qty`]="Qty must be > 0"),c?.amount!=null&&Number(c.amount)<0&&(v[`use_${I}_amount`]="Must be ≥ 0")}),A.value=v,Object.keys(v).length===0},ee=()=>{if(x.value||!K())return;const v={..._.value};!v.filed_by_user_id&&h.user?.id&&(v.filed_by_user_id=h.user.id),m("submit",v)};return(v,o)=>u.value?(S(),F("div",Ze,[a("div",et,[a("div",tt,[a("div",at,[a("h2",st,$(C.value),1),a("span",nt,$(_.value.status),1)]),a("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:o[0]||(o[0]=c=>u.value=!1)},"Close")]),x.value?(S(),F("div",ot,[o[11]||(o[11]=H(" This liquidation is ",-1)),a("strong",null,$(_.value.status),1),o[12]||(o[12]=H(". Editing is disabled. ",-1))])):Q("",!0),a("div",lt,[o[14]||(o[14]=a("label",{class:"block mb-1"},[H("Activity Design "),a("span",{class:"text-red-500"},"*")],-1)),R(a("select",{"onUpdate:modelValue":o[1]||(o[1]=c=>_.value.activity_design_id=c),class:M(["w-full border rounded px-2.5 py-2",A.value.activity_design_id?"border-red-500":""]),disabled:x.value||D(i).isLoading},[o[13]||(o[13]=a("option",{value:""},"Select approved activity design…",-1)),(S(!0),F(ne,null,le(T.value,c=>(S(),F("option",{key:c.id,value:c.id},$(L(c)),9,rt))),128))],10,it),[[be,_.value.activity_design_id]]),A.value.activity_design_id?(S(),F("p",dt,$(A.value.activity_design_id),1)):Q("",!0),D(i).isLoading?(S(),F("p",ut,"Loading approved activities…")):T.value.length?Q("",!0):(S(),F("p",ct,"No approved activity designs found."))]),a("div",mt,[o[26]||(o[26]=a("div",{class:"text-sm font-medium mb-2"},"Sources of Fund",-1)),a("div",ft,[a("div",null,[o[15]||(o[15]=a("label",{class:"block mb-1"},"Contribution",-1)),R(a("input",{type:"number",step:"0.01",min:"0",class:M(["w-full border rounded px-2.5 py-2",A.value.src_contribution?"border-red-500":""]),"onUpdate:modelValue":o[2]||(o[2]=c=>_.value.sources_of_fund.contribution=c),disabled:x.value},null,10,pt),[[P,_.value.sources_of_fund.contribution,void 0,{number:!0}]])]),a("div",null,[o[16]||(o[16]=a("label",{class:"block mb-1"},"Payment from Fines",-1)),R(a("input",{type:"number",step:"0.01",min:"0",class:M(["w-full border rounded px-2.5 py-2",A.value.src_payment_from_fines?"border-red-500":""]),"onUpdate:modelValue":o[3]||(o[3]=c=>_.value.sources_of_fund.payment_from_fines=c),disabled:x.value},null,10,_t),[[P,_.value.sources_of_fund.payment_from_fines,void 0,{number:!0}]])]),a("div",null,[o[17]||(o[17]=a("label",{class:"block mb-1"},"Solicitations",-1)),R(a("input",{type:"number",step:"0.01",min:"0",class:M(["w-full border rounded px-2.5 py-2",A.value.src_solicitations?"border-red-500":""]),"onUpdate:modelValue":o[4]||(o[4]=c=>_.value.sources_of_fund.solicitations=c),disabled:x.value},null,10,yt),[[P,_.value.sources_of_fund.solicitations,void 0,{number:!0}]])]),a("div",null,[o[18]||(o[18]=a("label",{class:"block mb-1"},"Donations",-1)),R(a("input",{type:"number",step:"0.01",min:"0",class:M(["w-full border rounded px-2.5 py-2",A.value.src_donations?"border-red-500":""]),"onUpdate:modelValue":o[5]||(o[5]=c=>_.value.sources_of_fund.donations=c),disabled:x.value},null,10,vt),[[P,_.value.sources_of_fund.donations,void 0,{number:!0}]])]),a("div",null,[o[19]||(o[19]=a("label",{class:"block mb-1"},"Other Sources",-1)),R(a("input",{type:"number",step:"0.01",min:"0",class:M(["w-full border rounded px-2.5 py-2",A.value.src_other_sources?"border-red-500":""]),"onUpdate:modelValue":o[6]||(o[6]=c=>_.value.sources_of_fund.other_sources=c),disabled:x.value},null,10,gt),[[P,_.value.sources_of_fund.other_sources,void 0,{number:!0}]])]),a("div",null,[o[20]||(o[20]=a("label",{class:"block mb-1"},"Current Available Funds",-1)),R(a("input",{type:"number",step:"0.01",min:"0",class:M(["w-full border rounded px-2.5 py-2",A.value.src_current_available_funds?"border-red-500":""]),"onUpdate:modelValue":o[7]||(o[7]=c=>_.value.sources_of_fund.current_available_funds=c),disabled:x.value},null,10,bt),[[P,_.value.sources_of_fund.current_available_funds,void 0,{number:!0}]])]),a("div",ht,[o[21]||(o[21]=a("label",{class:"block mb-1"},"Other Sources Note (optional)",-1)),R(a("textarea",{rows:"2",class:"w-full border rounded px-2.5 py-2","onUpdate:modelValue":o[8]||(o[8]=c=>_.value.sources_of_fund.other_sources_note=c),disabled:x.value},null,8,xt),[[P,_.value.sources_of_fund.other_sources_note]])])]),a("div",wt,[a("div",St,[a("div",null,[o[22]||(o[22]=H("Total Sources: ",-1)),a("strong",null,$(d(U.value)),1)]),a("div",null,[o[23]||(o[23]=H("Total Uses: ",-1)),a("strong",null,$(d(V.value)),1)]),a("div",null,[o[24]||(o[24]=H("Cash on Hand: ",-1)),a("strong",{class:M(p.value<0?"text-red-600":"text-emerald-700")},$(d(p.value)),3)])]),o[25]||(o[25]=a("p",{class:"text-[11px] text-gray-500 mt-1"},"Server recalculates totals on save.",-1))])]),a("div",Ct,[a("div",Ft,[o[27]||(o[27]=a("label",{class:"block mb-1 font-medium"},"Use of Fund",-1)),a("button",{class:"px-3 py-1 bg-gray-200 rounded text-xs",disabled:x.value,onClick:n},"Add Row",8,At)]),a("div",$t,[a("table",Tt,[o[28]||(o[28]=a("thead",{class:"bg-gray-50"},[a("tr",null,[a("th",{class:"text-left p-2"},"Date"),a("th",{class:"text-left p-2"},"Qty"),a("th",{class:"text-left p-2"},"Unit"),a("th",{class:"text-left p-2"},"Particulars"),a("th",{class:"text-left p-2"},"Sheet No."),a("th",{class:"text-left p-2"},"Amount"),a("th",{class:"text-left p-2"},"In-Charge"),a("th",{class:"p-2 w-16"})])],-1)),a("tbody",null,[(S(!0),F(ne,null,le(_.value.uses_of_fund,(c,I)=>(S(),F("tr",{key:I,class:"border-t"},[a("td",kt,[R(a("input",{type:"date","onUpdate:modelValue":E=>c.date=E,class:"border rounded px-2 py-1",disabled:x.value},null,8,Ut),[[P,c.date]])]),a("td",Et,[R(a("input",{type:"number",min:"1","onUpdate:modelValue":E=>c.qty=E,class:M(["w-20 border rounded px-2 py-1",A.value[`use_${I}_qty`]?"border-red-500":""]),disabled:x.value},null,10,Bt),[[P,c.qty,void 0,{number:!0}]])]),a("td",Rt,[R(a("input",{"onUpdate:modelValue":E=>c.unit=E,class:"w-20 border rounded px-2 py-1",disabled:x.value},null,8,qt),[[P,c.unit]])]),a("td",Lt,[R(a("input",{"onUpdate:modelValue":E=>c.particulars=E,class:"w-52 border rounded px-2 py-1",disabled:x.value},null,8,Pt),[[P,c.particulars]])]),a("td",Vt,[R(a("input",{"onUpdate:modelValue":E=>c.sheet_no=E,class:"w-24 border rounded px-2 py-1",disabled:x.value},null,8,It),[[P,c.sheet_no]])]),a("td",Nt,[R(a("input",{type:"number",step:"0.01",min:"0","onUpdate:modelValue":E=>c.amount=E,class:M(["w-28 border rounded px-2 py-1",A.value[`use_${I}_amount`]?"border-red-500":""]),disabled:x.value},null,10,Dt),[[P,c.amount,void 0,{number:!0}]])]),a("td",Ot,[R(a("input",{"onUpdate:modelValue":E=>c.in_charge=E,class:"w-32 border rounded px-2 py-1",disabled:x.value},null,8,Yt),[[P,c.in_charge]])]),a("td",zt,[a("button",{class:"px-2 py-1 bg-red-50 text-red-700 rounded",disabled:x.value,onClick:E=>z(I)},"Remove",8,Mt)])]))),128))])])]),a("div",jt,[o[29]||(o[29]=a("span",{class:"mr-4"},"Total Uses:",-1)),a("strong",null,$(d(V.value)),1)])]),a("div",Wt,[o[30]||(o[30]=a("label",{class:"block mb-1"},"Remarks",-1)),R(a("textarea",{"onUpdate:modelValue":o[9]||(o[9]=c=>_.value.remarks=c),rows:"3",class:"w-full border rounded px-2.5 py-2",disabled:x.value},null,8,Gt),[[P,_.value.remarks]])]),a("div",Ht,[a("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:o[10]||(o[10]=c=>u.value=!1)},"Close"),x.value?Q("",!0):(S(),F("button",{key:0,class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:ee},$(k.value),1))])])])):Q("",!0)}},Kt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},Jt={class:"bg-white p-4 rounded-xl shadow-xl w-[980px] max-h-screen overflow-auto"},Qt={class:"flex items-center justify-between mb-3"},Xt={class:"text-lg font-semibold"},Zt={class:"text-gray-600"},ea={class:"flex items-center justify-between gap-2"},ta={class:"text-sm text-gray-600"},aa={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24"},sa=["d"],na=["disabled"],oa={class:"mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"},la={class:"aspect-video bg-white border rounded overflow-hidden flex items-center justify-center"},ia=["src"],ra={key:1,class:"flex items-center justify-center w-full h-full"},da=["d"],ua={class:"mt-2 text-xs"},ca=["title"],ma={class:"text-gray-500 flex items-center justify-between"},fa={key:0},pa={key:0},_a={class:"mt-2 flex items-center justify-between gap-2"},ya=["onClick","title"],va={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24"},ga=["d"],ba=["onClick"],ha={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24"},xa=["d"],wa={key:0,class:"mt-6 text-center text-sm text-gray-500"},Sa=10*1024*1024,Ca={__name:"LiquidationAttachmentsModal",props:{modelValue:{type:Boolean,default:!1},row:{type:Object,default:null}},emits:["update:modelValue"],setup(t,{emit:e}){const l=t,m=e,u=Y({get:()=>l.modelValue,set:s=>m("update:modelValue",s)}),h=de(),i=O(null),T=O(!1),_=new Set(["image/png","image/jpeg","image/webp","application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]),A=new Set(["png","jpg","jpeg","webp","pdf","docx","xlsx"]),q=(s="")=>String(s).toLowerCase().match(/\.([a-z0-9]+)$/i)?.[1]||"",x=(s="")=>typeof s=="string"&&s.match(/^data:([^;]+);base64,/i)?.[1]||"",C=s=>{const g=s?.type&&_.has(s.type),b=s?.name&&A.has(q(s.name));return g||b},k=(s="")=>String(s).startsWith("image/"),L=(s="")=>s==="application/pdf",w=(s="")=>s==="application/vnd.openxmlformats-officedocument.wordprocessingml.document",U=(s="")=>s==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",V=(s="")=>L(s)?Be:w(s)?Re:U(s)?qe:k(s)?Le:Pe,p=(s="")=>L(s)?"PDF":w(s)?"Word":U(s)?"Excel":k(s)?"Image":"File",d=(s="")=>L(s)?"pdf":w(s)?"docx":U(s)?"xlsx":s==="image/png"?"png":s==="image/jpeg"?"jpg":s==="image/webp"?"webp":"",n=(s="attachment",g="")=>/\.[a-z0-9]+$/i.test(s)?s:g?`${s}.${g.startsWith(".")?g.slice(1):g}`:s,z=s=>s<1024?`${s} B`:s<1024*1024?`${(s/1024).toFixed(1)} KB`:`${(s/(1024*1024)).toFixed(1)} MB`,K=Y(()=>{const s=i.value?.attachments;if(!s)return[];try{return Array.isArray(s)?s:JSON.parse(s||"[]")}catch{return[]}}),ee=Y(()=>(K.value||[]).map((s,g)=>{const b=s.mime||x(s.data)||(s.name?q(s.name)==="pdf"&&"application/pdf":"")||"",j=q(s.name||"")||d(b),te=s.size??null,ae=s.name||`${p(b)} ${g+1}`;return{id:s.id??g+1,name:ae,data:s.data||"",url:s.url||s.href||s.path||"",mime:b,ext:j,size:te,filename:n(ae,j)}}));ge(()=>l.modelValue,async s=>{s&&l.row?.id&&(await h.fetchById(l.row.id),i.value=h.selected||l.row)});const v=async s=>{const g=s.target.files?.[0];if(s.target.value="",!(!g||!i.value?.id)){if(g.size>Sa){await B.fire("File too large","Maximum size is 10 MB.","warning");return}if(!C(g)){await B.fire("Unsupported file","Only images (PNG/JPEG/WEBP), PDF, DOCX, and XLSX are allowed.","warning");return}try{T.value=!0,await h.uploadAttachment(i.value.id,g),await h.fetchById(i.value.id),i.value=h.selected}finally{T.value=!1}}},o=async s=>{!i.value?.id||!(await B.fire({title:"Remove attachment?",icon:"warning",showCancelButton:!0,confirmButtonText:"Remove",confirmButtonColor:"#d33"})).isConfirmed||(await h.deleteAttachment(i.value.id,s),await h.fetchById(i.value.id),i.value=h.selected)},c=s=>{if(s.data&&String(s.data).startsWith("data:")&&k(s.mime)){const g=window.open();g&&g.document.write(`<img src="${s.data}" style="display:block;max-width:100%;height:auto;margin:0 auto;object-fit:contain"/>`);return}s.url&&window.open(String(s.url),"_blank")},I=s=>{const[g,b]=s.split(","),j=g.match(/data:([^;]+);base64/i)?.[1]||"application/octet-stream",te=atob(b),ae=new Uint8Array(te.length);for(let oe=0;oe<te.length;oe++)ae[oe]=te.charCodeAt(oe);return new Blob([ae],{type:j})},E=(s,g)=>{const b=URL.createObjectURL(s),j=document.createElement("a");j.href=b,j.download=g||"download",document.body.appendChild(j),j.click(),j.remove(),setTimeout(()=>URL.revokeObjectURL(b),1e3)},ie=async s=>{if(s.data&&String(s.data).startsWith("data:")){const g=I(s.data);E(g,s.filename);return}if(s.url)try{const b=await(await fetch(s.url,{credentials:"include"})).blob();E(b,s.filename)}catch{const g=document.createElement("a");g.href=String(s.url),g.setAttribute("download",s.filename),document.body.appendChild(g),g.click(),g.remove()}},y=s=>k(s.mime)?"Open":"Download",r=s=>k(s.mime)?Ve:Ie,f=s=>k(s.mime)?c(s):ie(s);return(s,g)=>u.value?(S(),F("div",Kt,[a("div",Jt,[a("div",Qt,[a("h2",Xt,[g[1]||(g[1]=H(" Liquidation Attachments — ",-1)),a("span",Zt,$(i.value?.reference_code||""),1)]),a("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:g[0]||(g[0]=b=>u.value=!1)},"Close")]),a("div",ea,[a("div",ta,[g[2]||(g[2]=H(" Activity: ",-1)),a("strong",null,$(i.value?.activity_design?.name_of_activity||"—"),1)]),a("label",{class:M(["inline-flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white rounded text-xs cursor-pointer disabled:opacity-60",{"opacity-60 pointer-events-none":T.value}])},[(S(),F("svg",aa,[a("path",{d:D(Ee)},null,8,sa)])),a("span",null,$(T.value?"Uploading…":"Upload"),1),a("input",{type:"file",class:"hidden",disabled:T.value,onChange:v,accept:".png,.jpg,.jpeg,.webp,.pdf,.docx,.xlsx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,image/png,image/jpeg,image/webp"},null,40,na)],2)]),a("div",oa,[(S(!0),F(ne,null,le(ee.value,b=>(S(),F("div",{key:b.id,class:"border rounded-lg p-2 bg-gray-50 flex flex-col"},[a("div",la,[b.data&&b.data.startsWith("data:")&&b.mime?.startsWith("image/")?(S(),F("img",{key:0,src:b.data,class:"object-contain w-full h-full",alt:"Attachment preview"},null,8,ia)):(S(),F("div",ra,[(S(),F("svg",{style:{width:"64px",height:"64px"},viewBox:"0 0 24 24",class:M({"text-red-600":b.mime==="application/pdf","text-blue-600":b.mime==="application/vnd.openxmlformats-officedocument.wordprocessingml.document","text-emerald-600":b.mime==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text-gray-500":!b.mime||!b.mime.startsWith("image/")&&b.mime!=="application/pdf"})},[a("path",{d:V(b.mime)},null,8,da)],2))]))]),a("div",ua,[a("div",{class:"font-medium truncate",title:b.name},$(b.name),9,ca),a("div",ma,[a("span",null,[H($(p(b.mime))+" ",1),b.ext?(S(),F("span",fa,"("+$(b.ext.toUpperCase())+")",1)):Q("",!0)]),b.size?(S(),F("span",pa,$(z(b.size)),1)):Q("",!0)])]),a("div",_a,[a("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-white border rounded text-xs hover:bg-gray-50",onClick:j=>f(b),title:y(b)},[(S(),F("svg",va,[a("path",{d:r(b)},null,8,ga)])),H(" "+$(y(b)),1)],8,ya),a("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-red-600 text-white rounded text-xs",onClick:j=>o(b.id),title:"Remove"},[(S(),F("svg",ha,[a("path",{d:D(Ne)},null,8,xa)])),g[3]||(g[3]=H(" Remove ",-1))],8,ba)])]))),128))]),ee.value.length?Q("",!0):(S(),F("div",wa," No attachments yet. "))])])):Q("",!0)}},Fa="KOLEHIYO NG PANTUKAN",Aa="Juan A. Sarenas Campus, Kingking, Pantukan, Davao de Oro",$a="https://osas.knp.edu.ph/verify-liquidation?id=",se=t=>t?he(t).format("MMMM DD, YYYY"):"—",Z=(t,e=2)=>t==null||t===""||Number.isNaN(Number(t))?"—":Number(t).toLocaleString(void 0,{minimumFractionDigits:e,maximumFractionDigits:e}),pe=(t,e)=>{if(Array.isArray(t)||t&&typeof t=="object")return t;try{return JSON.parse(t||"null")??e}catch{return e}},xe="./",Ta=`${xe}images/logo.png`,ka=`${xe}images/bg.jpg`;async function _e(t){try{const l=await(await fetch(t)).blob();return new Promise(m=>{const u=new FileReader;u.onloadend=()=>m(u.result),u.readAsDataURL(l)})}catch{return null}}function Ua(t){switch(t){case"APPROVED":return[32,141,85];case"PENDING":return[240,158,47];case"REJECTED":return[220,53,69];case"CANCELLED":return[107,114,128];case"COMPLETED":return[37,99,235];default:return[90,90,90]}}async function Ea(t){const e=t.internal.pageSize.getWidth(),l=110,m=36,u=await _e(ka);u?(t.addImage(u,"JPEG",0,0,e,l,void 0,"FAST"),t.setGState(new t.GState({opacity:.18})),t.setFillColor(0,0,0),t.rect(0,0,e,l,"F"),t.setGState(new t.GState({opacity:1}))):(t.setFillColor(21,62,121),t.rect(0,0,e,l,"F"));const h=await _e(Ta);return h&&t.addImage(h,"PNG",m,20,70,70,void 0,"FAST"),t.setTextColor(255,255,255),t.setFont("helvetica","bold"),t.setFontSize(20),t.text(Fa,m+86,38),t.setFont("helvetica","normal"),t.setFontSize(10),t.text(Aa,m+86,58),t.setTextColor(20),t.setFont("helvetica","bold"),t.setFontSize(14),t.text("LIQUIDATION FUND",e/2,l+24,{align:"center"}),l+34}async function Ba(t,e,l){const m=t.internal.pageSize.getWidth(),u=36,h=e?.id??e?.reference_code??"",i=`${$a}${encodeURIComponent(String(h))}`,T=await Te.toDataURL(i,{margin:0,width:75,errorCorrectionLevel:"M",color:{dark:"#000000",light:"#FFFFFF"}}),_=String(e.status||"").toUpperCase(),[A,q,x]=Ua(_),C=e.approved_at?se(e.approved_at):e.date_filed?se(e.date_filed):"—",k=`osas.knp.edu.ph/verify-liquidation?id=${String(h)}`;return N(t,{startY:l,theme:"plain",styles:{cellPadding:0,fontSize:9},bodyStyles:{minCellHeight:120},margin:{left:u,right:u},tableWidth:m-u*2,body:[[{content:""},{content:""}]],columnStyles:{0:{cellWidth:m-u*2-260},1:{cellWidth:260}},didDrawCell:L=>{if(L.section!=="body")return;const{x:w,y:U,width:V,height:p}=L.cell,d=10;if(L.column.index===0){t.setFillColor(255,255,255),t.roundedRect(w,U,V-1,p,6,6,"F");const n=24,z=Math.min(180,V-22);t.setFillColor(A,q,x),t.roundedRect(w+d,U+d,z,n,12,12,"F"),t.setTextColor(255,255,255),t.setFont("helvetica","bold"),t.setFontSize(10),t.text(_||"STATUS",w+d+10,U+d+16),t.setTextColor(20),t.setFont("helvetica","normal"),t.setFontSize(9);let K=U+d+n+16;t.text(`Ref No.: ${e.reference_code||"—"}`,w+d,K),K+=16,t.text(`Date Filed: ${se(e.date_filed)}`,w+d,K),K+=16,t.text(`Date Issued: ${C}`,w+d,K),t.setDrawColor(230),t.roundedRect(w,U,V-1,p,6,6,"S")}if(L.column.index===1){t.setFillColor(255,255,255),t.roundedRect(w,U,V-1,p,6,6,"F"),t.setFillColor(66,103,178),t.roundedRect(w,U,V-1,22,6,6,"F"),t.setTextColor(255,255,255),t.setFont("helvetica","bold"),t.setFontSize(10),t.text("VERIFY",w+d,U+15);const n=w+d,z=U+28;t.addImage(T,"PNG",n,z,75,75,void 0,"FAST"),t.setTextColor(20),t.setFont("helvetica","bold"),t.setFontSize(10),t.text("Scan to verify",n+100,z+14),t.setFont("helvetica","normal"),t.setFontSize(9),t.text("This document can be verified",n+100,z+32),t.text("online via the OSAS portal.",n+100,z+46),t.setTextColor(110),t.setFontSize(8),t.text(k,n+100,z+72),t.setDrawColor(230),t.roundedRect(w,U,V-1,p,6,6,"S")}}}),t.lastAutoTable.finalY}async function Ra(t){const e=new $e({unit:"pt",format:[612,936],orientation:"landscape"}),l=e.internal.pageSize.getWidth(),m=36,u=pe(t.sources_of_fund,{}),h=pe(t.uses_of_fund,[]);let i=await Ea(e);i=await Ba(e,t,i)+10,N(e,{startY:i,theme:"plain",styles:{fontSize:10},body:[[{content:"LINKED ACTIVITY",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",halign:"left",valign:"middle",cellPadding:6}}]],margin:{left:m,right:m}}),i=e.lastAutoTable.finalY;const T=t.activity_design||{};N(e,{startY:i,theme:"grid",styles:{fontSize:9,cellPadding:6},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},body:[[{content:"NAME OF ACTIVITY",styles:{fillColor:[243,248,255],fontStyle:"bold"}},T.name_of_activity||"—"],[{content:"DATE OF IMPLEMENTATION",styles:{fillColor:[243,248,255],fontStyle:"bold"}},se(T.date_of_implementation)],[{content:"SEMESTER",styles:{fillColor:[243,248,255],fontStyle:"bold"}},T.semester||"—"],[{content:"SCHOOL YEAR",styles:{fillColor:[243,248,255],fontStyle:"bold"}},T.school_year||"—"],[{content:"OFFICE/DEPARTMENT",styles:{fillColor:[243,248,255],fontStyle:"bold"}},T.office_department||T?.club?.name||"—"]],columnStyles:{0:{cellWidth:200,fontStyle:"bold"},1:{cellWidth:"auto"}},margin:{left:m,right:m}}),i=e.lastAutoTable.finalY+10,N(e,{startY:i,theme:"plain",styles:{fontSize:10},body:[[{content:"SUMMARY",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:m,right:m}}),i=e.lastAutoTable.finalY,N(e,{startY:i,theme:"grid",styles:{fontSize:9,cellPadding:8},body:[["Total Sources",Z(t.total_sources_amount,2)],["Total Uses",Z(t.total_uses_amount,2)],["Total Cash on Hand",Z(t.total_cash_on_hand,2)]],columnStyles:{0:{cellWidth:220,fontStyle:"bold"},1:{cellWidth:"auto"}},margin:{left:m,right:m}}),i=e.lastAutoTable.finalY+10,N(e,{startY:i,theme:"plain",styles:{fontSize:10},body:[[{content:"SOURCES OF FUND",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:m,right:m}}),i=e.lastAutoTable.finalY;const _=[["Contribution",u.contribution],["Payment from Fines",u.payment_from_fines],["Solicitations",u.solicitations],["Donations",u.donations],["Other Sources",u.other_sources],["Current Available Funds",u.current_available_funds]];N(e,{startY:i,theme:"grid",styles:{fontSize:9,cellPadding:6},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},head:[["PARTICULAR","AMOUNT"]],body:_.map(([C,k])=>[C,Z(k,2)]),columnStyles:{0:{cellWidth:320},1:{cellWidth:"auto",halign:"right"}},margin:{left:m,right:m}}),i=e.lastAutoTable.finalY,u?.other_sources_note&&(N(e,{startY:i,theme:"plain",styles:{fontSize:9},body:[[{content:`Note: ${String(u.other_sources_note)}`,styles:{cellPadding:6,textColor:[71,85,105]}}]],margin:{left:m,right:m}}),i=e.lastAutoTable.finalY),i+=10,N(e,{startY:i,theme:"plain",styles:{fontSize:10},body:[[{content:"USE OF FUND",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:m,right:m}}),i=e.lastAutoTable.finalY,Array.isArray(h)&&h.length?N(e,{startY:i,theme:"grid",styles:{fontSize:9,cellPadding:6},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},head:[["DATE","QTY","UNIT","PARTICULARS","SHEET NO.","AMOUNT","IN-CHARGE"]],body:h.map(C=>[C?.date?se(C.date):"—",Z(C?.qty??"",0),C?.unit||"—",C?.particulars||"—",C?.sheet_no||"—",Z(C?.amount??"",2),C?.in_charge||"—"]),columnStyles:{0:{cellWidth:82},1:{cellWidth:44,halign:"right"},2:{cellWidth:56},3:{cellWidth:200},4:{cellWidth:76},5:{cellWidth:78,halign:"right"},6:{cellWidth:"auto"}},margin:{left:m,right:m},foot:[["","","","","TOTAL",Z(t.total_uses_amount,2),""]],footStyles:{fontStyle:"bold"}}):N(e,{startY:i,theme:"grid",styles:{fontSize:9,cellPadding:8},body:[["—"]],margin:{left:m,right:m}}),i=e.lastAutoTable.finalY+10,N(e,{startY:i,theme:"plain",styles:{fontSize:10},body:[[{content:"REMARKS",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:m,right:m}}),i=e.lastAutoTable.finalY,N(e,{startY:i,theme:"grid",styles:{fontSize:9,cellPadding:8},body:[[t.remarks&&String(t.remarks).trim()?t.remarks:"—"]],margin:{left:m,right:m}}),i=e.lastAutoTable.finalY+10,N(e,{startY:i,theme:"plain",styles:{fontSize:10},body:[[{content:"SIGNATORIES",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:m,right:m}}),i=e.lastAutoTable.finalY;const A=t?.filed_by?`${t.filed_by.first_name||""} ${t.filed_by.last_name||""}`.trim():"",q=t?.approver?`${t.approver.first_name||""} ${t.approver.last_name||""}`.trim():"";N(e,{startY:i,theme:"grid",styles:{fontSize:9,cellPadding:10},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},head:[["PREPARED BY:","APPROVED BY:"]],body:[[A||" ",q||" "]],columnStyles:{0:{cellWidth:(l-m*2)/2},1:{cellWidth:"auto"}},didParseCell:C=>{C.section==="body"&&(C.cell.styles.halign="center",C.cell.styles.fontStyle="bold",C.cell.styles.cellPadding={top:16,right:10,bottom:18,left:10})},margin:{left:m,right:m}});const x=e.internal.pageSize.getHeight()-20;e.setFontSize(8),e.setTextColor(120),e.text(`Generated on ${he().format("YYYY-MM-DD HH:mm")} • ${window.location.origin}`,m,x),e.save(`${t.reference_code||"Liquidation_Fund"}.pdf`)}const qa={class:"flex items-center gap-2"},La={class:"p-3 mb-4 rounded-xl border bg-white/60"},Pa={class:"flex items-center gap-2 mb-2 text-gray-700"},Va={class:"w-4 h-4",viewBox:"0 0 24 24"},Ia=["d"],Na={class:"grid grid-cols-1 md:grid-cols-6 gap-2 text-sm"},Da={class:"md:col-span-2 flex"},Oa={class:"w-5 h-5",viewBox:"0 0 24 24"},Ya=["d"],za=["value"],Ma={class:"md:col-span-2"},ja={class:"flex items-center gap-2 md:col-span-1"},Xa={__name:"LiquidationFundsPage",setup(t){const e=de(),l=ye(),m={range:!0,partialRange:!0,multiCalendars:2,modelType:"yyyy-MM-dd",enableTimePicker:!1,autoApply:!0,clearable:!0},u=O({page:1,limit:10,sort:"created_at",order:"DESC",q:"",status:"",activity_design_id:"",filed_by_user_id:"",date_filed_from:"",date_filed_to:""}),h=Y({get:()=>{const{date_filed_from:y,date_filed_to:r}=u.value;return y||r?[y||null,r||null]:null},set:y=>{if(!y)u.value.date_filed_from=null,u.value.date_filed_to=null;else{const[r,f]=y;u.value.date_filed_from=r||null,u.value.date_filed_to=f||null}}}),i=async(y={},r=!0)=>{u.value={...u.value,...y};const f={...u.value};["q","status","activity_design_id","filed_by_user_id","date_filed_from","date_filed_to"].forEach(s=>{(f[s]===""||f[s]==null)&&delete f[s]}),await e.fetchAll(f,r)};ve(async()=>{await i({page:1,limit:10})});const T=Y(()=>({total:e.items.total||0,totalPages:e.items.totalPages||1,currentPage:e.items.currentPage||1,pageSize:e.items.pageSize||10,data:e.items.data||[]})),_=["draft","pending","approved","rejected","cancelled","completed"],A=y=>{switch(String(y||"").toLowerCase()){case"draft":return"gray";case"pending":return"amber";case"approved":return"emerald";case"rejected":return"red";case"cancelled":return"zinc";case"completed":return"blue";default:return"gray"}},q=y=>{const r=Number(y);return Number.isFinite(r)?r.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):"—"},x=[{key:"reference_code",label:"Ref Code",sortable:!0,width:140},{key:"activity_design",label:"Activity",sortable:!1,minWidth:240,formatter:(y,r)=>r.activity_design?r.activity_design.name_of_activity:""},{key:"total_sources_amount",label:"Sources",sortable:!0,width:120},{key:"total_uses_amount",label:"Uses",sortable:!0,width:120},{key:"total_cash_on_hand",label:"Cash on Hand",sortable:!0,width:140},{key:"date_filed",label:"Date Filed",sortable:!0,width:120},{key:"status",label:"Status",sortable:!0,width:120}],C=async y=>{await i(y)},k=O(!1),L=O(!1),w=O(null),U=()=>{k.value=!0},V=async y=>{await e.create(y),k.value=!1,await i({},!0)},p=async y=>{await e.fetchById(y.id);const r=e.selected||y;let f={},s=[];try{f=typeof r.sources_of_fund=="string"?JSON.parse(r.sources_of_fund||"{}"):r.sources_of_fund||{}}catch{}try{s=Array.isArray(r.uses_of_fund)?r.uses_of_fund:JSON.parse(r.uses_of_fund||"[]")}catch{}w.value={id:r.id,reference_code:r.reference_code,date_filed:r.date_filed||"",activity_design_id:r.activity_design_id||"",sources_of_fund:f,uses_of_fund:s,remarks:r.remarks||"",status:r.status||"draft"},L.value=!0},d=async y=>{const{id:r,...f}=y;await e.updateById(r,f),L.value=!1,await i({},!0)},n=async y=>{if(!y?.id)return;(await B.fire({title:`Delete liquidation "${y.reference_code}"?`,text:"This cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it",cancelButtonText:"Cancel"})).isConfirmed&&(await e.deleteById(y.id),await i({},!0),await B.fire("Deleted","The liquidation fund has been deleted.","success"))},z=async y=>{await p(y)},K=async y=>{if((await B.fire({title:"Submit for approval?",text:"You can no longer edit after submission.",icon:"question",showCancelButton:!0,confirmButtonText:"Submit",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1})).isConfirmed)try{await e.submit(y.id),await i({},!0),await B.fire("Submitted","Liquidation is now pending approval.","success")}catch{await B.fire("Error",e.error||"Failed to submit.","error")}},ee=async y=>{const r=await B.fire({title:"Approve liquidation?",input:"textarea",inputLabel:"Remarks (optional)",inputPlaceholder:"Add a note…",showCancelButton:!0,confirmButtonText:"Approve",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1});if(r.isConfirmed)try{await e.approve(y.id,r.value||""),await i({},!0),await B.fire("Approved","Liquidation has been approved.","success")}catch{await B.fire("Error",e.error||"Failed to approve.","error")}},v=async y=>{const r=await B.fire({title:"Reject liquidation?",input:"textarea",inputLabel:"Reason (required)",inputPlaceholder:"State the reason…",inputValidator:f=>f?.trim()?void 0:"Reason is required",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Reject",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1});if(r.isConfirmed)try{await e.reject(y.id,r.value),await i({},!0),await B.fire("Rejected","Liquidation has been rejected.","success")}catch{await B.fire("Error",e.error||"Failed to reject.","error")}},o=async y=>{const r=await B.fire({title:"Cancel liquidation?",input:"textarea",inputLabel:"Reason (required)",inputPlaceholder:"State the reason…",inputValidator:f=>f?.trim()?void 0:"Reason is required",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Cancel Liquidation",cancelButtonText:"Keep",allowOutsideClick:!1,allowEscapeKey:!1});if(r.isConfirmed)try{await e.cancel(y.id,r.value),await i({},!0),await B.fire("Cancelled","Liquidation has been cancelled.","success")}catch{await B.fire("Error",e.error||"Failed to cancel.","error")}},c=async y=>{if(String(y?.status||"").toLowerCase()!=="approved"){await B.fire("Not allowed","Only approved liquidation can be printed.","info");return}try{await e.fetchById(y.id);const f=e.selected||y;await Ra(f)}catch(f){await B.fire("Error",e.error||"Failed to generate PDF.","error"),console.error(f)}},I=O(!1),E=O(null),ie=async y=>{await e.fetchById(y.id),E.value=e.selected||y,I.value=!0};return(y,r)=>(S(),F(ne,null,[G(De,null,{default:X(()=>[G(Oe,null,{default:X(()=>[D(e).error?(S(),Se(He,{key:0,icon:D(Ye),color:"danger"},{default:X(()=>[H($(D(e).error),1)]),_:1},8,["icon"])):Q("",!0),G(Ke,{icon:D(ze),title:"Liquidation Funds",main:""},{default:X(()=>[a("div",qa,[G(ue,{icon:D(Me),color:"primary",label:"New Liquidation",onClick:U},null,8,["icon"]),G(ue,{icon:D(je),color:"info",label:"Refresh",onClick:r[0]||(r[0]=f=>i({},!0))},null,8,["icon"])])]),_:1},8,["icon"]),a("div",La,[a("div",Pa,[(S(),F("svg",Va,[a("path",{d:D(We)},null,8,Ia)])),r[11]||(r[11]=a("span",{class:"font-medium text-sm"},"Filters",-1))]),a("div",Na,[a("div",Da,[R(a("input",{"onUpdate:modelValue":r[1]||(r[1]=f=>u.value.q=f),placeholder:"Search by ref, remarks…",class:"border rounded-s px-2 py-2 flex-1",onKeyup:r[2]||(r[2]=Ce(f=>i({page:1}),["enter"]))},null,544),[[P,u.value.q]]),a("button",{class:"px-3 border border-l-0 rounded-e bg-gray-50",title:"Search",onClick:r[3]||(r[3]=f=>i({page:1}))},[(S(),F("svg",Oa,[a("path",{d:D(Ge)},null,8,Ya)]))])]),R(a("select",{"onUpdate:modelValue":r[4]||(r[4]=f=>u.value.status=f),class:"border rounded px-2 py-2"},[r[12]||(r[12]=a("option",{value:""},"All status",-1)),(S(),F(ne,null,le(_,f=>a("option",{key:f,value:f},$(f),9,za)),64))],512),[[be,u.value.status]]),a("div",Ma,[G(D(ke),Fe({modelValue:h.value,"onUpdate:modelValue":r[5]||(r[5]=f=>h.value=f)},m,{placeholder:"Date filed range"}),null,16,["modelValue"])]),a("div",ja,[a("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:r[6]||(r[6]=f=>i({page:1}))}," Apply Filters "),a("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:r[7]||(r[7]=()=>{u.value.value={page:1,limit:10,sort:"created_at",order:"DESC",q:"",status:"",date_filed_from:"",date_filed_to:""},i({page:1},!0)})},"Reset")])])]),G(Je,{columns:x,data:T.value,loading:D(e).isLoading,onQueryChange:C},{"cell-total_sources_amount":X(({value:f})=>[a("span",null,$(q(f)),1)]),"cell-total_uses_amount":X(({value:f})=>[a("span",null,$(q(f)),1)]),"cell-total_cash_on_hand":X(({value:f})=>[a("span",{class:M(["font-medium",Number(f)<0?"text-red-600":"text-emerald-700"])},$(q(f)),3)]),"cell-status":X(({value:f})=>[G(Qe,{text:f||"—",tone:A(f)},null,8,["text","tone"])]),"cell-actions":X(({row:f})=>[G(Ue,{row:f,moderator:["admin","manager"].includes(String(D(l).user?.role||"").toLowerCase()),onAttachments:ie,onSubmit:K,onApprove:ee,onReject:v,onEdit:p,onDelete:n,onView:s=>z(f),onCancel:o,onPrint:c},null,8,["row","moderator","onView"])]),_:1},8,["data","loading"])]),_:1})]),_:1}),G(fe,{modelValue:k.value,"onUpdate:modelValue":r[8]||(r[8]=f=>k.value=f),mode:"create",onSubmit:V},null,8,["modelValue"]),G(fe,{modelValue:L.value,"onUpdate:modelValue":r[9]||(r[9]=f=>L.value=f),mode:"edit",initial:w.value||{},onSubmit:d},null,8,["modelValue","initial"]),G(Ca,{modelValue:I.value,"onUpdate:modelValue":r[10]||(r[10]=f=>I.value=f),row:E.value},null,8,["modelValue","row"])],64))}};export{Xa as default};
