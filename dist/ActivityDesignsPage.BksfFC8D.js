import{c as $,u as ge,r as q,o as xe,E as oe,a as p,d as w,q as c,e as t,h as x,t as f,j as X,k as C,C as J,F as j,B as W,v as O,g as D,S as T,z as Ae,f as z,l as Z,A as ce,O as ke,Q as me}from"./index.B70aI5H2.js";import{E as $e,a as ee,d as he,Q as Fe,b as pe,_ as fe}from"./browser.BI1HCE8O.js";import{B as Ee,C as Te,D as Re,z as Ve,E as Be,F as Pe,G as Ie,H as Ue,I as De,_ as Ne,a as Oe,g as je,J as Ye,K as Le,T as Me,U as ze}from"./SectionMain.BBzFmnTd.js";import{a as qe,b as We,c as ve,B as Ge,d as _e}from"./IconifyButton.B9au2O7p.js";import{u as we}from"./club.DVTikyJa.js";import{u as Je}from"./annualPlan.DfkzcxeQ.js";import{u as Se}from"./activityDesign.BzTvAwyq.js";import"./ToasterComponent.CU_kl-TQ.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const Ke={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},He={class:"bg-white p-4 md:p-5 rounded-2xl shadow-xl w-[1100px] max-h-screen overflow-auto"},Xe={class:"flex items-center justify-between mb-3"},Qe={class:"flex items-center gap-3"},Ze={class:"text-lg font-semibold"},et={key:0,class:"mb-3 text-xs px-3 py-2 rounded-lg border bg-amber-50 border-amber-200 text-amber-800"},tt={class:"p-3 mb-3 rounded-xl border bg-white/70"},lt={class:"flex items-center justify-between mb-2"},at={class:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm"},nt=["disabled"],it=["value"],st=["disabled"],ot=["value"],rt={key:0,class:"mt-3 text-xs rounded-lg border bg-gray-50 px-3 py-2"},dt={class:"flex flex-wrap gap-3"},ut={key:0},ct={key:1},mt={class:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm"},pt=["disabled"],ft={key:0,class:"text-red-600 text-[11px] mt-1"},vt=["disabled"],_t=["value"],bt={key:0,class:"text-red-600 text-[11px] mt-1"},yt=["disabled"],gt=["value"],xt={key:0,class:"text-red-600 text-[11px] mt-1"},ht={class:"md:col-span-3"},wt=["disabled"],St={key:0,class:"text-red-600 text-[11px] mt-1"},Ct={class:"mt-3 grid grid-cols-1 md:grid-cols-3 gap-3 text-sm"},At={class:"block mb-1"},kt={key:0,class:"ml-1 text-[10px] px-1.5 py-0.5 rounded bg-emerald-100 text-emerald-700 align-middle"},$t=["disabled"],Ft=["value"],Et={key:0,class:"text-red-600 text-[11px] mt-1"},Tt=["disabled"],Rt=["disabled","aria-invalid"],Vt={key:0,class:"text-red-600 text-[11px] mt-1"},Bt={class:"mt-3 grid grid-cols-1 md:grid-cols-3 gap-3 text-sm"},Pt=["disabled"],It=["disabled","aria-invalid"],Ut=["value"],Dt={key:0,class:"text-red-600 text-[11px] mt-1"},Nt=["disabled"],Ot={class:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},jt=["disabled","aria-invalid"],Yt={key:0,class:"text-red-600 text-[11px] mt-1"},Lt=["disabled","aria-invalid"],Mt={key:0,class:"text-red-600 text-[11px] mt-1"},zt={class:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},qt=["disabled","aria-invalid"],Wt={key:0,class:"text-red-600 text-[11px] mt-1"},Gt=["disabled","aria-invalid"],Jt={key:0,class:"text-red-600 text-[11px] mt-1"},Kt={class:"mt-3 text-sm"},Ht=["disabled"],Xt={class:"flex justify-end gap-2 mt-5"},be={__name:"ActivityDesignFormModal",props:{modelValue:{type:Boolean,default:!1},mode:{type:String,default:"create"},initial:{type:Object,default:()=>({id:null,date_filed:"",semester:"",office_department:"",school_year:"",name_of_activity:"",venue:"",date_of_implementation:"",proposed_budget:0,participants:"",nature_of_activity:"Curricular",rationale:"",objectives:"",details_of_activity:"",budgetary_requirements:"",filed_by_user_id:"",club_id:"",status:"draft",remarks:"",annual_plan_id:"",annual_plan_item:null})}},emits:["update:modelValue","submit"],setup(n,{emit:r}){const y=n,b=r,_=$({get:()=>y.modelValue,set:o=>b("update:modelValue",o)}),V=ge(),m=we(),I=Je(),L=$(()=>V.user?.id||null),a=q({...y.initial}),v=q({}),S=q(null),K=["1st Semester","2nd Semester","Summer"],Y=["Curricular","Co-Curricular","Extra-Curricular"],N=$(()=>{const o=new Date().getFullYear();return Array.from({length:6},(e,l)=>`${o-l}-${o-l+1}`)}),k=o=>{const e=Number(o);return Number.isFinite(e)?e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},F=(o,e=[])=>{if(Array.isArray(o))return o;try{return JSON.parse(o||"[]")||e}catch{return e}},G=(o,e=null)=>{if(o&&typeof o=="object")return o;try{return JSON.parse(o||"null")??e}catch{return e}},B=o=>{const e=Number(o);return(m.clubs?.data||[]).find(u=>Number(u.id)===e)?.name||""},U=$(()=>Array.isArray(I.items?.data)?I.items.data.filter(o=>String(o.status||"").toLowerCase()==="approved"):[]),h=$(()=>{const o=Number(a.value.annual_plan_id||0);return o&&U.value.find(e=>Number(e.id)===o)||null}),E=$(()=>{const o=h.value;return o?F(o.plans,[]).map((l,u)=>({key:String(l?.id??l?.plan_id??u),title:l?.title??l?.name??l?.activity??l?.label??`Item #${u+1}`,funds:Number(l?.funds??l?.budget??0)||0,raw:l})):[]}),R=q("");xe(async()=>{(!Array.isArray(m.clubs?.data)||!m.clubs.data.length)&&await m.fetchAll({page:1,limit:200},!0),await I.fetchAll({page:1,limit:500,status:"approved"},!0)}),oe(()=>y.initial,o=>{const e=G(o.annual_plan_item,null);if(a.value={...o,annual_plan_item:e},v.value={},S.value=null,a.value.school_year||(a.value.school_year=N.value[0]),!a.value.filed_by_user_id&&L.value&&(a.value.filed_by_user_id=L.value),a.value.club_id){const l=B(a.value.club_id);l&&(a.value.office_department=l)}queueMicrotask(()=>{if(!h.value||!a.value.annual_plan_item){R.value="";return}const u=E.value,A=u.findIndex(H=>JSON.stringify(H.raw)===JSON.stringify(a.value.annual_plan_item));R.value=A>=0?u[A].key:""})},{immediate:!0}),oe(()=>a.value.club_id,o=>{if(M.value)return;const e=B(o);e&&(a.value.office_department=e)}),oe(()=>a.value.annual_plan_id,(o,e)=>{a.value.annual_plan_item=null,R.value="";const l=h.value;l&&(S.value||(S.value={school_year:a.value.school_year,proposed_budget:a.value.proposed_budget,club_id:a.value.club_id,office_department:a.value.office_department}),a.value.club_id=l.club_id,a.value.office_department=l?.club?.name||B(l.club_id)||a.value.office_department)}),oe(()=>R.value,o=>{const e=h.value;if(!e||!o){a.value.annual_plan_item=null;return}const l=E.value.find(u=>u.key===o);if(!l){a.value.annual_plan_item=null;return}a.value.annual_plan_item=l.raw,e.school_year&&(a.value.school_year=e.school_year),Number.isFinite(l.funds)&&(a.value.proposed_budget=l.funds),a.value.school_year=e.school_year||a.value.school_year,a.value.club_id=e.club_id,a.value.office_department=e?.club?.name||B(e.club_id)||a.value.office_department});const M=$(()=>!!a.value.annual_plan_id),re=()=>{if(!g.value){if(a.value.annual_plan_id="",a.value.annual_plan_item=null,R.value="",S.value){const o=S.value;a.value.school_year=o.school_year,a.value.proposed_budget=o.proposed_budget,a.value.club_id=o.club_id,a.value.office_department=o.office_department}S.value=null}},te=$(()=>String(a.value?.status||"").toLowerCase()),g=$(()=>y.mode==="edit"&&te.value!=="draft"),ae=$(()=>y.mode!=="edit"?"New Activity":g.value?"View Activity (read-only)":"Edit Activity"),ne=$(()=>y.mode==="edit"?"Save Changes":"Create"),ie=$(()=>{switch(te.value){case"draft":return"bg-gray-100 text-gray-800";case"pending":return"bg-amber-100 text-amber-800";case"approved":return"bg-emerald-100 text-emerald-700";case"rejected":return"bg-rose-100 text-rose-700";case"cancelled":return"bg-zinc-200 text-zinc-800";default:return"bg-gray-100 text-gray-800"}}),le=()=>{if(g.value)return!1;const o={};return a.value.date_filed||(o.date_filed="Required"),a.value.semester?.trim()||(o.semester="Required"),a.value.school_year?.trim()||(o.school_year="Required"),a.value.name_of_activity?.trim()||(o.name_of_activity="Required"),a.value.date_of_implementation||(o.date_of_implementation="Required"),a.value.nature_of_activity||(o.nature_of_activity="Required"),a.value.club_id||(o.club_id="Required"),a.value.rationale?.trim()||(o.rationale="Required"),a.value.objectives?.trim()||(o.objectives="Required"),a.value.details_of_activity?.trim()||(o.details_of_activity="Required"),a.value.budgetary_requirements?.trim()||(o.budgetary_requirements="Required"),v.value=o,Object.keys(o).length===0},se=()=>{if(g.value||!le())return;const o={...a.value};o.proposed_budget===""&&(o.proposed_budget=0),o.filed_by_user_id=L.value,M.value&&h.value?(o.club_id=h.value.club_id,o.office_department=h.value?.club?.name||B(h.value.club_id)||o.office_department||""):o.office_department=B(o.club_id)||o.office_department||"",o.annual_plan_id===""&&(o.annual_plan_id=null),b("submit",o)};return(o,e)=>_.value?(c(),p("div",Ke,[t("div",He,[t("div",Xe,[t("div",Qe,[t("h2",Ze,f(ae.value),1),t("span",{class:X(["text-[11px] px-2 py-1 rounded",ie.value])},f(a.value.status),3)]),t("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:e[0]||(e[0]=l=>_.value=!1)},"Close")]),g.value?(c(),p("div",et,[e[22]||(e[22]=C(" This activity has been submitted and is now ",-1)),t("strong",null,f(a.value.status),1),e[23]||(e[23]=C(". Editing is disabled. ",-1))])):w("",!0),t("div",tt,[t("div",lt,[e[24]||(e[24]=t("div",{class:"text-sm font-medium"},"Link to Annual Plan (optional)",-1)),!g.value&&(M.value||a.value.annual_plan_item)?(c(),p("button",{key:0,class:"text-xs px-2 py-1 rounded border bg-gray-50 hover:bg-gray-100",onClick:re}," Reset Annual Plan link ")):w("",!0)]),t("div",at,[t("div",null,[e[26]||(e[26]=t("label",{class:"block mb-1"},"Annual Plan",-1)),x(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.annual_plan_id=l),class:"w-full border rounded px-2.5 py-2",disabled:g.value},[e[25]||(e[25]=t("option",{value:""},"— Not linked —",-1)),(c(!0),p(j,null,W(U.value,l=>(c(),p("option",{key:l.id,value:l.id},f(l.reference_code)+" — SY "+f(l.school_year)+" — "+f(l?.club?.name||"Club#"+l.club_id),9,it))),128))],8,nt),[[J,a.value.annual_plan_id]])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block mb-1"},"Plan Item",-1)),x(t("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>R.value=l),class:"w-full border rounded px-2.5 py-2",disabled:g.value||!a.value.annual_plan_id||!E.value.length},[e[27]||(e[27]=t("option",{value:""},"— Select item —",-1)),(c(!0),p(j,null,W(E.value,l=>(c(),p("option",{key:l.key,value:l.key},f(l.title)+" — ₱"+f(k(l.funds)),9,ot))),128))],8,st),[[J,R.value]])]),e[29]||(e[29]=t("div",{class:"self-end text-[11px] text-gray-600"},[C(" Choosing an Annual Plan will lock the "),t("strong",null,"Club"),C(". Picking a plan item will also auto-fill "),t("strong",null,"School Year"),C(" and "),t("strong",null,"Proposed Budget"),C(". ")],-1))]),a.value.annual_plan_item?(c(),p("div",rt,[t("div",dt,[t("div",null,[e[30]||(e[30]=t("span",{class:"text-gray-500"},"Item:",-1)),t("strong",null,f(a.value.annual_plan_item.title||a.value.annual_plan_item.name||a.value.annual_plan_item.activity||"—"),1)]),t("div",null,[e[31]||(e[31]=t("span",{class:"text-gray-500"},"Funds:",-1)),t("strong",null,"₱"+f(k(a.value.annual_plan_item.funds||a.value.annual_plan_item.budget||0)),1)]),h.value?(c(),p("div",ut,[e[32]||(e[32]=t("span",{class:"text-gray-500"},"SY:",-1)),t("strong",null,f(h.value.school_year),1)])):w("",!0),h.value?.club?(c(),p("div",ct,[e[33]||(e[33]=t("span",{class:"text-gray-500"},"Club:",-1)),t("strong",null,f(h.value.club.name)+" ("+f(h.value.club.code||"—")+")",1)])):w("",!0)])])):w("",!0)]),t("div",mt,[t("div",null,[e[34]||(e[34]=t("label",{class:"block mb-1"},[C("Date Filed "),t("span",{class:"text-red-500"},"*")],-1)),x(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.date_filed=l),type:"date",class:"w-full border rounded px-2.5 py-2",disabled:g.value},null,8,pt),[[O,a.value.date_filed]]),v.value.date_filed?(c(),p("p",ft,f(v.value.date_filed),1)):w("",!0)]),t("div",null,[e[35]||(e[35]=t("label",{class:"block mb-1"},[C("School Year "),t("span",{class:"text-red-500"},"*")],-1)),x(t("select",{"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.school_year=l),class:"w-full border rounded px-2.5 py-2",disabled:g.value||M.value},[(c(!0),p(j,null,W(N.value,l=>(c(),p("option",{key:l,value:l},f(l),9,_t))),128))],8,vt),[[J,a.value.school_year]]),v.value.school_year?(c(),p("p",bt,f(v.value.school_year),1)):w("",!0)]),t("div",null,[e[37]||(e[37]=t("label",{class:"block mb-1"},[C("Semester "),t("span",{class:"text-red-500"},"*")],-1)),x(t("select",{"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.semester=l),class:"w-full border rounded px-2.5 py-2",disabled:g.value},[e[36]||(e[36]=t("option",{disabled:"",value:""},"Select semester…",-1)),(c(),p(j,null,W(K,l=>t("option",{key:l,value:l},f(l),9,gt)),64))],8,yt),[[J,a.value.semester]]),v.value.semester?(c(),p("p",xt,f(v.value.semester),1)):w("",!0)]),t("div",ht,[e[38]||(e[38]=t("label",{class:"block mb-1"},[C("Name of Activity "),t("span",{class:"text-red-500"},"*")],-1)),x(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.name_of_activity=l),class:"w-full border rounded px-2.5 py-2",disabled:g.value},null,8,wt),[[O,a.value.name_of_activity]]),v.value.name_of_activity?(c(),p("p",St,f(v.value.name_of_activity),1)):w("",!0)])]),t("div",Ct,[t("div",null,[t("label",At,[e[39]||(e[39]=C(" Club ",-1)),e[40]||(e[40]=t("span",{class:"text-red-500"},"*",-1)),M.value?(c(),p("span",kt,"locked by Annual Plan")):w("",!0)]),x(t("select",{"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.club_id=l),class:"w-full border rounded px-2.5 py-2",disabled:g.value||M.value},[e[41]||(e[41]=t("option",{value:""},"Select club…",-1)),(c(!0),p(j,null,W(D(m).clubs.data||[],l=>(c(),p("option",{key:l.id,value:l.id},f(l.name),9,Ft))),128))],8,$t),[[J,a.value.club_id]]),v.value.club_id?(c(),p("p",Et,f(v.value.club_id),1)):w("",!0)]),t("div",null,[e[42]||(e[42]=t("label",{class:"block mb-1"},"Venue",-1)),x(t("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.venue=l),class:"w-full border rounded px-2.5 py-2",disabled:g.value},null,8,Tt),[[O,a.value.venue]])]),t("div",null,[e[43]||(e[43]=t("label",{class:"block mb-1"},[C("Date of Implementation "),t("span",{class:"text-red-500"},"*")],-1)),x(t("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>a.value.date_of_implementation=l),type:"date",class:X(["w-full border rounded px-2.5 py-2",v.value.date_of_implementation?"border-red-500":""]),disabled:g.value,"aria-invalid":!!v.value.date_of_implementation},null,10,Rt),[[O,a.value.date_of_implementation]]),v.value.date_of_implementation?(c(),p("p",Vt,f(v.value.date_of_implementation),1)):w("",!0)])]),t("div",Bt,[t("div",null,[e[44]||(e[44]=t("label",{class:"block mb-1"},"Proposed Budget",-1)),x(t("input",{"onUpdate:modelValue":e[10]||(e[10]=l=>a.value.proposed_budget=l),type:"number",step:"0.01",min:"0",class:"w-full border rounded px-2.5 py-2",disabled:g.value},null,8,Pt),[[O,a.value.proposed_budget]])]),t("div",null,[e[45]||(e[45]=t("label",{class:"block mb-1"},[C("Nature of Activity "),t("span",{class:"text-red-500"},"*")],-1)),x(t("select",{"onUpdate:modelValue":e[11]||(e[11]=l=>a.value.nature_of_activity=l),class:X(["w-full border rounded px-2.5 py-2",v.value.nature_of_activity?"border-red-500":""]),disabled:g.value,"aria-invalid":!!v.value.nature_of_activity},[(c(),p(j,null,W(Y,l=>t("option",{key:l,value:l},f(l),9,Ut)),64))],10,It),[[J,a.value.nature_of_activity]]),v.value.nature_of_activity?(c(),p("p",Dt,f(v.value.nature_of_activity),1)):w("",!0)]),t("div",null,[e[46]||(e[46]=t("label",{class:"block mb-1"},"Participants",-1)),x(t("input",{"onUpdate:modelValue":e[12]||(e[12]=l=>a.value.participants=l),class:"w-full border rounded px-2.5 py-2",disabled:g.value},null,8,Nt),[[O,a.value.participants]])])]),t("div",Ot,[t("div",null,[e[47]||(e[47]=t("label",{class:"block mb-1"},[C("Rationale "),t("span",{class:"text-red-500"},"*")],-1)),x(t("textarea",{"onUpdate:modelValue":e[13]||(e[13]=l=>a.value.rationale=l),rows:"3",class:X(["w-full border rounded px-2.5 py-2",v.value.rationale?"border-red-500":""]),disabled:g.value,"aria-invalid":!!v.value.rationale},null,10,jt),[[O,a.value.rationale]]),v.value.rationale?(c(),p("p",Yt,f(v.value.rationale),1)):w("",!0)]),t("div",null,[e[48]||(e[48]=t("label",{class:"block mb-1"},[C("Objectives "),t("span",{class:"text-red-500"},"*")],-1)),x(t("textarea",{"onUpdate:modelValue":e[14]||(e[14]=l=>a.value.objectives=l),rows:"3",class:X(["w-full border rounded px-2.5 py-2",v.value.objectives?"border-red-500":""]),disabled:g.value,"aria-invalid":!!v.value.objectives},null,10,Lt),[[O,a.value.objectives]]),v.value.objectives?(c(),p("p",Mt,f(v.value.objectives),1)):w("",!0)])]),t("div",zt,[t("div",null,[e[49]||(e[49]=t("label",{class:"block mb-1"},[C("Details of the Activity "),t("span",{class:"text-red-500"},"*")],-1)),x(t("textarea",{"onUpdate:modelValue":e[15]||(e[15]=l=>a.value.details_of_activity=l),rows:"4",class:X(["w-full border rounded px-2.5 py-2",v.value.details_of_activity?"border-red-500":""]),disabled:g.value,"aria-invalid":!!v.value.details_of_activity},null,10,qt),[[O,a.value.details_of_activity]]),v.value.details_of_activity?(c(),p("p",Wt,f(v.value.details_of_activity),1)):w("",!0)]),t("div",null,[e[50]||(e[50]=t("label",{class:"block mb-1"},[C("Budgetary Requirements "),t("span",{class:"text-red-500"},"*")],-1)),x(t("textarea",{"onUpdate:modelValue":e[16]||(e[16]=l=>a.value.budgetary_requirements=l),rows:"4",class:X(["w-full border rounded px-2.5 py-2",v.value.budgetary_requirements?"border-red-500":""]),disabled:g.value,"aria-invalid":!!v.value.budgetary_requirements},null,10,Gt),[[O,a.value.budgetary_requirements]]),v.value.budgetary_requirements?(c(),p("p",Jt,f(v.value.budgetary_requirements),1)):w("",!0)])]),t("div",Kt,[e[51]||(e[51]=t("label",{class:"block mb-1"},"Remarks",-1)),x(t("textarea",{"onUpdate:modelValue":e[17]||(e[17]=l=>a.value.remarks=l),rows:"2",class:"w-full border rounded px-2.5 py-2",disabled:g.value},null,8,Ht),[[O,a.value.remarks]])]),x(t("input",{type:"hidden","onUpdate:modelValue":e[18]||(e[18]=l=>a.value.filed_by_user_id=l)},null,512),[[O,a.value.filed_by_user_id]]),x(t("input",{type:"hidden","onUpdate:modelValue":e[19]||(e[19]=l=>a.value.office_department=l)},null,512),[[O,a.value.office_department]]),x(t("input",{type:"hidden","onUpdate:modelValue":e[20]||(e[20]=l=>a.value.status=l)},null,512),[[O,a.value.status]]),t("div",Xt,[t("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:e[21]||(e[21]=l=>_.value=!1)},"Close"),g.value?w("",!0):(c(),p("button",{key:0,class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:se},f(ne.value),1))])])])):w("",!0)}},Qt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},Zt={class:"bg-white p-4 rounded-xl shadow-xl w-[980px] max-h-screen overflow-auto"},el={class:"flex items-center justify-between mb-3"},tl={class:"text-lg font-semibold"},ll={class:"text-gray-600"},al={class:"flex items-center justify-between gap-2"},nl={class:"text-sm text-gray-600"},il={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},sl=["d"],ol=["disabled"],rl={class:"mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"},dl={class:"aspect-video bg-white border rounded overflow-hidden flex items-center justify-center"},ul=["src"],cl={key:1,class:"flex items-center justify-center w-full h-full"},ml=["d"],pl={class:"mt-2 text-xs"},fl=["title"],vl={class:"text-gray-500 flex items-center justify-between"},_l={key:0},bl={key:0},yl={class:"mt-2 flex items-center justify-between gap-2"},gl=["onClick","title"],xl={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},hl=["d"],wl=["onClick"],Sl={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},Cl=["d"],Al={key:0,class:"mt-6 text-center text-sm text-gray-500"},kl=10*1024*1024,$l={__name:"ActivityAttachmentsModal",props:{modelValue:{type:Boolean,default:!1},row:{type:Object,default:null}},emits:["update:modelValue"],setup(n,{emit:r}){const y=n,b=r,_=$({get:()=>y.modelValue,set:e=>b("update:modelValue",e)}),V=Se(),m=q(null),I=q(!1),L=new Set(["image/png","image/jpeg","image/webp","application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]),a=new Set(["png","jpg","jpeg","webp","pdf","docx","xlsx"]),v=(e="")=>{const l=String(e).toLowerCase().match(/\.([a-z0-9]+)$/i);return l?l[1]:""},S=(e="")=>{if(typeof e!="string")return"";const l=e.match(/^data:([^;]+);base64,/i);return l?l[1]:""},K=e=>{const l=e?.type&&L.has(e.type),u=e?.name&&a.has(v(e.name));return l||u},Y=(e="")=>String(e).startsWith("image/"),N=(e="")=>e==="application/pdf",k=(e="")=>e==="application/vnd.openxmlformats-officedocument.wordprocessingml.document",F=(e="")=>e==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",G=(e="")=>N(e)?Be:k(e)?Pe:F(e)?Ie:Y(e)?Ue:De,B=(e="")=>N(e)?"PDF":k(e)?"Word":F(e)?"Excel":Y(e)?"Image":"File",U=(e="")=>N(e)?"pdf":k(e)?"docx":F(e)?"xlsx":e==="image/png"?"png":e==="image/jpeg"?"jpg":e==="image/webp"?"webp":"",h=(e="attachment",l="")=>{const u=/\.[a-z0-9]+$/i.test(e),A=l?l.startsWith(".")?l.slice(1):l:"";return u?e:A?`${e}.${A}`:e},E=e=>!e&&e!==0?"":e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(1)} MB`,R=$(()=>{const e=m.value?.attachments;if(!e)return[];try{return Array.isArray(e)?e:JSON.parse(e||"[]")}catch{return[]}}),M=$(()=>(R.value||[]).map((e,l)=>{const u=e.mime||S(e.data)||(e.name?v(e.name)==="pdf"&&"application/pdf":"")||"",A=v(e.name||"")||U(u),H=e.size??null,Q=e.name||`${B(u)} ${l+1}`;return{id:e.id??l+1,name:Q,data:e.data||"",url:e.url||e.href||e.path||"",mime:u,ext:A,size:H,filename:h(Q,A)}}));oe(()=>y.modelValue,async e=>{e&&y.row?.id&&(await V.fetchById(y.row.id),m.value=V.selected||y.row)},{immediate:!1});const re=async e=>{const l=e.target.files?.[0];if(e.target.value="",!(!l||!m.value?.id)){if(l.size>kl){await T.fire("File too large","Maximum size is 10 MB.","warning");return}if(!K(l)){await T.fire("Unsupported file","Only images (PNG/JPEG/WEBP), PDF, DOCX, and XLSX are allowed.","warning");return}try{I.value=!0,await V.uploadAttachment(m.value.id,l),await V.fetchById(m.value.id),m.value=V.selected}finally{I.value=!1}}},te=async e=>{!m.value?.id||!(await T.fire({title:"Remove attachment?",icon:"warning",showCancelButton:!0,confirmButtonText:"Remove",confirmButtonColor:"#d33"})).isConfirmed||(await V.deleteAttachment(m.value.id,e),await V.fetchById(m.value.id),m.value=V.selected)},g=e=>{if(e.data&&String(e.data).startsWith("data:")&&Y(e.mime)){const l=window.open();l&&l.document.write(`<img src="${e.data}" style="display:block;max-width:100%;height:auto;margin:0 auto;object-fit:contain"/>`);return}e.url&&window.open(String(e.url),"_blank")},ae=e=>{const[l,u]=e.split(","),A=l.match(/data:([^;]+);base64/i)?.[1]||"application/octet-stream",H=atob(u),Q=H.length,de=new Uint8Array(Q);for(let d=0;d<Q;d++)de[d]=H.charCodeAt(d);return new Blob([de],{type:A})},ne=(e,l)=>{const u=URL.createObjectURL(e),A=document.createElement("a");A.href=u,A.download=l||"download",document.body.appendChild(A),A.click(),A.remove(),setTimeout(()=>URL.revokeObjectURL(u),1e3)},ie=async e=>{if(e.data&&String(e.data).startsWith("data:")){const l=ae(e.data);ne(l,e.filename);return}if(e.url)try{const u=await(await fetch(e.url,{credentials:"include"})).blob();ne(u,e.filename)}catch{const u=document.createElement("a");u.href=String(e.url),u.setAttribute("download",e.filename),document.body.appendChild(u),u.click(),u.remove()}},le=e=>Y(e.mime)?"Open":"Download",se=e=>Y(e.mime)?Te:Re,o=e=>Y(e.mime)?g(e):ie(e);return(e,l)=>_.value?(c(),p("div",Qt,[t("div",Zt,[t("div",el,[t("h2",tl,[l[1]||(l[1]=C(" Attachments — ",-1)),t("span",ll,f(m.value?.name_of_activity||""),1)]),t("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:l[0]||(l[0]=u=>_.value=!1)},"Close")]),t("div",al,[t("div",nl,[l[2]||(l[2]=C(" Ref: ",-1)),t("strong",null,f(m.value?.reference_code||"—"),1)]),t("label",{class:X(["inline-flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white rounded text-xs cursor-pointer disabled:opacity-60",{"opacity-60 pointer-events-none":I.value}])},[(c(),p("svg",il,[t("path",{d:D(Ee)},null,8,sl)])),t("span",null,f(I.value?"Uploading…":"Upload"),1),t("input",{type:"file",class:"hidden",disabled:I.value,onChange:re,accept:".png,.jpg,.jpeg,.webp,.pdf,.docx,.xlsx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,image/png,image/jpeg,image/webp"},null,40,ol)],2)]),t("div",rl,[(c(!0),p(j,null,W(M.value,u=>(c(),p("div",{key:u.id,class:"border rounded-lg p-2 bg-gray-50 flex flex-col"},[t("div",dl,[Y(u.mime)&&u.data&&u.data.startsWith("data:")?(c(),p("img",{key:0,src:u.data,class:"object-contain w-full h-full",alt:"Attachment preview"},null,8,ul)):(c(),p("div",cl,[(c(),p("svg",{style:{width:"64px",height:"64px"},viewBox:"0 0 24 24","aria-hidden":"true",class:X({"text-red-600":N(u.mime),"text-blue-600":k(u.mime),"text-emerald-600":F(u.mime),"text-gray-500":!u.mime||!Y(u.mime)&&!N(u.mime)})},[t("path",{d:G(u.mime)},null,8,ml)],2))]))]),t("div",pl,[t("div",{class:"font-medium truncate",title:u.name},f(u.name),9,fl),t("div",vl,[t("span",null,[C(f(B(u.mime))+" ",1),u.ext?(c(),p("span",_l,"("+f(u.ext.toUpperCase())+")",1)):w("",!0)]),u.size?(c(),p("span",bl,f(E(u.size)),1)):w("",!0)])]),t("div",yl,[t("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-white border rounded text-xs hover:bg-gray-50",onClick:A=>o(u),title:le(u)},[(c(),p("svg",xl,[t("path",{d:se(u)},null,8,hl)])),C(" "+f(le(u)),1)],8,gl),t("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-red-600 text-white rounded text-xs",onClick:A=>te(u.id),title:"Remove"},[(c(),p("svg",Sl,[t("path",{d:D(Ve)},null,8,Cl)])),l[3]||(l[3]=C(" Remove ",-1))],8,wl)])]))),128))]),M.value.length?w("",!0):(c(),p("div",Al," No attachments yet. "))])])):w("",!0)}},Fl="KOLEHIYO NG PANTUKAN",El="Juan A. Sarenas Campus, Kingking, Pantukan, Davao de Oro",Tl="https://osas.knp.edu.ph/verify-actdesign?id=",ue=n=>n?he(n).format("MMMM DD, YYYY"):"—",Rl=n=>n==null||n===""?"—":Number(n).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),Ce="./",Vl=`${Ce}images/logo.png`,Bl=`${Ce}images/bg.jpg`;async function ye(n){const y=await(await fetch(n)).blob();return new Promise(b=>{const _=new FileReader;_.onloadend=()=>b(_.result),_.readAsDataURL(y)})}function Pl(n){switch(n){case"APPROVED":return[32,141,85];case"PENDING":return[240,158,47];case"REJECTED":return[220,53,69];case"CANCELLED":return[107,114,128];default:return[90,90,90]}}async function Il(n){const r=n.internal.pageSize.getWidth(),y=110,b=36;try{const _=await ye(Bl);n.addImage(_,"JPEG",0,0,r,y,void 0,"FAST")}catch{n.setFillColor(21,62,121),n.rect(0,0,r,y,"F")}n.setGState(new n.GState({opacity:.18})),n.setFillColor(0,0,0),n.rect(0,0,r,y,"F"),n.setGState(new n.GState({opacity:1}));try{const _=await ye(Vl);n.addImage(_,"PNG",b,20,70,70,void 0,"FAST")}catch{}return n.setTextColor(255,255,255),n.setFont("helvetica","bold"),n.setFontSize(20),n.text(Fl,b+86,38),n.setFont("helvetica","normal"),n.setFontSize(10),n.text(El,b+86,58),n.setTextColor(20),n.setFont("helvetica","bold"),n.setFontSize(14),n.text("ACTIVITY DESIGN",r/2,y+24,{align:"center"}),y+34}async function Ul(n,r,y){const b=n.internal.pageSize.getWidth(),_=36,V=r?.id??r?.reference_code??"",m=`${Tl}${encodeURIComponent(String(V))}`,I=await Fe.toDataURL(m,{margin:0,width:75,errorCorrectionLevel:"M",color:{dark:"#000000",light:"#FFFFFF"}}),L=String(r.status||"").toUpperCase(),[a,v,S]=Pl(L),K=r.approved_at?ue(r.approved_at):r.date_filed?ue(r.date_filed):"—",Y=`osas.knp.edu.ph/verify-actdesign?id=${String(V)}`;return ee(n,{startY:y,theme:"plain",styles:{cellPadding:0,fontSize:9},bodyStyles:{minCellHeight:110},margin:{left:_,right:_},tableWidth:b-_*2,body:[[{content:""},{content:""}]],columnStyles:{0:{cellWidth:b-_*2-260},1:{cellWidth:260}},didDrawCell:N=>{if(N.section!=="body")return;const{x:k,y:F,width:G,height:B}=N.cell,U=10;if(N.column.index===0){n.setFillColor(255,255,255),n.roundedRect(k,F,G-1,B,6,6,"F");const h=24,E=Math.min(140,G-22);n.setFillColor(a,v,S),n.roundedRect(k+U,F+U,E,h,12,12,"F"),n.setTextColor(255,255,255),n.setFont("helvetica","bold"),n.setFontSize(10),n.text(L||"STATUS",k+U+10,F+U+16),n.setTextColor(20),n.setFont("helvetica","normal"),n.setFontSize(9);const R=F+U+h+14;n.text(`Ref No.: ${r.reference_code||"—"}`,k+U,R),n.text(`Date Issued: ${K}`,k+U,R+16),n.setDrawColor(230),n.roundedRect(k,F,G-1,B,6,6,"S")}if(N.column.index===1){n.setFillColor(255,255,255),n.roundedRect(k,F,G-1,B,6,6,"F"),n.setFillColor(66,103,178),n.roundedRect(k,F,G-1,22,6,6,"F"),n.setTextColor(255,255,255),n.setFont("helvetica","bold"),n.setFontSize(10),n.text("VERIFY",k+U,F+15);const h=k+U,E=F+28;n.addImage(I,"PNG",h,E,75,75,void 0,"FAST"),n.setTextColor(20),n.setFont("helvetica","bold"),n.setFontSize(10),n.text("Scan to verify",h+100,E+14),n.setFont("helvetica","normal"),n.setFontSize(9),n.text("This document can be verified",h+100,E+32),n.text("online via the OSAS portal.",h+100,E+46),n.setTextColor(110),n.setFontSize(8),n.text(Y,h+100,E+72),n.setDrawColor(230),n.roundedRect(k,F,G-1,B,6,6,"S")}}}),n.lastAutoTable.finalY}async function Dl(n){const r=new $e({unit:"pt",format:[612,936],orientation:"portrait"}),y=r.internal.pageSize.getWidth(),b=36;let _=await Il(r);_=await Ul(r,n,_)+10,ee(r,{startY:_,theme:"grid",styles:{fontSize:9,cellPadding:5},headStyles:{fillColor:[222,235,247],textColor:20,fontStyle:"bold"},head:[["SEMESTER","DATE FILED","SCHOOL YEAR","OFFICE/DEPARTMENT"]],body:[[n.semester||"—",ue(n.date_filed),n.school_year||"—",n.office_department||n?.club?.name||"—"]],columnStyles:{0:{cellWidth:120},1:{cellWidth:120},2:{cellWidth:120},3:{cellWidth:"auto"}},margin:{left:b,right:b}}),_=r.lastAutoTable.finalY+10,ee(r,{startY:_,theme:"plain",styles:{fontSize:10},body:[[{content:"ACTIVITY INFORMATION",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",halign:"left",valign:"middle",cellPadding:6}}]],margin:{left:b,right:b}}),_=r.lastAutoTable.finalY,ee(r,{startY:_,theme:"grid",styles:{fontSize:9,cellPadding:6},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},body:[[{content:"NAME OF ACTIVITY",styles:{fillColor:[243,248,255],fontStyle:"bold"}},n.name_of_activity||"—"],[{content:"VENUE",styles:{fillColor:[243,248,255],fontStyle:"bold"}},n.venue||"—"],[{content:"DATE OF IMPLEMENTATION",styles:{fillColor:[243,248,255],fontStyle:"bold"}},ue(n.date_of_implementation)],[{content:"PROPOSED BUDGET",styles:{fillColor:[243,248,255],fontStyle:"bold"}},`${Rl(n.proposed_budget)}   (Source: Department Fund)`],[{content:"PARTICIPANTS",styles:{fillColor:[243,248,255],fontStyle:"bold"}},n.participants||"—"],[{content:"NATURE OF ACTIVITY",styles:{fillColor:[243,248,255],fontStyle:"bold"}},n.nature_of_activity||"—"]],columnStyles:{0:{cellWidth:180,fontStyle:"bold"},1:{cellWidth:"auto"}},margin:{left:b,right:b}}),_=r.lastAutoTable.finalY+10,[["RATIONALE",n.rationale],["OBJECTIVES",n.objectives],["DETAILS OF THE ACTIVITY",n.details_of_activity],["BUDGETARY REQUIREMENTS",n.budgetary_requirements]].forEach(([a,v])=>{ee(r,{startY:_,theme:"plain",styles:{fontSize:10},body:[[{content:a,styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:b,right:b}}),_=r.lastAutoTable.finalY,ee(r,{startY:_,theme:"grid",styles:{fontSize:9,cellPadding:8},body:[[v&&String(v).trim()?v:"—"]],margin:{left:b,right:b}}),_=r.lastAutoTable.finalY+10}),ee(r,{startY:_,theme:"plain",styles:{fontSize:10},body:[[{content:"APPROVAL",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:b,right:b}}),_=r.lastAutoTable.finalY;const m=n?.filed_by?`${n.filed_by.first_name||""} ${n.filed_by.last_name||""}`.trim():"",I=n?.approver?`${n.approver.first_name||""} ${n.approver.last_name||""}`.trim():"";ee(r,{startY:_,theme:"grid",styles:{fontSize:9,cellPadding:10},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},head:[["PREPARED BY:","NOTED BY:","APPROVED BY:"]],body:[[m||" ","Albert P. Mapalo",I||" "]],columnStyles:{0:{cellWidth:(y-b*2)/3},1:{cellWidth:(y-b*2)/3},2:{cellWidth:"auto"}},didParseCell:a=>{a.section==="body"&&(a.cell.styles.halign="center",a.cell.styles.fontStyle="bold",a.cell.styles.cellPadding={top:16,right:10,bottom:18,left:10})},margin:{left:b,right:b}});const L=r.internal.pageSize.getHeight()-20;r.setFontSize(8),r.setTextColor(120),r.text(`Generated on ${he().format("YYYY-MM-DD HH:mm")} • ${window.location.origin}`,b,L),r.save(`${n.reference_code||"Activity_Design"}.pdf`)}const Nl={class:"flex items-center gap-2"},Ol={class:"p-3 mb-4 rounded-xl border bg-white/60"},jl={class:"flex items-center gap-2 mb-2 text-gray-700"},Yl={class:"w-4 h-4",viewBox:"0 0 24 24"},Ll=["d"],Ml={class:"grid grid-cols-1 md:grid-cols-6 gap-2 text-sm"},zl=["value"],ql=["value"],Wl=["value"],Gl=["value"],Jl={key:0,value:""},Kl=["value"],Hl={value:""},Xl=["value"],Ql={class:"md:col-span-1"},Zl={class:"md:col-span-1"},ea={class:"flex items-center gap-2 md:col-span-2"},ta={class:"flex flex-col gap-1"},la={class:"text-xs"},aa={class:"inline-flex items-center gap-2 px-2 py-1 rounded bg-emerald-50 border border-emerald-200"},na={class:"font-medium"},ia={class:"text-gray-600"},sa={class:"text-xs text-gray-700"},oa={class:"font-medium"},ra={class:"text-gray-500"},da={key:1,class:"text-gray-400 text-xs"},ga={__name:"ActivityDesignsPage",setup(n){const r=Se(),y=ge(),b=we(),_=Ae(),V={range:!0,partialRange:!0,multiCalendars:2,modelType:"yyyy-MM-dd",enableTimePicker:!1,autoApply:!0,clearable:!0},m=q({page:1,limit:10,sort:"created_at",order:"DESC",q:"",status:"",nature_of_activity:"",school_year:"",semester:"",club_id:"",filed_by_user_id:"",date_filed_from:"",date_filed_to:"",impl_from:"",impl_to:""}),I=$({get:()=>{const{date_filed_from:d,date_filed_to:i}=m.value;return d||i?[d||null,i||null]:null},set:d=>{if(!d)m.value.date_filed_from=null,m.value.date_filed_to=null;else{const[i,s]=d;m.value.date_filed_from=i||null,m.value.date_filed_to=s||null}}}),L=$({get:()=>{const{impl_from:d,impl_to:i}=m.value;return d||i?[d||null,i||null]:null},set:d=>{if(!d)m.value.impl_from=null,m.value.impl_to=null;else{const[i,s]=d;m.value.impl_from=i||null,m.value.impl_to=s||null}}}),a=["1st Semester","2nd Semester","Summer"],v=$(()=>{const d=new Date().getFullYear();return Array.from({length:6},(i,s)=>`${d-s}-${d-s+1}`)}),S=async(d={},i=!0)=>{m.value={...m.value,...d},typeof m.value.officer>"u"&&(m.value.officer=!0);const s={...m.value};["q","status","nature_of_activity","school_year","semester","club_id","filed_by_user_id","date_filed_from","date_filed_to","impl_from","impl_to"].forEach(P=>{(s[P]===""||s[P]==null)&&delete s[P]}),s.officer=m.value.officer,await r.fetchAll(s,i)};xe(async()=>{await Promise.all([S({page:1,limit:10}),b.fetchAll({page:1,limit:200,officer:!0},!0),_.fetchAll({page:1,limit:200},!0)])});const K=q([]);oe(()=>m.value.club_id,async d=>{if(m.value.filed_by_user_id="",!d){K.value=[];return}try{await b.fetchById(d),K.value=Array.isArray(b.selectedClub?.users)?b.selectedClub.users:[]}catch{K.value=[]}});const Y=$(()=>m.value.club_id?K.value:_.users.data||[]),N=$(()=>({total:r.items.total||0,totalPages:r.items.totalPages||1,currentPage:r.items.currentPage||1,pageSize:r.items.pageSize||10,data:r.items.data||[]})),k=["Curricular","Co-Curricular","Extra-Curricular"],F=["draft","pending","approved","rejected","cancelled"],G=d=>{switch(String(d||"").toLowerCase()){case"draft":return"gray";case"pending":return"amber";case"approved":return"emerald";case"rejected":return"red";case"cancelled":return"zinc";default:return"gray"}},B=d=>{const i=Number(d);return Number.isFinite(i)?i.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},U=[{key:"reference_code",label:"Ref Code",sortable:!0,width:140},{key:"name_of_activity",label:"Activity",sortable:!0,minWidth:220},{key:"annual_plan_item",label:"Annual Plan / Item",sortable:!1,minWidth:260},{key:"club_id",label:"Club",sortable:!1,formatter:(d,i)=>i.club?i.club.name:""},{key:"semester",label:"Sem",sortable:!0,width:110},{key:"school_year",label:"S.Y.",sortable:!0,width:110},{key:"date_of_implementation",label:"Implementation",sortable:!0,width:140,formatter:d=>d?new Date(d).toLocaleDateString():"—"},{key:"status",label:"Status",sortable:!0,width:120}],h=async d=>{await S(d)},E=q(!1),R=q(!1),M=q(null),re=()=>{E.value=!0},te=d=>{if(!d)return null;if(typeof d=="object")return d;try{return JSON.parse(d)}catch{return null}},g=async d=>{await r.create(d),E.value=!1,await S({},!0)},ae=async d=>{await r.fetchById(d.id);const i=r.selected||d;M.value={id:i.id,date_filed:i.date_filed||"",semester:i.semester||"",office_department:i.office_department||"",school_year:i.school_year||"",name_of_activity:i.name_of_activity||"",venue:i.venue||"",date_of_implementation:i.date_of_implementation||"",proposed_budget:i.proposed_budget??"",participants:i.participants||"",nature_of_activity:i.nature_of_activity||"Curricular",rationale:i.rationale||"",objectives:i.objectives||"",details_of_activity:i.details_of_activity||"",budgetary_requirements:i.budgetary_requirements||"",filed_by_user_id:i.filed_by_user_id||"",club_id:i.club_id||"",status:i.status||"draft",remarks:i.remarks||"",annual_plan_id:i.annual_plan_id||"",annual_plan_item:te(i.annual_plan_item)},R.value=!0},ne=async d=>{const{id:i,...s}=d;await r.updateById(i,s),R.value=!1,await S({},!0)},ie=async d=>{if(!d?.id)return;(await T.fire({title:`Delete "${d.name_of_activity}"?`,text:"This cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it",cancelButtonText:"Cancel"})).isConfirmed&&(await r.deleteById(d.id),await S({},!0),await T.fire("Deleted","The activity design has been deleted.","success"))},le=async d=>{await r.fetchById(d.id);const i=r.selected||d;M.value={...i,date_filed:i.date_filed?String(i.date_filed).slice(0,10):"",date_of_implementation:i.date_of_implementation?String(i.date_of_implementation).slice(0,10):"",annual_plan_id:i.annual_plan_id||"",annual_plan_item:te(i.annual_plan_item)},R.value=!0},se=async d=>{if((await T.fire({title:"Submit for approval?",text:"You can no longer edit after submission.",icon:"question",showCancelButton:!0,confirmButtonText:"Submit",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1})).isConfirmed)try{await r.submit(d.id),await S({},!0),await T.fire("Submitted","Activity is now pending approval.","success")}catch{await T.fire("Error",r.error||"Failed to submit activity.","error")}},o=async d=>{const i=await T.fire({title:"Approve activity?",input:"textarea",inputLabel:"Remarks (optional)",inputPlaceholder:"Add a note…",showCancelButton:!0,confirmButtonText:"Approve",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1});if(!i.isConfirmed)return;const s=i.value||"";try{await r.approve(d.id,s),await S({},!0),await T.fire("Approved","Activity has been approved.","success")}catch{await T.fire("Error",r.error||"Failed to approve activity.","error")}},e=async d=>{const i=await T.fire({title:"Reject activity?",input:"textarea",inputLabel:"Reason (required)",inputPlaceholder:"State the reason…",inputValidator:P=>P?.trim()?void 0:"Reason is required",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Reject",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1});if(!i.isConfirmed)return;const s=i.value;try{await r.reject(d.id,s),await S({},!0),await T.fire("Rejected","Activity has been rejected.","success")}catch{await T.fire("Error",r.error||"Failed to reject activity.","error")}},l=async d=>{const i=await T.fire({title:"Cancel activity?",input:"textarea",inputLabel:"Reason (required)",inputPlaceholder:"State the reason…",inputValidator:P=>P?.trim()?void 0:"Reason is required",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Cancel Activity",cancelButtonText:"Keep Activity",allowOutsideClick:!1,allowEscapeKey:!1});if(!i.isConfirmed)return;const s=i.value;try{await r.cancel(d.id,s),await S({},!0),await T.fire("Cancelled","Activity has been cancelled.","success")}catch{await T.fire("Error",r.error||"Failed to cancel activity.","error")}},u=async d=>{if(String(d?.status||"").toLowerCase()!=="approved"){await T.fire("Not allowed","Only approved activities can be printed.","info");return}try{await r.fetchById(d.id);const s=r.selected||d;await Dl(s)}catch(s){await T.fire("Error",r.error||"Failed to generate PDF.","error"),console.error(s)}},A=q(!1),H=q(null),Q=async d=>{await r.fetchById(d.id),H.value=r.selected||d,A.value=!0},de=async()=>{await S({q:"",status:"",nature_of_activity:"",school_year:"",semester:"",club_id:"",filed_by_user_id:"",date_filed_from:"",date_filed_to:"",impl_from:"",impl_to:"",page:1})};return(d,i)=>(c(),p(j,null,[z(Ne,null,{default:Z(()=>[z(Oe,null,{default:Z(()=>[D(r).error?(c(),ce(qe,{key:0,icon:D(je),color:"danger"},{default:Z(()=>[C(f(D(r).error),1)]),_:1},8,["icon"])):w("",!0),z(We,{icon:D(Ye),title:"Activity Designs",main:""},{default:Z(()=>[t("div",Nl,[z(ve,{icon:D(Le),color:"primary",label:"New Activity",onClick:re},null,8,["icon"]),z(ve,{icon:D(Me),color:"info",label:"Refresh",onClick:i[0]||(i[0]=s=>S({},!0))},null,8,["icon"])])]),_:1},8,["icon"]),t("div",Ol,[t("div",jl,[(c(),p("svg",Yl,[t("path",{d:D(ze)},null,8,Ll)])),i[15]||(i[15]=t("span",{class:"font-medium text-sm"},"Filters",-1))]),t("div",Ml,[x(t("input",{"onUpdate:modelValue":i[1]||(i[1]=s=>m.value.q=s),placeholder:"Search by ref, activity, venue, office…",class:"border rounded px-2 py-2 md:col-span-2",onKeyup:i[2]||(i[2]=ke(s=>S({page:1}),["enter"]))},null,544),[[O,m.value.q]]),x(t("select",{"onUpdate:modelValue":i[3]||(i[3]=s=>m.value.status=s),class:"border rounded px-2 py-2"},[i[16]||(i[16]=t("option",{value:""},"All status",-1)),(c(),p(j,null,W(F,s=>t("option",{key:s,value:s},f(s),9,zl)),64))],512),[[J,m.value.status]]),x(t("select",{"onUpdate:modelValue":i[4]||(i[4]=s=>m.value.nature_of_activity=s),class:"border rounded px-2 py-2"},[i[17]||(i[17]=t("option",{value:""},"All natures",-1)),(c(),p(j,null,W(k,s=>t("option",{key:s,value:s},f(s),9,ql)),64))],512),[[J,m.value.nature_of_activity]]),x(t("select",{"onUpdate:modelValue":i[5]||(i[5]=s=>m.value.school_year=s),class:"border rounded px-2 py-2 md:col-span-1"},[(c(!0),p(j,null,W(v.value,s=>(c(),p("option",{key:s,value:s},f(s),9,Wl))),128))],512),[[J,m.value.school_year]]),x(t("select",{"onUpdate:modelValue":i[6]||(i[6]=s=>m.value.semester=s),class:"border rounded px-2 py-2 md:col-span-1"},[i[18]||(i[18]=t("option",{disabled:"",value:""},"Select semester…",-1)),(c(),p(j,null,W(a,s=>t("option",{key:s,value:s},f(s),9,Gl)),64))],512),[[J,m.value.semester]]),x(t("select",{"onUpdate:modelValue":i[7]||(i[7]=s=>m.value.club_id=s),class:"border rounded px-2 py-2 md:col-span-2"},[D(y).user.role==="admin"?(c(),p("option",Jl,"All clubs")):w("",!0),(c(!0),p(j,null,W(D(b).clubs.data||[],s=>(c(),p("option",{key:s.id,value:s.id},f(s.name),9,Kl))),128))],512),[[J,m.value.club_id]]),x(t("select",{"onUpdate:modelValue":i[8]||(i[8]=s=>m.value.filed_by_user_id=s),class:"border rounded px-2 py-2 md:col-span-2"},[t("option",Hl,f(m.value.club_id?"Filed by (club members)":"Filed by (any)"),1),(c(!0),p(j,null,W(Y.value,s=>(c(),p("option",{key:s.id,value:s.id},f(s.first_name)+" "+f(s.last_name)+" (@"+f(s.username)+") ",9,Xl))),128))],512),[[J,m.value.filed_by_user_id]]),t("div",Ql,[z(D(pe),me({modelValue:I.value,"onUpdate:modelValue":i[9]||(i[9]=s=>I.value=s)},V,{placeholder:"Filed date range"}),null,16,["modelValue"])]),t("div",Zl,[z(D(pe),me({modelValue:L.value,"onUpdate:modelValue":i[10]||(i[10]=s=>L.value=s)},V,{placeholder:"Implementation date range"}),null,16,["modelValue"])]),t("div",ea,[t("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:i[11]||(i[11]=s=>S({page:1}))}," Apply "),t("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:de}," Reset ")])])]),z(Ge,{columns:U,data:N.value,loading:D(r).isLoading,onQueryChange:h},{"cell-annual_plan_item":Z(({row:s})=>[t("div",ta,[s.annual_plan_id?(c(),p(j,{key:0},[t("div",la,[t("span",aa,[t("span",na,f(s.annual_plan?.reference_code||`AP-${s.annual_plan_id}`),1),t("span",ia,"SY "+f(s.annual_plan?.school_year||"—"),1)])]),t("div",sa,[t("span",oa,f((()=>{try{const P=typeof s.annual_plan_item=="string"?JSON.parse(s.annual_plan_item||"null")||{}:s.annual_plan_item||{};return P.item||P.title||P.name||P.activity||"—"}catch{return"—"}})()),1),t("span",ra," — ₱"+f((()=>{try{const P=typeof s.annual_plan_item=="string"?JSON.parse(s.annual_plan_item||"null")||{}:s.annual_plan_item||{};return B(P.funds??P.budget??0)}catch{return B(0)}})()),1)])],64)):(c(),p("span",da,"—"))])]),"cell-nature_of_activity":Z(({value:s})=>[z(_e,{text:s||"—",tone:"indigo"},null,8,["text"])]),"cell-status":Z(({value:s})=>[z(_e,{text:s||"—",tone:G(s)},null,8,["text","tone"])]),"cell-actions":Z(({row:s})=>[["admin","manager"].includes(String(D(y).user?.role||"").toLowerCase())?(c(),ce(fe,{key:0,row:s,moderator:!0,onAttachments:Q,onSubmit:se,onApprove:o,onReject:e,onEdit:ae,onDelete:ie,onView:P=>le(s),onCancel:l,onPrint:u},null,8,["row","onView"])):(c(),ce(fe,{key:1,row:s,moderator:!1,onAttachments:Q,onSubmit:se,onEdit:ae,onDelete:ie,onView:P=>le(s),onCancel:l,onPrint:u},null,8,["row","onView"]))]),_:1},8,["data","loading"])]),_:1})]),_:1}),z(be,{modelValue:E.value,"onUpdate:modelValue":i[12]||(i[12]=s=>E.value=s),mode:"create",onSubmit:g},null,8,["modelValue"]),z(be,{modelValue:R.value,"onUpdate:modelValue":i[13]||(i[13]=s=>R.value=s),mode:"edit",initial:M.value||{},onSubmit:ne},null,8,["modelValue","initial"]),z($l,{modelValue:A.value,"onUpdate:modelValue":i[14]||(i[14]=s=>A.value=s),row:H.value},null,8,["modelValue","row"])],64))}};export{ga as default};
