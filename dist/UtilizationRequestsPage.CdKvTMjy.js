import{c as W,r as _,x as me,a as S,d as J,q as h,e as s,k as le,t as V,j as Se,g as T,F as ae,B as ie,S as w,o as pe,f as $,h as M,v as X,C as ue,u as Je,z as He,l as q,s as Qe,p as Ke,A as Ce,M as Xe,Q as Ae}from"./index.Cn36LOKA.js";import{E as Ze,a as U,d as xe,Q as ke,_ as et}from"./dayjs.min.TV7bWUFM.js";import{B as tt,E as at,F as lt,G as it,H as st,I as nt,C as ot,D as rt,z as dt,_ as ct,a as ut,g as mt,J as pt,i as ft,a7 as yt,K as gt,L as vt,M as bt,V as _t}from"./SectionMain.DzFLPhaW.js";import{_ as ht,a as ce}from"./SectionTitleLineWithButton.YS3_2U69.js";import{_ as xt,B as wt,a as _e}from"./Badge.CP2mIvjs.js";import{_ as $e}from"./UtilizationRequestFormModal.DW8XAHbU.js";import{u as fe}from"./utilizationRequest.Bd8ULNJX.js";import{i as St,a as Ct,b as At,F as kt}from"./index.DqfmgckL.js";import{Q as $t}from"./browser.zcWkO08B.js";import{_ as Tt}from"./StatusTrailModal.C6b82tH6.js";import{u as Et}from"./clubScope.C1ij5bCG.js";import"./IconifyButton.mYIlt8qo.js";import"./appContext.OkQ-UGEt.js";import"./activityDesignService.Bhm81AMf.js";import"./utilizationRequestService.BVSkMsvB.js";import"./liquidationFundService.QYCtOObH.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";import"./ToasterComponent.C4k87c1C.js";import"./club.C5vXVCL3.js";import"./activityDesign.Bt_aVq5X.js";const Ft={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},Rt={class:"bg-white p-4 rounded-xl shadow-xl w-[980px] max-h-screen overflow-auto"},Bt={class:"flex items-center justify-between mb-3"},zt={class:"text-lg font-semibold"},Vt={class:"text-gray-600"},It={class:"flex items-center justify-between gap-2"},Ut={class:"text-sm text-gray-600"},Ot={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},Nt=["d"],Dt=["disabled"],Pt={class:"mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"},Lt={class:"aspect-video bg-white border rounded overflow-hidden flex items-center justify-center"},Mt=["src"],Yt={key:1,class:"flex items-center justify-center w-full h-full"},jt=["d"],qt={class:"mt-2 text-xs"},Wt=["title"],Gt={class:"text-gray-500 flex items-center justify-between"},Jt={key:0},Ht={key:0},Qt={class:"mt-2 flex items-center justify-between gap-2"},Kt=["onClick","title"],Xt={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},Zt=["d"],ea=["onClick"],ta={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},aa=["d"],la={key:0,class:"mt-6 text-center text-sm text-gray-500"},ia=10*1024*1024,sa={__name:"UtilizationAttachmentsModal",props:{modelValue:{type:Boolean,default:!1},row:{type:Object,default:null}},emits:["update:modelValue"],setup(t,{emit:l}){const x=t,d=l,b=W({get:()=>x.modelValue,set:i=>d("update:modelValue",i)}),u=fe(),r=_(null),v=_(!1),A=new Set(["image/png","image/jpeg","image/webp","application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]),E=new Set(["png","jpg","jpeg","webp","pdf","docx","xlsx"]),I=(i="")=>String(i).toLowerCase().match(/\.([a-z0-9]+)$/i)?.[1]||"",O=(i="")=>typeof i=="string"&&i.match(/^data:([^;]+);base64,/i)?.[1]||"",N=i=>{const p=i?.type&&A.has(i.type),m=i?.name&&E.has(I(i.name));return p||m},F=(i="")=>String(i).startsWith("image/"),f=(i="")=>i==="application/pdf",o=(i="")=>i==="application/vnd.openxmlformats-officedocument.wordprocessingml.document",c=(i="")=>i==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",j=(i="")=>f(i)?at:o(i)?lt:c(i)?it:F(i)?st:nt,D=(i="")=>f(i)?"PDF":o(i)?"Word":c(i)?"Excel":F(i)?"Image":"File",C=(i="")=>f(i)?"pdf":o(i)?"docx":c(i)?"xlsx":i==="image/png"?"png":i==="image/jpeg"?"jpg":i==="image/webp"?"webp":"",R=(i="attachment",p="")=>/\.[a-z0-9]+$/i.test(i)?i:p?`${i}.${p.startsWith(".")?p.slice(1):p}`:i,P=i=>i<1024?`${i} B`:i<1024*1024?`${(i/1024).toFixed(1)} KB`:`${(i/(1024*1024)).toFixed(1)} MB`,G=W(()=>{const i=r.value?.attachments;if(!i)return[];try{return Array.isArray(i)?i:JSON.parse(i||"[]")}catch{return[]}}),B=W(()=>(G.value||[]).map((i,p)=>{const m=i.mime||O(i.data)||(i.name?I(i.name)==="pdf"&&"application/pdf":"")||"",z=I(i.name||"")||C(m),Z=i.size??null,ee=i.name||`${D(m)} ${p+1}`;return{id:i.id??p+1,name:ee,data:i.data||"",url:i.url||i.href||i.path||"",mime:m,ext:z,size:Z,filename:R(ee,z)}}));me(()=>x.modelValue,async i=>{i&&x.row?.id&&(await u.fetchById(x.row.id),r.value=u.selected||x.row)},{immediate:!1});const y=async i=>{const p=i.target.files?.[0];if(i.target.value="",!(!p||!r.value?.id)){if(p.size>ia){await w.fire("File too large","Maximum size is 10 MB.","warning");return}if(!N(p)){await w.fire("Unsupported file","Only images (PNG/JPEG/WEBP), PDF, DOCX, and XLSX are allowed.","warning");return}try{v.value=!0,await u.uploadAttachment(r.value.id,p),await u.fetchById(r.value.id),r.value=u.selected}finally{v.value=!1}}},L=async i=>{!r.value?.id||!(await w.fire({title:"Remove attachment?",icon:"warning",showCancelButton:!0,confirmButtonText:"Remove",confirmButtonColor:"#d33"})).isConfirmed||(await u.deleteAttachment(r.value.id,i),await u.fetchById(r.value.id),r.value=u.selected)},H=i=>{if(i.data&&String(i.data).startsWith("data:")&&F(i.mime)){const p=window.open();p&&p.document.write(`<img src="${i.data}" style="display:block;max-width:100%;height:auto;margin:0 auto;object-fit:contain"/>`);return}i.url&&window.open(String(i.url),"_blank")},k=i=>{const[p,m]=i.split(","),z=p.match(/data:([^;]+);base64/i)?.[1]||"application/octet-stream",Z=atob(m),ee=Z.length,oe=new Uint8Array(ee);for(let K=0;K<ee;K++)oe[K]=Z.charCodeAt(K);return new Blob([oe],{type:z})},Q=(i,p)=>{const m=URL.createObjectURL(i),z=document.createElement("a");z.href=m,z.download=p||"download",document.body.appendChild(z),z.click(),z.remove(),setTimeout(()=>URL.revokeObjectURL(m),1e3)},ye=async i=>{if(i.data&&String(i.data).startsWith("data:")){const p=k(i.data);Q(p,i.filename);return}if(i.url)try{const m=await(await fetch(i.url,{credentials:"include"})).blob();Q(m,i.filename)}catch{const p=document.createElement("a");p.href=String(i.url),p.setAttribute("download",i.filename),document.body.appendChild(p),p.click(),p.remove()}},ne=i=>F(i.mime)?"Open":"Download",ge=i=>F(i.mime)?ot:rt,ve=i=>F(i.mime)?H(i):ye(i);return(i,p)=>b.value?(h(),S("div",Ft,[s("div",Rt,[s("div",Bt,[s("h2",zt,[p[1]||(p[1]=le(" Utilization Attachments — ",-1)),s("span",Vt,V(r.value?.reference_code||""),1)]),s("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:p[0]||(p[0]=m=>b.value=!1)},"Close")]),s("div",It,[s("div",Ut,[p[2]||(p[2]=le(" Activity: ",-1)),s("strong",null,V(r.value?.activity_design?.name_of_activity||"—"),1)]),s("label",{class:Se(["inline-flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white rounded text-xs cursor-pointer disabled:opacity-60",{"opacity-60 pointer-events-none":v.value}])},[(h(),S("svg",Ot,[s("path",{d:T(tt)},null,8,Nt)])),s("span",null,V(v.value?"Uploading…":"Upload"),1),s("input",{type:"file",class:"hidden",disabled:v.value,onChange:y,accept:".png,.jpg,.jpeg,.webp,.pdf,.docx,.xlsx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,image/png,image/jpeg,image/webp"},null,40,Dt)],2)]),s("div",Pt,[(h(!0),S(ae,null,ie(B.value,m=>(h(),S("div",{key:m.id,class:"border rounded-lg p-2 bg-gray-50 flex flex-col"},[s("div",Lt,[F(m.mime)&&m.data&&m.data.startsWith("data:")?(h(),S("img",{key:0,src:m.data,class:"object-contain w-full h-full",alt:"Attachment preview"},null,8,Mt)):(h(),S("div",Yt,[(h(),S("svg",{style:{width:"64px",height:"64px"},viewBox:"0 0 24 24","aria-hidden":"true",class:Se({"text-red-600":f(m.mime),"text-blue-600":o(m.mime),"text-emerald-600":c(m.mime),"text-gray-500":!m.mime||!F(m.mime)&&!f(m.mime)})},[s("path",{d:j(m.mime)},null,8,jt)],2))]))]),s("div",qt,[s("div",{class:"font-medium truncate",title:m.name},V(m.name),9,Wt),s("div",Gt,[s("span",null,[le(V(D(m.mime))+" ",1),m.ext?(h(),S("span",Jt,"("+V(m.ext.toUpperCase())+")",1)):J("",!0)]),m.size?(h(),S("span",Ht,V(P(m.size)),1)):J("",!0)])]),s("div",Qt,[s("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-white border rounded text-xs hover:bg-gray-50",onClick:z=>ve(m),title:ne(m)},[(h(),S("svg",Xt,[s("path",{d:ge(m)},null,8,Zt)])),le(" "+V(ne(m)),1)],8,Kt),s("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-red-600 text-white rounded text-xs",onClick:z=>L(m.id),title:"Remove"},[(h(),S("svg",ta,[s("path",{d:T(dt)},null,8,aa)])),p[3]||(p[3]=le(" Remove ",-1))],8,ea)])]))),128))]),B.value.length?J("",!0):(h(),S("div",la," No attachments yet. "))])])):J("",!0)}},na={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/35 backdrop-blur-sm"},oa={class:"bg-white rounded-2xl shadow-2xl w-full sm:w-[1200px] max-w-[100vw] sm:max-w-[95vw] h-[100vh] sm:h-auto sm:max-h-[90vh] overflow-hidden"},ra={class:"px-4 py-3 border-b flex items-center justify-between"},da={class:"p-2 overflow-auto"},ca={__name:"CalendarViewModal",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","open"],setup(t,{emit:l}){const x=t,d=l,b=W({get:()=>x.modelValue,set:f=>d("update:modelValue",f)}),u=fe(),r=_([]),v=(f,o=[])=>{if(Array.isArray(f))return f;try{return JSON.parse(f||"[]")||o}catch{return o}},A=(f=[])=>{r.value=f.map(o=>{const c=v(o.facilities),j=[];o.activity_design?.name_of_activity&&j.push(o.activity_design.name_of_activity),c.length&&j.push(c.join(", "));const D=j.join(" — ")||o.reference_code||"Utilization",C=o.start_date&&o.start_time&&`${o.start_date}T${o.start_time}:00`||o.start_at||null,R=o.end_date&&o.end_time&&`${o.end_date}T${o.end_time}:00`||o.end_at||null;return!C||!R?null:{id:String(o.id),title:D,start:C,end:R,backgroundColor:"#047857",borderColor:"#065f46",textColor:"#ffffff",extendedProps:{reference_code:o.reference_code,facilities:c,availability_status:o.availability_status,status:o.status}}}).filter(Boolean)},E=async()=>{await u.fetchAll({page:1,limit:500,status:"approved",order:"ASC",sort:"start_at"},!0),A(u.items.data||[])},I=f=>{const o=f?.event?.id;o&&d("open",Number(o))},O=_(!1),N=()=>{O.value=window.innerWidth<640};pe(()=>{N(),window.addEventListener("resize",N)});const F=W(()=>({plugins:[St,Ct,At],initialView:"dayGridMonth",headerToolbar:O.value?{left:"prev,next",center:"title",right:"dayGridMonth"}:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},height:"auto",handleWindowResize:!0,expandRows:!0,navLinks:!0,eventDisplay:"block",eventClick:I,events:r.value}));return me(()=>x.modelValue,f=>{f&&E()}),me(()=>u.items.data,f=>{b.value&&A(f||[])},{deep:!0}),pe(()=>{b.value&&E()}),(f,o)=>b.value?(h(),S("div",na,[s("div",oa,[s("div",ra,[o[1]||(o[1]=s("h2",{class:"text-base font-semibold"},"Utilization Calendar (Approved)",-1)),s("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:o[0]||(o[0]=c=>b.value=!1)},"Close")]),s("div",da,[$(T(kt),{options:F.value},null,8,["options"])]),o[2]||(o[2]=s("div",{class:"px-4 py-2 text-[11px] text-gray-500 border-t"}," Click an event to open it. ",-1))])])):J("",!0)}},ua={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},ma={class:"bg-white p-3 md:p-4 rounded-xl shadow-lg w-[560px] max-h-[85vh] overflow-y-auto"},pa={class:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm"},fa={class:"md:col-span-2"},ya=["value"],ga={__name:"QuickAvailabilityModal",props:{modelValue:{type:Boolean,default:!1},facilities:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(t,{emit:l}){const x=t,d=l,b=fe(),u=_(""),r=_("08:00"),v=_(""),A=_("10:00"),E=_([]),I=W(()=>(E.value||[]).filter(f=>x.facilities.includes(f))),O=()=>d("update:modelValue",!1),N=()=>{u.value="",r.value="08:00",v.value="",A.value="10:00",E.value=[]},F=async()=>{if(!u.value||!v.value||!I.value.length){await w.fire("Missing fields","Start/End dates and at least one facility are required.","info");return}try{const f=await b.checkAvailability({start_date:u.value,start_time:r.value||"00:00",end_date:v.value,end_time:A.value||"00:00",facilities:I.value}),o=f.available_for_all?"All selected facilities are available.":`Conflicts on: ${(f.conflict_facilities||[]).join(", ")||"—"}`;await w.fire({icon:f.available_for_all?"success":"warning",title:"Availability Result",html:`<div class="text-left text-sm">
        <div><strong>Facilities:</strong> ${(f.facilities||[]).join(", ")}</div>
        <div class="mt-2"><strong>Status:</strong> ${o}</div>
        <div class="mt-2"><strong>Conflicts:</strong> ${Array.isArray(f.conflicts)&&f.conflicts.length?`<ul class="list-disc ml-5">${f.conflicts.map(c=>`<li>${c.reference_code} — ${new Date(c.start_at).toLocaleString()} to ${new Date(c.end_at).toLocaleString()}</li>`).join("")}</ul>`:"None"}</div>
      </div>`})}catch(f){await w.fire("Error",b.error||"Failed to check availability.","error"),console.error(f)}};return(f,o)=>t.modelValue?(h(),S("div",ua,[s("div",ma,[s("div",{class:"flex items-center justify-between mb-2"},[o[5]||(o[5]=s("h3",{class:"text-base font-semibold"},"Quick Availability Check",-1)),s("button",{class:"px-2.5 py-1 text-[11px] bg-gray-200 rounded",onClick:O},"Close")]),s("div",pa,[s("div",null,[o[6]||(o[6]=s("label",{class:"block mb-0.5"},"Start Date",-1)),M(s("input",{"onUpdate:modelValue":o[0]||(o[0]=c=>u.value=c),type:"date",class:"w-full border rounded px-2 py-1.5"},null,512),[[X,u.value]])]),s("div",null,[o[7]||(o[7]=s("label",{class:"block mb-0.5"},"Start Time",-1)),M(s("input",{"onUpdate:modelValue":o[1]||(o[1]=c=>r.value=c),type:"time",class:"w-full border rounded px-2 py-1.5"},null,512),[[X,r.value]])]),s("div",null,[o[8]||(o[8]=s("label",{class:"block mb-0.5"},"End Date",-1)),M(s("input",{"onUpdate:modelValue":o[2]||(o[2]=c=>v.value=c),type:"date",class:"w-full border rounded px-2 py-1.5"},null,512),[[X,v.value]])]),s("div",null,[o[9]||(o[9]=s("label",{class:"block mb-0.5"},"End Time",-1)),M(s("input",{"onUpdate:modelValue":o[3]||(o[3]=c=>A.value=c),type:"time",class:"w-full border rounded px-2 py-1.5"},null,512),[[X,A.value]])]),s("div",fa,[o[10]||(o[10]=s("label",{class:"block mb-0.5"},"Facilities",-1)),M(s("select",{"onUpdate:modelValue":o[4]||(o[4]=c=>E.value=c),multiple:"",class:"w-full border rounded px-2 py-1.5 min-h-[40px]"},[(h(!0),S(ae,null,ie(t.facilities,c=>(h(),S("option",{key:c,value:c},V(c),9,ya))),128))],512),[[ue,E.value]]),o[11]||(o[11]=s("p",{class:"text-[11px] text-gray-500 mt-0.5"},"Hold Ctrl/Cmd to select multiple.",-1))])]),s("div",{class:"flex justify-end gap-1.5 mt-4"},[s("button",{class:"px-3 py-1.5 bg-gray-200 rounded text-xs",onClick:N},"Reset"),s("button",{class:"px-3 py-1.5 bg-indigo-600 text-white rounded text-xs",onClick:F},"Check")])])])):J("",!0)}},va="KOLEHIYO NG PANTUKAN",ba="Juan A. Sarenas Campus, Kingking, Pantukan, Davao de Oro",_a="https://osas.knp.edu.ph/#/verify-utilization?id=",he=t=>t?xe(t).format("MMMM DD, YYYY"):"—",Te=t=>t?xe(t).format("MMM DD, YYYY, h:mm A"):"—",Ee=(t,l=0)=>t==null||t===""||Number.isNaN(Number(t))?"—":Number(t).toLocaleString(void 0,{minimumFractionDigits:l,maximumFractionDigits:l}),Fe=(t,l)=>{if(Array.isArray(t))return t;try{return JSON.parse(t||"null")??l}catch{return l}},Be="./",ha=`${Be}images/logo.png`,xa=`${Be}images/bg.jpg`;async function Re(t){const x=await(await fetch(t)).blob();return new Promise(d=>{const b=new FileReader;b.onloadend=()=>d(b.result),b.readAsDataURL(x)})}function wa(t){switch(t){case"APPROVED":return[32,141,85];case"PENDING":return[240,158,47];case"REJECTED":return[220,53,69];case"CANCELLED":return[107,114,128];case"COMPLETED":return[37,99,235];default:return[90,90,90]}}function Sa(t){switch(String(t||"").toUpperCase()){case"AVAILABLE":return[16,185,129];case"RESERVED":return[99,102,241];case"CONFLICT":return[239,68,68];case"MAINTENANCE":return[245,158,11];case"PENDING-CHECK":return[245,158,11];default:return[107,114,128]}}async function Ca(t){const l=t.internal.pageSize.getWidth(),x=110,d=15;try{const b=await Re(xa);t.addImage(b,"JPEG",0,0,l,x,void 0,"FAST")}catch{t.setFillColor(21,62,121),t.rect(0,0,l,x,"F")}t.setGState(new t.GState({opacity:.18})),t.setFillColor(0,0,0),t.rect(0,0,l,x,"F"),t.setGState(new t.GState({opacity:1}));try{const b=await Re(ha);t.addImage(b,"PNG",d,20,70,70,void 0,"FAST")}catch{}return t.setTextColor(255,255,255),t.setFont("helvetica","bold"),t.setFontSize(20),t.text(va,d+86,38),t.setFont("helvetica","normal"),t.setFontSize(10),t.text(ba,d+86,58),t.setTextColor(20),t.setFont("helvetica","bold"),t.setFontSize(14),t.text("UTILIZATION REQUEST",l/2,x+24,{align:"center"}),x+34}async function Aa(t,l,x){const d=t.internal.pageSize.getWidth(),b=15,u=l?.id??l?.reference_code??"",r=`${_a}${encodeURIComponent(String(u))}`,v=await $t.toDataURL(r,{margin:0,width:75,errorCorrectionLevel:"M",color:{dark:"#000000",light:"#FFFFFF"}}),A=String(l.status||"").toUpperCase(),[E,I,O]=wa(A),N=String(l.availability_status||"").toUpperCase(),[F,f,o]=Sa(N),c=l.approved_at?he(l.approved_at):l.date_filed?he(l.date_filed):"—",j=`osas.knp.edu.ph/#/verify-utilization?id=${String(u)}`;return U(t,{startY:x,theme:"plain",styles:{cellPadding:0,fontSize:9},bodyStyles:{minCellHeight:120},margin:{left:b,right:b},tableWidth:d-b*2,body:[[{content:""},{content:""}]],columnStyles:{0:{cellWidth:d-b*2-280},1:{cellWidth:280}},didDrawCell:D=>{if(D.section!=="body")return;const{x:C,y:R,width:P,height:G}=D.cell,B=10;if(D.column.index===0){t.setFillColor(255,255,255),t.roundedRect(C,R,P-1,G,6,6,"F");const y=24,L=Math.min(160,P-22);t.setFillColor(E,I,O),t.roundedRect(C+B,R+B,L,y,12,12,"F"),t.setTextColor(255,255,255),t.setFont("helvetica","bold"),t.setFontSize(10),t.text(A||"STATUS",C+B+10,R+B+16);const H=R+B+y+10,k=Math.min(160,P-22);t.setFillColor(F,f,o),t.roundedRect(C+B,H,k,y,12,12,"F"),t.setTextColor(255,255,255),t.text(N||"AVAILABILITY",C+B+10,H+16),t.setTextColor(20),t.setFont("helvetica","normal"),t.setFontSize(9);let Q=H+y+12;t.text(`Ref No.: ${l.reference_code||"—"}`,C+B,Q),Q+=16,t.text(`Date Issued: ${c}`,C+B,Q),t.setDrawColor(230),t.roundedRect(C,R,P-1,G,6,6,"S")}if(D.column.index===1){t.setFillColor(255,255,255),t.roundedRect(C,R,P-1,G,6,6,"F"),t.setFillColor(66,103,178),t.roundedRect(C,R,P-1,22,6,6,"F"),t.setTextColor(255,255,255),t.setFont("helvetica","bold"),t.setFontSize(10),t.text("VERIFY",C+B,R+15);const y=C+B,L=R+28;t.addImage(v,"PNG",y,L,75,75,void 0,"FAST"),t.setTextColor(20),t.setFont("helvetica","bold"),t.setFontSize(10),t.text("Scan to verify",y+100,L+14),t.setFont("helvetica","normal"),t.setFontSize(9),t.text("This document can be verified",y+100,L+32),t.text("online via the OSAS portal.",y+100,L+46),t.setTextColor(110),t.setFontSize(8),t.text(j,y+100,L+72),t.setDrawColor(230),t.roundedRect(C,R,P-1,G,6,6,"S")}}}),t.lastAutoTable.finalY}async function ze(t){const l=new Ze({unit:"pt",format:[612,936],orientation:"portrait"}),x=l.internal.pageSize.getWidth(),d=36,b=Fe(t.facilities,[]),u=Fe(t.equipment_items,[]);let r=await Ca(l);r=await Aa(l,t,r)+10,U(l,{startY:r,theme:"plain",styles:{fontSize:10},body:[[{content:"LINKED ACTIVITY",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",halign:"left",valign:"middle",cellPadding:6}}]],margin:{left:d,right:d}}),r=l.lastAutoTable.finalY;const v=t.activity_design||{};U(l,{startY:r,theme:"grid",styles:{fontSize:9,cellPadding:6},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},body:[[{content:"NAME OF ACTIVITY",styles:{fillColor:[243,248,255],fontStyle:"bold"}},v.name_of_activity||"—"],[{content:"DATE OF IMPLEMENTATION",styles:{fillColor:[243,248,255],fontStyle:"bold"}},he(v.date_of_implementation)],[{content:"SEMESTER",styles:{fillColor:[243,248,255],fontStyle:"bold"}},v.semester||"—"],[{content:"SCHOOL YEAR",styles:{fillColor:[243,248,255],fontStyle:"bold"}},v.school_year||"—"],[{content:"OFFICE/DEPARTMENT",styles:{fillColor:[243,248,255],fontStyle:"bold"}},v.office_department||v?.club?.name||"—"]],columnStyles:{0:{cellWidth:200,fontStyle:"bold"},1:{cellWidth:"auto"}},margin:{left:d,right:d}}),r=l.lastAutoTable.finalY+10,U(l,{startY:r,theme:"plain",styles:{fontSize:10},body:[[{content:"SCHEDULE",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:d,right:d}}),r=l.lastAutoTable.finalY;const A=t.start_at||(t.start_date&&t.start_time?`${t.start_date}T${t.start_time}:00`:null),E=t.end_at||(t.end_date&&t.end_time?`${t.end_date}T${t.end_time}:00`:null);U(l,{startY:r,theme:"grid",styles:{fontSize:9,cellPadding:6},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},body:[[{content:"START",styles:{fillColor:[243,248,255],fontStyle:"bold"}},Te(A)],[{content:"END",styles:{fillColor:[243,248,255],fontStyle:"bold"}},Te(E)],[{content:"DURATION (mins)",styles:{fillColor:[243,248,255],fontStyle:"bold"}},Ee(t.duration_minutes)]],columnStyles:{0:{cellWidth:200,fontStyle:"bold"},1:{cellWidth:"auto"}},margin:{left:d,right:d}}),r=l.lastAutoTable.finalY+10,U(l,{startY:r,theme:"plain",styles:{fontSize:10},body:[[{content:"FACILITIES",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:d,right:d}}),r=l.lastAutoTable.finalY;const I=Array.isArray(b)&&b.length?"• "+b.join(`
• `):"—";U(l,{startY:r,theme:"grid",styles:{fontSize:9,cellPadding:8},body:[[I]],margin:{left:d,right:d}}),r=l.lastAutoTable.finalY+10,U(l,{startY:r,theme:"plain",styles:{fontSize:10},body:[[{content:"EQUIPMENT / MATERIALS",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:d,right:d}}),r=l.lastAutoTable.finalY,Array.isArray(u)&&u.length?U(l,{startY:r,theme:"grid",styles:{fontSize:9,cellPadding:6},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},head:[["ITEM","QTY","UNIT"]],body:u.map(c=>[c?.name||"—",Ee(c?.qty),c?.unit||"—"]),columnStyles:{0:{cellWidth:300},1:{cellWidth:70},2:{cellWidth:"auto"}},margin:{left:d,right:d}}):U(l,{startY:r,theme:"grid",styles:{fontSize:9,cellPadding:8},body:[["—"]],margin:{left:d,right:d}}),r=l.lastAutoTable.finalY+10,U(l,{startY:r,theme:"plain",styles:{fontSize:10},body:[[{content:"UTILIZATION DETAILS",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:d,right:d}}),r=l.lastAutoTable.finalY,U(l,{startY:r,theme:"grid",styles:{fontSize:9,cellPadding:8},body:[[t.utilization_details&&String(t.utilization_details).trim()?t.utilization_details:"—"]],margin:{left:d,right:d}}),r=l.lastAutoTable.finalY+10;{const c=l.internal.pageSize.getHeight();r+180>c-30&&(l.addPage(),r=36)}U(l,{startY:r,theme:"plain",styles:{fontSize:10},body:[[{content:"APPROVAL",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:d,right:d}}),r=l.lastAutoTable.finalY;const N=String(t?.file_by_user_name||"").trim()||(t?.filed_by?`${t.filed_by.first_name||""} ${t.filed_by.last_name||""}`.trim():""),F=String(t?.noted_by||"").trim(),f=t?.approver?`${t.approver.first_name||""} ${t.approver.last_name||""}`.trim():"";U(l,{startY:r,theme:"grid",styles:{fontSize:9,cellPadding:10},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},showHead:"firstPage",rowPageBreak:"avoid",head:[["PREPARED BY:","NOTED BY:","RECOMMENDING APPROVAL:"]],body:[[N||" ",F||" ",f||" "],[{content:`APPROVED BY:


DR. MARY ANN R. ARAULA
Acting College President`,colSpan:3,styles:{halign:"center",fontStyle:"bold",cellPadding:{top:14,right:10,bottom:16,left:10}}}]],columnStyles:{0:{cellWidth:(x-d*2)/2},1:{cellWidth:"auto"}},didParseCell:c=>{c.section==="body"&&c.row.index===0&&(c.cell.styles.halign="center",c.cell.styles.fontStyle="bold",c.cell.styles.cellPadding={top:16,right:10,bottom:4,left:10})},margin:{left:d,right:d}});const o=l.internal.pageSize.getHeight()-20;return l.setFontSize(8),l.setTextColor(120),l.text(`Generated on ${xe().format("YYYY-MM-DD HH:mm")} • ${window.location.origin}`,d,o),l}async function ka(t){(await ze(t)).save(`${t.reference_code||"Utilization_Request"}.pdf`)}const $a={class:"flex flex-wrap items-center gap-2 w-full sm:w-auto justify-start sm:justify-end"},Ta={class:"p-2 mb-4 rounded-xl border bg-white/60"},Ea={class:"flex items-center gap-2 mb-2 text-gray-700"},Fa={class:"w-4 h-4",viewBox:"0 0 24 24"},Ra=["d"],Ba={class:"grid grid-cols-1 md:grid-cols-6 gap-2 text-sm"},za={class:"md:col-span-2 flex"},Va={class:"w-5 h-5",viewBox:"0 0 24 24"},Ia=["d"],Ua=["value"],Oa=["value"],Na={class:"md:col-span-1"},Da={class:"md:col-span-1"},Pa={class:"md:col-span-2"},La=["value"],Ma={class:"flex flex-wrap gap-1 max-w-[380px]"},Ya={key:0,class:"text-gray-400"},ja={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30"},qa={class:"bg-white w-[560px] rounded-xl shadow p-4"},Wa={class:"flex items-center justify-between mb-2"},Ga={class:"grid grid-cols-1 gap-2 text-sm"},Ja={class:"flex gap-2"},Ha={class:"text-[11px] text-gray-600"},Qa={class:"mt-3 flex justify-end gap-2"},vl={__name:"UtilizationRequestsPage",setup(t){const l=fe(),{isClub:x,activeClubId:d,withClub:b}=Et(),u=Je(),r=He(),v=W(()=>{const n=u.user?.last_name||"",e=(u.user?.first_name||"").slice(0,1);return`${n}${n?", ":""}${e?e+".":""}`}),A=n=>{try{return((Array.isArray(n)?n:JSON.parse(n||"[]")||[])||[]).map(a=>(!a||typeof a!="object"||Array.isArray(a.read_by)||(a.read_by=a.user_id!=null?[a.user_id]:[]),a))}catch{return[]}},E=_(!1),I=()=>{E.value=!0},O=_(!1),N=()=>{O.value=!0},F=async n=>{try{await l.fetchById(n);const e=l.selected;e&&await K(e)}catch(e){console.error(e)}finally{E.value=!1}},f=_(!1),o=_(null),c=async n=>{try{await l.fetchById(n.id),o.value=l.selected||n}catch{o.value=n}f.value=!0},j=async n=>{if(!o.value)return;const e=A(o.value.remarks);e.push({user_id:u.user?.id||null,user_name:v.value,message:n?.message||"",datetime:n?.datetime||new Date().toISOString(),is_read:!1,read_by:[u.user?.id||null]});try{o.value.remarks=JSON.stringify(e)}catch{}try{await l.updateById(o.value.id,{remarks:JSON.stringify(e)}),await k({},!0)}catch{}},D=async()=>{if(!o.value)return;const n=u.user?.id||null,a=A(o.value.remarks).map(g=>{if(!g||g.user_id===n)return g;const te=Array.isArray(g.read_by)?g.read_by.slice():[];return te.includes(n)||te.push(n),{...g,read_by:te}});try{o.value.remarks=JSON.stringify(a)}catch{}try{await l.updateById(o.value.id,{remarks:JSON.stringify(a)}),await k({},!0)}catch{}},C=Qe(),R=Ke(),P=async()=>{const n=String(C.query.open_remarks_type||""),e=Number(C.query.open_remarks_id||"");if(n==="UR"&&Number.isFinite(e)){try{await l.fetchById(e)}catch{}const a=l.selected;a&&await c(a);const g={...C.query};delete g.open_remarks_type,delete g.open_remarks_id,R.replace({query:g})}};pe(P),me(()=>[C.query.open_remarks_type,C.query.open_remarks_id],()=>{P()});const G=["EB 101","EB 102","EB 103","NB 104","NB 105","NB Lobby","NB 106","NB 107","NB 201","NB 3SR","OB 108","OB 109","OB 110","OB 111","OB 112","OB 113","OB 114","OB 115","OB 116","OB 117","Gym","AVR","Student Lobby","Activity Center","Library","Ground"],B={range:!0,partialRange:!0,multiCalendars:2,modelType:"yyyy-MM-dd",enableTimePicker:!1,autoApply:!0,clearable:!0},y=_({page:1,limit:10,sort:"created_at",order:"DESC",q:"",status:"",availability_status:"",start_from:"",start_to:"",end_from:"",end_to:"",facilities_any:[]}),L=W({get:()=>{const{start_from:n,start_to:e}=y.value;return n||e?[n||null,e||null]:null},set:n=>{if(!n)y.value.start_from=null,y.value.start_to=null;else{const[e,a]=n;y.value.start_from=e||null,y.value.start_to=a||null}}}),H=W({get:()=>{const{end_from:n,end_to:e}=y.value;return n||e?[n||null,e||null]:null},set:n=>{if(!n)y.value.end_from=null,y.value.end_to=null;else{const[e,a]=n;y.value.end_from=e||null,y.value.end_to=a||null}}}),k=async(n={},e=!0)=>{y.value={...y.value,...n};const a=b({...y.value});["q","status","availability_status","start_from","start_to","end_from","end_to"].forEach(g=>{(a[g]===""||a[g]==null)&&delete a[g]}),(!Array.isArray(a.facilities_any)||!a.facilities_any.length)&&delete a.facilities_any,await l.fetchAll(a,e)};pe(async()=>{await k({page:1,limit:10,club_id:x?d:""})});const Q=W(()=>({total:l.items.total||0,totalPages:l.items.totalPages||1,currentPage:l.items.currentPage||1,pageSize:l.items.pageSize||10,data:l.items.data||[]})),ye=["draft","pending","approved","rejected","cancelled","completed"],ne=["unknown","pending-check","available","conflict","reserved","maintenance"],ge=n=>{switch(String(n||"").toLowerCase()){case"draft":return"gray";case"pending":return"amber";case"approved":return"emerald";case"rejected":return"red";case"cancelled":return"zinc";case"completed":return"blue";default:return"gray"}},ve=n=>{switch(String(n||"").toLowerCase()){case"available":return"emerald";case"reserved":return"indigo";case"conflict":return"red";case"maintenance":return"orange";case"pending-check":return"amber";default:return"gray"}},i=[{key:"reference_code",label:"Ref Code",sortable:!0,width:140},{key:"activity_design",label:"Activity",sortable:!1,minWidth:220,formatter:(n,e)=>e.activity_design?e.activity_design.name_of_activity:""},{key:"facilities",label:"Facilities",sortable:!1,minWidth:260},{key:"start_at",label:"Start",sortable:!0,width:170},{key:"end_at",label:"End",sortable:!0,width:170},{key:"availability_status",label:"Availability",sortable:!0,width:130},{key:"status",label:"Status",sortable:!0,width:120}],p=async n=>{await k(n)},m=_(!1),z=_(!1),Z=_(null),ee=()=>{m.value=!0},oe=async n=>{await l.create(n),m.value=!1,await k({},!0)},K=async n=>{await l.fetchById(n.id);const e=l.selected||n;let a=[],g=[];try{a=Array.isArray(e.facilities)?e.facilities:JSON.parse(e.facilities||"[]")}catch{}try{g=Array.isArray(e.equipment_items)?e.equipment_items:JSON.parse(e.equipment_items||"[]")}catch{}Z.value={id:e.id,reference_code:e.reference_code,date_filed:e.date_filed||"",activity_design_id:e.activity_design_id||"",file_by_user_name:e.file_by_user_name||"",facilities:a,equipment_items:g,utilization_details:e.utilization_details||"",start_date:e.start_date||String(e.start_at||"").slice(0,10),start_time:e.start_time||(e.start_at?new Date(e.start_at).toTimeString().slice(0,5):""),end_date:e.end_date||String(e.end_at||"").slice(0,10),end_time:e.end_time||(e.end_at?new Date(e.end_at).toTimeString().slice(0,5):""),status:e.status||"draft",availability_status:e.availability_status||"pending-check",remarks:e.remarks||""},z.value=!0},Ve=async n=>{const{id:e,...a}=n;await l.updateById(e,a),z.value=!1,await k({},!0)},Ie=async n=>{if(!n?.id)return;(await w.fire({title:`Delete utilization "${n.reference_code}"?`,text:"This cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it",cancelButtonText:"Cancel"})).isConfirmed&&(await l.deleteById(n.id),await k({},!0),await w.fire("Deleted","The utilization request has been deleted.","success"))},Ue=async n=>{await K(n)},se=_(!1),re=_(null),Y=_({from_email:"",from_name:"",to:"",subject:"",html:"",attachments:[]}),Oe=async n=>{try{await l.fetchById(n.id);const e=l.selected||n,g=(await ze(e)).output("datauristring"),te=String(g).split(",")[1]||"",Ge=`${e.reference_code||"Utilization_Request"}.pdf`;re.value=e,Y.value={from_email:"osas@knp.edu.ph",from_name:`${u.user?.first_name||""} ${u.user?.last_name||""}`.trim(),to:"",subject:`Utilization Request ${e.reference_code||""}`.trim(),html:"Please see the attached file.",attachments:[{filename:Ge,content:te,type:"application/pdf"}]},se.value=!0}catch{await w.fire("Error",l.error||"Failed to prepare email.","error")}},Ne=async()=>{const n=re.value;if(n)try{await l.sendEmail(n.id,{...Y.value}),se.value=!1,await w.fire("Sent","Email sent successfully.","success")}catch{await w.fire("Error",l.error||"Failed to send email.","error")}},De=async n=>{if((await w.fire({title:"Submit for approval?",text:"You can no longer edit after submission.",icon:"question",showCancelButton:!0,confirmButtonText:"Submit",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1})).isConfirmed)try{const a=A(n.remarks);a.push({user_id:u.user?.id||null,user_name:v.value,message:`${v.value} submitted utilization request.`,datetime:new Date().toISOString(),is_read:!1,read_by:[u.user?.id||null]}),await l.updateById(n.id,{remarks:JSON.stringify(a)}),await l.submit(n.id),await k({},!0),await w.fire("Submitted","Utilization request is now pending approval.","success")}catch{await w.fire("Error",l.error||"Failed to submit request.","error")}},Pe=async n=>{const e=await w.fire({title:"Approve utilization?",input:"textarea",inputLabel:"Remarks (optional)",inputPlaceholder:"Add a note…",showCancelButton:!0,confirmButtonText:"Approve",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1});if(!e.isConfirmed)return;const a=e.value||"";try{const g=A(n.remarks);g.push({user_id:u.user?.id||null,user_name:v.value,message:`${v.value} approved utilization request.${a?" - "+a:""}`,datetime:new Date().toISOString(),is_read:!1,read_by:[u.user?.id||null]}),await l.approve(n.id,JSON.stringify(g)),await k({},!0),await w.fire("Approved","Utilization has been approved and reserved.","success")}catch{await w.fire("Error",l.error||"Failed to approve request.","error")}},Le=async n=>{const e=await w.fire({title:"Reject utilization?",input:"textarea",inputLabel:"Reason (required)",inputPlaceholder:"State the reason…",inputValidator:g=>g?.trim()?void 0:"Reason is required",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Reject",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1});if(!e.isConfirmed)return;const a=e.value;try{const g=A(n.remarks);g.push({user_id:u.user?.id||null,user_name:v.value,message:`${v.value} rejected utilization request - ${a}.`,datetime:new Date().toISOString(),is_read:!1,read_by:[u.user?.id||null]}),await l.reject(n.id,JSON.stringify(g)),await k({},!0),await w.fire("Rejected","Utilization has been rejected.","success")}catch{await w.fire("Error",l.error||"Failed to reject request.","error")}},Me=async n=>{const e=await w.fire({title:"Cancel utilization?",input:"textarea",inputLabel:"Reason (required)",inputPlaceholder:"State the reason…",inputValidator:a=>a?.trim()?void 0:"Reason is required",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Cancel Utilization",cancelButtonText:"Keep",allowOutsideClick:!1,allowEscapeKey:!1});if(e.isConfirmed){e.value;try{const a=A(n.remarks);a.push({user_id:u.user?.id||null,user_name:v.value,message:`${v.value} cancelled utilization request - ${e.value}.`,datetime:new Date().toISOString(),is_read:!1,read_by:[u.user?.id||null]}),await l.cancel(n.id,JSON.stringify(a)),await k({},!0),await w.fire("Cancelled","Utilization has been cancelled.","success")}catch{await w.fire("Error",l.error||"Failed to cancel request.","error")}}},Ye=async n=>{if(String(n?.status||"").toLowerCase()!=="approved"){await w.fire("Not allowed","Only approved utilization request can be printed.","info");return}try{await l.fetchById(n.id);const a=l.selected||n;await ka(a)}catch(a){await w.fire("Error",l.error||"Failed to generate PDF.","error"),console.error(a)}},be=_(!1),we=_(null),je=async n=>{await l.fetchById(n.id),we.value=l.selected||n,be.value=!0};_(""),_("08:00"),_(""),_("10:00"),_([]);const de=_([]),qe=async()=>{y.value.facilities_any=(de.value||[]).slice(),await k({page:1})},We=async()=>{de.value=[],await k({q:"",status:"",availability_status:"",start_from:"",start_to:"",end_from:"",end_to:"",facilities_any:[],page:1})};return(n,e)=>(h(),S(ae,null,[$(ct,null,{default:q(()=>[$(ut,null,{default:q(()=>[T(l).error?(h(),Ce(xt,{key:0,icon:T(mt),color:"danger"},{default:q(()=>[le(V(T(l).error),1)]),_:1},8,["icon"])):J("",!0),$(ht,{icon:T(pt),title:"Utilization Requests",main:""},{default:q(()=>[s("div",$a,[$(ce,{icon:T(ft),color:"info",label:"View Calendar",onClick:I},null,8,["icon"]),$(ce,{icon:T(yt),color:"info",label:"Quick Check",onClick:N},null,8,["icon"]),$(ce,{icon:T(gt),color:"primary",label:"New Request",onClick:ee},null,8,["icon"]),$(ce,{icon:T(vt),color:"info",label:"Refresh",onClick:e[0]||(e[0]=a=>k({},!0))},null,8,["icon"])])]),_:1},8,["icon"]),s("div",Ta,[s("div",Ea,[(h(),S("svg",Fa,[s("path",{d:T(bt)},null,8,Ra)])),e[22]||(e[22]=s("span",{class:"font-medium text-sm"},"Filters",-1))]),s("div",Ba,[s("div",za,[M(s("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>y.value.q=a),placeholder:"Search by ref, details, remarks…",class:"border rounded-s px-2 py-2 flex-1",onKeyup:e[2]||(e[2]=Xe(a=>k({page:1}),["enter"]))},null,544),[[X,y.value.q]]),s("button",{class:"px-3 border border-l-0 rounded-e bg-gray-50",title:"Search",onClick:e[3]||(e[3]=a=>k({page:1}))},[(h(),S("svg",Va,[s("path",{d:T(_t)},null,8,Ia)]))])]),M(s("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>y.value.status=a),class:"border rounded px-2 py-2"},[e[23]||(e[23]=s("option",{value:""},"All status",-1)),(h(),S(ae,null,ie(ye,a=>s("option",{key:a,value:a},V(a),9,Ua)),64))],512),[[ue,y.value.status]]),M(s("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>y.value.availability_status=a),class:"border rounded px-2 py-2"},[e[24]||(e[24]=s("option",{value:""},"Any availability",-1)),(h(),S(ae,null,ie(ne,a=>s("option",{key:a,value:a},V(a),9,Oa)),64))],512),[[ue,y.value.availability_status]]),s("div",Na,[$(T(ke),Ae({modelValue:L.value,"onUpdate:modelValue":e[6]||(e[6]=a=>L.value=a)},B,{placeholder:"Start date range"}),null,16,["modelValue"])]),s("div",Da,[$(T(ke),Ae({modelValue:H.value,"onUpdate:modelValue":e[7]||(e[7]=a=>H.value=a)},B,{placeholder:"End date range"}),null,16,["modelValue"])]),s("div",Pa,[e[25]||(e[25]=s("label",{class:"block text-[11px] text-gray-600 mb-1"},"Facilities (any)",-1)),M(s("select",{"onUpdate:modelValue":e[8]||(e[8]=a=>de.value=a),multiple:"",class:"w-full border rounded px-2 py-2 min-h-[38px]"},[(h(),S(ae,null,ie(G,a=>s("option",{key:a,value:a},V(a),9,La)),64))],512),[[ue,de.value]])]),s("div",{class:"flex items-center gap-2 md:col-span-2"},[s("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:qe}," Apply Filters "),s("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:We},"Reset")])])]),$(wt,{columns:i,data:Q.value,loading:T(l).isLoading,onQueryChange:p},{"cell-facilities":q(({row:a})=>[s("div",Ma,[(h(!0),S(ae,null,ie((()=>{try{return Array.isArray(a.facilities)?a.facilities:JSON.parse(a.facilities||"[]")}catch{return[]}})(),(g,te)=>(h(),Ce(_e,{key:te,text:g,tone:"slate"},null,8,["text"]))),128)),a.facilities&&JSON.parse(a.facilities||"[]").length?J("",!0):(h(),S("span",Ya,"—"))])]),"cell-start_at":q(({value:a})=>[s("span",null,V(a?new Date(a).toLocaleString():"—"),1)]),"cell-end_at":q(({value:a})=>[s("span",null,V(a?new Date(a).toLocaleString():"—"),1)]),"cell-availability_status":q(({value:a})=>[$(_e,{text:a||"—",tone:ve(a)},null,8,["text","tone"])]),"cell-status":q(({value:a})=>[$(_e,{text:a||"—",tone:ge(a)},null,8,["text","tone"])]),"cell-actions":q(({row:a})=>[$(et,{row:a,"current-user-id":T(u).user?.id,moderator:["admin","manager"].includes(String(T(u).user?.role||"").toLowerCase()),onAttachments:je,onSubmit:De,onApprove:Pe,onReject:Le,onEdit:K,onDelete:Ie,onView:g=>Ue(a),onCancel:Me,onRemarks:c,onPrint:Ye,onEmail:Oe},null,8,["row","current-user-id","moderator","onView"])]),_:1},8,["data","loading"])]),_:1})]),_:1}),$($e,{modelValue:m.value,"onUpdate:modelValue":e[9]||(e[9]=a=>m.value=a),mode:"create",onSubmit:oe},null,8,["modelValue"]),$($e,{modelValue:z.value,"onUpdate:modelValue":e[10]||(e[10]=a=>z.value=a),mode:"edit",initial:Z.value||{},onSubmit:Ve},null,8,["modelValue","initial"]),$(sa,{modelValue:be.value,"onUpdate:modelValue":e[11]||(e[11]=a=>be.value=a),row:we.value},null,8,["modelValue","row"]),$(Tt,{modelValue:f.value,"onUpdate:modelValue":e[12]||(e[12]=a=>f.value=a),title:"Remarks • "+(o.value?.reference_code||o.value?.activity_design?.name_of_activity||"Item"),items:A(o.value?.remarks),"can-add":!0,onAdd:j,onMarkAllRead:D},null,8,["modelValue","title","items"]),$(ca,{modelValue:E.value,"onUpdate:modelValue":e[13]||(e[13]=a=>E.value=a),onOpen:F},null,8,["modelValue"]),$(ga,{modelValue:O.value,"onUpdate:modelValue":e[14]||(e[14]=a=>O.value=a),facilities:G},null,8,["modelValue"]),se.value?(h(),S("div",ja,[s("div",qa,[s("div",Wa,[e[26]||(e[26]=s("h3",{class:"text-base font-semibold"},"Send Email",-1)),s("button",{class:"px-2 py-1 text-xs bg-gray-200 rounded",onClick:e[15]||(e[15]=a=>se.value=!1)},"Close")]),s("div",Ga,[s("div",null,[e[27]||(e[27]=s("label",{class:"block mb-0.5"},"To",-1)),s("div",Ja,[M(s("input",{"onUpdate:modelValue":e[16]||(e[16]=a=>Y.value.to=a),class:"flex-1 border rounded px-2 py-1.5",placeholder:"recipient@example.com"},null,512),[[X,Y.value.to]]),s("button",{class:"px-2 py-1 text-[11px] rounded border bg-gray-50 hover:bg-gray-100",onClick:e[17]||(e[17]=()=>{const a=re.value?.filed_by_user_id||re.value?.filed_by?.id;a&&T(r).fetchById(a).then(()=>{const g=T(r).selectedUser?.email;g&&(Y.value.to=g)})})},"Use Filer"),s("button",{class:"px-2 py-1 text-[11px] rounded border bg-rose-50 hover:bg-rose-100",onClick:e[18]||(e[18]=()=>{Y.value.attachments=[]})},"Remove Attachment")])]),s("div",null,[e[28]||(e[28]=s("label",{class:"block mb-0.5"},"Subject",-1)),M(s("input",{"onUpdate:modelValue":e[19]||(e[19]=a=>Y.value.subject=a),class:"w-full border rounded px-2 py-1.5"},null,512),[[X,Y.value.subject]])]),s("div",null,[e[29]||(e[29]=s("label",{class:"block mb-0.5"},"Message",-1)),M(s("textarea",{"onUpdate:modelValue":e[20]||(e[20]=a=>Y.value.html=a),rows:"4",class:"w-full border rounded px-2 py-1.5"},null,512),[[X,Y.value.html]])]),s("div",Ha,"Attachment: "+V(Y.value.attachments?.[0]?.filename||"utilization.pdf"),1)]),s("div",Qa,[s("button",{class:"px-3 py-1.5 text-xs bg-gray-200 rounded",onClick:e[21]||(e[21]=a=>se.value=!1)},"Cancel"),s("button",{class:"px-3 py-1.5 text-xs bg-emerald-600 text-white rounded",onClick:Ne},"Send")])])])):J("",!0)],64))}};export{vl as default};
