import{c as L,r as R,D as we,a as p,d as q,q as m,e as n,k as X,t as y,j as fe,g as w,F as O,A as G,S as v,u as ke,y as Be,o as Re,f as F,l as N,h as V,v as ne,z as ce,L as De,B as J,P as ye}from"./index.Da6HUUKU.js";import{E as Ie,a as j,d as Se,Q as Pe,b as _e,_ as ve}from"./browser.DLAUziVa.js";import{B as Ve,C as Ue,D as Oe,z as Ye,E as Ne,F as je,G as Le,H as Me,I as ze,_ as We,a as Ge,g as qe,J as Ke,K as He,L as Je,M as Xe}from"./SectionMain.BAY6H3vd.js";import{_ as Qe,a as ge,b as be}from"./Badge.Dr6JelPB.js";import{_ as Ze,B as et}from"./NotificationBar.BY9XUqvx.js";import{_ as he}from"./ActivityDesignFormModal.DJOWoVnS.js";import{u as Ce}from"./activityDesign.BR5i_ioz.js";import{u as tt}from"./club.DmeP4G-7.js";import"./IconifyButton.pnsnPiXZ.js";import"./ToasterComponent.DV2EnYLS.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";import"./annualPlan.Q_gCqSh6.js";const at={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},lt={class:"bg-white p-4 rounded-xl shadow-xl w-[980px] max-h-screen overflow-auto"},nt={class:"flex items-center justify-between mb-3"},it={class:"text-lg font-semibold"},ot={class:"text-gray-600"},st={class:"flex items-center justify-between gap-2"},rt={class:"text-sm text-gray-600"},dt={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},ut=["d"],ct=["disabled"],mt={class:"mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"},pt={class:"aspect-video bg-white border rounded overflow-hidden flex items-center justify-center"},ft=["src"],yt={key:1,class:"flex items-center justify-center w-full h-full"},_t=["d"],vt={class:"mt-2 text-xs"},gt=["title"],bt={class:"text-gray-500 flex items-center justify-between"},ht={key:0},xt={key:0},wt={class:"mt-2 flex items-center justify-between gap-2"},St=["onClick","title"],Ct={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},At=["d"],Et=["onClick"],Ft={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},Tt=["d"],$t={key:0,class:"mt-6 text-center text-sm text-gray-500"},kt=10*1024*1024,Bt={__name:"ActivityAttachmentsModal",props:{modelValue:{type:Boolean,default:!1},row:{type:Object,default:null}},emits:["update:modelValue"],setup(l,{emit:i}){const f=l,c=i,u=L({get:()=>f.modelValue,set:t=>c("update:modelValue",t)}),S=Ce(),r=R(null),T=R(!1),U=new Set(["image/png","image/jpeg","image/webp","application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]),M=new Set(["png","jpg","jpeg","webp","pdf","docx","xlsx"]),C=(t="")=>{const d=String(t).toLowerCase().match(/\.([a-z0-9]+)$/i);return d?d[1]:""},g=(t="")=>{if(typeof t!="string")return"";const d=t.match(/^data:([^;]+);base64,/i);return d?d[1]:""},Y=t=>{const d=t?.type&&U.has(t.type),s=t?.name&&M.has(C(t.name));return d||s},$=(t="")=>String(t).startsWith("image/"),k=(t="")=>t==="application/pdf",b=(t="")=>t==="application/vnd.openxmlformats-officedocument.wordprocessingml.document",x=(t="")=>t==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",D=(t="")=>k(t)?Ne:b(t)?je:x(t)?Le:$(t)?Me:ze,I=(t="")=>k(t)?"PDF":b(t)?"Word":x(t)?"Excel":$(t)?"Image":"File",E=(t="")=>k(t)?"pdf":b(t)?"docx":x(t)?"xlsx":t==="image/png"?"png":t==="image/jpeg"?"jpg":t==="image/webp"?"webp":"",B=(t="attachment",d="")=>{const s=/\.[a-z0-9]+$/i.test(t),h=d?d.startsWith(".")?d.slice(1):d:"";return s?t:h?`${t}.${h}`:t},A=t=>!t&&t!==0?"":t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`,P=L(()=>{const t=r.value?.attachments;if(!t)return[];try{return Array.isArray(t)?t:JSON.parse(t||"[]")}catch{return[]}}),K=L(()=>(P.value||[]).map((t,d)=>{const s=t.mime||g(t.data)||(t.name?C(t.name)==="pdf"&&"application/pdf":"")||"",h=C(t.name||"")||E(s),H=t.size??null,z=t.name||`${I(s)} ${d+1}`;return{id:t.id??d+1,name:z,data:t.data||"",url:t.url||t.href||t.path||"",mime:s,ext:h,size:H,filename:B(z,h)}}));we(()=>f.modelValue,async t=>{t&&f.row?.id&&(await S.fetchById(f.row.id),r.value=S.selected||f.row)},{immediate:!1});const oe=async t=>{const d=t.target.files?.[0];if(t.target.value="",!(!d||!r.value?.id)){if(d.size>kt){await v.fire("File too large","Maximum size is 10 MB.","warning");return}if(!Y(d)){await v.fire("Unsupported file","Only images (PNG/JPEG/WEBP), PDF, DOCX, and XLSX are allowed.","warning");return}try{T.value=!0,await S.uploadAttachment(r.value.id,d),await S.fetchById(r.value.id),r.value=S.selected}finally{T.value=!1}}},Z=async t=>{!r.value?.id||!(await v.fire({title:"Remove attachment?",icon:"warning",showCancelButton:!0,confirmButtonText:"Remove",confirmButtonColor:"#d33"})).isConfirmed||(await S.deleteAttachment(r.value.id,t),await S.fetchById(r.value.id),r.value=S.selected)},se=t=>{if(t.data&&String(t.data).startsWith("data:")&&$(t.mime)){const d=window.open();d&&d.document.write(`<img src="${t.data}" style="display:block;max-width:100%;height:auto;margin:0 auto;object-fit:contain"/>`);return}t.url&&window.open(String(t.url),"_blank")},ee=t=>{const[d,s]=t.split(","),h=d.match(/data:([^;]+);base64/i)?.[1]||"application/octet-stream",H=atob(s),z=H.length,le=new Uint8Array(z);for(let W=0;W<z;W++)le[W]=H.charCodeAt(W);return new Blob([le],{type:h})},te=(t,d)=>{const s=URL.createObjectURL(t),h=document.createElement("a");h.href=s,h.download=d||"download",document.body.appendChild(h),h.click(),h.remove(),setTimeout(()=>URL.revokeObjectURL(s),1e3)},re=async t=>{if(t.data&&String(t.data).startsWith("data:")){const d=ee(t.data);te(d,t.filename);return}if(t.url)try{const s=await(await fetch(t.url,{credentials:"include"})).blob();te(s,t.filename)}catch{const s=document.createElement("a");s.href=String(t.url),s.setAttribute("download",t.filename),document.body.appendChild(s),s.click(),s.remove()}},Q=t=>$(t.mime)?"Open":"Download",ae=t=>$(t.mime)?Ue:Oe,de=t=>$(t.mime)?se(t):re(t);return(t,d)=>u.value?(m(),p("div",at,[n("div",lt,[n("div",nt,[n("h2",it,[d[1]||(d[1]=X(" Attachments — ",-1)),n("span",ot,y(r.value?.name_of_activity||""),1)]),n("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:d[0]||(d[0]=s=>u.value=!1)},"Close")]),n("div",st,[n("div",rt,[d[2]||(d[2]=X(" Ref: ",-1)),n("strong",null,y(r.value?.reference_code||"—"),1)]),n("label",{class:fe(["inline-flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white rounded text-xs cursor-pointer disabled:opacity-60",{"opacity-60 pointer-events-none":T.value}])},[(m(),p("svg",dt,[n("path",{d:w(Ve)},null,8,ut)])),n("span",null,y(T.value?"Uploading…":"Upload"),1),n("input",{type:"file",class:"hidden",disabled:T.value,onChange:oe,accept:".png,.jpg,.jpeg,.webp,.pdf,.docx,.xlsx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,image/png,image/jpeg,image/webp"},null,40,ct)],2)]),n("div",mt,[(m(!0),p(O,null,G(K.value,s=>(m(),p("div",{key:s.id,class:"border rounded-lg p-2 bg-gray-50 flex flex-col"},[n("div",pt,[$(s.mime)&&s.data&&s.data.startsWith("data:")?(m(),p("img",{key:0,src:s.data,class:"object-contain w-full h-full",alt:"Attachment preview"},null,8,ft)):(m(),p("div",yt,[(m(),p("svg",{style:{width:"64px",height:"64px"},viewBox:"0 0 24 24","aria-hidden":"true",class:fe({"text-red-600":k(s.mime),"text-blue-600":b(s.mime),"text-emerald-600":x(s.mime),"text-gray-500":!s.mime||!$(s.mime)&&!k(s.mime)})},[n("path",{d:D(s.mime)},null,8,_t)],2))]))]),n("div",vt,[n("div",{class:"font-medium truncate",title:s.name},y(s.name),9,gt),n("div",bt,[n("span",null,[X(y(I(s.mime))+" ",1),s.ext?(m(),p("span",ht,"("+y(s.ext.toUpperCase())+")",1)):q("",!0)]),s.size?(m(),p("span",xt,y(A(s.size)),1)):q("",!0)])]),n("div",wt,[n("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-white border rounded text-xs hover:bg-gray-50",onClick:h=>de(s),title:Q(s)},[(m(),p("svg",Ct,[n("path",{d:ae(s)},null,8,At)])),X(" "+y(Q(s)),1)],8,St),n("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-red-600 text-white rounded text-xs",onClick:h=>Z(s.id),title:"Remove"},[(m(),p("svg",Ft,[n("path",{d:w(Ye)},null,8,Tt)])),d[3]||(d[3]=X(" Remove ",-1))],8,Et)])]))),128))]),K.value.length?q("",!0):(m(),p("div",$t," No attachments yet. "))])])):q("",!0)}},Rt="KOLEHIYO NG PANTUKAN",Dt="Juan A. Sarenas Campus, Kingking, Pantukan, Davao de Oro",It="https://osas.knp.edu.ph/verify-actdesign?id=",ie=l=>l?Se(l).format("MMMM DD, YYYY"):"—",Pt=l=>l==null||l===""?"—":Number(l).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),Ae="./",Vt=`${Ae}images/logo.png`,Ut=`${Ae}images/bg.jpg`;async function xe(l){const f=await(await fetch(l)).blob();return new Promise(c=>{const u=new FileReader;u.onloadend=()=>c(u.result),u.readAsDataURL(f)})}function Ot(l){switch(l){case"APPROVED":return[32,141,85];case"PENDING":return[240,158,47];case"REJECTED":return[220,53,69];case"CANCELLED":return[107,114,128];default:return[90,90,90]}}async function Yt(l){const i=l.internal.pageSize.getWidth(),f=110,c=36;try{const u=await xe(Ut);l.addImage(u,"JPEG",0,0,i,f,void 0,"FAST")}catch{l.setFillColor(21,62,121),l.rect(0,0,i,f,"F")}l.setGState(new l.GState({opacity:.18})),l.setFillColor(0,0,0),l.rect(0,0,i,f,"F"),l.setGState(new l.GState({opacity:1}));try{const u=await xe(Vt);l.addImage(u,"PNG",c,20,70,70,void 0,"FAST")}catch{}return l.setTextColor(255,255,255),l.setFont("helvetica","bold"),l.setFontSize(20),l.text(Rt,c+86,38),l.setFont("helvetica","normal"),l.setFontSize(10),l.text(Dt,c+86,58),l.setTextColor(20),l.setFont("helvetica","bold"),l.setFontSize(14),l.text("ACTIVITY DESIGN",i/2,f+24,{align:"center"}),f+34}async function Nt(l,i,f){const c=l.internal.pageSize.getWidth(),u=36,S=i?.id??i?.reference_code??"",r=`${It}${encodeURIComponent(String(S))}`,T=await Pe.toDataURL(r,{margin:0,width:75,errorCorrectionLevel:"M",color:{dark:"#000000",light:"#FFFFFF"}}),U=String(i.status||"").toUpperCase(),[M,C,g]=Ot(U),Y=i.approved_at?ie(i.approved_at):i.date_filed?ie(i.date_filed):"—",$=`osas.knp.edu.ph/verify-actdesign?id=${String(S)}`;return j(l,{startY:f,theme:"plain",styles:{cellPadding:0,fontSize:9},bodyStyles:{minCellHeight:110},margin:{left:u,right:u},tableWidth:c-u*2,body:[[{content:""},{content:""}]],columnStyles:{0:{cellWidth:c-u*2-260},1:{cellWidth:260}},didDrawCell:k=>{if(k.section!=="body")return;const{x:b,y:x,width:D,height:I}=k.cell,E=10;if(k.column.index===0){l.setFillColor(255,255,255),l.roundedRect(b,x,D-1,I,6,6,"F");const B=24,A=Math.min(140,D-22);l.setFillColor(M,C,g),l.roundedRect(b+E,x+E,A,B,12,12,"F"),l.setTextColor(255,255,255),l.setFont("helvetica","bold"),l.setFontSize(10),l.text(U||"STATUS",b+E+10,x+E+16),l.setTextColor(20),l.setFont("helvetica","normal"),l.setFontSize(9);const P=x+E+B+14;l.text(`Ref No.: ${i.reference_code||"—"}`,b+E,P),l.text(`Date Issued: ${Y}`,b+E,P+16),l.setDrawColor(230),l.roundedRect(b,x,D-1,I,6,6,"S")}if(k.column.index===1){l.setFillColor(255,255,255),l.roundedRect(b,x,D-1,I,6,6,"F"),l.setFillColor(66,103,178),l.roundedRect(b,x,D-1,22,6,6,"F"),l.setTextColor(255,255,255),l.setFont("helvetica","bold"),l.setFontSize(10),l.text("VERIFY",b+E,x+15);const B=b+E,A=x+28;l.addImage(T,"PNG",B,A,75,75,void 0,"FAST"),l.setTextColor(20),l.setFont("helvetica","bold"),l.setFontSize(10),l.text("Scan to verify",B+100,A+14),l.setFont("helvetica","normal"),l.setFontSize(9),l.text("This document can be verified",B+100,A+32),l.text("online via the OSAS portal.",B+100,A+46),l.setTextColor(110),l.setFontSize(8),l.text($,B+100,A+72),l.setDrawColor(230),l.roundedRect(b,x,D-1,I,6,6,"S")}}}),l.lastAutoTable.finalY}async function Ee(l){const i=new Ie({unit:"pt",format:[612,936],orientation:"portrait"}),f=i.internal.pageSize.getWidth(),c=36;let u=await Yt(i);u=await Nt(i,l,u)+10,j(i,{startY:u,theme:"grid",styles:{fontSize:9,cellPadding:5},headStyles:{fillColor:[222,235,247],textColor:20,fontStyle:"bold"},head:[["SEMESTER","DATE FILED","SCHOOL YEAR","OFFICE/DEPARTMENT"]],body:[[l.semester||"—",ie(l.date_filed),l.school_year||"—",l.office_department||l?.club?.name||"—"]],columnStyles:{0:{cellWidth:120},1:{cellWidth:120},2:{cellWidth:120},3:{cellWidth:"auto"}},margin:{left:c,right:c}}),u=i.lastAutoTable.finalY+10,j(i,{startY:u,theme:"plain",styles:{fontSize:10},body:[[{content:"ACTIVITY INFORMATION",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",halign:"left",valign:"middle",cellPadding:6}}]],margin:{left:c,right:c}}),u=i.lastAutoTable.finalY,j(i,{startY:u,theme:"grid",styles:{fontSize:9,cellPadding:6},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},body:[[{content:"NAME OF ACTIVITY",styles:{fillColor:[243,248,255],fontStyle:"bold"}},l.name_of_activity||"—"],[{content:"VENUE",styles:{fillColor:[243,248,255],fontStyle:"bold"}},l.venue||"—"],[{content:"DATE OF IMPLEMENTATION",styles:{fillColor:[243,248,255],fontStyle:"bold"}},ie(l.date_of_implementation)],[{content:"PROPOSED BUDGET",styles:{fillColor:[243,248,255],fontStyle:"bold"}},`${Pt(l.proposed_budget)}   (Source: Department Fund)`],[{content:"PARTICIPANTS",styles:{fillColor:[243,248,255],fontStyle:"bold"}},l.participants||"—"],[{content:"NATURE OF ACTIVITY",styles:{fillColor:[243,248,255],fontStyle:"bold"}},l.nature_of_activity||"—"]],columnStyles:{0:{cellWidth:180,fontStyle:"bold"},1:{cellWidth:"auto"}},margin:{left:c,right:c}}),u=i.lastAutoTable.finalY+10,[["RATIONALE",l.rationale],["OBJECTIVES",l.objectives],["DETAILS OF THE ACTIVITY",l.details_of_activity],["BUDGETARY REQUIREMENTS",l.budgetary_requirements]].forEach(([C,g])=>{j(i,{startY:u,theme:"plain",styles:{fontSize:10},body:[[{content:C,styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:c,right:c}}),u=i.lastAutoTable.finalY,j(i,{startY:u,theme:"grid",styles:{fontSize:9,cellPadding:8},body:[[g&&String(g).trim()?g:"—"]],margin:{left:c,right:c}}),u=i.lastAutoTable.finalY+10}),j(i,{startY:u,theme:"plain",styles:{fontSize:10},body:[[{content:"APPROVAL",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:c,right:c}}),u=i.lastAutoTable.finalY;const T=String(l?.file_by_user_name||"").trim()||(l?.filed_by?`${l.filed_by.first_name||""} ${l.filed_by.last_name||""}`.trim():""),U=l?.approver?`${l.approver.first_name||""} ${l.approver.last_name||""}`.trim():"";j(i,{startY:u,theme:"grid",styles:{fontSize:9,cellPadding:10},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},head:[["PREPARED BY:","NOTED BY:","APPROVED BY:"]],body:[[T||" ","Albert P. Mapalo",U||" "]],columnStyles:{0:{cellWidth:(f-c*2)/3},1:{cellWidth:(f-c*2)/3},2:{cellWidth:"auto"}},didParseCell:C=>{C.section==="body"&&(C.cell.styles.halign="center",C.cell.styles.fontStyle="bold",C.cell.styles.cellPadding={top:16,right:10,bottom:18,left:10})},margin:{left:c,right:c}});const M=i.internal.pageSize.getHeight()-20;return i.setFontSize(8),i.setTextColor(120),i.text(`Generated on ${Se().format("YYYY-MM-DD HH:mm")} • ${window.location.origin}`,c,M),i}async function jt(l){(await Ee(l)).save(`${l.reference_code||"Activity_Design"}.pdf`)}const Lt={class:"flex items-center gap-2"},Mt={class:"p-2 mb-4 rounded-xl border bg-white/60"},zt={class:"flex items-center gap-2 mb-2 text-gray-700"},Wt={class:"w-4 h-4",viewBox:"0 0 24 24"},Gt=["d"],qt={class:"grid grid-cols-1 md:grid-cols-6 gap-2 text-sm"},Kt=["value"],Ht=["value"],Jt=["value"],Xt=["value"],Qt={key:0,value:""},Zt=["value"],ea={value:""},ta=["value"],aa={class:"md:col-span-1"},la={class:"md:col-span-1"},na={class:"flex items-center gap-2 md:col-span-2"},ia={class:"flex flex-col gap-1"},oa={class:"text-xs"},sa={class:"inline-flex items-center gap-2 px-2 py-1 rounded bg-emerald-50 border border-emerald-200"},ra={class:"font-medium"},da={class:"text-gray-600"},ua={class:"text-xs text-gray-700"},ca={class:"font-medium"},ma={class:"text-gray-500"},pa={key:1,class:"text-gray-400 text-xs"},fa={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30"},ya={class:"bg-white w-[560px] rounded-xl shadow p-4"},_a={class:"flex items-center justify-between mb-2"},va={class:"grid grid-cols-1 gap-2 text-sm"},ga={class:"flex gap-2"},ba={class:"text-[11px] text-gray-600"},ha={class:"mt-3 flex justify-end gap-2"},Da={__name:"ActivityDesignsPage",setup(l){const i=Ce(),f=ke(),c=tt(),u=Be(),S={range:!0,partialRange:!0,multiCalendars:2,modelType:"yyyy-MM-dd",enableTimePicker:!1,autoApply:!0,clearable:!0},r=R({page:1,limit:10,sort:"created_at",order:"DESC",q:"",status:"",nature_of_activity:"",school_year:"",semester:"",club_id:"",filed_by_user_id:"",date_filed_from:"",date_filed_to:"",impl_from:"",impl_to:""}),T=L({get:()=>{const{date_filed_from:o,date_filed_to:e}=r.value;return o||e?[o||null,e||null]:null},set:o=>{if(!o)r.value.date_filed_from=null,r.value.date_filed_to=null;else{const[e,a]=o;r.value.date_filed_from=e||null,r.value.date_filed_to=a||null}}}),U=L({get:()=>{const{impl_from:o,impl_to:e}=r.value;return o||e?[o||null,e||null]:null},set:o=>{if(!o)r.value.impl_from=null,r.value.impl_to=null;else{const[e,a]=o;r.value.impl_from=e||null,r.value.impl_to=a||null}}}),M=["1st Semester","2nd Semester","Summer"],C=L(()=>{const o=new Date().getFullYear();return Array.from({length:6},(e,a)=>`${o-a}-${o-a+1}`)}),g=async(o={},e=!0)=>{r.value={...r.value,...o},typeof r.value.officer>"u"&&(r.value.officer=!0);const a={...r.value};["q","status","nature_of_activity","school_year","semester","club_id","filed_by_user_id","date_filed_from","date_filed_to","impl_from","impl_to"].forEach(_=>{(a[_]===""||a[_]==null)&&delete a[_]}),a.officer=r.value.officer,await i.fetchAll(a,e)};Re(async()=>{await Promise.all([g({page:1,limit:10}),c.fetchAll({page:1,limit:200,officer:!0},!0),u.fetchAll({page:1,limit:200},!0)])});const Y=R([]);we(()=>r.value.club_id,async o=>{if(r.value.filed_by_user_id="",!o){Y.value=[];return}try{await c.fetchById(o),Y.value=Array.isArray(c.selectedClub?.users)?c.selectedClub.users:[]}catch{Y.value=[]}});const $=L(()=>r.value.club_id?Y.value:u.users.data||[]),k=L(()=>({total:i.items.total||0,totalPages:i.items.totalPages||1,currentPage:i.items.currentPage||1,pageSize:i.items.pageSize||10,data:i.items.data||[]})),b=["Curricular","Co-Curricular","Extra-Curricular"],x=["draft","pending","approved","rejected","cancelled"],D=o=>{switch(String(o||"").toLowerCase()){case"draft":return"gray";case"pending":return"amber";case"approved":return"emerald";case"rejected":return"red";case"cancelled":return"zinc";default:return"gray"}},I=o=>{const e=Number(o);return Number.isFinite(e)?e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},E=[{key:"reference_code",label:"Ref Code",sortable:!0,width:140},{key:"name_of_activity",label:"Activity",sortable:!0,minWidth:220},{key:"annual_plan_item",label:"Annual Plan / Item",sortable:!1,minWidth:260},{key:"club_id",label:"Club",sortable:!1,formatter:(o,e)=>e.club?e.club.name:""},{key:"semester",label:"Sem",sortable:!0,width:110},{key:"school_year",label:"S.Y.",sortable:!0,width:110},{key:"date_of_implementation",label:"Implementation",sortable:!0,width:140,formatter:o=>o?new Date(o).toLocaleDateString():"—"},{key:"status",label:"Status",sortable:!0,width:120}],B=async o=>{await g(o)},A=R(!1),P=R(!1),K=R(null),oe=()=>{A.value=!0},Z=o=>{if(!o)return null;if(typeof o=="object")return o;try{return JSON.parse(o)}catch{return null}},se=async o=>{await i.create(o),A.value=!1,await g({},!0)},ee=async o=>{await i.fetchById(o.id);const e=i.selected||o;K.value={id:e.id,date_filed:e.date_filed||"",semester:e.semester||"",office_department:e.office_department||"",school_year:e.school_year||"",name_of_activity:e.name_of_activity||"",venue:e.venue||"",date_of_implementation:e.date_of_implementation||"",proposed_budget:e.proposed_budget??"",participants:e.participants||"",nature_of_activity:e.nature_of_activity||"Curricular",rationale:e.rationale||"",objectives:e.objectives||"",details_of_activity:e.details_of_activity||"",budgetary_requirements:e.budgetary_requirements||"",file_by_user_name:e.file_by_user_name||"",filed_by_user_id:e.filed_by_user_id||"",club_id:e.club_id||"",status:e.status||"draft",remarks:e.remarks||"",annual_plan_id:e.annual_plan_id||"",annual_plan_item:Z(e.annual_plan_item)},P.value=!0},te=async o=>{const{id:e,...a}=o;await i.updateById(e,a),P.value=!1,await g({},!0)},re=async o=>{if(!o?.id)return;(await v.fire({title:`Delete "${o.name_of_activity}"?`,text:"This cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it",cancelButtonText:"Cancel"})).isConfirmed&&(await i.deleteById(o.id),await g({},!0),await v.fire("Deleted","The activity design has been deleted.","success"))},Q=async o=>{await i.fetchById(o.id);const e=i.selected||o;K.value={...e,date_filed:e.date_filed?String(e.date_filed).slice(0,10):"",date_of_implementation:e.date_of_implementation?String(e.date_of_implementation).slice(0,10):"",annual_plan_id:e.annual_plan_id||"",annual_plan_item:Z(e.annual_plan_item)},P.value=!0},ae=async o=>{if((await v.fire({title:"Submit for approval?",text:"You can no longer edit after submission.",icon:"question",showCancelButton:!0,confirmButtonText:"Submit",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1})).isConfirmed)try{await i.submit(o.id),await g({},!0),await v.fire("Submitted","Activity is now pending approval.","success")}catch{await v.fire("Error",i.error||"Failed to submit activity.","error")}},de=async o=>{const e=await v.fire({title:"Approve activity?",input:"textarea",inputLabel:"Remarks (optional)",inputPlaceholder:"Add a note…",showCancelButton:!0,confirmButtonText:"Approve",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1});if(!e.isConfirmed)return;const a=e.value||"";try{await i.approve(o.id,a),await g({},!0),await v.fire("Approved","Activity has been approved.","success")}catch{await v.fire("Error",i.error||"Failed to approve activity.","error")}},t=R(!1),d=R(null),s=R({from_email:"",from_name:"",to:"",subject:"",html:"",attachments:[]}),h=async o=>{try{await i.fetchById(o.id);const e=i.selected||o,_=(await Ee(e)).output("datauristring"),Te=String(_).split(",")[1]||"",$e=`${e.reference_code||"Activity_Design"}.pdf`;d.value=e,s.value={from_email:"osas@knp.edu.ph",from_name:`${f.user?.first_name||""} ${f.user?.last_name||""}`.trim(),to:"",subject:`Activity Design ${e.reference_code||""} - ${e.name_of_activity||""}`.trim(),html:"Please see the attached file.",attachments:[{filename:$e,content:Te,type:"application/pdf"}]},t.value=!0}catch{await v.fire("Error",i.error||"Failed to prepare email.","error")}},H=async()=>{const o=d.value;if(o)try{await i.sendEmail(o.id,{...s.value}),t.value=!1,await v.fire("Sent","Email sent successfully.","success")}catch{await v.fire("Error",i.error||"Failed to send email.","error")}},z=async o=>{const e=await v.fire({title:"Reject activity?",input:"textarea",inputLabel:"Reason (required)",inputPlaceholder:"State the reason…",inputValidator:_=>_?.trim()?void 0:"Reason is required",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Reject",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1});if(!e.isConfirmed)return;const a=e.value;try{await i.reject(o.id,a),await g({},!0),await v.fire("Rejected","Activity has been rejected.","success")}catch{await v.fire("Error",i.error||"Failed to reject activity.","error")}},le=async o=>{const e=await v.fire({title:"Cancel activity?",input:"textarea",inputLabel:"Reason (required)",inputPlaceholder:"State the reason…",inputValidator:_=>_?.trim()?void 0:"Reason is required",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Cancel Activity",cancelButtonText:"Keep Activity",allowOutsideClick:!1,allowEscapeKey:!1});if(!e.isConfirmed)return;const a=e.value;try{await i.cancel(o.id,a),await g({},!0),await v.fire("Cancelled","Activity has been cancelled.","success")}catch{await v.fire("Error",i.error||"Failed to cancel activity.","error")}},W=async o=>{if(String(o?.status||"").toLowerCase()!=="approved"){await v.fire("Not allowed","Only approved activities can be printed.","info");return}try{await i.fetchById(o.id);const a=i.selected||o;await jt(a)}catch(a){await v.fire("Error",i.error||"Failed to generate PDF.","error"),console.error(a)}},ue=R(!1),me=R(null),pe=async o=>{await i.fetchById(o.id),me.value=i.selected||o,ue.value=!0},Fe=async()=>{await g({q:"",status:"",nature_of_activity:"",school_year:"",semester:"",club_id:"",filed_by_user_id:"",date_filed_from:"",date_filed_to:"",impl_from:"",impl_to:"",page:1})};return(o,e)=>(m(),p(O,null,[F(We,null,{default:N(()=>[F(Ge,null,{default:N(()=>[w(i).error?(m(),ce(Ze,{key:0,icon:w(qe),color:"danger"},{default:N(()=>[X(y(w(i).error),1)]),_:1},8,["icon"])):q("",!0),F(Qe,{icon:w(Ke),title:"Activity Designs",main:""},{default:N(()=>[n("div",Lt,[F(ge,{icon:w(He),color:"primary",label:"New Activity",onClick:oe},null,8,["icon"]),F(ge,{icon:w(Je),color:"info",label:"Refresh",onClick:e[0]||(e[0]=a=>g({},!0))},null,8,["icon"])])]),_:1},8,["icon"]),n("div",Mt,[n("div",zt,[(m(),p("svg",Wt,[n("path",{d:w(Xe)},null,8,Gt)])),e[22]||(e[22]=n("span",{class:"font-medium text-sm"},"Filters",-1))]),n("div",qt,[V(n("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>r.value.q=a),placeholder:"Search by ref, activity, venue, office…",class:"border rounded px-2 py-2 md:col-span-2",onKeyup:e[2]||(e[2]=De(a=>g({page:1}),["enter"]))},null,544),[[ne,r.value.q]]),V(n("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>r.value.status=a),class:"border rounded px-2 py-2"},[e[23]||(e[23]=n("option",{value:""},"All status",-1)),(m(),p(O,null,G(x,a=>n("option",{key:a,value:a},y(a),9,Kt)),64))],512),[[J,r.value.status]]),V(n("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>r.value.nature_of_activity=a),class:"border rounded px-2 py-2"},[e[24]||(e[24]=n("option",{value:""},"All natures",-1)),(m(),p(O,null,G(b,a=>n("option",{key:a,value:a},y(a),9,Ht)),64))],512),[[J,r.value.nature_of_activity]]),V(n("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>r.value.school_year=a),class:"border rounded px-2 py-2 md:col-span-1"},[(m(!0),p(O,null,G(C.value,a=>(m(),p("option",{key:a,value:a},y(a),9,Jt))),128))],512),[[J,r.value.school_year]]),V(n("select",{"onUpdate:modelValue":e[6]||(e[6]=a=>r.value.semester=a),class:"border rounded px-2 py-2 md:col-span-1"},[e[25]||(e[25]=n("option",{disabled:"",value:""},"Select semester…",-1)),(m(),p(O,null,G(M,a=>n("option",{key:a,value:a},y(a),9,Xt)),64))],512),[[J,r.value.semester]]),V(n("select",{"onUpdate:modelValue":e[7]||(e[7]=a=>r.value.club_id=a),class:"border rounded px-2 py-2 md:col-span-2"},[w(f).user.role==="admin"?(m(),p("option",Qt,"All clubs")):q("",!0),(m(!0),p(O,null,G(w(c).clubs.data||[],a=>(m(),p("option",{key:a.id,value:a.id},y(a.name),9,Zt))),128))],512),[[J,r.value.club_id]]),V(n("select",{"onUpdate:modelValue":e[8]||(e[8]=a=>r.value.filed_by_user_id=a),class:"border rounded px-2 py-2 md:col-span-2"},[n("option",ea,y(r.value.club_id?"Filed by (club members)":"Filed by (any)"),1),(m(!0),p(O,null,G($.value,a=>(m(),p("option",{key:a.id,value:a.id},y(a.first_name)+" "+y(a.last_name)+" (@"+y(a.username)+") ",9,ta))),128))],512),[[J,r.value.filed_by_user_id]]),n("div",aa,[F(w(_e),ye({modelValue:T.value,"onUpdate:modelValue":e[9]||(e[9]=a=>T.value=a)},S,{placeholder:"Filed date range"}),null,16,["modelValue"])]),n("div",la,[F(w(_e),ye({modelValue:U.value,"onUpdate:modelValue":e[10]||(e[10]=a=>U.value=a)},S,{placeholder:"Implementation date range"}),null,16,["modelValue"])]),n("div",na,[n("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:e[11]||(e[11]=a=>g({page:1}))}," Apply "),n("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:Fe}," Reset ")])])]),F(et,{columns:E,data:k.value,loading:w(i).isLoading,onQueryChange:B},{"cell-annual_plan_item":N(({row:a})=>[n("div",ia,[a.annual_plan_id?(m(),p(O,{key:0},[n("div",oa,[n("span",sa,[n("span",ra,y(a.annual_plan?.reference_code||`AP-${a.annual_plan_id}`),1),n("span",da,"SY "+y(a.annual_plan?.school_year||"—"),1)])]),n("div",ua,[n("span",ca,y((()=>{try{const _=typeof a.annual_plan_item=="string"?JSON.parse(a.annual_plan_item||"null")||{}:a.annual_plan_item||{};return _.item||_.title||_.name||_.activity||"—"}catch{return"—"}})()),1),n("span",ma," — ₱"+y((()=>{try{const _=typeof a.annual_plan_item=="string"?JSON.parse(a.annual_plan_item||"null")||{}:a.annual_plan_item||{};return I(_.funds??_.budget??0)}catch{return I(0)}})()),1)])],64)):(m(),p("span",pa,"—"))])]),"cell-nature_of_activity":N(({value:a})=>[F(be,{text:a||"—",tone:"indigo"},null,8,["text"])]),"cell-status":N(({value:a})=>[F(be,{text:a||"—",tone:D(a)},null,8,["text","tone"])]),"cell-actions":N(({row:a})=>[["admin","manager"].includes(String(w(f).user?.role||"").toLowerCase())?(m(),ce(ve,{key:0,row:a,moderator:!0,onAttachments:pe,onSubmit:ae,onApprove:de,onReject:z,onEdit:ee,onDelete:re,onView:_=>Q(a),onCancel:le,onPrint:W,onEmail:h},null,8,["row","onView"])):(m(),ce(ve,{key:1,row:a,moderator:!1,onAttachments:pe,onSubmit:ae,onEdit:ee,onView:_=>Q(a),onPrint:W,onEmail:h},null,8,["row","onView"]))]),_:1},8,["data","loading"])]),_:1})]),_:1}),F(he,{modelValue:A.value,"onUpdate:modelValue":e[12]||(e[12]=a=>A.value=a),mode:"create",onSubmit:se},null,8,["modelValue"]),F(he,{modelValue:P.value,"onUpdate:modelValue":e[13]||(e[13]=a=>P.value=a),mode:"edit",initial:K.value||{},onSubmit:te},null,8,["modelValue","initial"]),F(Bt,{modelValue:ue.value,"onUpdate:modelValue":e[14]||(e[14]=a=>ue.value=a),row:me.value},null,8,["modelValue","row"]),t.value?(m(),p("div",fa,[n("div",ya,[n("div",_a,[e[26]||(e[26]=n("h3",{class:"text-base font-semibold"},"Send Email",-1)),n("button",{class:"px-2 py-1 text-xs bg-gray-200 rounded",onClick:e[15]||(e[15]=a=>t.value=!1)},"Close")]),n("div",va,[n("div",null,[e[27]||(e[27]=n("label",{class:"block mb-0.5"},"To",-1)),n("div",ga,[V(n("input",{"onUpdate:modelValue":e[16]||(e[16]=a=>s.value.to=a),class:"flex-1 border rounded px-2 py-1.5",placeholder:"recipient@example.com"},null,512),[[ne,s.value.to]]),n("button",{class:"px-2 py-1 text-[11px] rounded border bg-gray-50 hover:bg-gray-100",onClick:e[17]||(e[17]=()=>{const a=d.value?.filed_by_user_id||d.value?.filed_by?.id;a&&w(u).fetchById(a).then(()=>{const _=w(u).selectedUser?.email;_&&(s.value.to=_)})})},"Use Filer"),n("button",{class:"px-2 py-1 text-[11px] rounded border bg-rose-50 hover:bg-rose-100",onClick:e[18]||(e[18]=()=>{s.value.attachments=[]})},"Remove Attachment")])]),n("div",null,[e[28]||(e[28]=n("label",{class:"block mb-0.5"},"Subject",-1)),V(n("input",{"onUpdate:modelValue":e[19]||(e[19]=a=>s.value.subject=a),class:"w-full border rounded px-2 py-1.5"},null,512),[[ne,s.value.subject]])]),n("div",null,[e[29]||(e[29]=n("label",{class:"block mb-0.5"},"Message",-1)),V(n("textarea",{"onUpdate:modelValue":e[20]||(e[20]=a=>s.value.html=a),rows:"4",class:"w-full border rounded px-2 py-1.5"},null,512),[[ne,s.value.html]])]),n("div",ba,"Attachment: "+y(s.value.attachments?.[0]?.filename||"activity.pdf"),1)]),n("div",ha,[n("button",{class:"px-3 py-1.5 text-xs bg-gray-200 rounded",onClick:e[21]||(e[21]=a=>t.value=!1)},"Cancel"),n("button",{class:"px-3 py-1.5 text-xs bg-emerald-600 text-white rounded",onClick:H},"Send")])])])):q("",!0)],64))}};export{Da as default};
