import{c as q,r as A,x as te,G as Oe,a as v,d as M,q as m,e,t as b,h as j,k as T,v as Y,C as se,b as ze,j as oe,g as P,z as Ne,F as H,B as ee,S as ae,H as We,I as Ke,o as ye,E as je,J as Ge,K as qe,L as Se,n as Ve,f as W,A as xe,u as Je,l as de,M as Ye}from"./index.w1fTWaRQ.js";import{u as He,v as Xe,w as Qe,x as Ze,y as et,z as Pe,A as tt,B as nt,C as lt,D as ot,E as at,F as st,G as it,H as rt,I as ut,_ as dt,a as ct,g as mt,J as vt,K as pt,L as ft,M as bt}from"./SectionMain.Co2y8BLV.js";import{_ as gt,a as De}from"./SectionTitleLineWithButton.AVJG-kj_.js";import{_ as xt,B as yt,a as Ue}from"./Badge.BfbdF7_K.js";import{u as he}from"./club.CZEs4jG_.js";import{u as ht}from"./clubDoc.DWTPIkNa.js";import{_ as ve}from"./IconifyButton.CaN1pAk4.js";import"./appContext.Db1VNKoe.js";import"./activityDesignService.DKPfTybd.js";import"./utilizationRequestService.BsNdNhg3.js";import"./liquidationFundService.n_EUG0wO.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";import"./ToasterComponent.C4X8owM8.js";const wt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},Ct={class:"bg-white p-4 rounded-xl shadow-xl w-[920px] max-h-screen overflow-auto"},_t={class:"flex items-center justify-between mb-3"},$t={class:"text-lg font-semibold"},kt={class:"grid grid-cols-2 gap-4 text-sm"},St={key:0,class:"text-red-600 text-xs mt-1"},Vt={key:0,class:"text-red-600 text-xs mt-1"},Dt={key:0,class:"text-red-600 text-xs mt-1"},Ut={class:"col-span-2"},At={class:"col-span-2 grid grid-cols-2 gap-4"},Et={class:"space-y-2"},Bt={class:"border-2 border-dashed rounded-xl p-4 flex items-center justify-between gap-3"},It={class:"flex items-center gap-3"},Lt={class:"w-16 h-16 bg-gray-50 border rounded-lg overflow-hidden flex items-center justify-center"},Mt=["src"],Ot={key:1,class:"text-xs text-gray-400"},jt={class:"flex items-center gap-2"},Pt={class:"px-3 py-2 bg-gray-800 text-white rounded cursor-pointer text-xs"},Rt=["disabled"],Tt={key:0,class:"text-red-600 text-xs mt-1"},Ft={key:1,class:"text-xs text-gray-500 break-all"},zt={class:"space-y-2"},Nt={class:"border-2 border-dashed rounded-xl p-4 flex items-center justify-between gap-3"},Wt={class:"flex items-center gap-3"},Kt={class:"w-40 h-16 bg-gray-50 border rounded-lg overflow-hidden flex items-center justify-center"},Gt=["src"],qt={key:1,class:"text-xs text-gray-400"},Jt={class:"flex items-center gap-2"},Yt={class:"px-3 py-2 bg-gray-800 text-white rounded cursor-pointer text-xs"},Ht=["disabled"],Xt={key:0,class:"text-red-600 text-xs mt-1"},Qt={key:1,class:"text-xs text-gray-500 break-all"},Zt={class:"flex justify-end gap-2 mt-5"},en={class:"px-4 py-2 bg-blue-600 text-white rounded text-xs"},tn=2*1024*1024,Ae={__name:"ClubFormModal",props:{modelValue:{type:Boolean,default:!1},mode:{type:String,default:"create"},initial:{type:Object,default:()=>({id:null,name:"",code:"",category:"",adviser:"",description:"",is_active:!0,established_at:"",website:"",email:"",phone:"",logo:"",banner:""})}},emits:["update:modelValue","submit"],setup(n,{emit:y}){const a=n,x=y,u=q({get:()=>a.modelValue,set:g=>x("update:modelValue",g)}),D="https://knp.edu.ph",o=A({...a.initial}),s=A({});te(()=>a.initial,g=>{o.value={...g},s.value={}},{immediate:!0});const p=q(()=>a.mode==="edit"?"Edit Club":"Add New Club"),w=q(()=>a.mode==="edit"?"Save Changes":"Create"),O=q(()=>{const g=o.value.logo;return g?g.startsWith("data:")?g:`${D}${g}`:""}),z=q(()=>{const g=o.value.banner;return g?g.startsWith("data:")?g:`${D}${g}`:""}),I=()=>{const g={};return o.value.name?.trim()||(g.name="Name is required"),o.value.code?.trim()||(g.code="Code is required"),o.value.adviser?.trim()||(g.adviser="Adviser is required"),s.value={...s.value,...g},Object.keys(g).length===0},E=["image/png","image/jpeg"],J=g=>new Promise((l,Q)=>{const L=new FileReader;L.onload=X=>l(X.target.result),L.onerror=Q,L.readAsDataURL(g)});function F(g,l){return s.value[l]="",E.includes(g.type)?g.size>tn?(s.value[l]="File too large. Maximum size is 2 MB.",!1):!0:(s.value[l]="Invalid file type. Please upload a PNG or JPEG image.",!1)}const K=async g=>{const l=g.target.files?.[0];if(l){if(!F(l,"logo")){g.target.value="";return}o.value.logo=await J(l)}},N=async g=>{const l=g.target.files?.[0];if(l){if(!F(l,"banner")){g.target.value="";return}o.value.banner=await J(l)}},R=()=>{o.value.logo="",s.value.logo=""},V=()=>{o.value.banner="",s.value.banner=""},$=()=>{if(!I())return;const g={...o.value};Object.keys(g).forEach(l=>{g[l]===""&&(g[l]=null)}),x("submit",g)};return(g,l)=>{const Q=Oe("pending-click");return u.value?(m(),v("div",wt,[e("div",Ct,[e("div",_t,[e("h2",$t,b(p.value),1),e("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:l[0]||(l[0]=L=>u.value=!1)},"Close")]),e("div",kt,[e("div",null,[l[12]||(l[12]=e("label",{class:"block mb-1"},[T("Name "),e("span",{class:"text-red-500"},"*")],-1)),j(e("input",{"onUpdate:modelValue":l[1]||(l[1]=L=>o.value.name=L),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring",placeholder:"e.g. Math Society"},null,512),[[Y,o.value.name]]),s.value.name?(m(),v("p",St,b(s.value.name),1)):M("",!0)]),e("div",null,[l[13]||(l[13]=e("label",{class:"block mb-1"},[T("Code "),e("span",{class:"text-red-500"},"*")],-1)),j(e("input",{"onUpdate:modelValue":l[2]||(l[2]=L=>o.value.code=L),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring",placeholder:"e.g. MATHSOC"},null,512),[[Y,o.value.code]]),s.value.code?(m(),v("p",Vt,b(s.value.code),1)):M("",!0)]),e("div",null,[l[15]||(l[15]=e("label",{class:"block mb-1"},"Category",-1)),j(e("select",{"onUpdate:modelValue":l[3]||(l[3]=L=>o.value.category=L),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring"},l[14]||(l[14]=[ze('<option disabled value="">Select a category</option><option value="Academic">Academic</option><option value="Cultural">Cultural</option><option value="Athletics">Athletics</option><option value="Social">Social</option><option value="Community Service">Community Service</option><option value="Religious/Spiritual">Religious / Spiritual</option><option value="Environmental">Environmental</option><option value="Leadership">Leadership</option><option value="Others">Others</option>',10)]),512),[[se,o.value.category]])]),e("div",null,[l[16]||(l[16]=e("label",{class:"block mb-1"},[T("Adviser "),e("span",{class:"text-red-500"},"*")],-1)),j(e("input",{"onUpdate:modelValue":l[4]||(l[4]=L=>o.value.adviser=L),class:oe(["w-full border rounded px-3 py-2 focus:outline-none focus:ring",s.value.adviser?"border-red-500":""]),placeholder:"Adviser full name"},null,2),[[Y,o.value.adviser]]),s.value.adviser?(m(),v("p",Dt,b(s.value.adviser),1)):M("",!0)]),e("div",null,[l[18]||(l[18]=e("label",{class:"block mb-1"},"Active?",-1)),j(e("select",{"onUpdate:modelValue":l[5]||(l[5]=L=>o.value.is_active=L),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring"},l[17]||(l[17]=[e("option",{value:!0},"Yes",-1),e("option",{value:!1},"No",-1)]),512),[[se,o.value.is_active]])]),e("div",Ut,[l[19]||(l[19]=e("label",{class:"block mb-1"},"Description",-1)),j(e("textarea",{"onUpdate:modelValue":l[6]||(l[6]=L=>o.value.description=L),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring",rows:"3",placeholder:"Brief description of the club (mission, focus, etc.)"},null,512),[[Y,o.value.description]])]),e("div",null,[l[20]||(l[20]=e("label",{class:"block mb-1"},"Established At",-1)),j(e("input",{"onUpdate:modelValue":l[7]||(l[7]=L=>o.value.established_at=L),type:"date",class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring"},null,512),[[Y,o.value.established_at]])]),e("div",null,[l[21]||(l[21]=e("label",{class:"block mb-1"},"Website",-1)),j(e("input",{"onUpdate:modelValue":l[8]||(l[8]=L=>o.value.website=L),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring",placeholder:"https://…"},null,512),[[Y,o.value.website]])]),e("div",null,[l[22]||(l[22]=e("label",{class:"block mb-1"},"Email",-1)),j(e("input",{"onUpdate:modelValue":l[9]||(l[9]=L=>o.value.email=L),type:"email",class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring",placeholder:"club@example.com"},null,512),[[Y,o.value.email]])]),e("div",null,[l[23]||(l[23]=e("label",{class:"block mb-1"},"Phone",-1)),j(e("input",{"onUpdate:modelValue":l[10]||(l[10]=L=>o.value.phone=L),class:"w-full border rounded px-3 py-2 focus:outline-none focus:ring",placeholder:"+63…"},null,512),[[Y,o.value.phone]])]),e("div",At,[e("div",Et,[l[26]||(l[26]=e("label",{class:"block"},"Logo",-1)),e("div",Bt,[e("div",It,[e("div",Lt,[O.value?(m(),v("img",{key:0,src:O.value,alt:"Logo",class:"w-full h-full object-contain"},null,8,Mt)):(m(),v("span",Ot,"No logo"))]),l[24]||(l[24]=e("div",{class:"text-xs text-gray-500"},[e("p",{class:"font-medium text-gray-700"},"PNG/JPEG • ≤ 2MB"),e("p",null,"Square works best")],-1))]),e("div",jt,[e("label",Pt,[l[25]||(l[25]=T(" Change ",-1)),e("input",{type:"file",class:"hidden",accept:"image/png,image/jpeg",onChange:K},null,32)]),e("button",{class:"px-3 py-2 bg-gray-200 rounded text-xs",onClick:R,disabled:!o.value.logo},"Remove",8,Rt)])]),s.value.logo?(m(),v("p",Tt,b(s.value.logo),1)):M("",!0),o.value.logo&&!o.value.logo.startsWith("data:")?(m(),v("p",Ft,b(P(D)+o.value.logo),1)):M("",!0)]),e("div",zt,[l[29]||(l[29]=e("label",{class:"block"},"Banner",-1)),e("div",Nt,[e("div",Wt,[e("div",Kt,[z.value?(m(),v("img",{key:0,src:z.value,alt:"Banner",class:"w-full h-full object-contain"},null,8,Gt)):(m(),v("span",qt,"No banner"))]),l[27]||(l[27]=e("div",{class:"text-xs text-gray-500"},[e("p",{class:"font-medium text-gray-700"},"PNG/JPEG • ≤ 2MB"),e("p",null,"Wide 5:1 recommended")],-1))]),e("div",Jt,[e("label",Yt,[l[28]||(l[28]=T(" Change ",-1)),e("input",{type:"file",class:"hidden",accept:"image/png,image/jpeg",onChange:N},null,32)]),e("button",{class:"px-3 py-2 bg-gray-200 rounded text-xs",onClick:V,disabled:!o.value.banner},"Remove",8,Ht)])]),s.value.banner?(m(),v("p",Xt,b(s.value.banner),1)):M("",!0),o.value.banner&&!o.value.banner.startsWith("data:")?(m(),v("p",Qt,b(P(D)+o.value.banner),1)):M("",!0)])])]),e("div",Zt,[e("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:l[11]||(l[11]=L=>u.value=!1)},"Cancel"),j((m(),v("button",en,[T(b(w.value),1)])),[[Q,$]])])])])):M("",!0)}}},nn={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},ln={class:"bg-white p-4 rounded shadow-lg w-[860px] max-h-screen overflow-auto"},on={class:"flex items-center justify-between"},an={class:"text-lg font-semibold"},sn={class:"text-gray-600"},rn={class:"mt-3 flex flex-col gap-2"},un={class:"flex items-center gap-2"},dn=["value"],cn={class:"text-[12px] text-gray-600"},mn={class:"mt-4"},vn={class:"relative"},pn={key:0,class:"absolute z-10 mt-1 w-full bg-white border rounded shadow max-h-64 overflow-auto"},fn={key:0,class:"px-3 py-2 text-xs text-gray-500"},bn=["onClick"],gn={class:"font-medium"},xn={class:"text-gray-500"},yn={class:"text-xs text-gray-500"},hn={key:0,class:"px-3 py-2 text-xs text-gray-500"},wn={key:0,class:"flex flex-wrap gap-2 mt-2"},Cn=["onClick"],_n={class:"flex justify-end mt-2"},$n=["disabled"],kn={class:"space-y-2 mt-4 max-h-[60vh] overflow-y-auto pr-2 -mr-2"},Sn={class:"text-sm"},Vn={class:"font-semibold"},Dn={class:"text-gray-500 text-xs"},Un={class:"text-gray-600 text-xs"},An={class:"mt-1 text-xs flex flex-wrap items-center gap-3"},En=["disabled","value","onChange"],Bn=["value"],In=["disabled","value","onChange"],Ln=["value"],Mn={key:0,class:"text-[11px] text-gray-500"},On=["onClick"],jn={class:"flex justify-between items-center mt-3 text-xs text-gray-600"},pe=10,Pn={__name:"ClubMembersModal",props:{modelValue:{type:Boolean,default:!1},clubId:{type:[Number,String],required:!0},clubName:{type:String,default:""}},emits:["update:modelValue"],setup(n,{emit:y}){const a=n,x=y,u=he(),D=Ne(),o=q({get:()=>a.modelValue,set:c=>x("update:modelValue",c)}),s=A([]),p=A(1),w=A(""),O=A("all"),z=A("all"),I=["president","vice-president","secretary","treasurer","pio","business manager","bod","officer"],E=new Set([...I,"officer"]),J=[...I,"member"],F=["pending","active","inactive"],K=c=>(c??"member").toString().trim().toLowerCase()||"member",N=c=>{const i=K(c);if(i==="member")return 999;const r=I.indexOf(i);return r===-1?I.indexOf("officer"):r},R=c=>E.has(K(c?.UserClub?.role)),V=c=>{const i=(c??"active").toString().trim().toLowerCase();return F.includes(i)?i:"active"},$=c=>{const i=K(c?.UserClub?.role);return i==="member"?"member":J.includes(i)?i:"officer"},g=(c,i)=>{if(!i)return!0;const r=`${c.first_name||""} ${c.last_name||""}`.toLowerCase(),B=(c.username||"").toLowerCase(),re=(c.email||"").toLowerCase();return r.includes(i)||B.includes(i)||re.includes(i)},l=q(()=>{const c=w.value.trim().toLowerCase();let i=s.value||[];return O.value==="officers"?i=i.filter(R):O.value==="members"&&(i=i.filter(r=>!R(r))),z.value!=="all"&&(i=i.filter(r=>V(r?.UserClub?.status)===z.value)),c&&(i=i.filter(r=>g(r,c))),i.slice().sort((r,B)=>{const re=N(r.UserClub?.role),we=N(B.UserClub?.role);if(re!==we)return re-we;const Ce=(r.last_name||"").toLowerCase(),_e=(B.last_name||"").toLowerCase();if(Ce!==_e)return Ce.localeCompare(_e);const $e=(r.first_name||"").toLowerCase(),ke=(B.first_name||"").toLowerCase();return $e!==ke?$e.localeCompare(ke):(r.username||"").toLowerCase().localeCompare((B.username||"").toLowerCase())})}),Q=q(()=>(s.value||[]).filter(R).length),L=q(()=>(s.value||[]).filter(c=>!R(c)).length),X=q(()=>{const c=l.value.length,i=Math.ceil(Math.max(c,1)/pe),r=Math.min(p.value,i||1),B=(r-1)*pe,re=l.value.slice(B,B+pe);return{total:c,totalPages:i,currentPage:r,pageSize:pe,data:re}});te([w,O,z],()=>p.value=1);const ue=async()=>{await u.fetchById(a.clubId),s.value=Array.isArray(u.selectedClub?.users)?u.selectedClub.users:[],w.value="",O.value="all",z.value="all",p.value=1},U=A(""),d=A([]),k=A(!1),C=A([]);let S=null;const f=c=>{const i={};return c&&(c.includes("@")?i.email=c:i.username=c,i.is_active=!0),i},t=c=>{const i=new Set((s.value||[]).map(B=>B.id)),r=new Set((C.value||[]).map(B=>B.id));return(c||[]).filter(B=>!i.has(B.id)&&!r.has(B.id))},_=async()=>{const c=U.value.trim();if(!c){d.value=[];return}k.value=!0;try{await D.fetchAll({page:1,limit:8,filters:f(c)},!0),d.value=t(D.users.data||[])}finally{k.value=!1}};te(U,c=>{if(clearTimeout(S),!c?.trim()){d.value=[];return}S=setTimeout(_,250)});const h=c=>{C.value.push(c),d.value=d.value.filter(i=>i.id!==c.id),U.value=""},G=c=>{C.value=C.value.filter(i=>i.id!==c)},le=async()=>{if(!C.value.length)return;const c=C.value.map(i=>i.id);await u.addUsersToClub(a.clubId,c),s.value=Array.isArray(u.selectedClub?.users)?u.selectedClub.users:[],C.value=[],d.value=[],U.value="",p.value=1},Z=A(new Set),ie=A(new Set),me=async(c,i)=>{const r=V(i),B=V(c.UserClub?.status);if(B!==r){Z.value.add(c.id),c.UserClub||(c.UserClub={}),c.UserClub.status=r;try{await u.updateMemberStatus(a.clubId,c.id,r)}catch{c.UserClub.status=B,ae.fire("Update failed",u.error||"Unable to update status","error")}finally{Z.value.delete(c.id)}}},Te=async(c,i)=>{const r=K(i),B=K(c.UserClub?.role);if(B!==r){ie.value.add(c.id),c.UserClub||(c.UserClub={}),c.UserClub.role=r;try{await u.updateMemberRole(a.clubId,c.id,r)}catch{c.UserClub.role=B,ae.fire("Update failed",u.error||"Unable to update role","error")}finally{ie.value.delete(c.id)}}},Fe=async c=>{await u.removeUserFromClub(a.clubId,c),s.value=s.value.filter(i=>i.id!==c),U.value.trim()&&d.value.length&&(d.value=t(d.value))};return te(()=>a.modelValue,c=>{c&&ue()},{immediate:!1}),(c,i)=>o.value?(m(),v("div",nn,[e("div",ln,[e("div",on,[e("h2",an,[i[7]||(i[7]=T("Club Members — ",-1)),e("span",sn,b(n.clubName),1)]),e("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:i[0]||(i[0]=r=>o.value=!1)},"Close")]),e("div",rn,[e("div",un,[j(e("select",{"onUpdate:modelValue":i[1]||(i[1]=r=>O.value=r),class:"border rounded px-2 py-1 text-sm"},i[8]||(i[8]=[e("option",{value:"all"},"All roles",-1),e("option",{value:"officers"},"Officers",-1),e("option",{value:"members"},"Members",-1)]),512),[[se,O.value]]),j(e("select",{"onUpdate:modelValue":i[2]||(i[2]=r=>z.value=r),class:"border rounded px-2 py-1 text-sm"},[i[9]||(i[9]=e("option",{value:"all"},"All statuses",-1)),(m(),v(H,null,ee(F,r=>e("option",{key:r,value:r},b(r),9,dn)),64))],512),[[se,z.value]]),j(e("input",{"onUpdate:modelValue":i[3]||(i[3]=r=>w.value=r),type:"text",placeholder:"Search club members by name, username, or email…",class:"border rounded px-2 py-1 text-sm w-full"},null,512),[[Y,w.value]])]),e("div",cn," Showing "+b(X.value.total)+" result(s). Officers: "+b(Q.value)+" • Members: "+b(L.value),1)]),e("div",mn,[e("div",vn,[j(e("input",{"onUpdate:modelValue":i[4]||(i[4]=r=>U.value=r),type:"text",placeholder:"Add users: search by username or email…",class:"border rounded px-2 py-1 text-sm w-full",autocomplete:"off"},null,512),[[Y,U.value]]),U.value&&(d.value.length||k.value)?(m(),v("div",pn,[k.value?(m(),v("div",fn,"Searching…")):(m(),v(H,{key:1},[(m(!0),v(H,null,ee(d.value,r=>(m(),v("button",{key:r.id,class:"w-full text-left px-3 py-2 hover:bg-gray-100 text-sm",onClick:B=>h(r)},[e("div",gn,[T(b(r.first_name)+" "+b(r.last_name)+" ",1),e("span",xn,"@"+b(r.username),1)]),e("div",yn,b(r.email),1)],8,bn))),128)),d.value.length?M("",!0):(m(),v("div",hn,"No matches"))],64))])):M("",!0)]),C.value.length?(m(),v("div",wn,[(m(!0),v(H,null,ee(C.value,r=>(m(),v("span",{key:r.id,class:"inline-flex items-center gap-2 px-2 py-1 bg-blue-50 border border-blue-200 rounded text-xs"},[T(b(r.first_name)+" "+b(r.last_name)+" (@"+b(r.username)+") ",1),e("button",{class:"ml-1 text-blue-600",onClick:B=>G(r.id)},"✕",8,Cn)]))),128))])):M("",!0),e("div",_n,[e("button",{class:"px-3 py-1 bg-blue-600 text-white rounded text-xs disabled:opacity-50",disabled:!C.value.length,onClick:le}," Add Selected ",8,$n)])]),e("div",kn,[(m(!0),v(H,null,ee(X.value.data,r=>(m(),v("div",{key:r.id,class:"flex items-start justify-between p-3 border bg-gray-50 rounded"},[e("div",Sn,[e("div",Vn,[T(b(r.first_name)+" "+b(r.last_name)+" ",1),e("span",Dn,"(@"+b(r.username)+")",1)]),e("div",Un,b(r.email),1),e("div",An,[e("span",null,[i[10]||(i[10]=T("Role: ",-1)),e("select",{class:"border rounded px-1 py-0.5 text-xs",disabled:ie.value.has(r.id),value:$(r),onChange:B=>Te(r,B.target.value)},[(m(),v(H,null,ee(J,B=>e("option",{key:B,value:B},b(B),9,Bn)),64))],40,En)]),e("span",null,[i[11]||(i[11]=T("Status: ",-1)),e("select",{class:"border rounded px-1 py-0.5 text-xs",disabled:Z.value.has(r.id),value:V(r.UserClub?.status),onChange:B=>me(r,B.target.value)},[(m(),v(H,null,ee(F,B=>e("option",{key:B,value:B},b(B),9,Ln)),64))],40,In)]),e("span",null,[i[12]||(i[12]=T("Joined: ",-1)),e("strong",null,b(r.UserClub?.joined_at?new Date(r.UserClub.joined_at).toLocaleDateString():"—"),1)]),ie.value.has(r.id)||Z.value.has(r.id)?(m(),v("span",Mn,"Saving…")):M("",!0)])]),e("div",null,[e("button",{class:"px-2 py-1 bg-red-600 text-white rounded text-xs",onClick:B=>Fe(r.id)},"Remove",8,On)])]))),128))]),e("div",jn,[p.value>1?(m(),v("button",{key:0,onClick:i[5]||(i[5]=r=>p.value=p.value-1),class:"px-3 py-1 bg-gray-300 rounded"},"Previous")):M("",!0),e("div",null,"Page "+b(X.value.currentPage)+" of "+b(X.value.totalPages||1),1),p.value<X.value.totalPages?(m(),v("button",{key:1,onClick:i[6]||(i[6]=r=>p.value=p.value+1),class:"px-3 py-1 bg-gray-300 rounded"},"Next")):M("",!0)])])])):M("",!0)}};var Rn=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCommentChange","onCompositionEnd","onCompositionStart","onCompositionUpdate","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onInput","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],Tn=function(n){return Rn.map(function(y){return y.toLowerCase()}).indexOf(n.toLowerCase())!==-1},Fn=function(n,y,a){Object.keys(y).filter(Tn).forEach(function(x){var u=y[x];typeof u=="function"&&(x==="onInit"?u(n,a):a.on(x.substring(2),function(D){return u(D,a)}))})},zn=function(n,y,a,x){var u=n.modelEvents?n.modelEvents:null,D=Array.isArray(u)?u.join(" "):u;te(x,function(o,s){a&&typeof o=="string"&&o!==s&&o!==a.getContent({format:n.outputFormat})&&a.setContent(o)}),a.on(D||"change input undo redo",function(){y.emit("update:modelValue",a.getContent({format:n.outputFormat}))})},Nn=function(n,y,a,x,u,D){x.setContent(D()),a.attrs["onUpdate:modelValue"]&&zn(y,a,x,u),Fn(n,a.attrs,x)},Ee=0,Re=function(n){var y=Date.now(),a=Math.floor(Math.random()*1e9);return Ee++,n+"_"+a+Ee+String(y)},Wn=function(n){return n!==null&&n.tagName.toLowerCase()==="textarea"},Be=function(n){return typeof n>"u"||n===""?[]:Array.isArray(n)?n:n.split(" ")},Kn=function(n,y){return Be(n).concat(Be(y))},Gn=function(n){return n==null},Ie=function(n){var y;return typeof((y=n.options)===null||y===void 0?void 0:y.set)=="function"&&n.options.isRegistered("disabled")},Le=function(){return{listeners:[],scriptId:Re("tiny-script"),scriptLoaded:!1}},qn=function(){var n=Le(),y=function(u,D,o,s){var p=D.createElement("script");p.referrerPolicy="origin",p.type="application/javascript",p.id=u,p.src=o;var w=function(){p.removeEventListener("load",w),s()};p.addEventListener("load",w),D.head&&D.head.appendChild(p)},a=function(u,D,o){n.scriptLoaded?o():(n.listeners.push(o),u.getElementById(n.scriptId)||y(n.scriptId,u,D,function(){n.listeners.forEach(function(s){return s()}),n.scriptLoaded=!0}))},x=function(){n=Le()};return{load:a,reinitialize:x}},Jn=qn(),Yn=function(){return typeof window<"u"?window:global},ce=function(){var n=Yn();return n&&n.tinymce?n.tinymce:null},Hn={apiKey:String,licenseKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,readonly:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(n){return n==="html"||n==="text"}}},ne=function(){return ne=Object.assign||function(n){for(var y,a=1,x=arguments.length;a<x;a++){y=arguments[a];for(var u in y)Object.prototype.hasOwnProperty.call(y,u)&&(n[u]=y[u])}return n},ne.apply(this,arguments)},Xn=function(n,y,a,x){return n(x||"div",{id:y,ref:a})},Qn=function(n,y,a){return n("textarea",{id:y,visibility:"hidden",ref:a})},be={selector:void 0,target:void 0},ge=function(n,y){var a;typeof((a=n.mode)===null||a===void 0?void 0:a.set)=="function"?n.mode.set(y):n.setMode(y)},Zn=We({props:Hn,setup:function(n,y){var a=n.init?ne(ne({},n.init),be):ne({},be),x=Ke(n),u=x.disabled,D=x.readonly,o=x.modelValue,s=x.tagName,p=A(null),w=null,O=n.id||Re("tiny-vue"),z=n.init&&n.init.inline||n.inline,I=!!y.attrs["onUpdate:modelValue"],E=!0,J=n.initialValue?n.initialValue:"",F="",K=function(V){return I?function(){return o?.value?o.value:""}:function(){return V?J:F}},N=function(){var V=K(E),$=ne(ne({},a),{disabled:n.disabled,readonly:n.readonly,target:p.value,plugins:Kn(a.plugins,n.plugins),toolbar:n.toolbar||a.toolbar,inline:z,license_key:n.licenseKey,setup:function(g){w=g,!Ie(w)&&n.disabled===!0&&ge(w,"readonly"),g.on("init",function(l){return Nn(l,n,y,g,o,V)}),typeof a.setup=="function"&&a.setup(g)}});Wn(p.value)&&(p.value.style.visibility=""),ce().init($),E=!1};te(D,function(V){w!==null&&ge(w,V?"readonly":"design")}),te(u,function(V){w!==null&&(Ie(w)?w.options.set("disabled",V):ge(w,V?"readonly":"design"))}),te(s,function(V){var $;w&&(I||(F=w.getContent()),($=ce())===null||$===void 0||$.remove(w),Ve(function(){return N()}))}),ye(function(){if(ce()!==null)N();else if(p.value&&p.value.ownerDocument){var V=n.cloudChannel?n.cloudChannel:"8",$=n.apiKey?n.apiKey:"no-api-key",g=Gn(n.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat($,"/tinymce/").concat(V,"/tinymce.min.js"):n.tinymceScriptSrc;Jn.load(p.value.ownerDocument,g,N)}}),je(function(){ce()!==null&&ce().remove(w)}),z||(Ge(function(){E||N()}),qe(function(){var V;w&&(I||(F=w.getContent()),(V=ce())===null||V===void 0||V.remove(w))}));var R=function(V){var $;w&&(F=w.getContent(),($=ce())===null||$===void 0||$.remove(w),a=ne(ne(ne({},a),V),be),Ve(function(){return N()}))};return y.expose({rerender:R,getEditor:function(){return w}}),function(){return z?Xn(Se,O,p,n.tagName):Qn(Se,O,p)}}});function el(){const n=A(null),y=A(!1);return{editorRef:n,isFullscreen:y,onInit:(o,s)=>{n.value=s},toggleFullscreen:()=>{n.value&&(n.value.execCommand("mceFullScreen"),y.value=!y.value)},ensureExitFullscreen:()=>{y.value&&n.value&&(n.value.execCommand("mceFullScreen"),y.value=!1)},tinymceInit:{menubar:!1,height:320,plugins:"lists link image table code paste fullscreen",toolbar:"undo redo | blocks | bold italic underline strikethrough | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | removeformat | code | fullscreen",paste_data_images:!0,image_dimensions:!0,image_caption:!0,object_resizing:"img",branding:!1,content_style:"body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; font-size:14px}",automatic_uploads:!1,file_picker_types:"image",file_picker_callback:o=>{const s=document.createElement("input");s.type="file",s.accept="image/*",s.onchange=()=>{const p=s.files?.[0];if(!p)return;const w=new FileReader;w.onload=()=>o(w.result),w.readAsDataURL(p)},s.click()}}}}const tl={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},nl={class:"bg-white p-4 rounded shadow-lg w-[1024px] max-h-screen overflow-auto"},ll={class:"flex items-center justify-between mb-2"},ol={class:"text-lg font-semibold"},al={class:"flex items-center gap-2"},sl={class:"bg-white w-full max-w-[1024px] max-h-screen rounded-2xl shadow-lg flex flex-col"},il={class:"p-5 flex-1 overflow-auto"},rl={class:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"},ul=["aria-invalid"],dl=["value"],cl={key:0,class:"text-red-600 text-xs mt-1"},ml=["aria-invalid"],vl=["value"],pl={key:0,class:"text-red-600 text-xs mt-1"},fl={class:"md:col-span-2"},bl=["aria-invalid"],gl={key:0,class:"text-red-600 text-xs mt-1"},xl={class:"md:col-span-2"},yl={key:0,class:"text-red-600 text-xs mt-1"},hl={class:"md:col-span-2"},wl={class:"border-t p-4 bg-white flex items-center justify-end gap-2"},Me={__name:"DocFormModal",props:{modelValue:{type:Boolean,default:!1},mode:{type:String,default:"create"},initial:{type:Object,default:()=>({id:null,type:"cbl",title:"",content:"",status:"draft",doc_date:""})}},emits:["update:modelValue","submit","closed"],setup(n,{emit:y}){const a=["draft","published","archived"],x=["cbl","resolution","minute"],u=n,D=y,o=q({get:()=>u.modelValue,set:V=>D("update:modelValue",V)}),{isFullscreen:s,onInit:p,toggleFullscreen:w,ensureExitFullscreen:O,tinymceInit:z}=el(),I=A({...u.initial}),E=A({});te(()=>u.initial,V=>{I.value={...V},E.value={}},{immediate:!0});const J=q(()=>u.mode==="edit"?"Edit Document":"Add Document"),F=q(()=>u.mode==="edit"?"Save Changes":"Create"),K=()=>{const V={};return I.value.type||(V.type="Type is required"),I.value.title?.trim()||(V.title="Title is required"),I.value.content?.trim()||(V.content="Content is required"),I.value.status&&!a.includes(I.value.status)&&(V.status="Invalid status"),E.value=V,Object.keys(V).length===0},N=()=>{if(!K())return;const V={...I.value,doc_date:I.value.doc_date||null};D("submit",V)},R=()=>{O(),o.value=!1,D("closed")};return(V,$)=>{const g=Oe("pending-click");return o.value?(m(),v("div",tl,[e("div",nl,[e("div",ll,[e("h2",ol,b(J.value),1),e("div",al,[e("button",{class:"px-3 py-1 text-xs bg-indigo-600 text-white rounded",onClick:$[0]||($[0]=(...l)=>P(w)&&P(w)(...l))},b(P(s)?"Restore":"Maximize"),1),e("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:R},"Close")])]),e("div",sl,[e("div",il,[e("div",rl,[e("div",null,[$[6]||($[6]=e("label",{class:"block mb-1 font-medium text-gray-700"},[T("Type "),e("span",{class:"text-red-500"},"*")],-1)),j(e("select",{"onUpdate:modelValue":$[1]||($[1]=l=>I.value.type=l),"aria-invalid":!!E.value.type,class:oe(["w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",E.value.type?"border-red-500":"border-gray-300"])},[(m(),v(H,null,ee(x,l=>e("option",{key:l,value:l},b(l),9,dl)),64))],10,ul),[[se,I.value.type]]),E.value.type?(m(),v("p",cl,b(E.value.type),1)):M("",!0)]),e("div",null,[$[7]||($[7]=e("label",{class:"block mb-1 font-medium text-gray-700"},"Status",-1)),j(e("select",{"onUpdate:modelValue":$[2]||($[2]=l=>I.value.status=l),"aria-invalid":!!E.value.status,class:oe(["w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",E.value.status?"border-red-500":"border-gray-300"])},[(m(),v(H,null,ee(["draft","published","archived"],l=>e("option",{key:l,value:l},b(l),9,vl)),64))],10,ml),[[se,I.value.status]]),E.value.status?(m(),v("p",pl,b(E.value.status),1)):M("",!0)]),e("div",fl,[$[8]||($[8]=e("label",{class:"block mb-1 font-medium text-gray-700"},[T("Title "),e("span",{class:"text-red-500"},"*")],-1)),j(e("input",{"onUpdate:modelValue":$[3]||($[3]=l=>I.value.title=l),"aria-invalid":!!E.value.title,placeholder:"Document title",class:oe(["w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",E.value.title?"border-red-500":"border-gray-300"])},null,10,bl),[[Y,I.value.title]]),E.value.title?(m(),v("p",gl,b(E.value.title),1)):M("",!0)]),e("div",xl,[$[9]||($[9]=e("label",{class:"block mb-1 font-medium text-gray-700"},[T("Content "),e("span",{class:"text-red-500"},"*")],-1)),e("div",{class:oe(["rounded-lg border",E.value.content?"border-red-500":"border-gray-300"])},[W(P(Zn),{modelValue:I.value.content,"onUpdate:modelValue":$[4]||($[4]=l=>I.value.content=l),init:P(z),onInit:P(p),"tinymce-script-src":"/tinymce/tinymce.min.js",licenseKey:"gpl"},null,8,["modelValue","init","onInit"])],2),E.value.content?(m(),v("p",yl,b(E.value.content),1)):M("",!0)]),e("div",hl,[$[10]||($[10]=e("label",{class:"block mb-1 font-medium text-gray-700"},"Document Date",-1)),j(e("input",{"onUpdate:modelValue":$[5]||($[5]=l=>I.value.doc_date=l),type:"date",class:"w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 border-gray-300"},null,512),[[Y,I.value.doc_date]])])])]),e("div",wl,[e("button",{type:"button",class:"px-4 py-2 rounded-lg text-xs border border-gray-300 hover:bg-gray-100 transition",onClick:R}," Cancel "),j((m(),v("button",{type:"button",class:oe(["px-4 py-2 rounded-lg text-xs",u.mode==="edit"?"bg-emerald-600 text-white hover:bg-emerald-700":"bg-blue-600 text-white hover:bg-blue-700"])},[T(b(F.value),1)],2)),[[g,N]])])])])])):M("",!0)}}},Cl={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},_l={class:"bg-white p-4 rounded shadow-lg w-[900px] max-h-screen overflow-auto"},$l={class:"flex items-center justify-between"},kl={class:"text-lg font-semibold"},Sl={class:"text-gray-600"},Vl={class:"flex items-center gap-2"},Dl={class:"mt-3 flex flex-col gap-2"},Ul={class:"flex items-center gap-2"},Al=["value"],El=["value"],Bl={class:"text-[12px] text-gray-600"},Il={class:"space-y-2 mt-4 max-h-[60vh] overflow-y-auto pr-2 -mr-2"},Ll={class:"text-sm"},Ml={class:"flex flex-wrap items-center gap-2"},Ol={class:"font-semibold"},jl={class:"px-2 py-[2px] text-[11px] rounded bg-indigo-100 text-indigo-700 uppercase"},Pl={class:"text-xs text-gray-600"},Rl={class:"shrink-0 flex items-center gap-2"},Tl=["onClick"],Fl=["onClick"],zl={class:"flex justify-between items-center mt-3 text-xs text-gray-600"},fe=10,Nl={__name:"ClubDocsModal",props:{modelValue:{type:Boolean,default:!1},clubId:{type:[Number,String],required:!0},clubName:{type:String,default:""}},emits:["update:modelValue"],setup(n,{emit:y}){const a=n,x=y,u=ht(),D=q({get:()=>a.modelValue,set:C=>x("update:modelValue",C)}),o=A([]),s=A(1),p=A(""),w=A("all"),O=A("all"),z=["cbl","resolution","minute"],I=["draft","published","archived"],E=["cbl","resolution","minute"],J=C=>E.includes((C||"").toLowerCase())?(C||"").toLowerCase():"cbl",F=C=>{const S=J(C),f=z.indexOf(S);return f===-1?999:f},K=(C,S)=>{if(!S)return!0;const f=(C.title||"").toLowerCase(),t=(C.content||"").toLowerCase();return f.includes(S)||t.includes(S)},N=q(()=>{const C=p.value.trim().toLowerCase();let S=o.value||[];return w.value!=="all"&&(S=S.filter(f=>(f.type||"").toLowerCase()===w.value)),O.value!=="all"&&(S=S.filter(f=>(f.status||"").toLowerCase()===O.value)),C&&(S=S.filter(f=>K(f,C))),S.slice().sort((f,t)=>{const _=F(f.type),h=F(t.type);if(_!==h)return _-h;const G=f.doc_date||f.created_at,le=t.doc_date||t.created_at,Z=G?new Date(G).getTime():0;return(le?new Date(le).getTime():0)-Z})}),R=q(()=>{const C=N.value.length,S=Math.ceil(Math.max(C,1)/fe),f=Math.min(s.value,S||1),t=(f-1)*fe,_=N.value.slice(t,t+fe);return{total:C,totalPages:S,currentPage:f,pageSize:fe,data:_}});te([p,w,O],()=>s.value=1);const V=async()=>{p.value="",w.value="all",O.value="all",s.value=1,await u.fetchByClub(a.clubId,{page:1,limit:200}),o.value=Array.isArray(u.docs?.data)?u.docs.data:[]},$=A(!1),g=A(!1),l=A(null),Q=()=>{$.value=!0},L=async C=>{const S=await u.create({...C,club_id:a.clubId});o.value.unshift(S),$.value=!1},X=()=>{},ue=C=>{l.value={id:C.id,type:C.type||"cbl",title:C.title||"",content:C.content||"",status:C.status||"draft",doc_date:C.doc_date?String(C.doc_date).slice(0,10):""},g.value=!0},U=async C=>{const{id:S,...f}=C,t=await u.updateById(S,{...f}),_=o.value.findIndex(h=>h.id===S);_!==-1&&(o.value[_]=t),g.value=!1},d=()=>{},k=async C=>{(await ae.fire({title:`Delete document "${C.title}"?`,text:"This cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it",cancelButtonText:"Cancel"})).isConfirmed&&(await u.deleteById(C.id),o.value=o.value.filter(f=>f.id!==C.id),await ae.fire("Deleted!","The document has been deleted.","success"))};return te(()=>a.modelValue,C=>{C&&V()},{immediate:!1}),(C,S)=>D.value?(m(),v("div",Cl,[e("div",_l,[e("div",$l,[e("h2",kl,[S[8]||(S[8]=T("Club Documents — ",-1)),e("span",Sl,b(n.clubName),1)]),e("div",Vl,[e("button",{class:"px-3 py-1 text-xs bg-blue-600 text-white rounded",onClick:Q},"+ Add Document"),e("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:S[0]||(S[0]=f=>D.value=!1)},"Close")])]),e("div",Dl,[e("div",Ul,[j(e("select",{"onUpdate:modelValue":S[1]||(S[1]=f=>w.value=f),class:"border rounded px-2 py-1 text-sm"},[S[9]||(S[9]=e("option",{value:"all"},"All types",-1)),(m(),v(H,null,ee(E,f=>e("option",{key:f,value:f},b(f),9,Al)),64))],512),[[se,w.value]]),j(e("select",{"onUpdate:modelValue":S[2]||(S[2]=f=>O.value=f),class:"border rounded px-2 py-1 text-sm"},[S[10]||(S[10]=e("option",{value:"all"},"All statuses",-1)),(m(),v(H,null,ee(I,f=>e("option",{key:f,value:f},b(f),9,El)),64))],512),[[se,O.value]]),j(e("input",{"onUpdate:modelValue":S[3]||(S[3]=f=>p.value=f),type:"text",placeholder:"Search documents by title or content…",class:"border rounded px-2 py-1 text-sm w-full"},null,512),[[Y,p.value]])]),e("div",Bl," Showing "+b(R.value.total)+" document(s). Ordered by type → date. ",1)]),e("div",Il,[(m(!0),v(H,null,ee(R.value.data,f=>(m(),v("div",{key:f.id,class:"border rounded p-3 bg-gray-50 flex items-start justify-between gap-4"},[e("div",Ll,[e("div",Ml,[e("span",Ol,b(f.title),1),e("span",jl,b(f.type),1),e("span",{class:oe(["px-2 py-[2px] text-[11px] rounded",{"bg-yellow-100 text-yellow-700":f.status==="draft","bg-emerald-100 text-emerald-700":f.status==="published","bg-gray-200 text-gray-700":f.status==="archived"}])},b(f.status),3),e("span",Pl,b(f.doc_date?new Date(f.doc_date).toLocaleDateString():f.created_at?new Date(f.created_at).toLocaleDateString():"—"),1)])]),e("div",Rl,[e("button",{class:"px-2 py-1 bg-amber-500 hover:bg-amber-600 text-white rounded text-xs",onClick:t=>ue(f)},"Edit",8,Tl),e("button",{class:"px-2 py-1 bg-red-600 text-white rounded text-xs",onClick:t=>k(f)},"Delete",8,Fl)])]))),128))]),e("div",zl,[s.value>1?(m(),v("button",{key:0,onClick:S[4]||(S[4]=f=>s.value=s.value-1),class:"px-3 py-1 bg-gray-300 rounded"},"Previous")):M("",!0),e("div",null,"Page "+b(R.value.currentPage)+" of "+b(R.value.totalPages||1),1),s.value<R.value.totalPages?(m(),v("button",{key:1,onClick:S[5]||(S[5]=f=>s.value=s.value+1),class:"px-3 py-1 bg-gray-300 rounded"},"Next")):M("",!0)])]),W(Me,{modelValue:$.value,"onUpdate:modelValue":S[6]||(S[6]=f=>$.value=f),mode:"create",initial:{type:"cbl",title:"",content:"",status:"draft",doc_date:""},onSubmit:L,onClosed:X},null,8,["modelValue"]),W(Me,{modelValue:g.value,"onUpdate:modelValue":S[7]||(S[7]=f=>g.value=f),mode:"edit",initial:l.value||{id:null,type:"cbl",title:"",content:"",status:"draft",doc_date:""},onSubmit:U,onClosed:d},null,8,["modelValue","initial"])])):M("",!0)}},Wl={class:"flex items-center gap-1 md:gap-2"},Kl=["aria-expanded"],Gl={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24","aria-hidden":"true"},ql=["d"],Jl={__name:"ClubRowActions",props:{row:{type:Object,required:!0}},emits:["members","docs","edit","delete","view","attachments"],setup(n,{emit:y}){const a=A(!1),x=A(null),u=A(null),D=o=>{if(!a.value)return;const s=x.value,p=u.value;s&&!s.contains(o.target)&&p&&!p.contains(o.target)&&(a.value=!1)};return ye(()=>{document.addEventListener("click",D)}),je(()=>{document.removeEventListener("click",D)}),(o,s)=>(m(),v("div",Wl,[W(ve,{"icon-path":P(He),color:"text-indigo-600",label:"Attachments",tooltip:"Attachments",size:"sm",onClick:s[0]||(s[0]=p=>o.$emit("attachments",n.row))},null,8,["icon-path"]),W(ve,{"icon-path":P(Xe),color:"text-gray-700",label:"View",tooltip:"View Club",size:"sm",onClick:s[1]||(s[1]=p=>o.$emit("view",n.row))},null,8,["icon-path"]),W(ve,{"icon-path":P(Qe),color:"text-blue-600",label:"Members",tooltip:"View Members",size:"sm",onClick:s[2]||(s[2]=p=>o.$emit("members",n.row))},null,8,["icon-path"]),W(ve,{"icon-path":P(Ze),color:"text-indigo-600",label:"Docs",tooltip:"View Documents",size:"sm",onClick:s[3]||(s[3]=p=>o.$emit("docs",n.row))},null,8,["icon-path"]),W(ve,{"icon-path":P(et),color:"text-emerald-600",label:"Edit",tooltip:"Edit Club",size:"sm",onClick:s[4]||(s[4]=p=>o.$emit("edit",n.row))},null,8,["icon-path"]),o.$attrs.moderator?(m(),xe(ve,{key:0,"icon-path":P(Pe),color:"text-red-600",label:"Delete",tooltip:"Delete Club",size:"sm",onClick:s[5]||(s[5]=p=>o.$emit("delete",n.row))},null,8,["icon-path"])):M("",!0),e("div",{class:"relative md:hidden",ref_key:"btnRef",ref:u},[e("button",{class:"inline-flex items-center justify-center rounded-xl p-1.5 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-1","aria-expanded":a.value,"aria-haspopup":"menu",title:"More",onClick:s[6]||(s[6]=p=>a.value=!a.value)},[(m(),v("svg",Gl,[e("path",{d:P(tt)},null,8,ql)]))],8,Kl),a.value?(m(),v("div",{key:0,ref_key:"menuRef",ref:x,role:"menu",class:"absolute right-0 z-20 mt-1 w-40 overflow-hidden rounded-xl border bg-white shadow-lg"},[e("button",{role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:s[7]||(s[7]=p=>{a.value=!1,o.$emit("attachments",n.row)})}," Attachments "),e("button",{role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:s[8]||(s[8]=p=>{a.value=!1,o.$emit("view",n.row)})}," View Club "),e("button",{role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:s[9]||(s[9]=p=>{a.value=!1,o.$emit("members",n.row)})}," View Members "),e("button",{role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:s[10]||(s[10]=p=>{a.value=!1,o.$emit("docs",n.row)})}," View Documents "),e("button",{role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:s[11]||(s[11]=p=>{a.value=!1,o.$emit("edit",n.row)})}," Edit Club "),o.$attrs.moderator?(m(),v("button",{key:0,role:"menuitem",class:"w-full px-3 py-2 text-left text-sm text-red-600 hover:bg-red-50",onClick:s[12]||(s[12]=p=>{a.value=!1,o.$emit("delete",n.row)})}," Delete ")):M("",!0)],512)):M("",!0)],512)]))}},Yl={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},Hl={class:"bg-white p-4 rounded-xl shadow-xl w-[980px] max-h-screen overflow-auto"},Xl={class:"flex items-center justify-between mb-3"},Ql={class:"text-lg font-semibold"},Zl={class:"text-gray-600"},eo={class:"flex items-center justify-between gap-2"},to={class:"text-sm text-gray-600"},no={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},lo=["d"],oo=["disabled"],ao={class:"mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"},so={class:"aspect-video bg-white border rounded overflow-hidden flex items-center justify-center"},io=["src"],ro={key:1,class:"flex items-center justify-center w-full h-full"},uo=["d"],co={class:"mt-2 text-xs"},mo=["title"],vo={class:"text-gray-500 flex items-center justify-between"},po={key:0},fo={key:0},bo={class:"mt-2 flex items-center justify-between gap-2"},go=["onClick","title"],xo={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},yo=["d"],ho=["onClick"],wo={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},Co=["d"],_o={key:0,class:"mt-6 text-center text-sm text-gray-500"},$o=10*1024*1024,ko={__name:"ClubAttachmentsModal",props:{modelValue:{type:Boolean,default:!1},row:{type:Object,default:null}},emits:["update:modelValue"],setup(n,{emit:y}){const a=n,x=y,u=q({get:()=>a.modelValue,set:t=>x("update:modelValue",t)}),D=he(),o=A(null),s=A(!1),p=new Set(["image/png","image/jpeg","image/webp","application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]),w=new Set(["png","jpg","jpeg","webp","pdf","docx","xlsx"]),O=(t="")=>{const _=String(t).toLowerCase().match(/\.([a-z0-9]+)$/i);return _?_[1]:""},z=(t="")=>{if(typeof t!="string")return"";const _=t.match(/^data:([^;]+);base64,/i);return _?_[1]:""},I=t=>{const _=t?.type&&p.has(t.type),h=t?.name&&w.has(O(t.name));return _||h},E=(t="")=>String(t).startsWith("image/"),J=(t="")=>t==="application/pdf",F=(t="")=>t==="application/vnd.openxmlformats-officedocument.wordprocessingml.document",K=(t="")=>t==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",N=(t="")=>J(t)?at:F(t)?st:K(t)?it:E(t)?rt:ut,R=(t="")=>J(t)?"PDF":F(t)?"Word":K(t)?"Excel":E(t)?"Image":"File",V=(t="")=>J(t)?"pdf":F(t)?"docx":K(t)?"xlsx":t==="image/png"?"png":t==="image/jpeg"?"jpg":t==="image/webp"?"webp":"",$=(t="attachment",_="")=>{const h=/\.[a-z0-9]+$/i.test(t),G=_?_.startsWith(".")?_.slice(1):_:"";return h?t:G?`${t}.${G}`:t},g=t=>!t&&t!==0?"":t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`,l=q(()=>{const t=o.value?.attachments;if(!t)return[];try{return Array.isArray(t)?t:JSON.parse(t||"[]")}catch{return[]}}),Q=q(()=>(l.value||[]).map((t,_)=>{const h=t.mime||z(t.data)||(t.name?O(t.name)==="pdf"&&"application/pdf":"")||"",G=O(t.name||"")||V(h),le=t.size??null,Z=t.name||`${R(h)} ${_+1}`;return{id:t.id??_+1,name:Z,data:t.data||"",url:t.url||t.href||t.path||"",mime:h,ext:G,size:le,filename:$(Z,G)}}));te(()=>a.modelValue,async t=>{t&&a.row?.id&&(await D.fetchById(a.row.id),o.value=D.selectedClub||a.row)},{immediate:!1});const L=async t=>{const _=t.target.files?.[0];if(t.target.value="",!(!_||!o.value?.id)){if(_.size>$o){await ae.fire("File too large","Maximum size is 10 MB.","warning");return}if(!I(_)){await ae.fire("Unsupported file","Only images (PNG/JPEG/WEBP), PDF, DOCX, and XLSX are allowed.","warning");return}try{s.value=!0,await D.uploadAttachment(o.value.id,_),await D.fetchById(o.value.id),o.value=D.selectedClub}finally{s.value=!1}}},X=async t=>{!o.value?.id||!(await ae.fire({title:"Remove attachment?",icon:"warning",showCancelButton:!0,confirmButtonText:"Remove",confirmButtonColor:"#d33"})).isConfirmed||(await D.deleteAttachment(o.value.id,t),await D.fetchById(o.value.id),o.value=D.selectedClub)},ue=t=>{if(t.data&&String(t.data).startsWith("data:")&&E(t.mime)){const _=window.open();_&&_.document.write(`<img src="${t.data}" style="display:block;max-width:100%;height:auto;margin:0 auto;object-fit:contain"/>`);return}t.url&&window.open(String(t.url),"_blank")},U=t=>{const[_,h]=t.split(","),G=_.match(/data:([^;]+);base64/i)?.[1]||"application/octet-stream",le=atob(h),Z=le.length,ie=new Uint8Array(Z);for(let me=0;me<Z;me++)ie[me]=le.charCodeAt(me);return new Blob([ie],{type:G})},d=(t,_)=>{const h=URL.createObjectURL(t),G=document.createElement("a");G.href=h,G.download=_||"download",document.body.appendChild(G),G.click(),G.remove(),setTimeout(()=>URL.revokeObjectURL(h),1e3)},k=async t=>{if(t.data&&String(t.data).startsWith("data:")){const _=U(t.data);d(_,t.filename);return}if(t.url)try{const h=await(await fetch(t.url,{credentials:"include"})).blob();d(h,t.filename)}catch{const h=document.createElement("a");h.href=String(t.url),h.setAttribute("download",t.filename),document.body.appendChild(h),h.click(),h.remove()}},C=t=>E(t.mime)?"Open":"Download",S=t=>E(t.mime)?lt:ot,f=t=>E(t.mime)?ue(t):k(t);return(t,_)=>u.value?(m(),v("div",Yl,[e("div",Hl,[e("div",Xl,[e("h2",Ql,[_[1]||(_[1]=T(" Attachments — ",-1)),e("span",Zl,b(o.value?.name||""),1)]),e("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:_[0]||(_[0]=h=>u.value=!1)},"Close")]),e("div",eo,[e("div",to,[_[2]||(_[2]=T(" Ref: ",-1)),e("strong",null,b(o.value?.code||"—"),1)]),e("label",{class:oe(["inline-flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white rounded text-xs cursor-pointer disabled:opacity-60",{"opacity-60 pointer-events-none":s.value}])},[(m(),v("svg",no,[e("path",{d:P(nt)},null,8,lo)])),e("span",null,b(s.value?"Uploading…":"Upload"),1),e("input",{type:"file",class:"hidden",disabled:s.value,onChange:L,accept:".png,.jpg,.jpeg,.webp,.pdf,.docx,.xlsx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,image/png,image/jpeg,image/webp"},null,40,oo)],2)]),e("div",ao,[(m(!0),v(H,null,ee(Q.value,h=>(m(),v("div",{key:h.id,class:"border rounded-lg p-2 bg-gray-50 flex flex-col"},[e("div",so,[E(h.mime)&&h.data&&h.data.startsWith("data:")?(m(),v("img",{key:0,src:h.data,class:"object-contain w-full h-full",alt:"Attachment preview"},null,8,io)):(m(),v("div",ro,[(m(),v("svg",{style:{width:"64px",height:"64px"},viewBox:"0 0 24 24","aria-hidden":"true",class:oe({"text-red-600":J(h.mime),"text-blue-600":F(h.mime),"text-emerald-600":K(h.mime),"text-gray-500":!h.mime||!E(h.mime)&&!J(h.mime)})},[e("path",{d:N(h.mime)},null,8,uo)],2))]))]),e("div",co,[e("div",{class:"font-medium truncate",title:h.name},b(h.name),9,mo),e("div",vo,[e("span",null,[T(b(R(h.mime))+" ",1),h.ext?(m(),v("span",po,"("+b(h.ext.toUpperCase())+")",1)):M("",!0)]),h.size?(m(),v("span",fo,b(g(h.size)),1)):M("",!0)])]),e("div",bo,[e("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-white border rounded text-xs hover:bg-gray-50",onClick:G=>f(h),title:C(h)},[(m(),v("svg",xo,[e("path",{d:S(h)},null,8,yo)])),T(" "+b(C(h)),1)],8,go),e("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-red-600 text-white rounded text-xs",onClick:G=>X(h.id),title:"Remove"},[(m(),v("svg",wo,[e("path",{d:P(Pe)},null,8,Co)])),_[3]||(_[3]=T(" Remove ",-1))],8,ho)])]))),128))]),Q.value.length?M("",!0):(m(),v("div",_o," No attachments yet. "))])])):M("",!0)}},So={class:"flex items-center gap-2"},Vo={class:"p-3 mb-4 rounded-xl border bg-white/60"},Do={class:"flex items-center gap-2 mb-2 text-gray-700"},Uo={class:"w-4 h-4",viewBox:"0 0 24 24"},Ao=["d"],Eo={class:"grid grid-cols-1 md:grid-cols-6 gap-2 text-sm"},Bo={class:"flex items-center gap-2 md:col-span-2"},Go={__name:"ClubsOrganizationPage",setup(n){const y=Je(),a=he(),x=A({page:1,limit:10,sort:"established_at",order:"DESC",q:"",name:"",code:"",category:"",is_active:""}),u=async(U={},d=!0)=>{x.value={...x.value,...U},typeof x.value.officer>"u"&&(x.value.officer=!0);const k={...x.value};k.is_active===""?delete k.is_active:k.is_active=k.is_active===!0||k.is_active==="true",["q","name","code","category"].forEach(C=>{(k[C]===""||k[C]==null)&&delete k[C]}),await a.fetchAll(k,d)};ye(()=>u({page:1,limit:10}));const D=q(()=>({total:a.clubs.total||0,totalPages:a.clubs.totalPages||1,currentPage:a.clubs.currentPage||1,pageSize:a.clubs.pageSize||10,data:a.clubs.data||[]})),o=A(!1),s=A(null),p=async U=>{await a.fetchById(U.id),s.value=a.selectedClub||U,o.value=!0},w=A(!1),O=A(!1),z=A(null),I=()=>{w.value=!0},E=async U=>{await a.create(U),w.value=!1,await u(x.value,!0)},J=async U=>{await a.fetchById(U.id);const d=a.selectedClub||U;z.value={id:d.id,name:d.name||"",code:d.code||"",category:d.category||"",description:d.description||"",is_active:d.is_active??!0,established_at:d.established_at?String(d.established_at).slice(0,10):"",website:d.website||"",email:d.email||"",phone:d.phone||"",logo:d.logo||"",banner:d.banner||""},O.value=!0},F=async U=>{const{id:d,...k}=U;await a.updateById(d,k),O.value=!1,await u(x.value,!0)},K=async U=>{if(!U?.id)return;(await ae.fire({title:`Delete club "${U.name}"?`,text:"This cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it",cancelButtonText:"Cancel"})).isConfirmed&&(await a.deleteById(U.id),await u(x.value,!0),await ae.fire("Deleted!","The club has been deleted.","success"))},N=A(!1),R=A(!1),V=A(null),$=A(""),g=U=>{V.value=U.id,$.value=U.name||"",N.value=!0},l=U=>{V.value=U.id,$.value=U.name||"",R.value=!0},Q=U=>{U?.id&&window.open(`/#/club/${U.id}`,"_self")},L=async()=>{await u({q:"",name:"",code:"",category:"",is_active:"",page:1})},X=[{key:"name",label:"Name",sortable:!0,filterable:!0},{key:"code",label:"Code",sortable:!0,filterable:!0},{key:"category",label:"Category",sortable:!0,filterable:!0},{key:"is_active",label:"Active",sortable:!0,formatter:U=>U?"Yes":"No"}],ue=async U=>{await u(U)};return(U,d)=>(m(),v(H,null,[W(dt,null,{default:de(()=>[W(ct,null,{default:de(()=>[P(a).error?(m(),xe(xt,{key:0,icon:P(mt),color:"danger"},{default:de(()=>[T(b(P(a).error),1)]),_:1},8,["icon"])):M("",!0),W(gt,{icon:P(vt),title:"Clubs",main:""},{default:de(()=>[e("div",So,[P(y).user.role==="admin"?(m(),xe(De,{key:0,icon:P(pt),color:"primary",label:"Add Club",onClick:I},null,8,["icon"])):M("",!0),W(De,{icon:P(ft),color:"info",label:"Refresh",onClick:d[0]||(d[0]=k=>u({page:1,limit:D.value.pageSize},!0))},null,8,["icon"])])]),_:1},8,["icon"]),e("div",Vo,[e("div",Do,[(m(),v("svg",Uo,[e("path",{d:P(bt)},null,8,Ao)])),d[13]||(d[13]=e("span",{class:"font-medium text-sm"},"Filters",-1))]),e("div",Eo,[j(e("input",{"onUpdate:modelValue":d[1]||(d[1]=k=>x.value.q=k),placeholder:"Search by name, code, category…",class:"border rounded px-2 py-2 md:col-span-2",onKeyup:d[2]||(d[2]=Ye(k=>u({page:1}),["enter"]))},null,544),[[Y,x.value.q]]),j(e("input",{"onUpdate:modelValue":d[3]||(d[3]=k=>x.value.name=k),placeholder:"Name contains…",class:"border rounded px-2 py-2"},null,512),[[Y,x.value.name]]),j(e("input",{"onUpdate:modelValue":d[4]||(d[4]=k=>x.value.code=k),placeholder:"Code contains…",class:"border rounded px-2 py-2"},null,512),[[Y,x.value.code]]),j(e("input",{"onUpdate:modelValue":d[5]||(d[5]=k=>x.value.category=k),placeholder:"Category contains…",class:"border rounded px-2 py-2"},null,512),[[Y,x.value.category]]),j(e("select",{"onUpdate:modelValue":d[6]||(d[6]=k=>x.value.is_active=k),class:"border rounded px-2 py-2"},d[14]||(d[14]=[e("option",{value:""},"All status",-1),e("option",{value:!0},"Active",-1),e("option",{value:!1},"Inactive",-1)]),512),[[se,x.value.is_active]]),e("div",Bo,[e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:d[7]||(d[7]=k=>u({page:1}))}," Apply "),e("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:L}," Reset ")])])]),W(yt,{columns:X,data:D.value,loading:P(a).isLoading,onQueryChange:ue},{"cell-category":de(({value:k})=>[W(Ue,{text:k||"—",tone:"indigo"},null,8,["text"])]),"cell-is_active":de(({value:k})=>[W(Ue,{text:k?"Active":"Inactive",tone:k?"emerald":"gray"},null,8,["text","tone"])]),"cell-actions":de(({row:k})=>[W(Jl,{row:k,moderator:["admin","manager"].includes(String(P(y).user?.role||"").toLowerCase()),onView:Q,onMembers:g,onDocs:l,onEdit:J,onDelete:K,onAttachments:p},null,8,["row","moderator"])]),_:1},8,["data","loading"])]),_:1})]),_:1}),W(Ae,{modelValue:w.value,"onUpdate:modelValue":d[8]||(d[8]=k=>w.value=k),mode:"create",onSubmit:E},null,8,["modelValue"]),W(Ae,{modelValue:O.value,"onUpdate:modelValue":d[9]||(d[9]=k=>O.value=k),mode:"edit",initial:z.value||{},onSubmit:F},null,8,["modelValue","initial"]),W(Pn,{modelValue:N.value,"onUpdate:modelValue":d[10]||(d[10]=k=>N.value=k),"club-id":V.value,"club-name":$.value},null,8,["modelValue","club-id","club-name"]),W(Nl,{modelValue:R.value,"onUpdate:modelValue":d[11]||(d[11]=k=>R.value=k),"club-id":V.value,"club-name":$.value},null,8,["modelValue","club-id","club-name"]),W(ko,{modelValue:o.value,"onUpdate:modelValue":d[12]||(d[12]=k=>o.value=k),row:s.value},null,8,["modelValue","row"])],64))}};export{Go as default};
