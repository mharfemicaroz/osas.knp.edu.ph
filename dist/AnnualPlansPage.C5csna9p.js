import{c as A,r as _,o as G,E as ce,a as c,q as s,f as k,A as M,d as b,e as l,g as f,x as ie,k as I,t as B,j as re,F as q,B as H,S as x,u as me,l as z,M as pe,h as Q,L as fe,v as ve,C as oe}from"./index.Cs4GACOs.js";import{u as be,v as ye,a8 as ge,y as he,a9 as we,aa as xe,ab as Ce,z as ue,A as $e,B as ke,E as _e,F as Ae,G as Be,H as Se,I as Ve,C as je,D as Ee,_ as Fe,a as De,g as Pe,J as Re,i as ze,K as Le,L as Me,M as Te,V as Ie}from"./SectionMain.FuOYMLH7.js";import{_ as Ue,a as le}from"./SectionTitleLineWithButton.DdtbjV5M.js";import{_ as Oe,B as We,a as Ne}from"./Badge.BNRfv0xz.js";import{_ as L}from"./IconifyButton.BQVJYk0W.js";import{_ as de}from"./AnnualPlanFormModal.Citw3HrI.js";import{u as se}from"./annualPlan.CiY0R3rh.js";import{i as qe,a as Ge,b as Ye,F as Ke}from"./index.zQ0GbO5s.js";import"./activityDesignService.BUnTjc2O.js";import"./utilizationRequestService.BlPfWJ4X.js";import"./liquidationFundService.DDkmtkzo.js";import"./ToasterComponent.Bzbm0vlX.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const Xe={class:"flex items-center gap-1 md:gap-2"},Je=["aria-expanded"],Qe={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},He=["d"],Ze={__name:"AnnualPlanRowActions",props:{row:{type:Object,required:!0},moderator:{type:Boolean,default:!1}},emits:["attachments","submit","approve","reject","edit","delete","view","cancel"],setup(m,{emit:u}){const C=m,V=A(()=>String(C.row?.status||"").toLowerCase()),$=A(()=>V.value==="draft"),h=A(()=>V.value==="draft"),y=A(()=>V.value!=="draft"),w=A(()=>C.moderator&&V.value==="pending"),D=A(()=>C.moderator&&V.value==="approved"),F=A(()=>C.moderator),v=_(!1),g=_(null),p=_(null),S=i=>{if(!v.value)return;const o=g.value,d=p.value;o&&!o.contains(i.target)&&d&&!d.contains(i.target)&&(v.value=!1)};return G(()=>document.addEventListener("click",S)),ce(()=>document.removeEventListener("click",S)),(i,o)=>(s(),c("div",Xe,[k(L,{"icon-path":f(be),color:"text-indigo-600",label:"Attachments",tooltip:"Attachments",size:"sm",onClick:o[0]||(o[0]=d=>i.$emit("attachments",m.row))},null,8,["icon-path"]),y.value?(s(),M(L,{key:0,"icon-path":f(ye),color:"text-gray-700",label:"View",tooltip:"View (read-only)",size:"sm",onClick:o[1]||(o[1]=d=>i.$emit("view",m.row))},null,8,["icon-path"])):b("",!0),$.value?(s(),M(L,{key:1,"icon-path":f(ge),color:"text-blue-600",label:"Submit",tooltip:"Submit",size:"sm",onClick:o[2]||(o[2]=d=>i.$emit("submit",m.row))},null,8,["icon-path"])):b("",!0),h.value?(s(),M(L,{key:2,"icon-path":f(he),color:"text-amber-600",label:"Edit",tooltip:"Edit",size:"sm",onClick:o[3]||(o[3]=d=>i.$emit("edit",m.row))},null,8,["icon-path"])):b("",!0),w.value?(s(),M(L,{key:3,"icon-path":f(we),color:"text-emerald-600",label:"Approve",tooltip:"Approve",size:"sm",onClick:o[4]||(o[4]=d=>i.$emit("approve",m.row))},null,8,["icon-path"])):b("",!0),w.value?(s(),M(L,{key:4,"icon-path":f(xe),color:"text-rose-600",label:"Reject",tooltip:"Reject",size:"sm",onClick:o[5]||(o[5]=d=>i.$emit("reject",m.row))},null,8,["icon-path"])):b("",!0),D.value?(s(),M(L,{key:5,"icon-path":f(Ce),color:"text-orange-600",label:"Cancel",tooltip:"Cancel plan",size:"sm",onClick:o[6]||(o[6]=d=>i.$emit("cancel",m.row))},null,8,["icon-path"])):b("",!0),F.value?(s(),M(L,{key:6,"icon-path":f(ue),color:"text-red-600",label:"Delete",tooltip:"Delete",size:"sm",onClick:o[7]||(o[7]=d=>i.$emit("delete",m.row))},null,8,["icon-path"])):b("",!0),l("div",{class:"relative md:hidden",ref_key:"btnRef",ref:p},[l("button",{class:"inline-flex items-center justify-center rounded-xl p-1.5 hover:bg-gray-100","aria-expanded":v.value,"aria-haspopup":"menu",title:"More",onClick:o[8]||(o[8]=d=>v.value=!v.value)},[(s(),c("svg",Qe,[l("path",{d:f($e)},null,8,He)]))],8,Je),v.value?(s(),c("div",{key:0,ref_key:"menuRef",ref:g,role:"menu",class:"absolute right-0 z-20 mt-1 w-44 overflow-hidden rounded-xl border bg-white shadow-lg"},[l("button",{role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:o[9]||(o[9]=d=>{v.value=!1,i.$emit("attachments",m.row)})},"Attachments"),y.value?(s(),c("button",{key:0,role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:o[10]||(o[10]=d=>{v.value=!1,i.$emit("view",m.row)})},"View (read-only)")):b("",!0),$.value?(s(),c("button",{key:1,role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:o[11]||(o[11]=d=>{v.value=!1,i.$emit("submit",m.row)})},"Submit")):b("",!0),h.value?(s(),c("button",{key:2,role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:o[12]||(o[12]=d=>{v.value=!1,i.$emit("edit",m.row)})},"Edit")):b("",!0),w.value?(s(),c("button",{key:3,role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:o[13]||(o[13]=d=>{v.value=!1,i.$emit("approve",m.row)})},"Approve")):b("",!0),w.value?(s(),c("button",{key:4,role:"menuitem",class:"w-full px-3 py-2 text-left text-sm text-rose-600 hover:bg-rose-50",onClick:o[14]||(o[14]=d=>{v.value=!1,i.$emit("reject",m.row)})},"Reject")):b("",!0),D.value?(s(),c("button",{key:5,role:"menuitem",class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-50",onClick:o[15]||(o[15]=d=>{v.value=!1,i.$emit("cancel",m.row)})},"Cancel")):b("",!0),F.value?(s(),c("button",{key:6,role:"menuitem",class:"w-full px-3 py-2 text-left text-sm text-red-600 hover:bg-red-50",onClick:o[16]||(o[16]=d=>{v.value=!1,i.$emit("delete",m.row)})},"Delete")):b("",!0)],512)):b("",!0)],512)]))}},et={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},tt={class:"bg-white p-4 rounded-xl shadow-xl w-[980px] max-h-screen overflow-auto"},at={class:"flex items-center justify-between mb-3"},nt={class:"text-lg font-semibold"},ot={class:"text-gray-600"},lt={class:"flex items-center justify-between gap-2"},it={class:"text-sm text-gray-600"},st={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24"},rt=["d"],dt=["disabled"],ut={class:"mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"},ct={class:"aspect-video bg-white border rounded overflow-hidden flex items-center justify-center"},mt=["src"],pt={key:1,class:"flex items-center justify-center w-full h-full"},ft=["d"],vt={class:"mt-2 text-xs"},bt=["title"],yt={class:"text-gray-500 flex items-center justify-between"},gt={key:0},ht={key:0},wt={class:"mt-2 flex items-center justify-between gap-2"},xt=["onClick","title"],Ct={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24"},$t=["d"],kt=["onClick"],_t={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24"},At=["d"],Bt={key:0,class:"mt-6 text-center text-sm text-gray-500"},St=10*1024*1024,Vt={__name:"AnnualPlanAttachmentsModal",props:{modelValue:{type:Boolean,default:!1},row:{type:Object,default:null}},emits:["update:modelValue"],setup(m,{emit:u}){const C=m,V=u,$=A({get:()=>C.modelValue,set:e=>V("update:modelValue",e)}),h=se(),y=_(null),w=_(!1),D=new Set(["image/png","image/jpeg","image/webp","application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]),F=new Set(["png","jpg","jpeg","webp","pdf","docx","xlsx"]),v=(e="")=>String(e).toLowerCase().match(/\.([a-z0-9]+)$/i)?.[1]||"",g=(e="")=>typeof e=="string"&&e.match(/^data:([^;]+);base64,/i)?.[1]||"",p=e=>e?.type&&D.has(e.type)||e?.name&&F.has(v(e.name)),S=(e="")=>String(e).startsWith("image/"),i=(e="")=>e==="application/pdf",o=(e="")=>e==="application/vnd.openxmlformats-officedocument.wordprocessingml.document",d=(e="")=>e==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",U=(e="")=>i(e)?_e:o(e)?Ae:d(e)?Be:S(e)?Se:Ve,T=(e="")=>i(e)?"PDF":o(e)?"Word":d(e)?"Excel":S(e)?"Image":"File",j=(e="")=>i(e)?"pdf":o(e)?"docx":d(e)?"xlsx":e==="image/png"?"png":e==="image/jpeg"?"jpg":e==="image/webp"?"webp":"",P=(e="attachment",r="")=>/\.[a-z0-9]+$/i.test(e)?e:r?`${e}.${r.startsWith(".")?r.slice(1):r}`:e,R=e=>e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(1)} MB`,O=A(()=>{const e=y.value?.attachments;if(!e)return[];try{return Array.isArray(e)?e:JSON.parse(e||"[]")}catch{return[]}}),Y=A(()=>(O.value||[]).map((e,r)=>{const a=e.mime||g(e.data)||"",t=v(e.name||"")||j(a),n=e.size??null,E=e.name||`${T(a)} ${r+1}`;return{id:e.id??r+1,name:E,data:e.data||"",url:e.url||e.href||e.path||"",mime:a,ext:t,size:n,filename:P(E,t)}}));ie(()=>C.modelValue,async e=>{e&&C.row?.id&&(await h.fetchById(C.row.id),y.value=h.selected||C.row)});const W=async e=>{const r=e.target.files?.[0];if(e.target.value="",!(!r||!y.value?.id)){if(r.size>St){await x.fire("File too large","Maximum size is 10 MB.","warning");return}if(!p(r)){await x.fire("Unsupported file","Only images, PDF, DOCX, XLSX allowed.","warning");return}try{w.value=!0,await h.uploadAttachment(y.value.id,r),await h.fetchById(y.value.id),y.value=h.selected}finally{w.value=!1}}},Z=async e=>{!y.value?.id||!(await x.fire({title:"Remove attachment?",icon:"warning",showCancelButton:!0,confirmButtonText:"Remove",confirmButtonColor:"#d33"})).isConfirmed||(await h.deleteAttachment(y.value.id,e),await h.fetchById(y.value.id),y.value=h.selected)},ee=e=>{if(e.data&&String(e.data).startsWith("data:")&&S(e.mime)){const r=window.open();r&&r.document.write(`<img src="${e.data}" style="display:block;max-width:100%;height:auto;margin:0 auto;object-fit:contain"/>`);return}e.url&&window.open(String(e.url),"_blank")},te=e=>{const[r,a]=e.split(","),t=r.match(/data:([^;]+);base64/i)?.[1]||"application/octet-stream",n=atob(a),E=new Uint8Array(n.length);for(let J=0;J<n.length;J++)E[J]=n.charCodeAt(J);return new Blob([E],{type:t})},K=(e,r)=>{const a=URL.createObjectURL(e),t=document.createElement("a");t.href=a,t.download=r||"download",document.body.appendChild(t),t.click(),t.remove(),setTimeout(()=>URL.revokeObjectURL(a),1e3)},ae=async e=>{if(e.data&&String(e.data).startsWith("data:")){K(te(e.data),e.filename);return}if(e.url)try{const a=await(await fetch(e.url,{credentials:"include"})).blob();K(a,e.filename)}catch{const r=document.createElement("a");r.href=String(e.url),r.setAttribute("download",e.filename),document.body.appendChild(r),r.click(),r.remove()}},X=e=>S(e.mime)?"Open":"Download",ne=e=>S(e.mime)?je:Ee,N=e=>S(e.mime)?ee(e):ae(e);return(e,r)=>$.value?(s(),c("div",et,[l("div",tt,[l("div",at,[l("h2",nt,[r[1]||(r[1]=I(" Annual Plan Attachments — ",-1)),l("span",ot,B(y.value?.reference_code||""),1)]),l("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:r[0]||(r[0]=a=>$.value=!1)},"Close")]),l("div",lt,[l("div",it,[r[2]||(r[2]=I(" School Year: ",-1)),l("strong",null,B(y.value?.school_year||"—"),1)]),l("label",{class:re(["inline-flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white rounded text-xs cursor-pointer disabled:opacity-60",{"opacity-60 pointer-events-none":w.value}])},[(s(),c("svg",st,[l("path",{d:f(ke)},null,8,rt)])),l("span",null,B(w.value?"Uploading…":"Upload"),1),l("input",{type:"file",class:"hidden",disabled:w.value,onChange:W,accept:".png,.jpg,.jpeg,.webp,.pdf,.docx,.xlsx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,image/png,image/jpeg,image/webp"},null,40,dt)],2)]),l("div",ut,[(s(!0),c(q,null,H(Y.value,a=>(s(),c("div",{key:a.id,class:"border rounded-lg p-2 bg-gray-50 flex flex-col"},[l("div",ct,[a.data&&a.data.startsWith("data:")&&a.mime?.startsWith("image/")?(s(),c("img",{key:0,src:a.data,class:"object-contain w-full h-full",alt:"Attachment preview"},null,8,mt)):(s(),c("div",pt,[(s(),c("svg",{style:{width:"64px",height:"64px"},viewBox:"0 0 24 24",class:re({"text-red-600":a.mime==="application/pdf","text-blue-600":a.mime==="application/vnd.openxmlformats-officedocument.wordprocessingml.document","text-emerald-600":a.mime==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text-gray-500":!a.mime||!a.mime.startsWith("image/")&&a.mime!=="application/pdf"})},[l("path",{d:U(a.mime)},null,8,ft)],2))]))]),l("div",vt,[l("div",{class:"font-medium truncate",title:a.name},B(a.name),9,bt),l("div",yt,[l("span",null,[I(B(T(a.mime))+" ",1),a.ext?(s(),c("span",gt,"("+B(a.ext.toUpperCase())+")",1)):b("",!0)]),a.size?(s(),c("span",ht,B(R(a.size)),1)):b("",!0)])]),l("div",wt,[l("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-white border rounded text-xs hover:bg-gray-50",onClick:t=>N(a),title:X(a)},[(s(),c("svg",Ct,[l("path",{d:ne(a)},null,8,$t)])),I(" "+B(X(a)),1)],8,xt),l("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-red-600 text-white rounded text-xs",onClick:t=>Z(a.id),title:"Remove"},[(s(),c("svg",_t,[l("path",{d:f(ue)},null,8,At)])),r[3]||(r[3]=I(" Remove ",-1))],8,kt)])]))),128))]),Y.value.length?b("",!0):(s(),c("div",Bt," No attachments yet. "))])])):b("",!0)}},jt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/35 backdrop-blur-sm"},Et={class:"bg-white rounded-2xl shadow-2xl w-full sm:w-[1200px] max-w-[100vw] sm:max-w-[95vw] h-[100vh] sm:h-auto sm:max-h-[90vh] overflow-hidden"},Ft={class:"px-4 py-3 border-b flex items-center justify-between"},Dt={class:"p-2 overflow-auto"},Pt={__name:"AnnualPlansCalendarModal",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","open"],setup(m,{emit:u}){const C=m,V=u,$=A({get:()=>C.modelValue,set:i=>V("update:modelValue",i)}),h=se(),y=_([]),w=i=>{if(Array.isArray(i))return i;try{return JSON.parse(i||"[]")}catch{return[]}},D=(i=[])=>{const o=[];i.forEach(d=>{const U=w(d.plans),T=d.club?.name?`[${d.club.name}] `:"";U.forEach((j,P)=>{const R=j?.date_of_implementation;if(!R)return;const O=`${T}${j.item||"Planned Activity"}`;o.push({id:`${d.id}-${P}`,title:O,start:`${R}T00:00:00`,end:`${R}T23:59:59`,backgroundColor:"#b45309",borderColor:"#92400e",textColor:"#ffffff",extendedProps:{annual_plan_id:d.id,reference_code:d.reference_code,school_year:d.school_year,funds:j?.funds??0,status:d.status}})})}),y.value=o},F=async()=>{await h.fetchAll({page:1,limit:500,status:"approved",sort:"created_at",order:"ASC"},!0),D(h.items.data||[])},v=i=>{const o=i?.event?.extendedProps?.annual_plan_id;o&&V("open",Number(o))},g=_(!1),p=()=>{g.value=window.innerWidth<640};G(()=>{p(),window.addEventListener("resize",p)});const S=A(()=>({plugins:[qe,Ge,Ye],initialView:"dayGridMonth",headerToolbar:g.value?{left:"prev,next",center:"title",right:"dayGridMonth"}:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},height:"auto",handleWindowResize:!0,expandRows:!0,navLinks:!0,eventDisplay:"block",eventClick:v,events:y.value}));return ie(()=>C.modelValue,i=>{i&&F()}),ie(()=>h.items.data,i=>{$.value&&D(i||[])},{deep:!0}),G(()=>{$.value&&F()}),(i,o)=>$.value?(s(),c("div",jt,[l("div",Et,[l("div",Ft,[o[1]||(o[1]=l("h2",{class:"text-base font-semibold"},"Annual Plans Calendar (Approved)",-1)),l("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:o[0]||(o[0]=d=>$.value=!1)},"Close")]),l("div",Dt,[k(f(Ke),{options:S.value},null,8,["options"])]),o[2]||(o[2]=l("div",{class:"px-4 py-2 text-[11px] text-gray-500 border-t"}," Click a plan item to open its Annual Plan. ",-1))])])):b("",!0)}},Rt={class:"flex flex-wrap items-center gap-2 w-full sm:w-auto justify-start sm:justify-end"},zt={class:"p-3 mb-4 rounded-xl border bg-white/60"},Lt={class:"flex items-center gap-2 mb-2 text-gray-700"},Mt={class:"w-4 h-4",viewBox:"0 0 24 24"},Tt=["d"],It={class:"grid grid-cols-1 md:grid-cols-6 gap-2 text-sm"},Ut={class:"md:col-span-2 flex"},Ot={class:"w-5 h-5",viewBox:"0 0 24 24"},Wt=["d"],Nt=["value"],qt=["disabled"],Gt=["value"],Yt=["value"],Kt={class:"flex items-center gap-2 md:col-span-2"},Xt={class:"font-medium"},da={__name:"AnnualPlansPage",setup(m){const u=se(),C=me(),V=A(()=>["admin","manager"].includes(String(C.user?.role||"").toLowerCase())),$=_(!1),h=()=>{$.value=!0},y=async a=>{try{await u.fetchById(a);const t=u.selected;t&&await W(t)}catch(t){console.error(t)}finally{$.value=!1}},w=_([]);G(async()=>{try{const{data:a}=await pe.get("/clubs",{params:{page:1,limit:500,order:"ASC",sort:"name"}});w.value=Array.isArray(a?.data)?a.data:[]}catch{w.value=[]}});const F=a=>w.value.find(t=>t.id===Number(a))?.name||"—",v=A(()=>{const a=new Date().getFullYear();return Array.from({length:6},(t,n)=>`${a-n}-${a-n+1}`)}),g=_({page:1,limit:10,sort:"created_at",order:"DESC",q:"",status:"",school_year:"",club_id:"",filed_by_user_id:"",approver_user_id:""}),p=async(a={},t=!0)=>{g.value={...g.value,...a};const n={...g.value};["q","status","school_year","club_id","filed_by_user_id","approver_user_id"].forEach(E=>{(n[E]===""||n[E]==null)&&delete n[E]}),await u.fetchAll(n,t)};G(async()=>{await p({page:1,limit:10})});const S=A(()=>({total:u.items.total||0,totalPages:u.items.totalPages||1,currentPage:u.items.currentPage||1,pageSize:u.items.pageSize||10,data:u.items.data||[]})),i=["draft","pending","approved","rejected","cancelled","archived"],o=a=>{switch(String(a||"").toLowerCase()){case"draft":return"gray";case"pending":return"amber";case"approved":return"emerald";case"rejected":return"red";case"cancelled":return"zinc";case"archived":return"slate";default:return"gray"}},d=a=>{const t=Number(a);return Number.isFinite(t)?t.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):"—"},U=[{key:"reference_code",label:"Ref Code",sortable:!0,width:140},{key:"school_year",label:"School Year",sortable:!0,width:120},{key:"club",label:"Club",sortable:!1,minWidth:200,formatter:(a,t)=>t.club?.name||F(t.club_id)||""},{key:"total_budget",label:"Total Budget",sortable:!0,width:140},{key:"status",label:"Status",sortable:!0,width:110},{key:"created_at",label:"Created",sortable:!0,width:170}],T=async a=>{await p(a)},j=_(!1),P=_(!1),R=_(null),O=()=>{j.value=!0},Y=async a=>{await u.create(a),j.value=!1,await p({},!0)},W=async a=>{await u.fetchById(a.id);const t=u.selected||a;let n=[];try{n=Array.isArray(t.plans)?t.plans:JSON.parse(t.plans||"[]")}catch{}R.value={id:t.id,reference_code:t.reference_code,school_year:t.school_year||"",club_id:t.club_id||"",filed_by_user_id:t.filed_by_user_id||C.user?.id||"",approver_user_id:t.approver_user_id||"",plans:n,remarks:t.remarks||"",status:t.status||"draft"},P.value=!0},Z=async a=>{const{id:t,...n}=a;await u.updateById(t,n),P.value=!1,await p({},!0)},ee=async a=>{if(!a?.id)return;(await x.fire({title:`Delete annual plan "${a.reference_code}"?`,text:"This cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it",cancelButtonText:"Cancel"})).isConfirmed&&(await u.deleteById(a.id),await p({},!0),await x.fire("Deleted","The annual plan has been deleted.","success"))},te=async a=>{await W(a)},K=async a=>{if((await x.fire({title:"Submit for approval?",text:"You can no longer edit after submission.",icon:"question",showCancelButton:!0,confirmButtonText:"Submit",cancelButtonText:"Cancel"})).isConfirmed)try{await u.submit(a.id),await p({},!0),await x.fire("Submitted","Annual plan is now pending approval.","success")}catch{await x.fire("Error",u.error||"Failed to submit.","error")}},ae=async a=>{const t=await x.fire({title:"Approve annual plan?",input:"textarea",inputLabel:"Remarks (optional)",inputPlaceholder:"Add a note…",showCancelButton:!0,confirmButtonText:"Approve",cancelButtonText:"Cancel"});if(t.isConfirmed)try{await u.approve(a.id,t.value||""),await p({},!0),await x.fire("Approved","Annual plan has been approved.","success")}catch{await x.fire("Error",u.error||"Failed to approve.","error")}},X=async a=>{const t=await x.fire({title:"Reject annual plan?",input:"textarea",inputLabel:"Reason (required)",inputPlaceholder:"State the reason…",inputValidator:n=>n?.trim()?void 0:"Reason is required",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Reject",cancelButtonText:"Cancel"});if(t.isConfirmed)try{await u.reject(a.id,t.value),await p({},!0),await x.fire("Rejected","Annual plan has been rejected.","success")}catch{await x.fire("Error",u.error||"Failed to reject.","error")}},ne=async a=>{const t=await x.fire({title:"Cancel annual plan?",input:"textarea",inputLabel:"Reason (required)",inputPlaceholder:"State the reason…",inputValidator:n=>n?.trim()?void 0:"Reason is required",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Cancel Plan",cancelButtonText:"Keep"});if(t.isConfirmed)try{await u.cancel(a.id,t.value),await u.updateById(a.id,{status:"draft"}),await p({},!0),await x.fire("Moved to Draft","Annual plan was cancelled and returned to Draft for editing.","success")}catch{await x.fire("Error",u.error||"Failed to cancel.","error")}},N=_(!1),e=_(null),r=async a=>{await u.fetchById(a.id),e.value=u.selected||a,N.value=!0};return(a,t)=>(s(),c(q,null,[k(Fe,null,{default:z(()=>[k(De,null,{default:z(()=>[f(u).error?(s(),M(Oe,{key:0,icon:f(Pe),color:"danger"},{default:z(()=>[I(B(f(u).error),1)]),_:1},8,["icon"])):b("",!0),k(Ue,{icon:f(Re),title:"Annual Plans",main:""},{default:z(()=>[l("div",Rt,[k(le,{icon:f(ze),color:"info",label:"View Calendar",onClick:h},null,8,["icon"]),k(le,{icon:f(Le),color:"primary",label:"New Annual Plan",onClick:O},null,8,["icon"]),k(le,{icon:f(Me),color:"info",label:"Refresh",onClick:t[0]||(t[0]=n=>p({},!0))},null,8,["icon"])])]),_:1},8,["icon"]),l("div",zt,[l("div",Lt,[(s(),c("svg",Mt,[l("path",{d:f(Te)},null,8,Tt)])),t[13]||(t[13]=l("span",{class:"font-medium text-sm"},"Filters",-1))]),l("div",It,[l("div",Ut,[Q(l("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>g.value.q=n),placeholder:"Search by ref, school year, remarks…",class:"border rounded-s px-2 py-2 flex-1",onKeyup:t[2]||(t[2]=fe(n=>p({page:1}),["enter"]))},null,544),[[ve,g.value.q]]),l("button",{class:"px-3 border border-l-0 rounded-e bg-gray-50",title:"Search",onClick:t[3]||(t[3]=n=>p({page:1}))},[(s(),c("svg",Ot,[l("path",{d:f(Ie)},null,8,Wt)]))])]),Q(l("select",{"onUpdate:modelValue":t[4]||(t[4]=n=>g.value.status=n),class:"border rounded px-2 py-2"},[t[14]||(t[14]=l("option",{value:""},"All status",-1)),(s(),c(q,null,H(i,n=>l("option",{key:n,value:n},B(n),9,Nt)),64))],512),[[oe,g.value.status]]),Q(l("select",{"onUpdate:modelValue":t[5]||(t[5]=n=>g.value.school_year=n),class:"border rounded px-2 py-2",disabled:a.readOnly},[t[15]||(t[15]=l("option",{value:""},"Select school year…",-1)),(s(!0),c(q,null,H(v.value,n=>(s(),c("option",{key:n,value:n},B(n),9,Gt))),128))],8,qt),[[oe,g.value.school_year]]),Q(l("select",{"onUpdate:modelValue":t[6]||(t[6]=n=>g.value.club_id=n),class:"border rounded px-2 py-2"},[t[16]||(t[16]=l("option",{value:""},"Any club",-1)),(s(!0),c(q,null,H(w.value,n=>(s(),c("option",{key:n.id,value:n.id},B(n.name),9,Yt))),128))],512),[[oe,g.value.club_id]]),l("div",Kt,[l("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:t[7]||(t[7]=n=>p({page:1}))}," Apply Filters "),l("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:t[8]||(t[8]=()=>{g.value.value={page:1,limit:10,sort:"created_at",order:"DESC",q:"",status:"",school_year:"",club_id:""},p({page:1},!0)})},"Reset")])])]),k(We,{columns:U,data:S.value,loading:f(u).isLoading,onQueryChange:T},{"cell-total_budget":z(({value:n})=>[l("span",Xt,B(d(n)),1)]),"cell-created_at":z(({value:n})=>[l("span",null,B(n?new Date(n).toLocaleString():"—"),1)]),"cell-status":z(({value:n})=>[k(Ne,{text:n||"—",tone:o(n)},null,8,["text","tone"])]),"cell-actions":z(({row:n})=>[k(Ze,{row:n,moderator:V.value,onAttachments:r,onSubmit:K,onApprove:ae,onReject:X,onEdit:W,onDelete:ee,onView:E=>te(n),onCancel:ne},null,8,["row","moderator","onView"])]),_:1},8,["data","loading"])]),_:1})]),_:1}),k(de,{modelValue:j.value,"onUpdate:modelValue":t[9]||(t[9]=n=>j.value=n),mode:"create",onSubmit:Y},null,8,["modelValue"]),k(de,{modelValue:P.value,"onUpdate:modelValue":t[10]||(t[10]=n=>P.value=n),mode:"edit",initial:R.value||{},onSubmit:Z},null,8,["modelValue","initial"]),k(Vt,{modelValue:N.value,"onUpdate:modelValue":t[11]||(t[11]=n=>N.value=n),row:e.value},null,8,["modelValue","row"]),k(Pt,{modelValue:$.value,"onUpdate:modelValue":t[12]||(t[12]=n=>$.value=n),onOpen:y},null,8,["modelValue"])],64))}};export{da as default};
