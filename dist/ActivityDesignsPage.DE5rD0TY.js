import{c as M,r as R,x as Se,a as p,d as G,q as m,e as n,k as Q,t as _,j as ye,g as x,F as N,B as W,S as g,u as De,z as Ie,o as Pe,f as T,l as j,h as V,v as ne,A as ce,M as Ve,C as J,Q as _e}from"./index.DAmVoDb3.js";import{E as Ue,a as L,d as Ce,Q as ve,_ as ge}from"./dayjs.min.CXnyh3NS.js";import{B as Oe,C as Ye,D as Ne,z as je,E as Le,F as Me,G as ze,H as We,I as Ge,_ as qe,a as Ke,g as He,J as Je,K as Qe,L as Xe,M as Ze}from"./SectionMain.CsbBTPh8.js";import{_ as et,a as be}from"./SectionTitleLineWithButton.C1wEuUOP.js";import{_ as tt,B as at,a as he}from"./Badge.ZDEpfiWP.js";import{_ as xe}from"./ActivityDesignFormModal.CGMoOlLP.js";import{u as Ae}from"./activityDesign.Qeh3bu7I.js";import{Q as lt}from"./browser.CP-TSE2Y.js";import{u as nt}from"./club.QgD8PTJg.js";import{u as it}from"./clubScope.Bbt8Hd8B.js";import"./IconifyButton.gvhAeUuV.js";import"./appContext.mdfYETyb.js";import"./activityDesignService.DhYBJKMI.js";import"./utilizationRequestService.BmHxJC7e.js";import"./liquidationFundService.BzNLtOK8.js";import"./ToasterComponent.U6uX3OD4.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";import"./annualPlan.BcsMM8a9.js";const ot={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},st={class:"bg-white p-4 rounded-xl shadow-xl w-[980px] max-h-screen overflow-auto"},rt={class:"flex items-center justify-between mb-3"},dt={class:"text-lg font-semibold"},ut={class:"text-gray-600"},ct={class:"flex items-center justify-between gap-2"},mt={class:"text-sm text-gray-600"},pt={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},ft=["d"],yt=["disabled"],_t={class:"mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"},vt={class:"aspect-video bg-white border rounded overflow-hidden flex items-center justify-center"},gt=["src"],bt={key:1,class:"flex items-center justify-center w-full h-full"},ht=["d"],xt={class:"mt-2 text-xs"},wt=["title"],St={class:"text-gray-500 flex items-center justify-between"},Ct={key:0},At={key:0},Et={class:"mt-2 flex items-center justify-between gap-2"},Ft=["onClick","title"],Tt={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},$t=["d"],kt=["onClick"],Bt={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},Rt=["d"],Dt={key:0,class:"mt-6 text-center text-sm text-gray-500"},It=10*1024*1024,Pt={__name:"ActivityAttachmentsModal",props:{modelValue:{type:Boolean,default:!1},row:{type:Object,default:null}},emits:["update:modelValue"],setup(l,{emit:i}){const y=l,c=i,u=M({get:()=>y.modelValue,set:a=>c("update:modelValue",a)}),A=Ae(),w=R(null),D=R(!1),U=new Set(["image/png","image/jpeg","image/webp","application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]),d=new Set(["png","jpg","jpeg","webp","pdf","docx","xlsx"]),E=(a="")=>{const r=String(a).toLowerCase().match(/\.([a-z0-9]+)$/i);return r?r[1]:""},I=(a="")=>{if(typeof a!="string")return"";const r=a.match(/^data:([^;]+);base64,/i);return r?r[1]:""},X=a=>{const r=a?.type&&U.has(a.type),s=a?.name&&d.has(E(a.name));return r||s},$=(a="")=>String(a).startsWith("image/"),f=(a="")=>a==="application/pdf",b=(a="")=>a==="application/vnd.openxmlformats-officedocument.wordprocessingml.document",S=(a="")=>a==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",P=(a="")=>f(a)?Le:b(a)?Me:S(a)?ze:$(a)?We:Ge,O=(a="")=>f(a)?"PDF":b(a)?"Word":S(a)?"Excel":$(a)?"Image":"File",F=(a="")=>f(a)?"pdf":b(a)?"docx":S(a)?"xlsx":a==="image/png"?"png":a==="image/jpeg"?"jpg":a==="image/webp"?"webp":"",k=(a="attachment",r="")=>{const s=/\.[a-z0-9]+$/i.test(a),h=r?r.startsWith(".")?r.slice(1):r:"";return s?a:h?`${a}.${h}`:a},B=a=>!a&&a!==0?"":a<1024?`${a} B`:a<1024*1024?`${(a/1024).toFixed(1)} KB`:`${(a/(1024*1024)).toFixed(1)} MB`,q=M(()=>{const a=w.value?.attachments;if(!a)return[];try{return Array.isArray(a)?a:JSON.parse(a||"[]")}catch{return[]}}),le=M(()=>(q.value||[]).map((a,r)=>{const s=a.mime||I(a.data)||(a.name?E(a.name)==="pdf"&&"application/pdf":"")||"",h=E(a.name||"")||F(s),Y=a.size??null,C=a.name||`${O(s)} ${r+1}`;return{id:a.id??r+1,name:C,data:a.data||"",url:a.url||a.href||a.path||"",mime:s,ext:h,size:Y,filename:k(C,h)}}));Se(()=>y.modelValue,async a=>{a&&y.row?.id&&(await A.fetchById(y.row.id),w.value=A.selected||y.row)},{immediate:!1});const K=async a=>{const r=a.target.files?.[0];if(a.target.value="",!(!r||!w.value?.id)){if(r.size>It){await g.fire("File too large","Maximum size is 10 MB.","warning");return}if(!X(r)){await g.fire("Unsupported file","Only images (PNG/JPEG/WEBP), PDF, DOCX, and XLSX are allowed.","warning");return}try{D.value=!0,await A.uploadAttachment(w.value.id,r),await A.fetchById(w.value.id),w.value=A.selected}finally{D.value=!1}}},z=async a=>{!w.value?.id||!(await g.fire({title:"Remove attachment?",icon:"warning",showCancelButton:!0,confirmButtonText:"Remove",confirmButtonColor:"#d33"})).isConfirmed||(await A.deleteAttachment(w.value.id,a),await A.fetchById(w.value.id),w.value=A.selected)},Z=a=>{if(a.data&&String(a.data).startsWith("data:")&&$(a.mime)){const r=window.open();r&&r.document.write(`<img src="${a.data}" style="display:block;max-width:100%;height:auto;margin:0 auto;object-fit:contain"/>`);return}a.url&&window.open(String(a.url),"_blank")},oe=a=>{const[r,s]=a.split(","),h=r.match(/data:([^;]+);base64/i)?.[1]||"application/octet-stream",Y=atob(s),C=Y.length,ae=new Uint8Array(C);for(let H=0;H<C;H++)ae[H]=Y.charCodeAt(H);return new Blob([ae],{type:h})},ee=(a,r)=>{const s=URL.createObjectURL(a),h=document.createElement("a");h.href=s,h.download=r||"download",document.body.appendChild(h),h.click(),h.remove(),setTimeout(()=>URL.revokeObjectURL(s),1e3)},se=async a=>{if(a.data&&String(a.data).startsWith("data:")){const r=oe(a.data);ee(r,a.filename);return}if(a.url)try{const s=await(await fetch(a.url,{credentials:"include"})).blob();ee(s,a.filename)}catch{const s=document.createElement("a");s.href=String(a.url),s.setAttribute("download",a.filename),document.body.appendChild(s),s.click(),s.remove()}},te=a=>$(a.mime)?"Open":"Download",re=a=>$(a.mime)?Ye:Ne,de=a=>$(a.mime)?Z(a):se(a);return(a,r)=>u.value?(m(),p("div",ot,[n("div",st,[n("div",rt,[n("h2",dt,[r[1]||(r[1]=Q(" Attachments — ",-1)),n("span",ut,_(w.value?.name_of_activity||""),1)]),n("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:r[0]||(r[0]=s=>u.value=!1)},"Close")]),n("div",ct,[n("div",mt,[r[2]||(r[2]=Q(" Ref: ",-1)),n("strong",null,_(w.value?.reference_code||"—"),1)]),n("label",{class:ye(["inline-flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white rounded text-xs cursor-pointer disabled:opacity-60",{"opacity-60 pointer-events-none":D.value}])},[(m(),p("svg",pt,[n("path",{d:x(Oe)},null,8,ft)])),n("span",null,_(D.value?"Uploading…":"Upload"),1),n("input",{type:"file",class:"hidden",disabled:D.value,onChange:K,accept:".png,.jpg,.jpeg,.webp,.pdf,.docx,.xlsx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,image/png,image/jpeg,image/webp"},null,40,yt)],2)]),n("div",_t,[(m(!0),p(N,null,W(le.value,s=>(m(),p("div",{key:s.id,class:"border rounded-lg p-2 bg-gray-50 flex flex-col"},[n("div",vt,[$(s.mime)&&s.data&&s.data.startsWith("data:")?(m(),p("img",{key:0,src:s.data,class:"object-contain w-full h-full",alt:"Attachment preview"},null,8,gt)):(m(),p("div",bt,[(m(),p("svg",{style:{width:"64px",height:"64px"},viewBox:"0 0 24 24","aria-hidden":"true",class:ye({"text-red-600":f(s.mime),"text-blue-600":b(s.mime),"text-emerald-600":S(s.mime),"text-gray-500":!s.mime||!$(s.mime)&&!f(s.mime)})},[n("path",{d:P(s.mime)},null,8,ht)],2))]))]),n("div",xt,[n("div",{class:"font-medium truncate",title:s.name},_(s.name),9,wt),n("div",St,[n("span",null,[Q(_(O(s.mime))+" ",1),s.ext?(m(),p("span",Ct,"("+_(s.ext.toUpperCase())+")",1)):G("",!0)]),s.size?(m(),p("span",At,_(B(s.size)),1)):G("",!0)])]),n("div",Et,[n("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-white border rounded text-xs hover:bg-gray-50",onClick:h=>de(s),title:te(s)},[(m(),p("svg",Tt,[n("path",{d:re(s)},null,8,$t)])),Q(" "+_(te(s)),1)],8,Ft),n("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-red-600 text-white rounded text-xs",onClick:h=>z(s.id),title:"Remove"},[(m(),p("svg",Bt,[n("path",{d:x(je)},null,8,Rt)])),r[3]||(r[3]=Q(" Remove ",-1))],8,kt)])]))),128))]),le.value.length?G("",!0):(m(),p("div",Dt," No attachments yet. "))])])):G("",!0)}},Vt="KOLEHIYO NG PANTUKAN",Ut="Juan A. Sarenas Campus, Kingking, Pantukan, Davao de Oro",Ot="https://osas.knp.edu.ph/#/verify-actdesign?id=",ie=l=>l?Ce(l).format("MMMM DD, YYYY"):"—",Yt=l=>l==null||l===""?"—":Number(l).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),Ee="./",Nt=`${Ee}images/logo.png`,jt=`${Ee}images/bg.jpg`;async function we(l){const y=await(await fetch(l)).blob();return new Promise(c=>{const u=new FileReader;u.onloadend=()=>c(u.result),u.readAsDataURL(y)})}function Lt(l){switch(l){case"APPROVED":return[32,141,85];case"PENDING":return[240,158,47];case"REJECTED":return[220,53,69];case"CANCELLED":return[107,114,128];default:return[90,90,90]}}async function Mt(l){const i=l.internal.pageSize.getWidth(),y=110,c=36;try{const u=await we(jt);l.addImage(u,"JPEG",0,0,i,y,void 0,"FAST")}catch{l.setFillColor(21,62,121),l.rect(0,0,i,y,"F")}l.setGState(new l.GState({opacity:.18})),l.setFillColor(0,0,0),l.rect(0,0,i,y,"F"),l.setGState(new l.GState({opacity:1}));try{const u=await we(Nt);l.addImage(u,"PNG",c,20,70,70,void 0,"FAST")}catch{}return l.setTextColor(255,255,255),l.setFont("helvetica","bold"),l.setFontSize(20),l.text(Vt,c+86,38),l.setFont("helvetica","normal"),l.setFontSize(10),l.text(Ut,c+86,58),l.setTextColor(20),l.setFont("helvetica","bold"),l.setFontSize(14),l.text("ACTIVITY DESIGN",i/2,y+24,{align:"center"}),y+34}async function zt(l,i,y){const c=l.internal.pageSize.getWidth(),u=36,A=i?.id??i?.reference_code??"",w=`${Ot}${encodeURIComponent(String(A))}`,D=await lt.toDataURL(w,{margin:0,width:75,errorCorrectionLevel:"M",color:{dark:"#000000",light:"#FFFFFF"}}),U=String(i.status||"").toUpperCase(),[d,E,I]=Lt(U),X=i.approved_at?ie(i.approved_at):i.date_filed?ie(i.date_filed):"—",$=`osas.knp.edu.ph/#/verify-actdesign?id=${String(A)}`;return L(l,{startY:y,theme:"plain",styles:{cellPadding:0,fontSize:9},bodyStyles:{minCellHeight:110},margin:{left:u,right:u},tableWidth:c-u*2,body:[[{content:""},{content:""}]],columnStyles:{0:{cellWidth:c-u*2-260},1:{cellWidth:260}},didDrawCell:f=>{if(f.section!=="body")return;const{x:b,y:S,width:P,height:O}=f.cell,F=10;if(f.column.index===0){l.setFillColor(255,255,255),l.roundedRect(b,S,P-1,O,6,6,"F");const k=24,B=Math.min(140,P-22);l.setFillColor(d,E,I),l.roundedRect(b+F,S+F,B,k,12,12,"F"),l.setTextColor(255,255,255),l.setFont("helvetica","bold"),l.setFontSize(10),l.text(U||"STATUS",b+F+10,S+F+16),l.setTextColor(20),l.setFont("helvetica","normal"),l.setFontSize(9);const q=S+F+k+14;l.text(`Ref No.: ${i.reference_code||"—"}`,b+F,q),l.text(`Date Issued: ${X}`,b+F,q+16),l.setDrawColor(230),l.roundedRect(b,S,P-1,O,6,6,"S")}if(f.column.index===1){l.setFillColor(255,255,255),l.roundedRect(b,S,P-1,O,6,6,"F"),l.setFillColor(66,103,178),l.roundedRect(b,S,P-1,22,6,6,"F"),l.setTextColor(255,255,255),l.setFont("helvetica","bold"),l.setFontSize(10),l.text("VERIFY",b+F,S+15);const k=b+F,B=S+28;l.addImage(D,"PNG",k,B,75,75,void 0,"FAST"),l.setTextColor(20),l.setFont("helvetica","bold"),l.setFontSize(10),l.text("Scan to verify",k+100,B+14),l.setFont("helvetica","normal"),l.setFontSize(9),l.text("This document can be verified",k+100,B+32),l.text("online via the OSAS portal.",k+100,B+46),l.setTextColor(110),l.setFontSize(8),l.text($,k+100,B+72),l.setDrawColor(230),l.roundedRect(b,S,P-1,O,6,6,"S")}}}),l.lastAutoTable.finalY}async function Fe(l){const i=new Ue({unit:"pt",format:[612,936],orientation:"portrait"}),y=i.internal.pageSize.getWidth(),c=36;let u=await Mt(i);u=await zt(i,l,u)+10,L(i,{startY:u,theme:"grid",styles:{fontSize:9,cellPadding:5},headStyles:{fillColor:[222,235,247],textColor:20,fontStyle:"bold"},head:[["SEMESTER","DATE FILED","SCHOOL YEAR","OFFICE/DEPARTMENT"]],body:[[l.semester||"—",ie(l.date_filed),l.school_year||"—",l.office_department||l?.club?.name||"—"]],columnStyles:{0:{cellWidth:120},1:{cellWidth:120},2:{cellWidth:120},3:{cellWidth:"auto"}},margin:{left:c,right:c}}),u=i.lastAutoTable.finalY+10,L(i,{startY:u,theme:"plain",styles:{fontSize:10},body:[[{content:"ACTIVITY INFORMATION",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",halign:"left",valign:"middle",cellPadding:6}}]],margin:{left:c,right:c}}),u=i.lastAutoTable.finalY,L(i,{startY:u,theme:"grid",styles:{fontSize:9,cellPadding:6},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},body:[[{content:"NAME OF ACTIVITY",styles:{fillColor:[243,248,255],fontStyle:"bold"}},l.name_of_activity||"—"],[{content:"VENUE",styles:{fillColor:[243,248,255],fontStyle:"bold"}},l.venue||"—"],[{content:"DATE OF IMPLEMENTATION",styles:{fillColor:[243,248,255],fontStyle:"bold"}},ie(l.date_of_implementation)],[{content:"PROPOSED BUDGET",styles:{fillColor:[243,248,255],fontStyle:"bold"}},`${Yt(l.proposed_budget)}   (Source: Department Fund)`],[{content:"PARTICIPANTS",styles:{fillColor:[243,248,255],fontStyle:"bold"}},l.participants||"—"],[{content:"NATURE OF ACTIVITY",styles:{fillColor:[243,248,255],fontStyle:"bold"}},l.nature_of_activity||"—"]],columnStyles:{0:{cellWidth:180,fontStyle:"bold"},1:{cellWidth:"auto"}},margin:{left:c,right:c}}),u=i.lastAutoTable.finalY+10,[["RATIONALE",l.rationale],["OBJECTIVES",l.objectives],["DETAILS OF THE ACTIVITY",l.details_of_activity],["BUDGETARY REQUIREMENTS",l.budgetary_requirements]].forEach(([E,I])=>{L(i,{startY:u,theme:"plain",styles:{fontSize:10},body:[[{content:E,styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:c,right:c}}),u=i.lastAutoTable.finalY,L(i,{startY:u,theme:"grid",styles:{fontSize:9,cellPadding:8},body:[[I&&String(I).trim()?I:"—"]],margin:{left:c,right:c}}),u=i.lastAutoTable.finalY+10}),L(i,{startY:u,theme:"plain",styles:{fontSize:10},body:[[{content:"APPROVAL",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:c,right:c}}),u=i.lastAutoTable.finalY;const D=String(l?.file_by_user_name||"").trim()||(l?.filed_by?`${l.filed_by.first_name||""} ${l.filed_by.last_name||""}`.trim():""),U=l?.approver?`${l.approver.first_name||""} ${l.approver.last_name||""}`.trim():"";L(i,{startY:u,theme:"grid",styles:{fontSize:9,cellPadding:10},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},head:[["PREPARED BY:","NOTED BY:","APPROVED BY:"]],body:[[D||" ","Albert P. Mapalo, LPT, MAEd",U||" "]],columnStyles:{0:{cellWidth:(y-c*2)/3},1:{cellWidth:(y-c*2)/3},2:{cellWidth:"auto"}},didParseCell:E=>{E.section==="body"&&(E.cell.styles.halign="center",E.cell.styles.fontStyle="bold",E.cell.styles.cellPadding={top:16,right:10,bottom:18,left:10})},margin:{left:c,right:c}});const d=i.internal.pageSize.getHeight()-20;return i.setFontSize(8),i.setTextColor(120),i.text(`Generated on ${Ce().format("YYYY-MM-DD HH:mm")} • ${window.location.origin}`,c,d),i}async function Wt(l){(await Fe(l)).save(`${l.reference_code||"Activity_Design"}.pdf`)}const Gt={class:"flex items-center gap-2"},qt={class:"p-2 mb-4 rounded-xl border bg-white/60"},Kt={class:"flex items-center gap-2 mb-2 text-gray-700"},Ht={class:"w-4 h-4",viewBox:"0 0 24 24"},Jt=["d"],Qt={class:"grid grid-cols-1 md:grid-cols-6 gap-2 text-sm"},Xt=["value"],Zt=["value"],ea=["value"],ta=["value"],aa={key:0,value:""},la=["value"],na={value:""},ia=["value"],oa={class:"md:col-span-1"},sa={class:"md:col-span-1"},ra={class:"flex items-center gap-2 md:col-span-2"},da={class:"flex flex-col gap-1"},ua={class:"text-xs"},ca={class:"inline-flex items-center gap-2 px-2 py-1 rounded bg-emerald-50 border border-emerald-200"},ma={class:"font-medium"},pa={class:"text-gray-600"},fa={class:"text-xs text-gray-700"},ya={class:"font-medium"},_a={class:"text-gray-500"},va={key:1,class:"text-gray-400 text-xs"},ga={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30"},ba={class:"bg-white w-[560px] rounded-xl shadow p-4"},ha={class:"flex items-center justify-between mb-2"},xa={class:"grid grid-cols-1 gap-2 text-sm"},wa={class:"flex gap-2"},Sa={class:"text-[11px] text-gray-600"},Ca={class:"mt-3 flex justify-end gap-2"},Ma={__name:"ActivityDesignsPage",setup(l){const i=Ae(),y=De(),c=nt(),u=Ie(),{isClub:A,activeClubId:w,withClub:D}=it(),U={range:!0,partialRange:!0,multiCalendars:2,modelType:"yyyy-MM-dd",enableTimePicker:!1,autoApply:!0,clearable:!0},d=R({page:1,limit:10,sort:"created_at",order:"DESC",q:"",status:"",nature_of_activity:"",school_year:"",semester:"",club_id:"",filed_by_user_id:"",date_filed_from:"",date_filed_to:"",impl_from:"",impl_to:""}),E=M({get:()=>{const{date_filed_from:o,date_filed_to:e}=d.value;return o||e?[o||null,e||null]:null},set:o=>{if(!o)d.value.date_filed_from=null,d.value.date_filed_to=null;else{const[e,t]=o;d.value.date_filed_from=e||null,d.value.date_filed_to=t||null}}}),I=M({get:()=>{const{impl_from:o,impl_to:e}=d.value;return o||e?[o||null,e||null]:null},set:o=>{if(!o)d.value.impl_from=null,d.value.impl_to=null;else{const[e,t]=o;d.value.impl_from=e||null,d.value.impl_to=t||null}}}),X=["1st Semester","2nd Semester","Summer"],$=M(()=>{const o=new Date().getFullYear();return Array.from({length:6},(e,t)=>`${o-t}-${o-t+1}`)}),f=async(o={},e=!0)=>{d.value={...d.value,...o},typeof d.value.officer>"u"&&(d.value.officer=!0);const t=D({...d.value});["q","status","nature_of_activity","school_year","semester","club_id","filed_by_user_id","date_filed_from","date_filed_to","impl_from","impl_to"].forEach(v=>{(t[v]===""||t[v]==null)&&delete t[v]}),t.officer=d.value.officer,await i.fetchAll(t,e)};Pe(async()=>{await Promise.all([f({page:1,limit:10,club_id:A?w:""}),c.fetchAll({page:1,limit:200,officer:!0},!0),u.fetchAll({page:1,limit:200},!0)])});const b=R([]);Se(()=>d.value.club_id,async o=>{if(d.value.filed_by_user_id="",!o){b.value=[];return}try{await c.fetchById(o),b.value=Array.isArray(c.selectedClub?.users)?c.selectedClub.users:[]}catch{b.value=[]}});const S=M(()=>d.value.club_id?b.value:u.users.data||[]),P=M(()=>({total:i.items.total||0,totalPages:i.items.totalPages||1,currentPage:i.items.currentPage||1,pageSize:i.items.pageSize||10,data:i.items.data||[]})),O=["Curricular","Co-Curricular","Extra-Curricular"],F=["draft","pending","approved","rejected","cancelled"],k=o=>{switch(String(o||"").toLowerCase()){case"draft":return"gray";case"pending":return"amber";case"approved":return"emerald";case"rejected":return"red";case"cancelled":return"zinc";default:return"gray"}},B=o=>{const e=Number(o);return Number.isFinite(e)?e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},q=[{key:"reference_code",label:"Ref Code",sortable:!0,width:140},{key:"name_of_activity",label:"Activity",sortable:!0,minWidth:220},{key:"annual_plan_item",label:"Annual Plan / Item",sortable:!1,minWidth:260},{key:"club_id",label:"Club",sortable:!1,formatter:(o,e)=>e.club?e.club.name:""},{key:"semester",label:"Sem",sortable:!0,width:110},{key:"school_year",label:"S.Y.",sortable:!0,width:110},{key:"date_of_implementation",label:"Implementation",sortable:!0,width:140,formatter:o=>o?new Date(o).toLocaleDateString():"—"},{key:"status",label:"Status",sortable:!0,width:120}],le=async o=>{await f(o)},K=R(!1),z=R(!1),Z=R(null),oe=()=>{K.value=!0},ee=o=>{if(!o)return null;if(typeof o=="object")return o;try{return JSON.parse(o)}catch{return null}},se=async o=>{await i.create(o),K.value=!1,await f({},!0)},te=async o=>{await i.fetchById(o.id);const e=i.selected||o;Z.value={id:e.id,date_filed:e.date_filed||"",semester:e.semester||"",office_department:e.office_department||"",school_year:e.school_year||"",name_of_activity:e.name_of_activity||"",venue:e.venue||"",date_of_implementation:e.date_of_implementation||"",proposed_budget:e.proposed_budget??"",participants:e.participants||"",nature_of_activity:e.nature_of_activity||"Curricular",rationale:e.rationale||"",objectives:e.objectives||"",details_of_activity:e.details_of_activity||"",budgetary_requirements:e.budgetary_requirements||"",file_by_user_name:e.file_by_user_name||"",filed_by_user_id:e.filed_by_user_id||"",club_id:e.club_id||"",status:e.status||"draft",remarks:e.remarks||"",annual_plan_id:e.annual_plan_id||"",annual_plan_item:ee(e.annual_plan_item)},z.value=!0},re=async o=>{const{id:e,...t}=o;await i.updateById(e,t),z.value=!1,await f({},!0)},de=async o=>{if(!o?.id)return;(await g.fire({title:`Delete "${o.name_of_activity}"?`,text:"This cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it",cancelButtonText:"Cancel"})).isConfirmed&&(await i.deleteById(o.id),await f({},!0),await g.fire("Deleted","The activity design has been deleted.","success"))},a=async o=>{await i.fetchById(o.id);const e=i.selected||o;Z.value={...e,date_filed:e.date_filed?String(e.date_filed).slice(0,10):"",date_of_implementation:e.date_of_implementation?String(e.date_of_implementation).slice(0,10):"",annual_plan_id:e.annual_plan_id||"",annual_plan_item:ee(e.annual_plan_item)},z.value=!0},r=async o=>{if((await g.fire({title:"Submit for approval?",text:"You can no longer edit after submission.",icon:"question",showCancelButton:!0,confirmButtonText:"Submit",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1})).isConfirmed)try{await i.submit(o.id),await f({},!0),await g.fire("Submitted","Activity is now pending approval.","success")}catch{await g.fire("Error",i.error||"Failed to submit activity.","error")}},s=async o=>{const e=await g.fire({title:"Approve activity?",input:"textarea",inputLabel:"Remarks (optional)",inputPlaceholder:"Add a note…",showCancelButton:!0,confirmButtonText:"Approve",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1});if(!e.isConfirmed)return;const t=e.value||"";try{await i.approve(o.id,t),await f({},!0),await g.fire("Approved","Activity has been approved.","success")}catch{await g.fire("Error",i.error||"Failed to approve activity.","error")}},h=R(!1),Y=R(null),C=R({from_email:"",from_name:"",to:"",subject:"",html:"",attachments:[]}),ae=async o=>{try{await i.fetchById(o.id);const e=i.selected||o,v=(await Fe(e)).output("datauristring"),Be=String(v).split(",")[1]||"",Re=`${e.reference_code||"Activity_Design"}.pdf`;Y.value=e,C.value={from_email:"osas@knp.edu.ph",from_name:`${y.user?.first_name||""} ${y.user?.last_name||""}`.trim(),to:"",subject:`Activity Design ${e.reference_code||""} - ${e.name_of_activity||""}`.trim(),html:"Please see the attached file.",attachments:[{filename:Re,content:Be,type:"application/pdf"}]},h.value=!0}catch{await g.fire("Error",i.error||"Failed to prepare email.","error")}},H=async()=>{const o=Y.value;if(o)try{await i.sendEmail(o.id,{...C.value}),h.value=!1,await g.fire("Sent","Email sent successfully.","success")}catch{await g.fire("Error",i.error||"Failed to send email.","error")}},Te=async o=>{const e=await g.fire({title:"Reject activity?",input:"textarea",inputLabel:"Reason (required)",inputPlaceholder:"State the reason…",inputValidator:v=>v?.trim()?void 0:"Reason is required",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Reject",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1});if(!e.isConfirmed)return;const t=e.value;try{await i.reject(o.id,t),await f({},!0),await g.fire("Rejected","Activity has been rejected.","success")}catch{await g.fire("Error",i.error||"Failed to reject activity.","error")}},$e=async o=>{const e=await g.fire({title:"Cancel activity?",input:"textarea",inputLabel:"Reason (required)",inputPlaceholder:"State the reason…",inputValidator:v=>v?.trim()?void 0:"Reason is required",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Cancel Activity",cancelButtonText:"Keep Activity",allowOutsideClick:!1,allowEscapeKey:!1});if(!e.isConfirmed)return;const t=e.value;try{await i.cancel(o.id,t),await f({},!0),await g.fire("Cancelled","Activity has been cancelled.","success")}catch{await g.fire("Error",i.error||"Failed to cancel activity.","error")}},me=async o=>{if(String(o?.status||"").toLowerCase()!=="approved"){await g.fire("Not allowed","Only approved activities can be printed.","info");return}try{await i.fetchById(o.id);const t=i.selected||o;await Wt(t)}catch(t){await g.fire("Error",i.error||"Failed to generate PDF.","error"),console.error(t)}},ue=R(!1),pe=R(null),fe=async o=>{await i.fetchById(o.id),pe.value=i.selected||o,ue.value=!0},ke=async()=>{await f({q:"",status:"",nature_of_activity:"",school_year:"",semester:"",club_id:"",filed_by_user_id:"",date_filed_from:"",date_filed_to:"",impl_from:"",impl_to:"",page:1})};return(o,e)=>(m(),p(N,null,[T(qe,null,{default:j(()=>[T(Ke,null,{default:j(()=>[x(i).error?(m(),ce(tt,{key:0,icon:x(He),color:"danger"},{default:j(()=>[Q(_(x(i).error),1)]),_:1},8,["icon"])):G("",!0),T(et,{icon:x(Je),title:"Activity Designs",main:""},{default:j(()=>[n("div",Gt,[T(be,{icon:x(Qe),color:"primary",label:"New Activity",onClick:oe},null,8,["icon"]),T(be,{icon:x(Xe),color:"info",label:"Refresh",onClick:e[0]||(e[0]=t=>f({},!0))},null,8,["icon"])])]),_:1},8,["icon"]),n("div",qt,[n("div",Kt,[(m(),p("svg",Ht,[n("path",{d:x(Ze)},null,8,Jt)])),e[22]||(e[22]=n("span",{class:"font-medium text-sm"},"Filters",-1))]),n("div",Qt,[V(n("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>d.value.q=t),placeholder:"Search by ref, activity, venue, office…",class:"border rounded px-2 py-2 md:col-span-2",onKeyup:e[2]||(e[2]=Ve(t=>f({page:1}),["enter"]))},null,544),[[ne,d.value.q]]),V(n("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>d.value.status=t),class:"border rounded px-2 py-2"},[e[23]||(e[23]=n("option",{value:""},"All status",-1)),(m(),p(N,null,W(F,t=>n("option",{key:t,value:t},_(t),9,Xt)),64))],512),[[J,d.value.status]]),V(n("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>d.value.nature_of_activity=t),class:"border rounded px-2 py-2"},[e[24]||(e[24]=n("option",{value:""},"All natures",-1)),(m(),p(N,null,W(O,t=>n("option",{key:t,value:t},_(t),9,Zt)),64))],512),[[J,d.value.nature_of_activity]]),V(n("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>d.value.school_year=t),class:"border rounded px-2 py-2 md:col-span-1"},[(m(!0),p(N,null,W($.value,t=>(m(),p("option",{key:t,value:t},_(t),9,ea))),128))],512),[[J,d.value.school_year]]),V(n("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>d.value.semester=t),class:"border rounded px-2 py-2 md:col-span-1"},[e[25]||(e[25]=n("option",{disabled:"",value:""},"Select semester…",-1)),(m(),p(N,null,W(X,t=>n("option",{key:t,value:t},_(t),9,ta)),64))],512),[[J,d.value.semester]]),V(n("select",{"onUpdate:modelValue":e[7]||(e[7]=t=>d.value.club_id=t),class:"border rounded px-2 py-2 md:col-span-2"},[x(y).user.role==="admin"?(m(),p("option",aa,"All clubs")):G("",!0),(m(!0),p(N,null,W(x(c).clubs.data||[],t=>(m(),p("option",{key:t.id,value:t.id},_(t.name),9,la))),128))],512),[[J,d.value.club_id]]),V(n("select",{"onUpdate:modelValue":e[8]||(e[8]=t=>d.value.filed_by_user_id=t),class:"border rounded px-2 py-2 md:col-span-2"},[n("option",na,_(d.value.club_id?"Filed by (club members)":"Filed by (any)"),1),(m(!0),p(N,null,W(S.value,t=>(m(),p("option",{key:t.id,value:t.id},_(t.first_name)+" "+_(t.last_name)+" (@"+_(t.username)+") ",9,ia))),128))],512),[[J,d.value.filed_by_user_id]]),n("div",oa,[T(x(ve),_e({modelValue:E.value,"onUpdate:modelValue":e[9]||(e[9]=t=>E.value=t)},U,{placeholder:"Filed date range"}),null,16,["modelValue"])]),n("div",sa,[T(x(ve),_e({modelValue:I.value,"onUpdate:modelValue":e[10]||(e[10]=t=>I.value=t)},U,{placeholder:"Implementation date range"}),null,16,["modelValue"])]),n("div",ra,[n("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:e[11]||(e[11]=t=>f({page:1}))}," Apply "),n("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:ke}," Reset ")])])]),T(at,{columns:q,data:P.value,loading:x(i).isLoading,onQueryChange:le},{"cell-annual_plan_item":j(({row:t})=>[n("div",da,[t.annual_plan_id?(m(),p(N,{key:0},[n("div",ua,[n("span",ca,[n("span",ma,_(t.annual_plan?.reference_code||`AP-${t.annual_plan_id}`),1),n("span",pa,"SY "+_(t.annual_plan?.school_year||"—"),1)])]),n("div",fa,[n("span",ya,_((()=>{try{const v=typeof t.annual_plan_item=="string"?JSON.parse(t.annual_plan_item||"null")||{}:t.annual_plan_item||{};return v.item||v.title||v.name||v.activity||"—"}catch{return"—"}})()),1),n("span",_a," — ₱"+_((()=>{try{const v=typeof t.annual_plan_item=="string"?JSON.parse(t.annual_plan_item||"null")||{}:t.annual_plan_item||{};return B(v.funds??v.budget??0)}catch{return B(0)}})()),1)])],64)):(m(),p("span",va,"—"))])]),"cell-nature_of_activity":j(({value:t})=>[T(he,{text:t||"—",tone:"indigo"},null,8,["text"])]),"cell-status":j(({value:t})=>[T(he,{text:t||"—",tone:k(t)},null,8,["text","tone"])]),"cell-actions":j(({row:t})=>[["admin","manager"].includes(String(x(y).user?.role||"").toLowerCase())?(m(),ce(ge,{key:0,row:t,moderator:!0,onAttachments:fe,onSubmit:r,onApprove:s,onReject:Te,onEdit:te,onDelete:de,onView:v=>a(t),onCancel:$e,onPrint:me,onEmail:ae},null,8,["row","onView"])):(m(),ce(ge,{key:1,row:t,moderator:!1,onAttachments:fe,onSubmit:r,onEdit:te,onView:v=>a(t),onPrint:me,onEmail:ae},null,8,["row","onView"]))]),_:1},8,["data","loading"])]),_:1})]),_:1}),T(xe,{modelValue:K.value,"onUpdate:modelValue":e[12]||(e[12]=t=>K.value=t),mode:"create","locked-club-id":x(A)?x(w):"",onSubmit:se},null,8,["modelValue","locked-club-id"]),T(xe,{modelValue:z.value,"onUpdate:modelValue":e[13]||(e[13]=t=>z.value=t),mode:"edit",initial:Z.value||{},onSubmit:re},null,8,["modelValue","initial"]),T(Pt,{modelValue:ue.value,"onUpdate:modelValue":e[14]||(e[14]=t=>ue.value=t),row:pe.value},null,8,["modelValue","row"]),h.value?(m(),p("div",ga,[n("div",ba,[n("div",ha,[e[26]||(e[26]=n("h3",{class:"text-base font-semibold"},"Send Email",-1)),n("button",{class:"px-2 py-1 text-xs bg-gray-200 rounded",onClick:e[15]||(e[15]=t=>h.value=!1)},"Close")]),n("div",xa,[n("div",null,[e[27]||(e[27]=n("label",{class:"block mb-0.5"},"To",-1)),n("div",wa,[V(n("input",{"onUpdate:modelValue":e[16]||(e[16]=t=>C.value.to=t),class:"flex-1 border rounded px-2 py-1.5",placeholder:"recipient@example.com"},null,512),[[ne,C.value.to]]),n("button",{class:"px-2 py-1 text-[11px] rounded border bg-gray-50 hover:bg-gray-100",onClick:e[17]||(e[17]=()=>{const t=Y.value?.filed_by_user_id||Y.value?.filed_by?.id;t&&x(u).fetchById(t).then(()=>{const v=x(u).selectedUser?.email;v&&(C.value.to=v)})})},"Use Filer"),n("button",{class:"px-2 py-1 text-[11px] rounded border bg-rose-50 hover:bg-rose-100",onClick:e[18]||(e[18]=()=>{C.value.attachments=[]})},"Remove Attachment")])]),n("div",null,[e[28]||(e[28]=n("label",{class:"block mb-0.5"},"Subject",-1)),V(n("input",{"onUpdate:modelValue":e[19]||(e[19]=t=>C.value.subject=t),class:"w-full border rounded px-2 py-1.5"},null,512),[[ne,C.value.subject]])]),n("div",null,[e[29]||(e[29]=n("label",{class:"block mb-0.5"},"Message",-1)),V(n("textarea",{"onUpdate:modelValue":e[20]||(e[20]=t=>C.value.html=t),rows:"4",class:"w-full border rounded px-2 py-1.5"},null,512),[[ne,C.value.html]])]),n("div",Sa,"Attachment: "+_(C.value.attachments?.[0]?.filename||"activity.pdf"),1)]),n("div",Ca,[n("button",{class:"px-3 py-1.5 text-xs bg-gray-200 rounded",onClick:e[21]||(e[21]=t=>h.value=!1)},"Cancel"),n("button",{class:"px-3 py-1.5 text-xs bg-emerald-600 text-white rounded",onClick:H},"Send")])])])):G("",!0)],64))}};export{Ma as default};
