import{c as L,r as k,x as Fe,a as _,d as K,q as y,e as s,k as te,t as v,j as he,g as b,F as M,B as q,S as g,u as Ye,z as je,o as Me,f as E,l as z,h as Y,v as se,A as pe,M as Le,C as ee,Q as xe}from"./index.DHp68N3N.js";import{E as ze,a as W,d as $e,Q as we,_ as Se}from"./dayjs.min.C9-ceLua.js";import{B as We,C as Ge,D as Je,z as qe,E as Ke,F as He,G as Qe,H as Xe,I as Ze,_ as et,a as tt,g as at,J as nt,K as lt,L as it,M as st}from"./SectionMain.DFP57mMD.js";import{_ as rt,a as Ce}from"./SectionTitleLineWithButton.BOgPZZ6q.js";import{_ as ot,B as dt,a as Ae}from"./Badge.DwLT8PU8.js";import{_ as Ee}from"./ActivityDesignFormModal.DFHML_oP.js";import{u as Re}from"./activityDesign._B7mmJrB.js";import{Q as ut}from"./browser.DbqPiEaM.js";import{_ as ct}from"./StatusTrailModal.Bvsr7VIW.js";import{u as mt}from"./club.B3JURkgS.js";import{u as ft}from"./clubScope.DDTolDD9.js";import"./IconifyButton.y-ZH1nmR.js";import"./appContext.nCqAHF_E.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";import"./activityDesignService.DEEXRllf.js";import"./utilizationRequestService.DGWUJLph.js";import"./liquidationFundService.CcknHeqK.js";import"./ToasterComponent.Dx1PSckr.js";import"./annualPlan.M-kt7Nva.js";const pt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},yt={class:"bg-white p-4 rounded-xl shadow-xl w-[980px] max-h-screen overflow-auto"},_t={class:"flex items-center justify-between mb-3"},vt={class:"text-lg font-semibold"},gt={class:"text-gray-600"},bt={class:"flex items-center justify-between gap-2"},ht={class:"text-sm text-gray-600"},xt={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},wt=["d"],St=["disabled"],Ct={class:"mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"},At={class:"aspect-video bg-white border rounded overflow-hidden flex items-center justify-center"},Et=["src"],kt={key:1,class:"flex items-center justify-center w-full h-full"},Ft=["d"],$t={class:"mt-2 text-xs"},Rt=["title"],Tt={class:"text-gray-500 flex items-center justify-between"},It={key:0},Bt={key:0},Dt={class:"mt-2 flex items-center justify-between gap-2"},Ot=["onClick","title"],Pt={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},Vt=["d"],Nt=["onClick"],Ut={style:{width:"16px",height:"16px"},viewBox:"0 0 24 24","aria-hidden":"true"},Yt=["d"],jt={key:0,class:"mt-6 text-center text-sm text-gray-500"},Mt=10*1024*1024,Lt={__name:"ActivityAttachmentsModal",props:{modelValue:{type:Boolean,default:!1},row:{type:Object,default:null}},emits:["update:modelValue"],setup(n,{emit:i}){const u=n,f=i,m=L({get:()=>u.modelValue,set:a=>f("update:modelValue",a)}),A=Re(),h=k(null),O=k(!1),S=new Set(["image/png","image/jpeg","image/webp","application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]),F=new Set(["png","jpg","jpeg","webp","pdf","docx","xlsx"]),N=(a="")=>{const d=String(a).toLowerCase().match(/\.([a-z0-9]+)$/i);return d?d[1]:""},o=(a="")=>{if(typeof a!="string")return"";const d=a.match(/^data:([^;]+);base64,/i);return d?d[1]:""},U=a=>{const d=a?.type&&S.has(a.type),r=a?.name&&F.has(N(a.name));return d||r},$=(a="")=>String(a).startsWith("image/"),B=(a="")=>a==="application/pdf",x=(a="")=>a==="application/vnd.openxmlformats-officedocument.wordprocessingml.document",p=(a="")=>a==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",R=(a="")=>B(a)?Ke:x(a)?He:p(a)?Qe:$(a)?Xe:Ze,j=(a="")=>B(a)?"PDF":x(a)?"Word":p(a)?"Excel":$(a)?"Image":"File",T=(a="")=>B(a)?"pdf":x(a)?"docx":p(a)?"xlsx":a==="image/png"?"png":a==="image/jpeg"?"jpg":a==="image/webp"?"webp":"",D=(a="attachment",d="")=>{const r=/\.[a-z0-9]+$/i.test(a),w=d?d.startsWith(".")?d.slice(1):d:"";return r?a:w?`${a}.${w}`:a},P=a=>!a&&a!==0?"":a<1024?`${a} B`:a<1024*1024?`${(a/1024).toFixed(1)} KB`:`${(a/(1024*1024)).toFixed(1)} MB`,H=L(()=>{const a=h.value?.attachments;if(!a)return[];try{return Array.isArray(a)?a:JSON.parse(a||"[]")}catch{return[]}}),ae=L(()=>(H.value||[]).map((a,d)=>{const r=a.mime||o(a.data)||(a.name?N(a.name)==="pdf"&&"application/pdf":"")||"",w=N(a.name||"")||T(r),Z=a.size??null,V=a.name||`${j(r)} ${d+1}`;return{id:a.id??d+1,name:V,data:a.data||"",url:a.url||a.href||a.path||"",mime:r,ext:w,size:Z,filename:D(V,w)}}));Fe(()=>u.modelValue,async a=>{a&&u.row?.id&&(await A.fetchById(u.row.id),h.value=A.selected||u.row)},{immediate:!1});const oe=async a=>{const d=a.target.files?.[0];if(a.target.value="",!(!d||!h.value?.id)){if(d.size>Mt){await g.fire("File too large","Maximum size is 10 MB.","warning");return}if(!U(d)){await g.fire("Unsupported file","Only images (PNG/JPEG/WEBP), PDF, DOCX, and XLSX are allowed.","warning");return}try{O.value=!0,await A.uploadAttachment(h.value.id,d),await A.fetchById(h.value.id),h.value=A.selected}finally{O.value=!1}}},de=async a=>{!h.value?.id||!(await g.fire({title:"Remove attachment?",icon:"warning",showCancelButton:!0,confirmButtonText:"Remove",confirmButtonColor:"#d33"})).isConfirmed||(await A.deleteAttachment(h.value.id,a),await A.fetchById(h.value.id),h.value=A.selected)},Q=a=>{if(a.data&&String(a.data).startsWith("data:")&&$(a.mime)){const d=window.open();d&&d.document.write(`<img src="${a.data}" style="display:block;max-width:100%;height:auto;margin:0 auto;object-fit:contain"/>`);return}a.url&&window.open(String(a.url),"_blank")},G=a=>{const[d,r]=a.split(","),w=d.match(/data:([^;]+);base64/i)?.[1]||"application/octet-stream",Z=atob(r),V=Z.length,J=new Uint8Array(V);for(let C=0;C<V;C++)J[C]=Z.charCodeAt(C);return new Blob([J],{type:w})},X=(a,d)=>{const r=URL.createObjectURL(a),w=document.createElement("a");w.href=r,w.download=d||"download",document.body.appendChild(w),w.click(),w.remove(),setTimeout(()=>URL.revokeObjectURL(r),1e3)},ue=async a=>{if(a.data&&String(a.data).startsWith("data:")){const d=G(a.data);X(d,a.filename);return}if(a.url)try{const r=await(await fetch(a.url,{credentials:"include"})).blob();X(r,a.filename)}catch{const r=document.createElement("a");r.href=String(a.url),r.setAttribute("download",a.filename),document.body.appendChild(r),r.click(),r.remove()}},ne=a=>$(a.mime)?"Open":"Download",ce=a=>$(a.mime)?Ge:Je,ie=a=>$(a.mime)?Q(a):ue(a);return(a,d)=>m.value?(y(),_("div",pt,[s("div",yt,[s("div",_t,[s("h2",vt,[d[1]||(d[1]=te(" Attachments — ",-1)),s("span",gt,v(h.value?.name_of_activity||""),1)]),s("button",{class:"px-3 py-1 text-xs bg-gray-200 rounded",onClick:d[0]||(d[0]=r=>m.value=!1)},"Close")]),s("div",bt,[s("div",ht,[d[2]||(d[2]=te(" Ref: ",-1)),s("strong",null,v(h.value?.reference_code||"—"),1)]),s("label",{class:he(["inline-flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white rounded text-xs cursor-pointer disabled:opacity-60",{"opacity-60 pointer-events-none":O.value}])},[(y(),_("svg",xt,[s("path",{d:b(We)},null,8,wt)])),s("span",null,v(O.value?"Uploading…":"Upload"),1),s("input",{type:"file",class:"hidden",disabled:O.value,onChange:oe,accept:".png,.jpg,.jpeg,.webp,.pdf,.docx,.xlsx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,image/png,image/jpeg,image/webp"},null,40,St)],2)]),s("div",Ct,[(y(!0),_(M,null,q(ae.value,r=>(y(),_("div",{key:r.id,class:"border rounded-lg p-2 bg-gray-50 flex flex-col"},[s("div",At,[$(r.mime)&&r.data&&r.data.startsWith("data:")?(y(),_("img",{key:0,src:r.data,class:"object-contain w-full h-full",alt:"Attachment preview"},null,8,Et)):(y(),_("div",kt,[(y(),_("svg",{style:{width:"64px",height:"64px"},viewBox:"0 0 24 24","aria-hidden":"true",class:he({"text-red-600":B(r.mime),"text-blue-600":x(r.mime),"text-emerald-600":p(r.mime),"text-gray-500":!r.mime||!$(r.mime)&&!B(r.mime)})},[s("path",{d:R(r.mime)},null,8,Ft)],2))]))]),s("div",$t,[s("div",{class:"font-medium truncate",title:r.name},v(r.name),9,Rt),s("div",Tt,[s("span",null,[te(v(j(r.mime))+" ",1),r.ext?(y(),_("span",It,"("+v(r.ext.toUpperCase())+")",1)):K("",!0)]),r.size?(y(),_("span",Bt,v(P(r.size)),1)):K("",!0)])]),s("div",Dt,[s("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-white border rounded text-xs hover:bg-gray-50",onClick:w=>ie(r),title:ne(r)},[(y(),_("svg",Pt,[s("path",{d:ce(r)},null,8,Vt)])),te(" "+v(ne(r)),1)],8,Ot),s("button",{class:"inline-flex items-center gap-1 px-2 py-1 bg-red-600 text-white rounded text-xs",onClick:w=>de(r.id),title:"Remove"},[(y(),_("svg",Ut,[s("path",{d:b(qe)},null,8,Yt)])),d[3]||(d[3]=te(" Remove ",-1))],8,Nt)])]))),128))]),ae.value.length?K("",!0):(y(),_("div",jt," No attachments yet. "))])])):K("",!0)}},zt="KOLEHIYO NG PANTUKAN",Wt="Juan A. Sarenas Campus, Kingking, Pantukan, Davao de Oro",Gt="https://osas.knp.edu.ph/#/verify-actdesign?id=",re=n=>n?$e(n).format("MMMM DD, YYYY"):"—",Jt=n=>n==null||n===""?"—":Number(n).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),Te="./",qt=`${Te}images/logo.png`,Kt=`${Te}images/bg.jpg`;async function ke(n){const u=await(await fetch(n)).blob();return new Promise(f=>{const m=new FileReader;m.onloadend=()=>f(m.result),m.readAsDataURL(u)})}function Ht(n){switch(n){case"APPROVED":return[32,141,85];case"PENDING":return[240,158,47];case"REJECTED":return[220,53,69];case"CANCELLED":return[107,114,128];default:return[90,90,90]}}async function Qt(n){const i=n.internal.pageSize.getWidth(),u=110,f=36;try{const m=await ke(Kt);n.addImage(m,"JPEG",0,0,i,u,void 0,"FAST")}catch{n.setFillColor(21,62,121),n.rect(0,0,i,u,"F")}n.setGState(new n.GState({opacity:.18})),n.setFillColor(0,0,0),n.rect(0,0,i,u,"F"),n.setGState(new n.GState({opacity:1}));try{const m=await ke(qt);n.addImage(m,"PNG",f,20,70,70,void 0,"FAST")}catch{}return n.setTextColor(255,255,255),n.setFont("helvetica","bold"),n.setFontSize(20),n.text(zt,f+86,38),n.setFont("helvetica","normal"),n.setFontSize(10),n.text(Wt,f+86,58),n.setTextColor(20),n.setFont("helvetica","bold"),n.setFontSize(14),n.text("ACTIVITY DESIGN",i/2,u+24,{align:"center"}),u+34}async function Xt(n,i,u){const f=n.internal.pageSize.getWidth(),m=36,A=i?.id??i?.reference_code??"",h=`${Gt}${encodeURIComponent(String(A))}`,O=await ut.toDataURL(h,{margin:0,width:75,errorCorrectionLevel:"M",color:{dark:"#000000",light:"#FFFFFF"}}),S=String(i.status||"").toUpperCase(),[F,N,o]=Ht(S),U=i.approved_at?re(i.approved_at):i.date_filed?re(i.date_filed):"—",$=`osas.knp.edu.ph/#/verify-actdesign?id=${String(A)}`;return W(n,{startY:u,theme:"plain",styles:{cellPadding:0,fontSize:9},bodyStyles:{minCellHeight:110},margin:{left:m,right:m},tableWidth:f-m*2,body:[[{content:""},{content:""}]],columnStyles:{0:{cellWidth:f-m*2-260},1:{cellWidth:260}},didDrawCell:B=>{if(B.section!=="body")return;const{x,y:p,width:R,height:j}=B.cell,T=10;if(B.column.index===0){n.setFillColor(255,255,255),n.roundedRect(x,p,R-1,j,6,6,"F");const D=24,P=Math.min(140,R-22);n.setFillColor(F,N,o),n.roundedRect(x+T,p+T,P,D,12,12,"F"),n.setTextColor(255,255,255),n.setFont("helvetica","bold"),n.setFontSize(10),n.text(S||"STATUS",x+T+10,p+T+16),n.setTextColor(20),n.setFont("helvetica","normal"),n.setFontSize(9);const H=p+T+D+14;n.text(`Ref No.: ${i.reference_code||"—"}`,x+T,H),n.text(`Date Issued: ${U}`,x+T,H+16),n.setDrawColor(230),n.roundedRect(x,p,R-1,j,6,6,"S")}if(B.column.index===1){n.setFillColor(255,255,255),n.roundedRect(x,p,R-1,j,6,6,"F"),n.setFillColor(66,103,178),n.roundedRect(x,p,R-1,22,6,6,"F"),n.setTextColor(255,255,255),n.setFont("helvetica","bold"),n.setFontSize(10),n.text("VERIFY",x+T,p+15);const D=x+T,P=p+28;n.addImage(O,"PNG",D,P,75,75,void 0,"FAST"),n.setTextColor(20),n.setFont("helvetica","bold"),n.setFontSize(10),n.text("Scan to verify",D+100,P+14),n.setFont("helvetica","normal"),n.setFontSize(9),n.text("This document can be verified",D+100,P+32),n.text("online via the OSAS portal.",D+100,P+46),n.setTextColor(110),n.setFontSize(8),n.text($,D+100,P+72),n.setDrawColor(230),n.roundedRect(x,p,R-1,j,6,6,"S")}}}),n.lastAutoTable.finalY}async function Ie(n){const i=new ze({unit:"pt",format:[612,936],orientation:"portrait"}),u=i.internal.pageSize.getWidth(),f=36;let m=await Qt(i);m=await Xt(i,n,m)+10,W(i,{startY:m,theme:"grid",styles:{fontSize:9,cellPadding:5},headStyles:{fillColor:[222,235,247],textColor:20,fontStyle:"bold"},head:[["SEMESTER","DATE FILED","SCHOOL YEAR","OFFICE/DEPARTMENT"]],body:[[n.semester||"—",re(n.date_filed),n.school_year||"—",n.office_department||n?.club?.name||"—"]],columnStyles:{0:{cellWidth:120},1:{cellWidth:120},2:{cellWidth:120},3:{cellWidth:"auto"}},margin:{left:f,right:f}}),m=i.lastAutoTable.finalY+10,W(i,{startY:m,theme:"plain",styles:{fontSize:10},body:[[{content:"ACTIVITY INFORMATION",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",halign:"left",valign:"middle",cellPadding:6}}]],margin:{left:f,right:f}}),m=i.lastAutoTable.finalY,W(i,{startY:m,theme:"grid",styles:{fontSize:9,cellPadding:6},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},body:[[{content:"NAME OF ACTIVITY",styles:{fillColor:[243,248,255],fontStyle:"bold"}},n.name_of_activity||"—"],[{content:"VENUE",styles:{fillColor:[243,248,255],fontStyle:"bold"}},n.venue||"—"],[{content:"DATE OF IMPLEMENTATION",styles:{fillColor:[243,248,255],fontStyle:"bold"}},re(n.date_of_implementation)],[{content:"PROPOSED BUDGET",styles:{fillColor:[243,248,255],fontStyle:"bold"}},`${Jt(n.proposed_budget)}   (Source: Department Fund)`],[{content:"PARTICIPANTS",styles:{fillColor:[243,248,255],fontStyle:"bold"}},n.participants||"—"],[{content:"NATURE OF ACTIVITY",styles:{fillColor:[243,248,255],fontStyle:"bold"}},n.nature_of_activity||"—"]],columnStyles:{0:{cellWidth:180,fontStyle:"bold"},1:{cellWidth:"auto"}},margin:{left:f,right:f}}),m=i.lastAutoTable.finalY+10,[["RATIONALE",n.rationale],["OBJECTIVES",n.objectives],["DETAILS OF THE ACTIVITY",n.details_of_activity],["BUDGETARY REQUIREMENTS",n.budgetary_requirements]].forEach(([o,U])=>{W(i,{startY:m,theme:"plain",styles:{fontSize:10},body:[[{content:o,styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:f,right:f}}),m=i.lastAutoTable.finalY,W(i,{startY:m,theme:"grid",styles:{fontSize:9,cellPadding:8},body:[[U&&String(U).trim()?U:"—"]],margin:{left:f,right:f}}),m=i.lastAutoTable.finalY+10}),W(i,{startY:m,theme:"plain",styles:{fontSize:10},body:[[{content:"APPROVAL",styles:{fillColor:[66,103,178],textColor:255,fontStyle:"bold",cellPadding:6}}]],margin:{left:f,right:f}}),m=i.lastAutoTable.finalY;const O=String(n?.file_by_user_name||"").trim()||(n?.filed_by?`${n.filed_by.first_name||""} ${n.filed_by.last_name||""}`.trim():""),S=String(n?.noted_by||"").trim(),F=n?.approver?`${n.approver.first_name||""} ${n.approver.last_name||""}`.trim():"";W(i,{startY:m,theme:"grid",styles:{fontSize:9,cellPadding:10},headStyles:{fillColor:[241,245,249],textColor:20,fontStyle:"bold"},head:[["PREPARED BY:","NOTED BY:","RECOMMENDING APPROVAL:"]],body:[[O||" ",S||" ",F||" "],[{content:`APPROVED BY:


DR. MARY ANN R. ARAULA`,colSpan:3,styles:{halign:"center",fontStyle:"bold",cellPadding:{top:4,right:10,bottom:4,left:10}}}]],columnStyles:{0:{cellWidth:(u-f*2)/3},1:{cellWidth:(u-f*2)/3},2:{cellWidth:"auto"}},didParseCell:o=>{o.section==="body"&&o.row.index===0&&(o.cell.styles.halign="center",o.cell.styles.fontStyle="bold",o.cell.styles.cellPadding={top:16,right:10,bottom:4,left:10})},margin:{left:f,right:f}});const N=i.internal.pageSize.getHeight()-20;return i.setFontSize(8),i.setTextColor(120),i.text(`Generated on ${$e().format("YYYY-MM-DD HH:mm")} • ${window.location.origin}`,f,N),i}async function Zt(n){(await Ie(n)).save(`${n.reference_code||"Activity_Design"}.pdf`)}const ea={class:"flex items-center gap-2"},ta={class:"p-2 mb-4 rounded-xl border bg-white/60"},aa={class:"flex items-center gap-2 mb-2 text-gray-700"},na={class:"w-4 h-4",viewBox:"0 0 24 24"},la=["d"],ia={class:"grid grid-cols-1 md:grid-cols-6 gap-2 text-sm"},sa=["value"],ra=["value"],oa=["value"],da=["value"],ua={key:0,value:""},ca=["value"],ma={value:""},fa=["value"],pa={class:"md:col-span-1"},ya={class:"md:col-span-1"},_a={class:"flex items-center gap-2 md:col-span-2"},va={class:"flex flex-col gap-1"},ga={class:"text-xs"},ba={class:"inline-flex items-center gap-2 px-2 py-1 rounded bg-emerald-50 border border-emerald-200"},ha={class:"font-medium"},xa={class:"text-gray-600"},wa={class:"text-xs text-gray-700"},Sa={class:"font-medium"},Ca={class:"text-gray-500"},Aa={key:1,class:"text-gray-400 text-xs"},Ea={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30"},ka={class:"bg-white w-[560px] rounded-xl shadow p-4"},Fa={class:"flex items-center justify-between mb-2"},$a={class:"grid grid-cols-1 gap-2 text-sm"},Ra={class:"flex gap-2"},Ta={class:"text-[11px] text-gray-600"},Ia={class:"mt-3 flex justify-end gap-2"},Xa={__name:"ActivityDesignsPage",setup(n){const i=Re(),u=Ye(),f=mt(),m=je(),{isClub:A,activeClubId:h,withClub:O}=ft(),S=L(()=>{const l=u.user?.last_name||"",e=(u.user?.first_name||"").slice(0,1);return`${l}${l?", ":""}${e?e+".":""}`}),F=l=>{try{return((Array.isArray(l)?l:JSON.parse(l||"[]")||[])||[]).map(t=>(!t||typeof t!="object"||Array.isArray(t.read_by)||(t.read_by=t.user_id!=null?[t.user_id]:[]),t))}catch{return[]}},N={range:!0,partialRange:!0,multiCalendars:2,modelType:"yyyy-MM-dd",enableTimePicker:!1,autoApply:!0,clearable:!0},o=k({page:1,limit:10,sort:"created_at",order:"DESC",q:"",status:"",nature_of_activity:"",school_year:"",semester:"",club_id:"",filed_by_user_id:"",date_filed_from:"",date_filed_to:"",impl_from:"",impl_to:""}),U=L({get:()=>{const{date_filed_from:l,date_filed_to:e}=o.value;return l||e?[l||null,e||null]:null},set:l=>{if(!l)o.value.date_filed_from=null,o.value.date_filed_to=null;else{const[e,t]=l;o.value.date_filed_from=e||null,o.value.date_filed_to=t||null}}}),$=L({get:()=>{const{impl_from:l,impl_to:e}=o.value;return l||e?[l||null,e||null]:null},set:l=>{if(!l)o.value.impl_from=null,o.value.impl_to=null;else{const[e,t]=l;o.value.impl_from=e||null,o.value.impl_to=t||null}}}),B=["1st Semester","2nd Semester","Summer"],x=L(()=>{const l=new Date().getFullYear();return Array.from({length:6},(e,t)=>`${l-t}-${l-t+1}`)}),p=async(l={},e=!0)=>{o.value={...o.value,...l},typeof o.value.officer>"u"&&(o.value.officer=!0);const t=O({...o.value});["q","status","nature_of_activity","school_year","semester","club_id","filed_by_user_id","date_filed_from","date_filed_to","impl_from","impl_to"].forEach(c=>{(t[c]===""||t[c]==null)&&delete t[c]}),t.officer=o.value.officer,await i.fetchAll(t,e)};Me(async()=>{await Promise.all([p({page:1,limit:10,club_id:A?h:""}),f.fetchAll({page:1,limit:200,officer:!0},!0),m.fetchAll({page:1,limit:200},!0)])});const R=k([]);Fe(()=>o.value.club_id,async l=>{if(o.value.filed_by_user_id="",!l){R.value=[];return}try{await f.fetchById(l),R.value=Array.isArray(f.selectedClub?.users)?f.selectedClub.users:[]}catch{R.value=[]}});const j=L(()=>o.value.club_id?R.value:m.users.data||[]),T=L(()=>({total:i.items.total||0,totalPages:i.items.totalPages||1,currentPage:i.items.currentPage||1,pageSize:i.items.pageSize||10,data:i.items.data||[]})),D=["Curricular","Co-Curricular","Extra-Curricular"],P=["draft","pending","approved","rejected","cancelled"],H=l=>{switch(String(l||"").toLowerCase()){case"draft":return"gray";case"pending":return"amber";case"approved":return"emerald";case"rejected":return"red";case"cancelled":return"zinc";default:return"gray"}},ae=l=>{const e=Number(l);return Number.isFinite(e)?e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},oe=[{key:"reference_code",label:"Ref Code",sortable:!0,width:140},{key:"name_of_activity",label:"Activity",sortable:!0,minWidth:220},{key:"annual_plan_item",label:"Annual Plan / Item",sortable:!1,minWidth:260},{key:"club_id",label:"Club",sortable:!1,formatter:(l,e)=>e.club?e.club.name:""},{key:"semester",label:"Sem",sortable:!0,width:110},{key:"school_year",label:"S.Y.",sortable:!0,width:110},{key:"date_of_implementation",label:"Implementation",sortable:!0,width:140,formatter:l=>l?new Date(l).toLocaleDateString():"—"},{key:"status",label:"Status",sortable:!0,width:120}],de=async l=>{await p(l)},Q=k(!1),G=k(!1),X=k(null),ue=()=>{Q.value=!0},ne=l=>{if(!l)return null;if(typeof l=="object")return l;try{return JSON.parse(l)}catch{return null}},ce=async l=>{await i.create(l),Q.value=!1,await p({},!0)},ie=async l=>{await i.fetchById(l.id);const e=i.selected||l;X.value={id:e.id,date_filed:e.date_filed||"",semester:e.semester||"",office_department:e.office_department||"",school_year:e.school_year||"",name_of_activity:e.name_of_activity||"",venue:e.venue||"",date_of_implementation:e.date_of_implementation||"",proposed_budget:e.proposed_budget??"",participants:e.participants||"",nature_of_activity:e.nature_of_activity||"Curricular",rationale:e.rationale||"",objectives:e.objectives||"",details_of_activity:e.details_of_activity||"",budgetary_requirements:e.budgetary_requirements||"",file_by_user_name:e.file_by_user_name||"",filed_by_user_id:e.filed_by_user_id||"",club_id:e.club_id||"",status:e.status||"draft",remarks:e.remarks||"",annual_plan_id:e.annual_plan_id||"",annual_plan_item:ne(e.annual_plan_item)},G.value=!0},a=async l=>{const{id:e,...t}=l;await i.updateById(e,t),G.value=!1,await p({},!0)},d=async l=>{if(!l?.id)return;(await g.fire({title:`Delete "${l.name_of_activity}"?`,text:"This cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it",cancelButtonText:"Cancel"})).isConfirmed&&(await i.deleteById(l.id),await p({},!0),await g.fire("Deleted","The activity design has been deleted.","success"))},r=async l=>{await i.fetchById(l.id);const e=i.selected||l;X.value={...e,date_filed:e.date_filed?String(e.date_filed).slice(0,10):"",date_of_implementation:e.date_of_implementation?String(e.date_of_implementation).slice(0,10):"",annual_plan_id:e.annual_plan_id||"",annual_plan_item:ne(e.annual_plan_item)},G.value=!0},w=async l=>{if((await g.fire({title:"Submit for approval?",text:"You can no longer edit after submission.",icon:"question",showCancelButton:!0,confirmButtonText:"Submit",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1})).isConfirmed)try{const t=F(l.remarks);t.push({user_id:u.user?.id||null,user_name:S.value,message:`${S.value} submitted activity design.`,datetime:new Date().toISOString(),is_read:!1,read_by:[u.user?.id||null]}),await i.updateById(l.id,{remarks:JSON.stringify(t)}),await i.submit(l.id),await p({},!0),await g.fire("Submitted","Activity is now pending approval.","success")}catch{await g.fire("Error",i.error||"Failed to submit activity.","error")}},Z=async l=>{const e=await g.fire({title:"Approve activity?",input:"textarea",inputLabel:"Remarks (optional)",inputPlaceholder:"Add a note…",showCancelButton:!0,confirmButtonText:"Approve",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1});if(!e.isConfirmed)return;const t=e.value||"";try{const c=F(l.remarks);c.push({user_id:u.user?.id||null,user_name:S.value,message:`${S.value} approved activity design.${t?" - "+t:""}`,datetime:new Date().toISOString(),is_read:!1,read_by:[u.user?.id||null]}),await i.approve(l.id,JSON.stringify(c)),await p({},!0),await g.fire("Approved","Activity has been approved.","success")}catch{await g.fire("Error",i.error||"Failed to approve activity.","error")}},V=k(!1),J=k(null),C=k({from_email:"",from_name:"",to:"",subject:"",html:"",attachments:[]}),ye=async l=>{try{await i.fetchById(l.id);const e=i.selected||l,c=(await Ie(e)).output("datauristring"),le=String(c).split(",")[1]||"",Ue=`${e.reference_code||"Activity_Design"}.pdf`;J.value=e,C.value={from_email:"osas@knp.edu.ph",from_name:`${u.user?.first_name||""} ${u.user?.last_name||""}`.trim(),to:"",subject:`Activity Design ${e.reference_code||""} - ${e.name_of_activity||""}`.trim(),html:"Please see the attached file.",attachments:[{filename:Ue,content:le,type:"application/pdf"}]},V.value=!0}catch{await g.fire("Error",i.error||"Failed to prepare email.","error")}},Be=async()=>{const l=J.value;if(l)try{await i.sendEmail(l.id,{...C.value}),V.value=!1,await g.fire("Sent","Email sent successfully.","success")}catch{await g.fire("Error",i.error||"Failed to send email.","error")}},De=async l=>{const e=await g.fire({title:"Reject activity?",input:"textarea",inputLabel:"Reason (required)",inputPlaceholder:"State the reason…",inputValidator:c=>c?.trim()?void 0:"Reason is required",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Reject",cancelButtonText:"Cancel",allowOutsideClick:!1,allowEscapeKey:!1});if(!e.isConfirmed)return;const t=e.value;try{const c=F(l.remarks);c.push({user_id:u.user?.id||null,user_name:S.value,message:`${S.value} rejected activity design - ${t}.`,datetime:new Date().toISOString(),is_read:!1,read_by:[u.user?.id||null]}),await i.reject(l.id,JSON.stringify(c)),await p({},!0),await g.fire("Rejected","Activity has been rejected.","success")}catch{await g.fire("Error",i.error||"Failed to reject activity.","error")}},Oe=async l=>{const e=await g.fire({title:"Cancel activity?",input:"textarea",inputLabel:"Reason (required)",inputPlaceholder:"State the reason…",inputValidator:c=>c?.trim()?void 0:"Reason is required",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Cancel Activity",cancelButtonText:"Keep Activity",allowOutsideClick:!1,allowEscapeKey:!1});if(!e.isConfirmed)return;const t=e.value;try{const c=F(l.remarks);c.push({user_id:u.user?.id||null,user_name:S.value,message:`${S.value} cancelled activity design - ${t}.`,datetime:new Date().toISOString(),is_read:!1,read_by:[u.user?.id||null]}),await i.cancel(l.id,JSON.stringify(c)),await p({},!0),await g.fire("Cancelled","Activity has been cancelled.","success")}catch{await g.fire("Error",i.error||"Failed to cancel activity.","error")}},_e=async l=>{if(String(l?.status||"").toLowerCase()!=="approved"){await g.fire("Not allowed","Only approved activities can be printed.","info");return}try{await i.fetchById(l.id);const t=i.selected||l;await Zt(t)}catch(t){await g.fire("Error",i.error||"Failed to generate PDF.","error"),console.error(t)}},me=k(!1),ve=k(null),ge=async l=>{await i.fetchById(l.id),ve.value=i.selected||l,me.value=!0},fe=k(!1),I=k(null),be=async l=>{try{await i.fetchById(l.id),I.value=i.selected||l}catch{I.value=l}fe.value=!0},Pe=async l=>{if(!I.value)return;const e=F(I.value.remarks);e.push({user_id:u.user?.id||null,user_name:S.value,message:l?.message||"",datetime:l?.datetime||new Date().toISOString(),is_read:!1,read_by:[u.user?.id||null]});try{I.value.remarks=JSON.stringify(e)}catch{}try{await i.updateById(I.value.id,{remarks:JSON.stringify(e)}),await p({},!0)}catch{}},Ve=async()=>{if(!I.value)return;const l=u.user?.id||null,t=F(I.value.remarks).map(c=>{if(!c||c.user_id===l)return c;const le=Array.isArray(c.read_by)?c.read_by.slice():[];return le.includes(l)||le.push(l),{...c,read_by:le}});try{I.value.remarks=JSON.stringify(t)}catch{}try{await i.updateById(I.value.id,{remarks:JSON.stringify(t)}),await p({},!0)}catch{}},Ne=async()=>{await p({q:"",status:"",nature_of_activity:"",school_year:"",semester:"",club_id:"",filed_by_user_id:"",date_filed_from:"",date_filed_to:"",impl_from:"",impl_to:"",page:1})};return(l,e)=>(y(),_(M,null,[E(et,null,{default:z(()=>[E(tt,null,{default:z(()=>[b(i).error?(y(),pe(ot,{key:0,icon:b(at),color:"danger"},{default:z(()=>[te(v(b(i).error),1)]),_:1},8,["icon"])):K("",!0),E(rt,{icon:b(nt),title:"Activity Designs",main:""},{default:z(()=>[s("div",ea,[E(Ce,{icon:b(lt),color:"primary",label:"New Activity",onClick:ue},null,8,["icon"]),E(Ce,{icon:b(it),color:"info",label:"Refresh",onClick:e[0]||(e[0]=t=>p({},!0))},null,8,["icon"])])]),_:1},8,["icon"]),s("div",ta,[s("div",aa,[(y(),_("svg",na,[s("path",{d:b(st)},null,8,la)])),e[23]||(e[23]=s("span",{class:"font-medium text-sm"},"Filters",-1))]),s("div",ia,[Y(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>o.value.q=t),placeholder:"Search by ref, activity, venue, office…",class:"border rounded px-2 py-2 md:col-span-2",onKeyup:e[2]||(e[2]=Le(t=>p({page:1}),["enter"]))},null,544),[[se,o.value.q]]),Y(s("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.status=t),class:"border rounded px-2 py-2"},[e[24]||(e[24]=s("option",{value:""},"All status",-1)),(y(),_(M,null,q(P,t=>s("option",{key:t,value:t},v(t),9,sa)),64))],512),[[ee,o.value.status]]),Y(s("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.value.nature_of_activity=t),class:"border rounded px-2 py-2"},[e[25]||(e[25]=s("option",{value:""},"All natures",-1)),(y(),_(M,null,q(D,t=>s("option",{key:t,value:t},v(t),9,ra)),64))],512),[[ee,o.value.nature_of_activity]]),Y(s("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.school_year=t),class:"border rounded px-2 py-2 md:col-span-1"},[(y(!0),_(M,null,q(x.value,t=>(y(),_("option",{key:t,value:t},v(t),9,oa))),128))],512),[[ee,o.value.school_year]]),Y(s("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.semester=t),class:"border rounded px-2 py-2 md:col-span-1"},[e[26]||(e[26]=s("option",{disabled:"",value:""},"Select semester…",-1)),(y(),_(M,null,q(B,t=>s("option",{key:t,value:t},v(t),9,da)),64))],512),[[ee,o.value.semester]]),Y(s("select",{"onUpdate:modelValue":e[7]||(e[7]=t=>o.value.club_id=t),class:"border rounded px-2 py-2 md:col-span-2"},[b(u).user.role==="admin"?(y(),_("option",ua,"All clubs")):K("",!0),(y(!0),_(M,null,q(b(f).clubs.data||[],t=>(y(),_("option",{key:t.id,value:t.id},v(t.name),9,ca))),128))],512),[[ee,o.value.club_id]]),Y(s("select",{"onUpdate:modelValue":e[8]||(e[8]=t=>o.value.filed_by_user_id=t),class:"border rounded px-2 py-2 md:col-span-2"},[s("option",ma,v(o.value.club_id?"Filed by (club members)":"Filed by (any)"),1),(y(!0),_(M,null,q(j.value,t=>(y(),_("option",{key:t.id,value:t.id},v(t.first_name)+" "+v(t.last_name)+" (@"+v(t.username)+") ",9,fa))),128))],512),[[ee,o.value.filed_by_user_id]]),s("div",pa,[E(b(we),xe({modelValue:U.value,"onUpdate:modelValue":e[9]||(e[9]=t=>U.value=t)},N,{placeholder:"Filed date range"}),null,16,["modelValue"])]),s("div",ya,[E(b(we),xe({modelValue:$.value,"onUpdate:modelValue":e[10]||(e[10]=t=>$.value=t)},N,{placeholder:"Implementation date range"}),null,16,["modelValue"])]),s("div",_a,[s("button",{class:"px-4 py-2 bg-blue-600 text-white rounded text-xs",onClick:e[11]||(e[11]=t=>p({page:1}))}," Apply "),s("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:Ne}," Reset ")])])]),E(dt,{columns:oe,data:T.value,loading:b(i).isLoading,onQueryChange:de},{"cell-annual_plan_item":z(({row:t})=>[s("div",va,[t.annual_plan_id?(y(),_(M,{key:0},[s("div",ga,[s("span",ba,[s("span",ha,v(t.annual_plan?.reference_code||`AP-${t.annual_plan_id}`),1),s("span",xa,"SY "+v(t.annual_plan?.school_year||"—"),1)])]),s("div",wa,[s("span",Sa,v((()=>{try{const c=typeof t.annual_plan_item=="string"?JSON.parse(t.annual_plan_item||"null")||{}:t.annual_plan_item||{};return c.item||c.title||c.name||c.activity||"—"}catch{return"—"}})()),1),s("span",Ca," — ₱"+v((()=>{try{const c=typeof t.annual_plan_item=="string"?JSON.parse(t.annual_plan_item||"null")||{}:t.annual_plan_item||{};return ae(c.funds??c.budget??0)}catch{return ae(0)}})()),1)])],64)):(y(),_("span",Aa,"—"))])]),"cell-nature_of_activity":z(({value:t})=>[E(Ae,{text:t||"—",tone:"indigo"},null,8,["text"])]),"cell-status":z(({value:t})=>[E(Ae,{text:t||"—",tone:H(t)},null,8,["text","tone"])]),"cell-actions":z(({row:t})=>[["admin","manager"].includes(String(b(u).user?.role||"").toLowerCase())?(y(),pe(Se,{key:0,row:t,moderator:!0,"current-user-id":b(u).user?.id,onAttachments:ge,onSubmit:w,onApprove:Z,onReject:De,onEdit:ie,onDelete:d,onRemarks:be,onView:c=>r(t),onCancel:Oe,onPrint:_e,onEmail:ye},null,8,["row","current-user-id","onView"])):(y(),pe(Se,{key:1,row:t,moderator:!1,"current-user-id":b(u).user?.id,onAttachments:ge,onSubmit:w,onEdit:ie,onView:c=>r(t),onPrint:_e,onEmail:ye,onRemarks:be},null,8,["row","current-user-id","onView"]))]),_:1},8,["data","loading"])]),_:1})]),_:1}),E(Ee,{modelValue:Q.value,"onUpdate:modelValue":e[12]||(e[12]=t=>Q.value=t),mode:"create","locked-club-id":b(A)?b(h):"",onSubmit:ce},null,8,["modelValue","locked-club-id"]),E(Ee,{modelValue:G.value,"onUpdate:modelValue":e[13]||(e[13]=t=>G.value=t),mode:"edit",initial:X.value||{},onSubmit:a},null,8,["modelValue","initial"]),E(Lt,{modelValue:me.value,"onUpdate:modelValue":e[14]||(e[14]=t=>me.value=t),row:ve.value},null,8,["modelValue","row"]),E(ct,{modelValue:fe.value,"onUpdate:modelValue":e[15]||(e[15]=t=>fe.value=t),title:"Remarks • "+(I.value?.reference_code||I.value?.name_of_activity||"Item"),items:F(I.value?.remarks),"can-add":!0,onAdd:Pe,onMarkAllRead:Ve},null,8,["modelValue","title","items"]),V.value?(y(),_("div",Ea,[s("div",ka,[s("div",Fa,[e[27]||(e[27]=s("h3",{class:"text-base font-semibold"},"Send Email",-1)),s("button",{class:"px-2 py-1 text-xs bg-gray-200 rounded",onClick:e[16]||(e[16]=t=>V.value=!1)},"Close")]),s("div",$a,[s("div",null,[e[28]||(e[28]=s("label",{class:"block mb-0.5"},"To",-1)),s("div",Ra,[Y(s("input",{"onUpdate:modelValue":e[17]||(e[17]=t=>C.value.to=t),class:"flex-1 border rounded px-2 py-1.5",placeholder:"recipient@example.com"},null,512),[[se,C.value.to]]),s("button",{class:"px-2 py-1 text-[11px] rounded border bg-gray-50 hover:bg-gray-100",onClick:e[18]||(e[18]=()=>{const t=J.value?.filed_by_user_id||J.value?.filed_by?.id;t&&b(m).fetchById(t).then(()=>{const c=b(m).selectedUser?.email;c&&(C.value.to=c)})})},"Use Filer"),s("button",{class:"px-2 py-1 text-[11px] rounded border bg-rose-50 hover:bg-rose-100",onClick:e[19]||(e[19]=()=>{C.value.attachments=[]})},"Remove Attachment")])]),s("div",null,[e[29]||(e[29]=s("label",{class:"block mb-0.5"},"Subject",-1)),Y(s("input",{"onUpdate:modelValue":e[20]||(e[20]=t=>C.value.subject=t),class:"w-full border rounded px-2 py-1.5"},null,512),[[se,C.value.subject]])]),s("div",null,[e[30]||(e[30]=s("label",{class:"block mb-0.5"},"Message",-1)),Y(s("textarea",{"onUpdate:modelValue":e[21]||(e[21]=t=>C.value.html=t),rows:"4",class:"w-full border rounded px-2 py-1.5"},null,512),[[se,C.value.html]])]),s("div",Ta,"Attachment: "+v(C.value.attachments?.[0]?.filename||"activity.pdf"),1)]),s("div",Ia,[s("button",{class:"px-3 py-1.5 text-xs bg-gray-200 rounded",onClick:e[22]||(e[22]=t=>V.value=!1)},"Cancel"),s("button",{class:"px-3 py-1.5 text-xs bg-emerald-600 text-white rounded",onClick:Be},"Send")])])])):K("",!0)],64))}};export{Xa as default};
