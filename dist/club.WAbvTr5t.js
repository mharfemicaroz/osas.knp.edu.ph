import{M as d,N as U,r as v}from"./index.B-Q-J4WK.js";const c={async create(t){const{data:s}=await d.post("/clubs",t);return s},async getById(t){const{data:s}=await d.get(`/clubs/${t}`);return s},async updateById(t,s){const{data:u}=await d.put(`/clubs/${t}`,s);return u},async delete(t){const{data:s}=await d.delete(`/clubs/${t}`);return s},async list(t={}){const s={officer:!1,...t},{data:u}=await d.get("/clubs",{params:s});return u},async addUsers(t,s){const{data:u}=await d.post(`/clubs/${t}/users`,{userIds:s});return u},async removeUser(t,s){const{data:u}=await d.delete(`/clubs/${t}/users/${s}`);return u},async updateMember(t,s,u){const{data:i}=await d.patch(`/clubs/${t}/users/${s}`,u);return i?.data}},M=U("club",()=>{const t=v({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),s=v(!1),u=v(null),i=v(!1),n=v(null),y=l=>{if(!l?.id)return;const e=t.value.data.findIndex(a=>a.id===l.id);e!==-1&&(t.value.data[e]=l)},g=(l,e)=>{if(!e)return;if(n.value?.id===l&&Array.isArray(n.value.users)){const r=n.value.users.findIndex(o=>o.id===e.user_id);if(r!==-1){const o=n.value.users[r];n.value.users[r]={...o,UserClub:{...o.UserClub||{},...e}}}}const a=t.value.data.findIndex(r=>r.id===l);if(a!==-1&&Array.isArray(t.value.data[a].users)){const r=t.value.data[a].users,o=r.findIndex(f=>f.id===e.user_id);if(o!==-1){const f=r[o];r[o]={...f,UserClub:{...f.UserClub||{},...e}}}}},m=async(l={},e=!1)=>{if(u.value=null,!(!e&&i.value))try{s.value=!0;const a=await c.list(l);Object.assign(t.value,{total:a.total||0,totalPages:a.totalPages||1,currentPage:l.page||1,pageSize:l.limit||10,data:a.data||[]}),i.value=!0}catch(a){u.value=a?.response?.data?.message||a?.response?.message||a?.message||"Failed to fetch clubs"}finally{s.value=!1}},p=async l=>{u.value=null;try{s.value=!0;const e=await c.getById(l);n.value=e,y(e)}catch(e){u.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to fetch club"}finally{s.value=!1}},b=async l=>{u.value=null;try{s.value=!0;const e=await c.create(l);t.value.data.push(e),t.value.total+=1}catch(e){u.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to create club"}finally{s.value=!1}},w=async(l,e)=>{u.value=null;try{s.value=!0;const a=await c.updateById(l,e);y(a),n.value?.id===l&&(n.value=a)}catch(a){u.value=a?.response?.data?.message||a?.response?.message||a?.message||"Failed to update club"}finally{s.value=!1}},h=async l=>{u.value=null;try{s.value=!0,await c.delete(l),t.value.data=t.value.data.filter(e=>e.id!==l),t.value.total=Math.max(0,t.value.total-1),n.value?.id===l&&(n.value=null)}catch(e){u.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to delete club"}finally{s.value=!1}},x=async(l,e)=>{u.value=null;try{s.value=!0;const a=await c.addUsers(l,e);y(a),n.value?.id===l&&(n.value=a)}catch(a){u.value=a?.response?.data?.message||a?.response?.message||a?.message||"Failed to add users to club"}finally{s.value=!1}},I=async(l,e)=>{u.value=null;try{s.value=!0,await c.removeUser(l,e),n.value?.id===l&&Array.isArray(n.value.users)&&(n.value.users=n.value.users.filter(r=>r.id!==e));const a=t.value.data.findIndex(r=>r.id===l);a!==-1&&Array.isArray(t.value.data[a].users)&&(t.value.data[a].users=t.value.data[a].users.filter(r=>r.id!==e))}catch(a){u.value=a?.response?.data?.message||a?.response?.message||a?.message||"Failed to remove user from club"}finally{s.value=!1}};async function A(l,e,a){try{s.value=!0;const r=await c.updateMember(l,e,{status:a});return g(l,r),r}catch(r){throw u.value=r?.response?.data?.message||r?.response?.message||r?.message||"Failed to update member status",r}finally{s.value=!1}}async function F(l,e,a){try{s.value=!0;const r=await c.updateMember(l,e,{role:a});return g(l,r),r}catch(r){throw u.value=r?.response?.data?.message||r?.response?.message||r?.message||"Failed to update member role",r}finally{s.value=!1}}return{clubs:t,selectedClub:n,isLoading:s,error:u,isLoaded:i,fetchAll:m,fetchById:p,create:b,updateById:w,deleteById:h,addUsersToClub:x,removeUserFromClub:I,updateMemberRole:F,updateMemberStatus:A,resetStore:()=>{t.value={total:0,totalPages:1,currentPage:1,pageSize:10,data:[]},n.value=null,i.value=!1,s.value=!1,u.value=null}}});export{M as u};
