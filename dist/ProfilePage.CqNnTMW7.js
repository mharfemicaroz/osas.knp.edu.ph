import{u as te,z as le,c as m,s as ae,r as p,o as oe,x as T,A as re,l as R,q as a,f as ne,a as o,F as A,e,g as f,t as n,d as j,k as P,h as x,j as B,v as _,B as q,L as ie,S as g}from"./index.B2BJlPrj.js";import{a as de,c as ue}from"./imageCompression.CGjyEC1q.js";import{_ as ce,a as pe,a1 as ve,y as me,U as ge,a2 as fe,r as xe,Z as _e,a3 as ye,a4 as be}from"./SectionMain.s34g72MP.js";import{_ as he}from"./_plugin-vue_export-helper.DlAUqK2U.js";import"./appContext.CIeM8cBO.js";import"./activityDesignService.BcUtml_x.js";import"./utilizationRequestService.BKx4uH5b.js";import"./liquidationFundService.8vrYsrq0.js";import"./ToasterComponent.BcndTp7k.js";const we={key:0,class:"rounded-2xl border bg-white p-6 text-sm text-gray-500"},ke={class:"relative overflow-hidden rounded-2xl border bg-white shadow-sm"},Ce={class:"relative h-48 sm:h-80 md:h-[360px] w-full bg-gray-100 group overflow-hidden rounded-t-2xl"},Ue=["src"],je={key:1,class:"flex h-full w-full items-center justify-center bg-gradient-to-r from-indigo-50 to-blue-50 text-indigo-500"},Pe=["disabled"],Be=["disabled"],Se={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},Fe=["d"],Ae={class:"relative px-4 sm:px-6 pb-4 sm:pb-6"},Ne={class:"-mt-10 sm:-mt-12 flex flex-col sm:flex-row items-start sm:items-end gap-4"},Ve={class:"relative h-24 w-24 sm:h-28 sm:w-28 rounded-full border-4 border-white bg-gray-100 overflow-hidden shadow"},$e=["src"],Ie={key:1,class:"flex h-full w-full items-center justify-center bg-gray-200 text-gray-600 font-semibold"},Le=["title","disabled"],De={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},ze=["d"],Ee={class:"mt-2 sm:mt-11"},Ke={class:"text-xl font-semibold text-gray-900"},Me={class:"text-sm text-gray-500"},Oe={key:0,class:"mt-2 max-w-2xl text-sm text-gray-700 whitespace-pre-line"},Te={class:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6"},Re={class:"lg:col-span-2 space-y-6"},qe={class:"rounded-2xl border bg-white shadow-sm"},Ge={class:"border-b px-4 sm:px-6 py-3 flex items-center justify-between"},Ze={class:"text-sm font-semibold text-gray-800 inline-flex items-center gap-2"},He={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},Je=["d"],Qe={class:"px-4 sm:px-6 py-4"},We={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},Xe=["readonly"],Ye=["readonly"],es=["readonly"],ss={class:"sm:col-span-2"},ts=["readonly"],ls={key:0,class:"mt-4 flex justify-end"},as=["disabled"],os={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},rs=["d"],ns={class:"rounded-2xl border bg-white shadow-sm"},is={class:"border-b px-4 sm:px-6 py-3 flex items-center justify-between"},ds={class:"text-sm font-semibold text-gray-800 inline-flex items-center gap-2"},us={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},cs=["d"],ps={class:"text-xs text-gray-500"},vs={class:"p-4 sm:p-6"},ms={key:0,class:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4"},gs={key:1,class:"text-sm text-gray-500"},fs={key:2,class:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4"},xs=["title","onClick","onKeyup"],_s={class:"flex items-center gap-3"},ys={class:"h-10 w-10 rounded-lg bg-gray-100 overflow-hidden flex items-center justify-center text-xs font-semibold text-gray-600 shrink-0"},bs=["src"],hs={key:1},ws={class:"min-w-0"},ks={class:"truncate text-sm font-medium text-gray-900"},Cs={class:"truncate text-xs text-gray-500"},Us={class:"mt-3 flex items-center justify-between"},js={class:"inline-flex items-center rounded-full bg-indigo-50 px-2 py-[2px] text-[11px] text-indigo-700 ring-1 ring-indigo-200"},Ps={key:0,class:"inline-flex items-center rounded-full bg-gray-50 px-2 py-[2px] text-[11px] text-gray-700 ring-1 ring-gray-200"},Bs={class:"mt-2 text-[11px] text-gray-500 inline-flex items-center gap-1"},Ss={style:{width:"14px",height:"14px"},viewBox:"0 0 24 24"},Fs=["d"],As={class:"space-y-6"},Ns={key:0,class:"rounded-2xl border bg-white shadow-sm"},Vs={class:"border-b px-4 sm:px-6 py-3"},$s={class:"text-sm font-semibold text-gray-800 inline-flex items-center gap-2"},Is={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},Ls=["d"],Ds={class:"px-4 sm:px-6 py-4"},zs={class:"mt-4 flex justify-end"},Es=["disabled"],Ks={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},Ms=["d"],Os={class:"rounded-2xl border bg-white shadow-sm"},Ts={class:"p-4 sm:p-6 text-sm text-gray-700 space-y-2"},Rs={class:"flex items-center justify-between"},qs={class:"text-gray-500"},Gs={class:"flex items-center justify-between"},Zs={class:"text-gray-500"},Hs={class:"flex items-center justify-between"},Js={class:"text-gray-500"},Qs={__name:"ProfilePage",setup(Ws){const G=te(),d=le(),Z=ae(),y=m(()=>{const l=Z.params.id;return typeof l=="string"&&l.trim()?Number(l):null}),N=m(()=>G.user||{}),S=m(()=>N.value?.id||null),c=m(()=>y.value||S.value),r=m(()=>!!S.value&&S.value===c.value),F=p(!1),V=async()=>{if(c.value){F.value=!0;try{await d.fetchById(c.value),D(),await ee()}finally{F.value=!1}}};oe(V),T(()=>y.value,async()=>{await V()});const v=m(()=>{if(y.value){const l=d.selectedUser;return l&&l.id===y.value?l:null}return d.selectedUser||N.value||{}}),$=m(()=>v.value?.avatar||""),I=m(()=>v.value?.cover||""),L=m(()=>v.value?.bio||""),i=p({username:"",first_name:"",last_name:"",bio:""}),D=()=>{const l=y.value?d.selectedUser&&d.selectedUser.id===y.value?d.selectedUser:{}:v.value||{};Object.assign(i.value,{username:l.username||"",first_name:l.first_name||"",last_name:l.last_name||"",bio:l.bio||""})};T(v,D);const z=p(null),E=p(null),h=p(!1),w=p(!1),k=p(!1),b=p(!1),C=p(!1),u=p({old_password:"",new_password:"",confirm_password:""}),U=p([]),K=m(()=>{const l=i.value.first_name?.trim()||"",s=i.value.last_name?.trim()||"";return l||s?`${l} ${s}`.trim():v.value?.email||""}),M=l=>(l||"").split(" ").map(s=>s[0]).join("").slice(0,2).toUpperCase(),H=l=>{if(!l)return"—";const s=new Date(l);return isNaN(s)?"—":s.toLocaleDateString()},J=()=>{r.value&&z.value?.click()},Q=async l=>{const s=l.target.files?.[0];if(!(!s||!r.value||!c.value)){k.value=!0;try{const t=await ue(s);await d.uploadAvatar(c.value,t),g.fire("Updated","Profile photo updated!","success")}catch{g.fire("Upload failed",d.error||"Could not upload avatar","error")}finally{k.value=!1,l.target.value=""}}},W=async l=>{const s=l.target.files?.[0];if(!(!s||!r.value||!c.value)){b.value=!0;try{const t=await de(s);await d.uploadCover(c.value,t),g.fire("Updated","Cover photo updated!","success")}catch{g.fire("Upload failed",d.error||"Could not upload cover","error")}finally{b.value=!1,l.target.value=""}}},X=async()=>{if(!(!r.value||!c.value)){h.value=!0;try{await d.updateById(c.value,{username:i.value.username||null,first_name:i.value.first_name||null,last_name:i.value.last_name||null,bio:i.value.bio||null}),g.fire("Saved","Profile updated successfully","success")}catch{g.fire("Update failed",d.error||"Could not update profile","error")}finally{h.value=!1}}},Y=async()=>{if(r.value){if(!u.value.old_password||!u.value.new_password){g.fire("Missing fields","Please fill out both current and new password.","warning");return}if(u.value.new_password!==u.value.confirm_password){g.fire("Mismatch","New password and confirmation do not match.","warning");return}w.value=!0;try{await d.changePassword({old_password:u.value.old_password,new_password:u.value.new_password}),g.fire("Success","Password changed successfully","success"),Object.assign(u.value,{old_password:"",new_password:"",confirm_password:""})}catch{g.fire("Failed",d.error||"Could not change password","error")}finally{w.value=!1}}},ee=async()=>{if(c.value){C.value=!0;try{const l=await d.fetchUserClubs(c.value,{force:!0});U.value=(l||[]).map(s=>({id:s.id,name:s.name,code:s.code,logo:s.logo||s.logo_url||"",role:s.membership?.role||"member",status:s.membership?.status||"active",joined_at:s.membership?.joined_at||null,category:s.category||null}))}catch(l){console.error(l)}finally{C.value=!1}}},O=l=>{l&&window.open(`/#/club/${l}`,"_self")};return(l,s)=>(a(),re(ce,null,{default:R(()=>[ne(pe,null,{default:R(()=>[F.value||!v.value?(a(),o("div",we," Loading profile… ")):(a(),o(A,{key:1},[e("div",ke,[e("div",Ce,[I.value?(a(),o("img",{key:0,src:I.value,alt:"Cover",class:"h-full w-full object-cover",loading:"lazy"},null,8,Ue)):(a(),o("div",je,s[8]||(s[8]=[e("span",{class:"text-sm"},"No cover photo",-1)]))),e("input",{ref_key:"coverInput",ref:E,type:"file",accept:"image/*",class:"absolute inset-0 opacity-0 cursor-pointer",disabled:b.value||!r.value,onChange:W},null,40,Pe),e("button",{type:"button",class:"absolute right-3 bottom-3 inline-flex items-center gap-2 rounded-xl bg-white/90 px-3 py-1.5 text-xs shadow hover:bg-white z-10 disabled:opacity-60",disabled:b.value||!r.value,onClick:s[0]||(s[0]=t=>E.value?.click())},[(a(),o("svg",Se,[e("path",{d:f(ve)},null,8,Fe)])),e("span",null,n(b.value?"Uploading…":r.value?"Change cover":"Cover"),1)],8,Be),s[9]||(s[9]=e("div",{class:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"},null,-1))]),e("div",Ae,[e("div",Ne,[e("div",Ve,[$.value?(a(),o("img",{key:0,src:$.value,alt:"Avatar",class:"h-full w-full object-cover",loading:"lazy"},null,8,$e)):(a(),o("div",Ie,n(M(K.value)),1)),e("button",{type:"button",class:"absolute right-0 bottom-0 m-1 rounded-full bg-white p-1 shadow hover:bg-gray-50 disabled:opacity-60",title:k.value?"Uploading…":r.value?"Change photo":"View only",disabled:k.value||!r.value,onClick:J},[(a(),o("svg",De,[e("path",{d:f(me)},null,8,ze)]))],8,Le),e("input",{ref_key:"avatarInput",ref:z,type:"file",accept:"image/*",class:"hidden",onChange:Q},null,544)]),e("div",Ee,[e("div",Ke,n(K.value),1),e("div",Me,"@"+n(i.value.username||"username"),1),L.value?(a(),o("div",Oe,n(L.value),1)):j("",!0)])])])]),e("div",Te,[e("div",Re,[e("div",qe,[e("div",Ge,[e("h3",Ze,[(a(),o("svg",He,[e("path",{d:f(ge)},null,8,Je)])),P(" "+n(r.value?"Edit Profile":"Profile"),1)])]),e("div",Qe,[e("div",We,[e("div",null,[s[10]||(s[10]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Username",-1)),x(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>i.value.username=t),readonly:!r.value,class:B(["w-full rounded-lg border px-3 py-2 text-sm disabled:bg-gray-50",r.value?"":"bg-gray-50 text-gray-700"]),placeholder:"yourhandle"},null,10,Xe),[[_,i.value.username]])]),e("div",null,[s[11]||(s[11]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"First name",-1)),x(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>i.value.first_name=t),readonly:!r.value,class:B(["w-full rounded-lg border px-3 py-2 text-sm disabled:bg-gray-50",r.value?"":"bg-gray-50 text-gray-700"]),placeholder:"First name"},null,10,Ye),[[_,i.value.first_name]])]),e("div",null,[s[12]||(s[12]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Last name",-1)),x(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>i.value.last_name=t),readonly:!r.value,class:B(["w-full rounded-lg border px-3 py-2 text-sm disabled:bg-gray-50",r.value?"":"bg-gray-50 text-gray-700"]),placeholder:"Last name"},null,10,es),[[_,i.value.last_name]])]),e("div",ss,[s[13]||(s[13]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Bio",-1)),x(e("textarea",{"onUpdate:modelValue":s[4]||(s[4]=t=>i.value.bio=t),rows:"4",readonly:!r.value,class:B(["w-full rounded-lg border px-3 py-2 text-sm disabled:bg-gray-50",r.value?"":"bg-gray-50 text-gray-700"]),placeholder:"Tell us about yourself…"},null,10,ts),[[_,i.value.bio]])])]),r.value?(a(),o("div",ls,[e("button",{type:"button",class:"inline-flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-xs font-medium text-white hover:bg-blue-700 disabled:opacity-50",disabled:h.value,onClick:X},[(a(),o("svg",os,[e("path",{d:f(fe)},null,8,rs)])),e("span",null,n(h.value?"Saving…":"Save changes"),1)],8,as)])):j("",!0)])]),e("div",ns,[e("div",is,[e("h3",ds,[(a(),o("svg",us,[e("path",{d:f(xe)},null,8,cs)])),s[14]||(s[14]=P(" Clubs ",-1))]),e("div",ps,n(C.value?"Loading…":`${U.value.length} affiliation(s)`),1)]),e("div",vs,[C.value?(a(),o("div",ms,[(a(),o(A,null,q(6,t=>e("div",{key:t,class:"animate-pulse rounded-xl border p-4"},s[15]||(s[15]=[e("div",{class:"flex items-center gap-3"},[e("div",{class:"h-10 w-10 rounded-lg bg-gray-200"}),e("div",{class:"flex-1"},[e("div",{class:"h-3 w-2/3 bg-gray-200 rounded mb-2"}),e("div",{class:"h-3 w-1/3 bg-gray-100 rounded"})])],-1),e("div",{class:"mt-4 h-6 w-24 bg-gray-100 rounded"},null,-1)]))),64))])):U.value.length?(a(),o("div",fs,[(a(!0),o(A,null,q(U.value,t=>(a(),o("div",{key:t.id,class:"group rounded-xl border p-4 hover:shadow-sm transition bg-white cursor-pointer focus:outline-none focus:ring-2 focus:ring-indigo-300",role:"button",tabindex:"0",title:`Open ${t.name}`,onClick:se=>O(t.id),onKeyup:ie(se=>O(t.id),["enter"])},[e("div",_s,[e("div",ys,[t.logo?(a(),o("img",{key:0,src:t.logo,alt:"",class:"h-full w-full object-cover"},null,8,bs)):(a(),o("span",hs,n(M(t.name||t.code)),1))]),e("div",ws,[e("div",ks,n(t.name),1),e("div",Cs,"@"+n(t.code),1)])]),e("div",Us,[e("span",js,n(t.role||"member"),1),t.category?(a(),o("span",Ps,n(t.category),1)):j("",!0)]),e("div",Bs,[(a(),o("svg",Ss,[e("path",{d:f(_e)},null,8,Fs)])),P(" since "+n(H(t.joined_at)),1)])],40,xs))),128))])):(a(),o("div",gs," No clubs yet. "))])])]),e("div",As,[r.value?(a(),o("div",Ns,[e("div",Vs,[e("h3",$s,[(a(),o("svg",Is,[e("path",{d:f(ye)},null,8,Ls)])),s[16]||(s[16]=P(" Security ",-1))])]),e("div",Ds,[s[17]||(s[17]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Current password",-1)),x(e("input",{"onUpdate:modelValue":s[5]||(s[5]=t=>u.value.old_password=t),type:"password",class:"mb-3 w-full rounded-lg border px-3 py-2 text-sm",placeholder:"••••••••"},null,512),[[_,u.value.old_password]]),s[18]||(s[18]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"New password",-1)),x(e("input",{"onUpdate:modelValue":s[6]||(s[6]=t=>u.value.new_password=t),type:"password",class:"mb-3 w-full rounded-lg border px-3 py-2 text-sm",placeholder:"New password"},null,512),[[_,u.value.new_password]]),s[19]||(s[19]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Confirm new password",-1)),x(e("input",{"onUpdate:modelValue":s[7]||(s[7]=t=>u.value.confirm_password=t),type:"password",class:"w-full rounded-lg border px-3 py-2 text-sm",placeholder:"Confirm password"},null,512),[[_,u.value.confirm_password]]),e("div",zs,[e("button",{type:"button",class:"inline-flex items-center gap-2 rounded-lg bg-emerald-600 px-4 py-2 text-xs font-medium text-white hover:bg-emerald-700 disabled:opacity-50",disabled:w.value,onClick:Y},[(a(),o("svg",Ks,[e("path",{d:f(be)},null,8,Ms)])),e("span",null,n(w.value?"Updating…":"Update password"),1)],8,Es)])])])):j("",!0),e("div",Os,[s[23]||(s[23]=e("div",{class:"border-b px-4 sm:px-6 py-3"},[e("h3",{class:"text-sm font-semibold text-gray-800"},"Account")],-1)),e("div",Ts,[e("div",Rs,[s[20]||(s[20]=e("span",null,"Email",-1)),e("span",qs,n(v.value.email),1)]),e("div",Gs,[s[21]||(s[21]=e("span",null,"Role",-1)),e("span",Zs,n(v.value.role||"user"),1)]),e("div",Hs,[s[22]||(s[22]=e("span",null,"2FA",-1)),e("span",Js,n(v.value.twoFAEnabled?"Enabled":"Disabled"),1)])])])])])],64))]),_:1})]),_:1}))}},nt=he(Qs,[["__scopeId","data-v-a0cbf8f5"]]);export{nt as default};
