import{O as m,r as o}from"./index.B0nDbTtE.js";import{a as r}from"./activityDesignService.CP1gQRrR.js";const D=m("activityDesign",()=>{const u=o({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),s=o(!1),l=o(null),v=o(!1),n=o(null),d=o(new Set),g=a=>d.value.has(a),i=async(a,t)=>{a!=null&&d.value.add(a);try{return await t()}finally{a!=null&&d.value.delete(a)}},c=a=>{if(!a?.id)return;const t=u.value.data.findIndex(e=>e.id===a.id);t!==-1&&(u.value.data[t]=a)};return{items:u,selected:n,isActing:g,isLoading:s,error:l,isLoaded:v,fetchAll:async(a={},t=!1)=>{if(l.value=null,!(!t&&v.value))try{s.value=!0;const e=await r.list(a);Object.assign(u.value,{total:e.total||0,totalPages:e.totalPages||1,currentPage:a.page||1,pageSize:a.limit||10,data:e.data||[]}),v.value=!0}catch(e){l.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to fetch activity designs"}finally{s.value=!1}},fetchById:async a=>{l.value=null;try{s.value=!0;const t=await r.getById(a);n.value=t,c(t)}catch(t){l.value=t?.response?.data?.message||t?.response?.message||t?.message||"Failed to fetch activity design"}finally{s.value=!1}},create:async a=>{l.value=null;try{s.value=!0;const t=await r.create(a);return u.value.data.push(t),u.value.total+=1,t}catch(t){throw l.value=t?.response?.data?.message||t?.response?.message||t?.message||"Failed to create activity design",t}finally{s.value=!1}},updateById:async(a,t)=>{l.value=null;try{s.value=!0;const e=await i(a,()=>r.updateById(a,t));return c(e),n.value?.id===a&&(n.value=e),e}catch(e){throw l.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to update activity design",e}finally{s.value=!1}},deleteById:async a=>{l.value=null;try{s.value=!0,await i(a,()=>r.delete(a)),u.value.data=u.value.data.filter(t=>t.id!==a),u.value.total=Math.max(0,u.value.total-1),n.value?.id===a&&(n.value=null)}catch(t){l.value=t?.response?.data?.message||t?.response?.message||t?.message||"Failed to delete activity design"}finally{s.value=!1}},submit:async a=>{l.value=null;try{s.value=!0;const t=await i(a,()=>r.submit(a));return c(t),n.value?.id===a&&(n.value=t),t}catch(t){throw l.value=t?.response?.data?.message||t?.response?.message||t?.message||"Failed to submit activity design",t}finally{s.value=!1}},approve:async(a,t)=>{l.value=null;try{s.value=!0;const e=await i(a,()=>r.approve(a,{remarks:t}));return c(e),n.value?.id===a&&(n.value=e),e}catch(e){throw l.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to approve activity design",e}finally{s.value=!1}},reject:async(a,t)=>{l.value=null;try{s.value=!0;const e=await i(a,()=>r.reject(a,{remarks:t}));return c(e),n.value?.id===a&&(n.value=e),e}catch(e){throw l.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to reject activity design",e}finally{s.value=!1}},cancel:async(a,t)=>{l.value=null;try{s.value=!0;const e=await i(a,()=>r.cancel(a,{remarks:t}));return c(e),n.value?.id===a&&(n.value=e),e}catch(e){throw l.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to cancel activity design",e}finally{s.value=!1}},uploadAttachment:async(a,t)=>{l.value=null;try{s.value=!0;const e=await r.uploadAttachment(a,t);return c(e),n.value?.id===a&&(n.value=e),e}catch(e){throw l.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to upload attachment",e}finally{s.value=!1}},deleteAttachment:async(a,t)=>{l.value=null;try{s.value=!0;const e=await r.deleteAttachment(a,t);return c(e),n.value?.id===a&&(n.value=e),e}catch(e){throw l.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to delete attachment",e}finally{s.value=!1}},sendEmail:async(a,t)=>{l.value=null;try{return s.value=!0,await r.sendEmail(a,t)}catch(e){throw l.value=e?.response?.data?.message||e?.response?.message||e?.message||"Failed to send email",e}finally{s.value=!1}},resetStore:()=>{u.value={total:0,totalPages:1,currentPage:1,pageSize:10,data:[]},n.value=null,v.value=!1,s.value=!1,l.value=null}}});export{D as u};
