const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index.C20gUimh.js","./index.C8Co5cL2.css"])))=>i.map(i=>d[i]);
import{O as T,r as f,c as V,o as U,A as k,l as i,q as x,f as v,e as r,d as B,g as y,h as d,M as _,v as g,a as D,F as I,B as E,t as S,C as R,k as A,aa as O}from"./index.C20gUimh.js";import{ai as C,_ as q,a as M,M as N,L as K}from"./SectionMain.DOLbQH4J.js";import{_ as z,a as F}from"./SectionTitleLineWithButton.BFQQmMov.js";import{_ as j,B as H,a as Q}from"./Badge.C7tf28Bv.js";import"./appContext.7HuGpDYo.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";import"./activityDesignService.Bnn2Y4X2.js";import"./utilizationRequestService.BtvbPQF3.js";import"./liquidationFundService.CCvUFTja.js";import"./ToasterComponent.B8py6qzZ.js";const W=T("sessionLog",()=>{const b=f({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),s=f(!1),a=f(null),c=f(!1),o=f(null);return{items:b,selected:o,isLoading:s,isLoaded:c,error:a,fetchAll:async(p={},n=!1)=>{if(a.value=null,!(!n&&c.value))try{s.value=!0;const l=await C.list(p);Object.assign(b.value,{total:l.total||0,totalPages:l.totalPages||1,currentPage:p.page||1,pageSize:p.limit||10,data:l.data||[]}),c.value=!0}catch(l){a.value=l?.response?.data?.message||l?.response?.message||l?.message||"Failed to fetch session logs"}finally{s.value=!1}},fetchById:async p=>{a.value=null;try{s.value=!0;const n=await C.getById(p);return o.value=n,n}catch(n){throw a.value=n?.response?.data?.message||n?.response?.message||n?.message||"Failed to fetch session log",n}finally{s.value=!1}},resetStore:()=>{b.value={total:0,totalPages:1,currentPage:1,pageSize:10,data:[]},o.value=null,c.value=!1,s.value=!1,a.value=null}}}),G={class:"grid grid-cols-1 md:grid-cols-6 gap-2 mb-3 text-sm"},J=["value"],X=["title"],Y={class:"flex justify-end"},Z=["onClick"],pe={__name:"SessionLogsPage",setup(b){const s=W(),a=f({page:1,limit:10,q:"",method:"",status:"",user_id:"",user_role:"",ip:"",created_from:"",created_to:"",sort:"created_at",order:"DESC"}),c=V(()=>({total:s.items.total||0,totalPages:s.items.totalPages||1,currentPage:s.items.currentPage||1,pageSize:s.items.pageSize||10,data:s.items.data||[]})),o=async(l={},e=!0)=>{a.value={...a.value,...l};const t={...a.value};["q","method","status","user_id","user_role","ip","created_from","created_to","sort","order"].forEach(u=>{(t[u]===""||t[u]==null)&&delete t[u]}),await s.fetchAll(t,e)};U(async()=>{await o({page:1,limit:10})});const h=["GET","POST","PUT","DELETE","PATCH","OPTIONS","HEAD"],$=l=>{const e=Number(l||0);return e>=500?"red":e>=400?"amber":e>=300?"blue":"emerald"},P=[{key:"created_at",label:"Created",sortable:!0,width:170},{key:"request_id",label:"Request ID",sortable:!1,minWidth:140},{key:"method",label:"Method",sortable:!0,width:90},{key:"route",label:"Route",sortable:!1,minWidth:220},{key:"status",label:"Status",sortable:!0,width:100},{key:"response_time_ms",label:"Time (ms)",sortable:!0,width:110},{key:"user_id",label:"User",sortable:!0,width:90},{key:"user_role",label:"Role",sortable:!0,width:110},{key:"ip",label:"IP",sortable:!1,width:130}],p=async l=>{await s.fetchById(l.id);const e=s.selected||l,t=[["Created",e.created_at?new Date(e.created_at).toLocaleString():"-"],["Request ID",e.request_id||"-"],["User",e.user_id||"-"],["Role",e.user_role||"-"],["Method",e.method||"-"],["Route",e.route||"-"],["Status",e.status||"-"],["Response Time (ms)",e.response_time_ms??"-"],["IP",e.ip||"-"],["Origin",e.origin||"-"],["Referer",e.referer||"-"],["User Agent",e.user_agent||"-"]],u=m=>typeof m=="string"?m:JSON.stringify(m,null,2),L=`
    <div class="text-left text-sm">
      ${t.map(([m,w])=>`<div><strong>${m}:</strong> ${u(w)}</div>`).join("")}
      <div class="mt-2"><strong>Query:</strong><pre class="mt-1 p-2 bg-gray-50 rounded overflow-auto">${u(e.query||"{}")}</pre></div>
      <div class="mt-2"><strong>Body:</strong><pre class="mt-1 p-2 bg-gray-50 rounded overflow-auto">${u(e.body||"{}")}</pre></div>
    </div>`;await(await O(async()=>{const{default:m}=await import("./index.C20gUimh.js").then(w=>w.ah);return{default:m}},__vite__mapDeps([0,1]),import.meta.url)).default.fire({title:"Session Log",html:L,width:800,confirmButtonText:"Close"})},n=(l,e=80)=>{if(l==null)return"";const t=String(l);return t.length>e?t.slice(0,e-1)+"…":t};return(l,e)=>(x(),k(q,null,{default:i(()=>[v(M,null,{default:i(()=>[v(z,{icon:y(N),title:"Session Logs",main:""},{default:i(()=>[v(F,{icon:y(K),small:"",onClick:e[0]||(e[0]=t=>o({},!0))},null,8,["icon"])]),_:1},8,["icon"]),r("div",G,[d(r("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>a.value.q=t),class:"border rounded px-2 py-1.5",placeholder:"Search…",onKeyup:e[2]||(e[2]=_(t=>o({page:1}),["enter"]))},null,544),[[g,a.value.q]]),d(r("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.method=t),class:"border rounded px-2 py-1.5",onChange:e[4]||(e[4]=t=>o({page:1}))},[e[17]||(e[17]=r("option",{value:""},"Any method",-1)),(x(),D(I,null,E(h,t=>r("option",{key:t,value:t},S(t),9,J)),64))],544),[[R,a.value.method]]),d(r("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.status=t),class:"border rounded px-2 py-1.5",placeholder:"Status (e.g., 200)",onKeyup:e[6]||(e[6]=_(t=>o({page:1}),["enter"]))},null,544),[[g,a.value.status]]),d(r("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>a.value.user_id=t),class:"border rounded px-2 py-1.5",placeholder:"User ID",onKeyup:e[8]||(e[8]=_(t=>o({page:1}),["enter"]))},null,544),[[g,a.value.user_id]]),d(r("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>a.value.user_role=t),class:"border rounded px-2 py-1.5",placeholder:"User Role",onKeyup:e[10]||(e[10]=_(t=>o({page:1}),["enter"]))},null,544),[[g,a.value.user_role]]),d(r("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>a.value.ip=t),class:"border rounded px-2 py-1.5",placeholder:"IP",onKeyup:e[12]||(e[12]=_(t=>o({page:1}),["enter"]))},null,544),[[g,a.value.ip]]),d(r("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>a.value.created_from=t),type:"date",class:"border rounded px-2 py-1.5",onChange:e[14]||(e[14]=t=>o({page:1}))},null,544),[[g,a.value.created_from]]),d(r("input",{"onUpdate:modelValue":e[15]||(e[15]=t=>a.value.created_to=t),type:"date",class:"border rounded px-2 py-1.5",onChange:e[16]||(e[16]=t=>o({page:1}))},null,544),[[g,a.value.created_to]])]),y(s).error?(x(),k(j,{key:0,color:"danger"},{default:i(()=>[A(S(y(s).error),1)]),_:1})):B("",!0),v(H,{columns:P,data:c.value,loading:y(s).isLoading,onQueryChange:o},{"cell-created_at":i(({row:t})=>[r("span",null,S(t.created_at?new Date(t.created_at).toLocaleString():"-"),1)]),"cell-route":i(({row:t})=>[r("span",{title:t.route},S(n(t.route,80)),9,X)]),"cell-status":i(({row:t})=>[v(Q,{text:t.status,tone:$(t.status)},null,8,["text","tone"])]),"cell-actions":i(({row:t})=>[r("div",Y,[r("button",{class:"px-2 py-1 text-xs rounded bg-gray-200",onClick:u=>p(t)},"View",8,Z)])]),_:1},8,["data","loading"])]),_:1})]),_:1}))}};export{pe as default};
